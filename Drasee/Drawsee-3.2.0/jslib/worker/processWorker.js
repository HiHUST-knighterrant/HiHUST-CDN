var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),DrawseeProcess;(function(){function s(n,t,i){i.x=n.x+t.x;i.y=n.y+t.y;i.z=n.z+t.z}function k(n){var i=n.length,t=new Float32Array(i);return t.set(n,0),t}function e(n){var i=n.length,t=new Int32Array(i);return t.set(n,0),t}function nt(n){var t=it(n),i={type:n.type,results:t};postMessage(i,undefined,tt(t))}function tt(n){for(var i,t=[],r=0;r<n.length;r++)i=n[r].data,t.push(i.bounds),t.push(i.addrs),t.push(i.subs),t.push(i.entries),t.push(i.binderMin),t.push(i.binderMax),t.push(i.binderBoundsArray),t.push(i.triPointFloats);return t}function it(n){var r=[],i,t,o;try{for(i=n.tasks,t=0;t<i.length;t++){var f=i[t],s=f.data,e=void 0;e=new u(s);o=rt(e);r.push({id:f.id,data:o})}}catch(h){}return r}function rt(n){var r=g.Create(n,64,3),u=r.binder,t=new Float32Array(6),i=u.bounds;return t[0]=i.min.x,t[1]=i.min.y,t[2]=i.min.z,t[3]=i.max.x,t[4]=i.max.y,t[5]=i.max.z,new d(r.bounds,r.addrs,r.subs,r.entries,u.minArray,u.maxArray,t,n.data)}function st(n){new ot(n)}var o=function(){function n(){}return n.SetTimeDelta=function(t){n._DeltaMs=t},n.GetGlobalRelativeMs=function(){return performance.now()-this._StartMs+n._DeltaMs},n.GetRelativeMs=function(){return performance.now()-this._StartMs},n.Debug_TimeStamp=function(){return"time:"+(n.GetGlobalRelativeMs()*.001).toFixed(3)},n.WriteConsoleLine=function(t){a&&(t+=","+n.Debug_TimeStamp(),console.log(t))},n._DeltaMs=0,n._StartMs=performance.now(),n}(),n=function(){function n(n,t,i){this.x=n;this.y=t;this.z=i}return n.Zero=function(){return new n(0,0,0)},n.prototype.multiplyByFloats=function(t,i,r){return new n(this.x*t,this.y*i,this.z*r)},n}(),r=function(){function t(t,i){t===void 0&&(t=n.Zero());i===void 0&&(i=n.Zero());this.min=t;this.max=i}return t.prototype.contains=function(n){return n.x>=this.min.x&&n.x<=this.max.x&&n.y>=this.min.y&&n.y<=this.max.y&&n.z>=this.min.z&&n.z<=this.max.z},t.IntersectsMinMax=function(n,t,i,r){var u=i.x,f=i.y,e=i.z,o=r.x,s=r.y,h=r.z,c=n.x,l=n.y,a=n.z,v=t.x,y=t.y,p=t.z;return o<c||u>v?!1:s<l||f>y?!1:h<a||e>p?!1:!0},t.Intersects=function(n,i){return t.IntersectsMinMax(n.min,n.max,i.min,i.max)},t.CalcRangeFromArray=function(i){var l;if(!i||i.length<=0)return new t(n.Zero(),n.Zero());var r=0,u=0,s=u=r=17976931348623157e292,f=0,e=0,h=e=f=-17976931348623157e292,c=i.data,p=i.length,o=0;for(l=0;l<p;l++){var a=c[o],v=c[o+1],y=c[o+2];s=Math.min(s,a);u=Math.min(u,v);r=Math.min(r,y);h=Math.max(h,a);e=Math.max(e,v);f=Math.max(f,y);o+=3}return new t(new n(s,u,r),new n(h,e,f))},t}(),y=function(){function n(n,t){this._strideSize=0;this._length=0;this._strideSize=t;this._length=Math.floor(n.length/this._strideSize);this._data=n}return Object.defineProperty(n.prototype,"length",{get:function(){return this._length},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),n.prototype.getAt=function(n){return this.getElemAt(n*this._strideSize)},n.prototype.getToRef=function(n,t){return this.elemToRef(n*this._strideSize,t)},n.prototype.setAt=function(n,t){this.setElemAt(n*this._strideSize,t)},n.prototype.getElemAt=function(){return null},n.prototype.elemToRef=function(){},n.prototype.setElemAt=function(){},n.prototype.toElementArray=function(){var t=[],i,n;if(this._data)for(i=this.length,n=0;n<i;n++)t.push(this.getAt(n));return t},n}(),u=function(t){function i(n){return t.call(this,n,3)||this}return __extends(i,t),i.Create=function(n){return new i(new Float32Array(n*3))},i.prototype.clone=function(){return new i(new Float32Array(this._data.buffer.slice(0)))},i.prototype.getElemAt=function(t){return new n(this._data[t],this._data[t+1],this._data[t+2])},i.prototype.setElemAt=function(n,t){this._data[n]=t.x;this._data[n+1]=t.y;this._data[n+2]=t.z},i.prototype.elemToRef=function(n,t){t.x=this._data[n];t.y=this._data[n+1];t.z=this._data[n+2]},i}(y),f=function(){function n(){}return n.Vector3ToFloat=function(n){for(var r,u,f=n.length,t=new Float32Array(f*3),i=0;i<f;i++)r=i*3,u=n[i],t[r]=u.x,t[r+1]=u.y,t[r+2]=u.z;return t},n.JoinFloat32Arrays=function(n){var i,r,u,t,f;if(n.length===1)return n[0];for(i=0,t=0;t<n.length;t++)i+=n[t].length;for(r=new Float32Array(i),u=0,t=0;t<n.length;t++)f=n[t],r.set(f,u),u+=f.length;return r},n.JoinInt32Arrays=function(n){var i,r,u,t,f;if(n.length===1)return n[0];for(i=0,t=0;t<n.length;t++)i+=n[t].length;for(r=new Int32Array(i),u=0,t=0;t<n.length;t++)f=n[t],r.set(f,u),u+=f.length;return r},n.JoinNumberArrays=function(n){var r,f,t,u,i;if(n.length===1)return n[0];for(r=[],f=0,t=0;t<n.length;t++)for(u=n[t],i=0;i<u.length;i++)r.push(u[i]);return r},n.AddIntValue=function(n,t){for(var i=0;i<n.length;i++)n[i]+=t},n.CreateJoinTriangleIndiceArrays=function(n){for(var u,i,r,f=0,t=0;t<n.length;t++)f+=n[t].length;for(u=new Int32Array(f),i=0,t=0;t<n.length;t++)r=n[t].slice(0),this.AddIntValue(r,i/3),u.set(r,i),i+=r.length;return u},n.GetTrianglePointsDirect=function(n,t,i,r){var c;r===void 0&&(r=0);var l=Math.floor(t.length/3),h=0,e,o,s,f=r;for(c=0;c<l;c++){var a=t[h],v=t[h+1],y=t[h+2],u=a*3;e=n[u];o=n[u+1];s=n[u+2];i[f++]=e;i[f++]=o;i[f++]=s;u=v*3;e=n[u];o=n[u+1];s=n[u+2];i[f++]=e;i[f++]=o;i[f++]=s;u=y*3;e=n[u];o=n[u+1];s=n[u+2];i[f++]=e;i[f++]=o;i[f++]=s;h=h+3}},n}(),t=function(){function n(n){n===void 0&&(n="");this.message=n}return n.prototype.toString=function(){return"Exception: "+this.message},n}(),p=function(){function n(){}return Object.defineProperty(n.prototype,"position",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"length",{get:function(){return 0},enumerable:!1,configurable:!0}),n.prototype.toArray=function(){return null},n.prototype.readByte=function(){return 0},n.prototype.readBytes=function(){return null},n}(),w=function(n){function t(t){var i=n.call(this)||this;return i._i=0,i._d=t,i}return __extends(t,n),Object.defineProperty(t.prototype,"position",{get:function(){return this._i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._d.length},enumerable:!1,configurable:!0}),t.prototype.toArray=function(){return this._d},t.prototype.readByte=function(){return this._i<this._d.length?this._d[this._i++]:-1},t.prototype.readBytes=function(n){var t;n=Math.min(n,this._d.length-this._i);var i=new Uint8Array(n),r=this._d,u=this._i;for(t=0;t<n;t++)i[t]=r[u++];return this._i+=n,i},t}(p),b=function(){function n(n){this._l=0;this._i=0;this._bv=new Uint8Array(8);this._i32=new Int32Array(this._bv.buffer);this._i16=new Int16Array(this._bv.buffer);this._fV=new Float32Array(this._bv.buffer);this._dV=new Float64Array(this._bv.buffer);this.baseStream=n;this._d=n.toArray();this._l=this._d.length}return n.prototype.isEof=function(){return this._i>=this._l},n.prototype.readInt32=function(){var n;if(this._i>=this._l)throw new t("out of total length");var r=this._bv,u=this._d,i=this._i;for(n=0;n<4;n++)r[n]=u[i++];return this._i=i,this._i32[0]},n.prototype.readInt16=function(){var n;if(this._i>=this._l)throw new t("out of total length");var r=this._bv,u=this._d,i=this._i;for(n=0;n<2;n++)r[n]=u[i++];return this._i=i,this._i16[0]},n.prototype.readSingle=function(){var n;if(this._i>=this._l)throw new t("out of total length");var r=this._bv,u=this._d,i=this._i;for(n=0;n<4;n++)r[n]=u[i++];return this._i=i,this._fV[0]},n.prototype.readDouble=function(){var n;if(this._i>=this._l)throw new t("out of total length");var r=this._bv,u=this._d,i=this._i;for(n=0;n<8;n++)r[n]=u[i++];return this._i=i,this._dV[0]},n.prototype.readByte=function(){if(this._i>=this._l)throw new t("out of total length");return this._d[this._i++]},n.prototype.read=function(n,i,r){var f,e,o,u;if(this._i>=this._l)throw new t("out of total length");for(r=Math.min(r,this._d.length-this._i),f=this._i,this._i+=r,e=n,o=this._d,u=0;u<r;u++)e[u+i]=o[f+u]},n.prototype.readBytes=function(n){var r,u,f,i;if(this._i>=this._l)throw new t("out of total length");if(n=Math.min(n,this._d.length-this._i),r=this._i,this._i+=n,this._canSlice===undefined&&(this._canSlice=this._d.buffer&&this._d.buffer.slice!==undefined),n>32&&this._canSlice)return new Uint8Array(this._d.buffer.slice(r,r+n));for(u=new Uint8Array(n),f=this._d,i=0;i<n;i++)u[i]=f[r+i];return u},n.prototype.readBytesToEnd=function(){return this.readBytes(this._l-this._i)},n.prototype.close=function(){},n}(),ht=function(n){function t(t){return n.call(this,new w(t))||this}return __extends(t,n),t.prototype.readFloats=function(n){var t=this.readBytes(n*4);return new Float32Array(t.buffer)},t.prototype.readInt32s=function(n){var t=this.readBytes(n*4);return new Int32Array(t.buffer)},t}(b),h=function(){function t(){this._b=new r}return t.Create=function(n,i,r){var u=new t;return u._bounds=n,u._min=i,u._max=r,u._count=Math.floor(i.length/12),u},t.CreateFromPoints=function(n){var i=new t;return i.prepareVs(n),i},Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bounds",{get:function(){return this._bounds},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minArray",{get:function(){return this._min},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxArray",{get:function(){return this._max},enumerable:!1,configurable:!0}),t.prototype.prepareVs=function(t){var y,o,s;this._bounds=r.CalcRangeFromArray(t);y=t.data;o=Math.floor(t.length/3);this._count=o;var a=u.Create(o),v=u.Create(o),i=n.Zero(),f=n.Zero(),e=n.Zero(),h=n.Zero(),c=n.Zero(),l=0;for(s=0;s<o;s++)t.getToRef(l,i),t.getToRef(l+1,f),t.getToRef(l+2,e),h.x=Math.min(Math.min(i.x,f.x),e.x),h.y=Math.min(Math.min(i.y,f.y),e.y),h.z=Math.min(Math.min(i.z,f.z),e.z),c.x=Math.max(Math.max(i.x,f.x),e.x),c.y=Math.max(Math.max(i.y,f.y),e.y),c.z=Math.max(Math.max(i.z,f.z),e.z),a.setAt(s,h),v.setAt(s,c),l+=3;this._min=a.data;this._max=v.data},t.prototype.triBounds=function(n){var u=this._b,t=n*3,f=u.min,e=this._min,i,r;return f.x=e[t],f.y=e[t+1],f.z=e[t+2],i=u.max,r=this._max,i.x=r[t],i.y=r[t+1],i.z=r[t+2],u},t}(),c=function(){function n(n,t,i,r){this.binder=n;this.total=t;this.capacity=i;this.maxDepth=r}return n}(),l=function(){function t(n,t,i,r,u,f){r===void 0&&(r=[]);u===void 0&&(u=null);f===void 0&&(f=0);this.min=n;this.max=t;this.depth=i;this.entries=r;this.subs=u;this.count=f;this.no=0}return t.prototype.addEntries=function(n,t){for(var i=0;i<t.length;i++)this.addEntry(n,t[i])},t.prototype.addEntry=function(n,t){var e=n.binder.triBounds(t),i,o,u,f;if(r.IntersectsMinMax(this.min,this.max,e.min,e.max))if(this.count++,i=this.subs,i)for(o=i.length,u=0;u<o;u++)i[u].addEntry(n,t);else f=this.entries,f.push(t),f.length>n.capacity&&this.depth<n.maxDepth&&this.splitBlocks(n)},t.prototype.splitBlocks=function(i){var f,e,r,o,h,l;this.subs=[];var u=this.min,c=this.max,a=new n((c.x-u.x)*.5,(c.y-u.y)*.5,(c.z-u.z)*.5),v=this.subs,y=this.entries;for(f=0;f<2;f++)for(e=0;e<2;e++)for(r=0;r<2;r=r+1)o=a.multiplyByFloats(f,e,r),s(u,o,o),h=a.multiplyByFloats(f+1,e+1,r+1),s(u,h,h),l=new t(o,h,this.depth+1),l.addEntries(i,y),v.push(l),i.total++;this.entries.length=0},t.prototype.enumSubBlocks=function(n){var t,i;if(n.push(this),t=this.subs,t)for(i=0;i<t.length;i++)t[i].enumSubBlocks(n)},t.prototype.select=function(n,t,i){this.selectRecursive(n,t,i)},t.prototype.selectRecursive=function(n,t,i){var u,e,r,f,o;if(t.intersects(this.min,this.max))if(u=this.subs,u&&u.length>0)for(r=0;r<u.length;r++)u[r].selectRecursive(n,t,i);else for(e=this.entries,r=0;r<e.length;r++)f=e[r],t.intersectsEntry(n,f)&&(o=n.triBounds(f),i.push(f))},t}(),ct=function(){function n(){}return Object.defineProperty(n.prototype,"root",{get:function(){return this._root},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"count",{get:function(){return this._root.count},enumerable:!1,configurable:!0}),n.Create=function(t,i,r){var f;i===void 0&&(i=64);r===void 0&&(r=2);var e=new n,u=h.CreateFromPoints(t),o=new l(u.bounds.min,u.bounds.max,0),a=new c(u,0,i,r),s=[];for(f=0;f<u.count;f++)s.push(f);return o.addEntries(a,s),e._binder=u,e._root=o,e},n.prototype.select=function(n){var t=[];return this._root.select(this._binder,n,t),t},n}(),d=function(){function n(n,t,i,r,u,f,e,o){this.bounds=n;this.addrs=t;this.subs=i;this.entries=r;this.binderMin=u;this.binderMax=f;this.binderBoundsArray=e;this.triPointFloats=o}return n}(),g=function(){function t(t,i,r,u,f){this.binder=t;this.bounds=i;this.addrs=r;this.subs=u;this.entries=f;this._min=n.Zero();this._max=n.Zero()}return t.prototype.bindBounds=function(n){var t=this.bounds,i=n*6,r=this._min,u=this._max;r.x=t[i];r.y=t[i+1];r.z=t[i+2];u.x=t[i+3];u.y=t[i+4];u.z=t[i+5]},t.prototype.select=function(n){var t=[];return this.selectInner(this.binder,0,n,t),t},t.prototype.selectInner=function(n,t,i,r){var f,e,h,o,c,u,s;if(this.bindBounds(t),i.intersects(this._min,this._max))if(f=this.addrs[t],f>0)for(e=f-1,h=this.subs[e],u=0;u<h;u++)this.selectInner(n,this.subs[e+u+1],i,r);else for(o=-(f+1),c=this.entries[o],u=0;u<c;u++)s=this.entries[o+u+1],i.intersectsEntry(n,s)&&r.push(s)},t.Create=function(n,i,r){var f;i===void 0&&(i=64);r===void 0&&(r=2);var u=h.CreateFromPoints(n),e=new l(u.bounds.min,u.bounds.max,0),s=new c(u,0,i,r),o=[];for(f=0;f<u.count;f++)o.push(f);return e.addEntries(s,o),t.CreateFromBlock(u,e)},t.CreateFromBlock=function(n,i){var h=[],a,u,r,s,y,p,f;for(i.enumSubBlocks(h),a=h.length,u=0;u<a;u++)r=h[u],r.no=u;var o=[],v=[],c=[],l=[];for(u=0;u<a;u++)if(r=h[u],o.push(r.min.x),o.push(r.min.y),o.push(r.min.z),o.push(r.max.x),o.push(r.max.y),o.push(r.max.z),s=r.subs,s&&s.length>0)for(v.push(c.length+1),c.push(s.length),f=0;f<s.length;f++)c.push(s[f].no);else for(v.push(-(l.length+1)),y=r.entries.length,p=r.entries,l.push(y),f=0;f<y;f++)l.push(p[f]);return new t(n,k(o),e(v),e(c),e(l))},t}(),i,a,v;(function(n){n[n.TileMesh=1]="TileMesh";n[n.Octree=2]="Octree"})(i||(i={}));var lt=function(){function n(){this.textureBytes=[];this.vertexesArray=[];this.normalsArray=[];this.textureCoordsArray=[];this.indicesArray=[]}return n.prototype.getTransferObjects=function(){for(var t=[],n=0;n<this.textureBytes.length;n++)this.textureBytes[n]&&t.push(this.textureBytes[n].buffer);for(n=0;n<this.normalsArray.length;n++)this.normalsArray[n]&&t.push(this.normalsArray[n].buffer);for(n=0;n<this.vertexesArray.length;n++)this.vertexesArray[n]&&t.push(this.vertexesArray[n].buffer);for(n=0;n<this.textureCoordsArray.length;n++)this.textureCoordsArray[n]&&t.push(this.textureCoordsArray[n].buffer);for(n=0;n<this.indicesArray.length;n++)this.indicesArray[n]&&t.push(this.indicesArray[n].buffer);return t},n}(),ut=function(){function n(){this.imageBitmaps=[];this.boundsArray=[]}return n.prototype.getTransferObjects=function(){for(var n=[],t=0;t<this.imageBitmaps.length;t++)n.push(this.imageBitmaps[t]);return this.triPoints&&n.push(this.triPoints.buffer),this.vertexBuffer&&n.push(this.vertexBuffer.buffer),this.indiceBuffer&&n.push(this.indiceBuffer.buffer),n},n.Dispose=function(n){for(var t=0;t<n.imageBitmaps.length;t++)n.imageBitmaps[t].close();n.imageBitmaps=null;n.vertexBuffer=null;n.indiceBuffer=null;n.triPoints=null;n.boundsArray=null},n}(),ft=function(){function n(){}return n.ProcessVertexBufferAndTriPoints=function(t){var i=new ut;return t.isNeedTriPoints&&(i.triPoints=n.GetTrianglePoints(t.vertexesArray,t.indicesArray)),t.isNeedBounds&&(i.boundsArray=n.CalcSubMeshRange(t.vertexesArray)),n.CreateMergedVertexBufferData(t,i),i},n.CreateMergedVertexBufferData=function(t,i){for(var c,u=[],e=[],o=0,r=0;r<t.vertexesArray.length;r++){var s=t.vertexesArray[r],l=t.normalsArray[r],a=t.textureCoordsArray[r],h=t.indicesArray[r],v=n.PrepareVertexPositionNormalTextureBufferData(s,l,a,!0);u.push(v);r>0&&f.AddIntValue(h,o);e.push(h);c=Math.floor(s.length/3);o+=c}i.vertexBuffer=f.JoinFloat32Arrays(u);i.indiceBuffer=f.JoinInt32Arrays(e)},n.PrepareVertexPositionNormalTextureBufferData=function(n,t,i,r){var s;r===void 0&&(r=!1);var h=Math.floor(n.length/3),u=new Float32Array(8*h),f=0,e=0,o=0;for(s=0;s<h;s++)u[f]=n[e],u[f+1]=n[e+1],u[f+2]=n[e+2],t?(u[f+3]=t[e],u[f+4]=t[e+1],u[f+5]=t[e+2]):r&&(u[f+3]=n[e],u[f+4]=n[e+1],u[f+5]=n[e+2]),u[f+6]=i[o],u[f+7]=i[o+1],f+=8,e+=3,o+=2;return u},n.GetTrianglePoints=function(n,t){for(var r,u,e,o=n.length,s=0,i=0;i<o;i++)s+=t[i].length;for(r=new Float32Array(s*3),u=0,i=0;i<o;i++)e=t[i],f.GetTrianglePointsDirect(n[i],e,r,u),u+=e.length*3;return r},n.CalcSubMeshRange=function(n){for(var i=[],t=0;t<n.length;t++)i.push(r.CalcRangeFromArray(new u(n[t])));return i},n}(),et=function(){function n(){this._offset=0}return n.prototype.readUint16=function(n){var t=n[this._offset]<<8|n[this._offset+1];return this._offset+=2,t},n.prototype.readDataBlock=function(n){var i=this.readUint16(n),t=n.subarray(this._offset,this._offset+i-2);return this._offset+=t.length,t},n.prototype.getJpegSize=function(n){var t,u,r,i;this._offset=0;try{if(t=this.readUint16(n),t!=65496)throw new Error("SOI not found");for(t=this.readUint16(n);t!=65497;){switch(t){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:u=this.readDataBlock(n);break;case 65499:r=this.readUint16(n);this._offset+=r-2;break;case 65472:case 65473:case 65474:this.readUint16(n);var o=n[this._offset++],f=this.readUint16(n),e=this.readUint16(n);return{width:e,height:f};case 65500:this.readUint16(n);this.readUint16(n);break;case 65535:n[this._offset]!==255&&this._offset--;break;default:if(n[this._offset-3]==255&&n[this._offset-2]>=192&&n[this._offset-2]<=254){this._offset-=3;break}else if((t===224||t==225)&&(i=this.readUint16(n),n[this._offset+i-2]===255)){this._offset+=i-2;break}throw new Error("unknown JPEG marker "+t.toString(16));}t=this.readUint16(n)}}catch(s){}return null},n}(),ot=function(){function n(n){this.commitProcess(n)}return n.prototype.commitProcess=function(n){for(var r=n.tasks,u=function(n){var t=r[n];f.commitOneTileMeshTask(t).then(function(n){var r,u,f;n&&(r=[],n.name=t.data.name,u={id:t.id,data:n},r.push(u),f={type:i.TileMesh,results:r},postMessage(f,undefined,n.getTransferObjects()))})},f=this,t=0;t<r.length;t++)u(t)},n.prototype.commitOneTileMeshTask=function(n){var t=this;return new Promise(function(i){t.decodeImagesAndResize(n.data).then(function(t){try{var r=ft.ProcessVertexBufferAndTriPoints(n.data);r.imageBitmaps=t;i(r)}catch(u){i(null)}})})},n.prototype.decodeImagesAndResize=function(n){var t=this;return new Promise(function(i){for(var f=n.textureBytes,r=[],o=f.length,u=0,s={},h=function(e){var l=f[e],y=new Blob([l]),h,a,v,c;n.minStartSize&&n.scaleRatio&&(h=t.getImageSize(l),h&&(h.width>n.minStartSize||h.height>n.minStartSize)&&(a=h.width*n.scaleRatio,v=h.height*n.scaleRatio,s={resizeWidth:a,resizeHeight:v}));c=createImageBitmap(y,s);c.then(function(n){u++;r[e]=n;u===o&&i(r)});c.catch(function(){u++;r[e]=null;u===o&&i(r)})},e=0;e<f.length;e++)h(e)})},n.prototype.getImageSize=function(n){var t=this.getWebpSize(n),i;return(t||(i=new et,t=i.getJpegSize(n)),t&&(t.width>=8192||t.height>=8192||t.width<=32||t.height<=32))?null:t},n.prototype.getWebpSize=function(n){if(n[0]===82&&n[1]===73&&n[2]===70&&n[3]===70){var t=void 0,i=void 0;if(n[15]===88)t=n[24]&255|(n[25]&255)<<8|(n[26]&255)<<17,i=n[27]&255|(n[28]&255)<<8|(n[29]&255)<<17;else if(n[15]===32)t=(n[27]&255)<<8|n[26]&255,i=(n[29]&255)<<8|n[28]&255;else return null;return{width:t,height:i}}return null},n}();try{self&&(window={},v=function(n){a=n.data.debug;var t=n.data;t.type===i.Octree?nt(t):t.type===i.TileMesh&&st(t)},self.onmessage=v,o.WriteConsoleLine("process thread inited"))}catch(at){o.WriteConsoleLine("process thread fail")}})(DrawseeProcess||(DrawseeProcess={}))