/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
var __extends,Drawsee;(function(){"use strict";function i(n){throw n;}function s(n,i){var u=n.split("."),r=bt,f;for((u[0]in r)||!r.execScript||r.execScript("var "+u[0]);u.length&&(f=u.shift());)!u.length&&i!==t?r[f]=i:r=r[f]?r[f]:r[f]={}}function nt(n,t,i){for(var u="number"==typeof t?t:t=0,e="number"==typeof i?i:n.length,r=-1,u=e&7;u--;++t)r=r>>>8^f[(r^n[t])&255];for(u=e>>3;u--;t+=8)r=r>>>8^f[(r^n[t])&255],r=r>>>8^f[(r^n[t+1])&255],r=r>>>8^f[(r^n[t+2])&255],r=r>>>8^f[(r^n[t+3])&255],r=r>>>8^f[(r^n[t+4])&255],r=r>>>8^f[(r^n[t+5])&255],r=r>>>8^f[(r^n[t+6])&255],r=r>>>8^f[(r^n[t+7])&255];return(r^4294967295)>>>0}function e(){}function c(t){for(var v=t.length,f=0,s=Number.POSITIVE_INFINITY,h,c,u,e,l,o,a,r,y,i=0;i<v;++i)t[i]>f&&(f=t[i]),t[i]<s&&(s=t[i]);for(h=1<<f,c=new(n?Uint32Array:Array)(h),u=1,e=0,l=2;u<=f;){for(i=0;i<v;++i)if(t[i]===u){for(o=0,a=e,r=0;r<u;++r)o=o<<1|a&1,a>>=1;for(y=u<<16|i,r=o;r<h;r+=l)c[r]=y;++e}++u;e<<=1;l<<=1}return[c,f,s]}function o(t,r){this.i=[];this.j=32768;this.d=this.f=this.c=this.n=0;this.input=n?new Uint8Array(t):t;this.o=!1;this.k=p;this.z=!1;!r&&(r={})||(r.index&&(this.c=r.index),r.bufferSize&&(this.j=r.bufferSize),r.bufferType&&(this.k=r.bufferType),r.resize&&(this.z=r.resize));switch(this.k){case it:this.a=32768;this.b=new(n?Uint8Array:Array)(32768+this.j+258);break;case p:this.a=0;this.b=new(n?Uint8Array:Array)(this.j);this.e=this.F;this.q=this.B;this.l=this.D;break;default:i(Error("invalid inflate mode"))}}function u(n,t){for(var u=n.f,r=n.d,e=n.input,f=n.c,s=e.length,o;r<t;)f>=s&&i(Error("input buffer is broken")),u|=e[f++]<<r,r+=8;return o=u&(1<<t)-1,n.f=u>>>t,n.d=r-t,n.c=f,o}function a(n,t){for(var r=n.f,i=n.d,o=n.input,u=n.c,h=o.length,c=t[0],s=t[1],f,e;i<s&&!(u>=h);)r|=o[u++]<<i,i+=8;return f=c[r&(1<<s)-1],e=f>>>16,n.f=r>>e,n.d=i-e,n.c=u,f&65535}function dt(t){function o(n,t,i){for(var o,e=this.w,r,f=0;f<n;)switch(o=a(this,t),o){case 16:for(r=3+u(this,2);r--;)i[f++]=e;break;case 17:for(r=3+u(this,3);r--;)i[f++]=0;e=0;break;case 18:for(r=11+u(this,7);r--;)i[f++]=0;e=0;break;default:e=i[f++]=o}return this.w=e,i}for(var s=u(t,5)+257,h=u(t,5)+1,r=u(t,4)+4,f=new(n?Uint8Array:Array)(rt.length),e,l,v,i=0;i<r;++i)f[rt[i]]=u(t,3);if(!n)for(i=r,r=f.length;i<r;++i)f[rt[i]]=0;e=c(f);l=new(n?Uint8Array:Array)(s);v=new(n?Uint8Array:Array)(h);t.w=0;t.l(c(o.call(t,s,e,l)),c(o.call(t,h,e,v)))}function v(n){this.input=n;this.c=0;this.m=[];this.s=!1}var t=void 0,bt=this,n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView,y,tt,f,l,r,ft,it,p,yt,k,d,pt,wt;for(new(n?Uint8Array:Array)(256),y=0;256>y;++y)for(var g=y,kt=7,g=g>>>1;g;g>>>=1)--kt;for(tt=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],f=n?new Uint32Array(tt):tt,e.prototype.getName=function(){return this.name},e.prototype.getData=function(){return this.data},e.prototype.H=function(){return this.I},s("Zlib.GunzipMember",e),s("Zlib.GunzipMember.prototype.getName",e.prototype.getName),s("Zlib.GunzipMember.prototype.getData",e.prototype.getData),s("Zlib.GunzipMember.prototype.getMtime",e.prototype.H),l=[],r=0;288>r;r++)switch(!0){case 143>=r:l.push([r+48,8]);break;case 255>=r:l.push([r- -256,9]);break;case 279>=r:l.push([r-256,7]);break;case 287>=r:l.push([r-88,8]);break;default:i("invalid literal: "+r)}ft=function(){function u(n){switch(!0){case 3===n:return[257,n-3,0];case 4===n:return[258,n-4,0];case 5===n:return[259,n-5,0];case 6===n:return[260,n-6,0];case 7===n:return[261,n-7,0];case 8===n:return[262,n-8,0];case 9===n:return[263,n-9,0];case 10===n:return[264,n-10,0];case 12>=n:return[265,n-11,1];case 14>=n:return[266,n-13,1];case 16>=n:return[267,n-15,1];case 18>=n:return[268,n-17,1];case 22>=n:return[269,n-19,2];case 26>=n:return[270,n-23,2];case 30>=n:return[271,n-27,2];case 34>=n:return[272,n-31,2];case 42>=n:return[273,n-35,3];case 50>=n:return[274,n-43,3];case 58>=n:return[275,n-51,3];case 66>=n:return[276,n-59,3];case 82>=n:return[277,n-67,4];case 98>=n:return[278,n-83,4];case 114>=n:return[279,n-99,4];case 130>=n:return[280,n-115,4];case 162>=n:return[281,n-131,5];case 194>=n:return[282,n-163,5];case 226>=n:return[283,n-195,5];case 257>=n:return[284,n-227,5];case 258===n:return[285,n-258,0];default:i("invalid length: "+n)}}for(var r=[],t,n=3;258>=n;n++)t=u(n),r[n]=t[2]<<24|t[1]<<16|t[0];return r}();n&&new Uint32Array(ft);it=0;p=1;o.prototype.g=function(){for(var c;!this.o;){c=u(this,3);c&1&&(this.o=!0);c>>>=1;switch(c){case 0:var e=this.input,r=this.c,o=this.b,f=this.a,l=e.length,s=t,a=t,v=o.length,h=t;this.d=this.f=0;r+1>=l&&i(Error("invalid uncompressed block header: LEN"));s=e[r++]|e[r++]<<8;r+1>=l&&i(Error("invalid uncompressed block header: NLEN"));a=e[r++]|e[r++]<<8;s===~a&&i(Error("invalid uncompressed block header: length verify"));r+s>e.length&&i(Error("input buffer is broken"));switch(this.k){case it:for(;f+s>o.length;){if(h=v-f,s-=h,n)o.set(e.subarray(r,r+h),f),f+=h,r+=h;else for(;h--;)o[f++]=e[r++];this.a=f;o=this.e();f=this.a}break;case p:for(;f+s>o.length;)o=this.e({t:2});break;default:i(Error("invalid inflate mode"))}if(n)o.set(e.subarray(r,r+s),f),f+=s,r+=s;else for(;s--;)o[f++]=e[r++];this.c=r;this.a=f;this.b=o;break;case 1:this.l(yt,wt);break;case 2:dt(this);break;default:i(Error("unknown BTYPE: "+c))}}return this.q()};for(var et=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],rt=n?new Uint16Array(et):et,ot=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],st=n?new Uint16Array(ot):ot,ht=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],w=n?new Uint8Array(ht):ht,ct=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],lt=n?new Uint16Array(ct):ct,at=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],b=n?new Uint8Array(at):at,ut=new(n?Uint8Array:Array)(288),h=0,vt=ut.length;h<vt;++h)ut[h]=143>=h?8:255>=h?9:279>=h?7:8;for(yt=c(ut),k=new(n?Uint8Array:Array)(30),d=0,pt=k.length;d<pt;++d)k[d]=5;wt=c(k);o.prototype.l=function(n,t){var f=this.b,i=this.a,o,r,e,s,h;for(this.r=n,o=f.length-258;256!==(r=a(this,n));)if(256>r)i>=o&&(this.a=i,f=this.e(),i=this.a),f[i++]=r;else for(e=r-257,h=st[e],0<w[e]&&(h+=u(this,w[e])),r=a(this,t),s=lt[r],0<b[r]&&(s+=u(this,b[r])),i>=o&&(this.a=i,f=this.e(),i=this.a);h--;)f[i]=f[i++-s];for(;8<=this.d;)this.d-=8,this.c--;this.a=i};o.prototype.D=function(n,t){var i=this.b,f=this.a,e,r,o,h,s;for(this.r=n,e=i.length;256!==(r=a(this,n));)if(256>r)f>=e&&(i=this.e(),e=i.length),i[f++]=r;else for(o=r-257,s=st[o],0<w[o]&&(s+=u(this,w[o])),r=a(this,t),h=lt[r],0<b[r]&&(h+=u(this,b[r])),f+s>e&&(i=this.e(),e=i.length);s--;)i[f]=i[f++-h];for(;8<=this.d;)this.d-=8,this.c--;this.a=f};o.prototype.e=function(){var r=new(n?Uint8Array:Array)(this.a-32768),u=this.a-32768,t,f,i=this.b;if(n)r.set(i.subarray(32768,r.length));else for(t=0,f=r.length;t<f;++t)r[t]=i[t+32768];if(this.i.push(r),this.n+=r.length,n)i.set(i.subarray(u,u+32768));else for(t=0;32768>t;++t)i[t]=i[u+t];return this.a=32768,i};o.prototype.F=function(t){var r,u=this.input.length/this.c+1|0,o,f,e,s=this.input,i=this.b;return t&&("number"==typeof t.t&&(u=t.t),"number"==typeof t.A&&(u+=t.A)),2>u?(o=(s.length-this.c)/this.r[2],e=129*o|0,f=e<i.length?i.length+e:i.length<<1):f=i.length*u,n?(r=new Uint8Array(f),r.set(i)):r=i,this.b=r};o.prototype.q=function(){var o=0,h=this.b,u=this.i,f,e=new(n?Uint8Array:Array)(this.n+(this.a-32768)),t,i,r,s;if(0===u.length)return n?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);for(t=0,i=u.length;t<i;++t)for(f=u[t],r=0,s=f.length;r<s;++r)e[o++]=f[r];for(t=32768,i=this.a;t<i;++t)e[o++]=h[t];return this.i=[],this.buffer=e};o.prototype.B=function(){var t,i=this.a;return n?this.z?(t=new Uint8Array(i),t.set(this.b.subarray(0,i))):t=this.b.subarray(0,i):(this.b.length>i&&(this.b.length=i),t=this.b),this.buffer=t};v.prototype.G=function(){return this.s||this.g(),this.m.slice()};v.prototype.g=function(){for(var d=this.input.length;this.c<d;){var f=new e,c=t,b=t,a=t,g=t,y=t,p=t,l=t,tt=t,k=t,r=this.input,u=this.c;f.u=r[u++];f.v=r[u++];(31!==f.u||139!==f.v)&&i(Error("invalid file signature:"+f.u+","+f.v));f.p=r[u++];switch(f.p){case 8:break;default:i(Error("unknown compression method: "+f.p))}if(f.h=r[u++],tt=r[u++]|r[u++]<<8|r[u++]<<16|r[u++]<<24,f.I=new Date(1e3*tt),f.O=r[u++],f.N=r[u++],0<(f.h&4)&&(f.J=r[u++]|r[u++]<<8,u+=f.J),0<(f.h&8)){for(l=[],p=0;0<(y=r[u++]);)l[p++]=String.fromCharCode(y);f.name=l.join("")}if(0<(f.h&16)){for(l=[],p=0;0<(y=r[u++]);)l[p++]=String.fromCharCode(y);f.K=l.join("")}0<(f.h&2)&&(f.C=nt(r,0,u)&65535,f.C!==(r[u++]|r[u++]<<8)&&i(Error("invalid header crc16")));c=r[r.length-4]|r[r.length-3]<<8|r[r.length-2]<<16|r[r.length-1]<<24;r.length-u-8<512*c&&(g=c);b=new o(r,{index:u,bufferSize:g});f.data=a=b.g();u=b.c;f.L=k=(r[u++]|r[u++]<<8|r[u++]<<16|r[u++]<<24)>>>0;nt(a,t,t)!==k&&i(Error("invalid CRC-32 checksum: 0x"+nt(a,t,t).toString(16)+" / 0x"+k.toString(16)));f.M=c=(r[u++]|r[u++]<<8|r[u++]<<16|r[u++]<<24)>>>0;(a.length&4294967295)!==c&&i(Error("invalid input size: "+(a.length&4294967295)+" / "+c));this.m.push(f);this.c=u}this.s=!0;for(var v=this.m,it=0,rt=0,h,s=0,w=v.length;s<w;++s)rt+=v[s].data.length;if(n)for(h=new Uint8Array(rt),s=0;s<w;++s)h.set(v[s].data,it),it+=v[s].data.length;else{for(h=[],s=0;s<w;++s)h[s]=v[s].data;h=Array.prototype.concat.apply([],h)}return h};s("Zlib.Gunzip",v);s("Zlib.Gunzip.prototype.decompress",v.prototype.g);s("Zlib.Gunzip.prototype.getMembers",v.prototype.G)}).call(this);
/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.7
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */
(function(n,t){"use strict";typeof module=="object"&&module.exports?module.exports=t(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):typeof define=="function"&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],t):n.URI=t(n.punycode,n.IPv6,n.SecondLevelDomains,n)})(this,function(n,t,i,r){"use strict";function u(n,t){var i=arguments.length>=1,r=arguments.length>=2;if(!(this instanceof u))return i?r?new u(n,t):new u(n):new u;if(n===undefined){if(i)throw new TypeError("undefined is not a valid argument for URI");n=typeof location!="undefined"?location.href+"":""}if(n===null&&i)throw new TypeError("null is not a valid argument for URI");return(this.href(n),t!==undefined)?this.absoluteTo(t):this}function it(n){return/^[0-9]+$/.test(n)}function s(n){return n.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function h(n){return n===undefined?"Undefined":String(Object.prototype.toString.call(n)).slice(8,-1)}function e(n){return h(n)==="Array"}function k(n,t){var r={},i,u,f;if(h(t)==="RegExp")r=null;else if(e(t))for(i=0,u=t.length;i<u;i++)r[t[i]]=!0;else r[t]=!0;for(i=0,u=n.length;i<u;i++)f=r&&r[n[i]]!==undefined||!r&&t.test(n[i]),f&&(n.splice(i,1),u--,i--);return n}function c(n,t){var i,r,u;if(e(t)){for(i=0,r=t.length;i<r;i++)if(!c(n,t[i]))return!1;return!0}for(u=h(t),i=0,r=n.length;i<r;i++)if(u==="RegExp"){if(typeof n[i]=="string"&&n[i].match(t))return!0}else if(n[i]===t)return!0;return!1}function d(n,t){if(!e(n)||!e(t)||n.length!==t.length)return!1;n.sort();t.sort();for(var i=0,r=n.length;i<r;i++)if(n[i]!==t[i])return!1;return!0}function w(n){return n.replace(/^\/+|\/+$/g,"")}function rt(n){return escape(n)}function b(n){return encodeURIComponent(n).replace(/[!'()*]/g,rt).replace(/\*/g,"%2A")}function v(n){return function(t,i){return t===undefined?this._parts[n]||"":(this._parts[n]=t||null,this.build(!i),this)}}function g(n,t){return function(i,r){return i===undefined?this._parts[n]||"":(i!==null&&(i=i+"",i.charAt(0)===t&&(i=i.substring(1))),this._parts[n]=i,this.build(!r),this)}}var tt=r&&r.URI,f,o,y,l,p,a,nt;u.version="1.19.7";f=u.prototype;o=Object.prototype.hasOwnProperty;u._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:u.preventInvalidHostname,duplicateQueryParameters:u.duplicateQueryParameters,escapeQuerySpace:u.escapeQuerySpace}};u.preventInvalidHostname=!1;u.duplicateQueryParameters=!1;u.escapeQuerySpace=!0;u.protocol_expression=/^[a-z][a-z0-9.+-]*$/i;u.idn_expression=/[^a-z0-9\._-]/i;u.punycode_expression=/(xn--)/i;u.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;u.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;u.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig;u.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g};u.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"};u.hostProtocols=["http","https"];u.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/;u.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"};u.getDomAttribute=function(n){if(!n||!n.nodeName)return undefined;var t=n.nodeName.toLowerCase();return t==="input"&&n.type!=="image"?undefined:u.domAttributes[t]};u.encode=b;u.decode=decodeURIComponent;u.iso8859=function(){u.encode=escape;u.decode=unescape};u.unicode=function(){u.encode=b;u.decode=decodeURIComponent};u.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}};u.encodeQuery=function(n,t){var i=u.encode(n+"");return t===undefined&&(t=u.escapeQuerySpace),t?i.replace(/%20/g,"+"):i};u.decodeQuery=function(n,t){n+="";t===undefined&&(t=u.escapeQuerySpace);try{return u.decode(t?n.replace(/\+/g,"%20"):n)}catch(i){return n}};y={encode:"encode",decode:"decode"};p=function(n,t){return function(i){try{return u[t](i+"").replace(u.characters[n][t].expression,function(i){return u.characters[n][t].map[i]})}catch(r){return i}}};for(l in y)u[l+"PathSegment"]=p("pathname",y[l]),u[l+"UrnPathSegment"]=p("urnpath",y[l]);a=function(n,t,i){return function(r){var o,f,e,s;for(o=i?function(n){return u[t](u[i](n))}:u[t],f=(r+"").split(n),e=0,s=f.length;e<s;e++)f[e]=o(f[e]);return f.join(n)}};u.decodePath=a("/","decodePathSegment");u.decodeUrnPath=a(":","decodeUrnPathSegment");u.recodePath=a("/","encodePathSegment","decode");u.recodeUrnPath=a(":","encodeUrnPathSegment","decode");u.encodeReserved=p("reserved","encode");u.parse=function(n,t){var i;return t||(t={preventInvalidHostname:u.preventInvalidHostname}),i=n.indexOf("#"),i>-1&&(t.fragment=n.substring(i+1)||null,n=n.substring(0,i)),i=n.indexOf("?"),i>-1&&(t.query=n.substring(i+1)||null,n=n.substring(0,i)),n=n.replace(/^(https?|ftp|wss?)?:[/\\]*/,"$1://"),n.substring(0,2)==="//"?(t.protocol=null,n=n.substring(2),n=u.parseAuthority(n,t)):(i=n.indexOf(":"),i>-1&&(t.protocol=n.substring(0,i)||null,t.protocol&&!t.protocol.match(u.protocol_expression)?t.protocol=undefined:n.substring(i+1,i+3).replace(/\\/g,"/")==="//"?(n=n.substring(i+3),n=u.parseAuthority(n,t)):(n=n.substring(i+1),t.urn=!0))),t.path=n,t};u.parseHost=function(n,t){var i,r,f;if(n||(n=""),n=n.replace(/\\/g,"/"),i=n.indexOf("/"),i===-1&&(i=n.length),n.charAt(0)==="[")r=n.indexOf("]"),t.hostname=n.substring(1,r)||null,t.port=n.substring(r+2,i)||null,t.port==="/"&&(t.port=null);else{var s=n.indexOf(":"),e=n.indexOf("/"),o=n.indexOf(":",s+1);o!==-1&&(e===-1||o<e)?(t.hostname=n.substring(0,i)||null,t.port=null):(f=n.substring(0,i).split(":"),t.hostname=f[0]||null,t.port=f[1]||null)}return t.hostname&&n.substring(i).charAt(0)!=="/"&&(i++,n="/"+n),t.preventInvalidHostname&&u.ensureValidHostname(t.hostname,t.protocol),t.port&&u.ensureValidPort(t.port),n.substring(i)||"/"};u.parseAuthority=function(n,t){return n=u.parseUserinfo(n,t),u.parseHost(n,t)};u.parseUserinfo=function(n,t){var e=n,o=n.indexOf("\\"),r,f,i;return o!==-1&&(n=n.replace(/\\/g,"/")),r=n.indexOf("/"),f=n.lastIndexOf("@",r>-1?r:n.length-1),f>-1&&(r===-1||f<r)?(i=n.substring(0,f).split(":"),t.username=i[0]?u.decode(i[0]):null,i.shift(),t.password=i[0]?u.decode(i.join(":")):null,n=e.substring(f+1)):(t.username=null,t.password=null),n};u.parseQuery=function(n,t){var e;if(!n)return{};if(n=n.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!n)return{};var r={},h=n.split("&"),c=h.length,f,i,s;for(e=0;e<c;e++)if(f=h[e].split("="),i=u.decodeQuery(f.shift(),t),s=f.length?u.decodeQuery(f.join("="),t):null,i==="__proto__")continue;else o.call(r,i)?((typeof r[i]=="string"||r[i]===null)&&(r[i]=[r[i]]),r[i].push(s)):r[i]=s;return r};u.build=function(n){var t="",i=!1;return n.protocol&&(t+=n.protocol+":"),!n.urn&&(t||n.hostname)&&(t+="//",i=!0),t+=u.buildAuthority(n)||"",typeof n.path=="string"&&(n.path.charAt(0)!=="/"&&i&&(t+="/"),t+=n.path),typeof n.query=="string"&&n.query&&(t+="?"+n.query),typeof n.fragment=="string"&&n.fragment&&(t+="#"+n.fragment),t};u.buildHost=function(n){var t="";if(n.hostname)t+=u.ip6_expression.test(n.hostname)?"["+n.hostname+"]":n.hostname;else return"";return n.port&&(t+=":"+n.port),t};u.buildAuthority=function(n){return u.buildUserinfo(n)+u.buildHost(n)};u.buildUserinfo=function(n){var t="";return n.username&&(t+=u.encode(n.username)),n.password&&(t+=":"+u.encode(n.password)),t&&(t+="@"),t};u.buildQuery=function(n,t,i){var s="",h,r,f,c;for(r in n)if(r==="__proto__")continue;else if(o.call(n,r))if(e(n[r]))for(h={},f=0,c=n[r].length;f<c;f++)n[r][f]!==undefined&&h[n[r][f]+""]===undefined&&(s+="&"+u.buildQueryParameter(r,n[r][f],i),t!==!0&&(h[n[r][f]+""]=!0));else n[r]!==undefined&&(s+="&"+u.buildQueryParameter(r,n[r],i));return s.substring(1)};u.buildQueryParameter=function(n,t,i){return u.encodeQuery(n,i)+(t!==null?"="+u.encodeQuery(t,i):"")};u.addQuery=function(n,t,i){if(typeof t=="object")for(var r in t)o.call(t,r)&&u.addQuery(n,r,t[r]);else if(typeof t=="string"){if(n[t]===undefined){n[t]=i;return}typeof n[t]=="string"&&(n[t]=[n[t]]);e(i)||(i=[i]);n[t]=(n[t]||[]).concat(i)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");};u.setQuery=function(n,t,i){if(typeof t=="object")for(var r in t)o.call(t,r)&&u.setQuery(n,r,t[r]);else if(typeof t=="string")n[t]=i===undefined?null:i;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");};u.removeQuery=function(n,t,i){var f,s,r;if(e(t))for(f=0,s=t.length;f<s;f++)n[t[f]]=undefined;else if(h(t)==="RegExp")for(r in n)t.test(r)&&(n[r]=undefined);else if(typeof t=="object")for(r in t)o.call(t,r)&&u.removeQuery(n,r,t[r]);else if(typeof t=="string")i!==undefined?h(i)==="RegExp"?n[t]=!e(n[t])&&i.test(n[t])?undefined:k(n[t],i):n[t]!==String(i)||e(i)&&i.length!==1?e(n[t])&&(n[t]=k(n[t],i)):n[t]=undefined:n[t]=undefined;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");};u.hasQuery=function(n,t,i,r){var f,s,l,a;switch(h(t)){case"String":break;case"RegExp":for(f in n)if(o.call(n,f)&&t.test(f)&&(i===undefined||u.hasQuery(n,f,i)))return!0;return!1;case"Object":for(s in t)if(o.call(t,s)&&!u.hasQuery(n,s,t[s]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter");}switch(h(i)){case"Undefined":return t in n;case"Boolean":return l=Boolean(e(n[t])?n[t].length:n[t]),i===l;case"Function":return!!i(n[t],t,n);case"Array":return e(n[t])?(a=r?c:d,a(n[t],i)):!1;case"RegExp":return e(n[t])?r?c(n[t],i):!1:Boolean(n[t]&&n[t].match(i));case"Number":i=String(i);case"String":return e(n[t])?r?c(n[t],i):!1:n[t]===i;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter");}};u.joinPaths=function(){for(var o,t,n,i,r=[],f=[],s=0,e=0;e<arguments.length;e++)for(o=new u(arguments[e]),r.push(o),t=o.segment(),n=0;n<t.length;n++)typeof t[n]=="string"&&f.push(t[n]),t[n]&&s++;return!f.length||!s?new u(""):(i=new u("").segment(f),(r[0].path()===""||r[0].path().slice(0,1)==="/")&&i.path("/"+i.path()),i.normalize())};u.commonPath=function(n,t){for(var r=Math.min(n.length,t.length),i=0;i<r;i++)if(n.charAt(i)!==t.charAt(i)){i--;break}return i<1?n.charAt(0)===t.charAt(0)&&n.charAt(0)==="/"?"/":"":((n.charAt(i)!=="/"||t.charAt(i)!=="/")&&(i=n.substring(0,i).lastIndexOf("/")),n.substring(0,i+1))};u.withinString=function(n,t,i){var c,r,a,l,y,e;i||(i={});var o=i.start||u.findUri.start,p=i.end||u.findUri.end,v=i.trim||u.findUri.trim,w=i.parens||u.findUri.parens;for(o.lastIndex=0;;){if(c=o.exec(n),!c)break;if(r=c.index,!i.ignoreHtml||(a=n.slice(Math.max(r-3,0),r),!a||!/[a-z0-9-]=["']?$/i.test(a))){for(var s=r+n.slice(r).search(p),f=n.slice(r,s),h=-1;;){if(l=w.exec(f),!l)break;y=l.index+l[0].length;h=Math.max(h,y)}if((f=h>-1?f.slice(0,h)+f.slice(h).replace(v,""):f.replace(v,""),!(f.length<=c[0].length))&&(!i.ignore||!i.ignore.test(f))){if(s=r+f.length,e=t(f,r,s,n),e===undefined){o.lastIndex=s;continue}e=String(e);n=n.slice(0,r)+e+n.slice(s);o.lastIndex=r+e.length}}}return o.lastIndex=0,n};u.ensureValidHostname=function(t,i){var f=!!t,e=!!i,r=!1;if(e&&(r=c(u.hostProtocols,i)),r&&!f)throw new TypeError("Hostname cannot be empty, if protocol is "+i);else if(t&&t.match(u.invalid_hostname_characters)){if(!n)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(n.toASCII(t).match(u.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_]');}};u.ensureValidPort=function(n){if(n){var t=Number(n);if(!it(t)||!(t>0)||!(t<65536))throw new TypeError('Port "'+n+'" is not a valid port');}};u.noConflict=function(n){if(n){var t={URI:this.noConflict()};return r.URITemplate&&typeof r.URITemplate.noConflict=="function"&&(t.URITemplate=r.URITemplate.noConflict()),r.IPv6&&typeof r.IPv6.noConflict=="function"&&(t.IPv6=r.IPv6.noConflict()),r.SecondLevelDomains&&typeof r.SecondLevelDomains.noConflict=="function"&&(t.SecondLevelDomains=r.SecondLevelDomains.noConflict()),t}return r.URI===this&&(r.URI=tt),this};f.build=function(n){return n===!0?this._deferred_build=!0:(n===undefined||this._deferred_build)&&(this._string=u.build(this._parts),this._deferred_build=!1),this};f.clone=function(){return new u(this)};f.valueOf=f.toString=function(){return this.build(!1)._string};f.protocol=v("protocol");f.username=v("username");f.password=v("password");f.hostname=v("hostname");f.port=v("port");f.query=g("query","?");f.fragment=g("fragment","#");f.search=function(n,t){var i=this.query(n,t);return typeof i=="string"&&i.length?"?"+i:i};f.hash=function(n,t){var i=this.fragment(n,t);return typeof i=="string"&&i.length?"#"+i:i};f.pathname=function(n,t){if(n===undefined||n===!0){var i=this._parts.path||(this._parts.hostname?"/":"");return n?(this._parts.urn?u.decodeUrnPath:u.decodePath)(i):i}return this._parts.path=this._parts.urn?n?u.recodeUrnPath(n):"":n?u.recodePath(n):"/",this.build(!t),this};f.path=f.pathname;f.href=function(n,t){var i,f,e,s,r;if(n===undefined)return this.toString();if(this._string="",this._parts=u._parts(),f=n instanceof u,e=typeof n=="object"&&(n.hostname||n.path||n.pathname),n.nodeName&&(s=u.getDomAttribute(n),n=n[s]||"",e=!1),!f&&e&&n.pathname!==undefined&&(n=n.toString()),typeof n=="string"||n instanceof String)this._parts=u.parse(String(n),this._parts);else if(f||e){r=f?n._parts:n;for(i in r)i!=="query"&&o.call(this._parts,i)&&(this._parts[i]=r[i]);r.query&&this.query(r.query,!1)}else throw new TypeError("invalid input");return this.build(!t),this};f.is=function(n){var r=!1,f=!1,e=!1,t=!1,s=!1,h=!1,c=!1,o=!this._parts.urn;this._parts.hostname&&(o=!1,f=u.ip4_expression.test(this._parts.hostname),e=u.ip6_expression.test(this._parts.hostname),r=f||e,t=!r,s=t&&i&&i.has(this._parts.hostname),h=t&&u.idn_expression.test(this._parts.hostname),c=t&&u.punycode_expression.test(this._parts.hostname));switch(n.toLowerCase()){case"relative":return o;case"absolute":return!o;case"domain":case"name":return t;case"sld":return s;case"ip":return r;case"ip4":case"ipv4":case"inet4":return f;case"ip6":case"ipv6":case"inet6":return e;case"idn":return h;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return c}return null};var ut=f.protocol,ft=f.port,et=f.hostname;return f.protocol=function(n,t){if(n&&(n=n.replace(/:(\/\/)?$/,""),!n.match(u.protocol_expression)))throw new TypeError('Protocol "'+n+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return ut.call(this,n,t)},f.scheme=f.protocol,f.port=function(n,t){return this._parts.urn?n===undefined?"":this:(n!==undefined&&(n===0&&(n=null),n&&(n+="",n.charAt(0)===":"&&(n=n.substring(1)),u.ensureValidPort(n))),ft.call(this,n,t))},f.hostname=function(n,t){if(this._parts.urn)return n===undefined?"":this;if(n!==undefined){var i={preventInvalidHostname:this._parts.preventInvalidHostname},r=u.parseHost(n,i);if(r!=="/")throw new TypeError('Hostname "'+n+'" contains characters other than [A-Z0-9.-]');n=i.hostname;this._parts.preventInvalidHostname&&u.ensureValidHostname(n,this._parts.protocol)}return et.call(this,n,t)},f.origin=function(n,t){var i,f,r;return this._parts.urn?n===undefined?"":this:n===undefined?(i=this.protocol(),f=this.authority(),!f)?"":(i?i+"://":"")+this.authority():(r=u(n),this.protocol(r.protocol()).authority(r.authority()).build(!t),this)},f.host=function(n,t){if(this._parts.urn)return n===undefined?"":this;if(n===undefined)return this._parts.hostname?u.buildHost(this._parts):"";var i=u.parseHost(n,this._parts);if(i!=="/")throw new TypeError('Hostname "'+n+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},f.authority=function(n,t){if(this._parts.urn)return n===undefined?"":this;if(n===undefined)return this._parts.hostname?u.buildAuthority(this._parts):"";var i=u.parseAuthority(n,this._parts);if(i!=="/")throw new TypeError('Hostname "'+n+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},f.userinfo=function(n,t){if(this._parts.urn)return n===undefined?"":this;if(n===undefined){var i=u.buildUserinfo(this._parts);return i?i.substring(0,i.length-1):i}return n[n.length-1]!=="@"&&(n+="@"),u.parseUserinfo(n,this._parts),this.build(!t),this},f.resource=function(n,t){var i;return n===undefined?this.path()+this.search()+this.hash():(i=u.parse(n),this._parts.path=i.path,this._parts.query=i.query,this._parts.fragment=i.fragment,this.build(!t),this)},f.subdomain=function(n,t){var i;if(this._parts.urn)return n===undefined?"":this;if(n===undefined)return!this._parts.hostname||this.is("IP")?"":(i=this._parts.hostname.length-this.domain().length-1,this._parts.hostname.substring(0,i)||"");var r=this._parts.hostname.length-this.domain().length,f=this._parts.hostname.substring(0,r),e=new RegExp("^"+s(f));if(n&&n.charAt(n.length-1)!=="."&&(n+="."),n.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return n&&u.ensureValidHostname(n,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(e,n),this.build(!t),this},f.domain=function(n,t){var r,i,f;if(this._parts.urn)return n===undefined?"":this;if(typeof n=="boolean"&&(t=n,n=undefined),n===undefined)return!this._parts.hostname||this.is("IP")?"":(r=this._parts.hostname.match(/\./g),r&&r.length<2)?this._parts.hostname:(i=this._parts.hostname.length-this.tld(t).length-1,i=this._parts.hostname.lastIndexOf(".",i-1)+1,this._parts.hostname.substring(i)||"");if(!n)throw new TypeError("cannot set domain empty");if(n.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return u.ensureValidHostname(n,this._parts.protocol),!this._parts.hostname||this.is("IP")?this._parts.hostname=n:(f=new RegExp(s(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(f,n)),this.build(!t),this},f.tld=function(n,t){var f,r,u;if(this._parts.urn)return n===undefined?"":this;if(typeof n=="boolean"&&(t=n,n=undefined),n===undefined)return!this._parts.hostname||this.is("IP")?"":(f=this._parts.hostname.lastIndexOf("."),r=this._parts.hostname.substring(f+1),t!==!0&&i&&i.list[r.toLowerCase()])?i.get(this._parts.hostname)||r:r;if(n)if(n.match(/[^a-zA-Z0-9-]/))if(i&&i.is(n))u=new RegExp(s(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(u,n);else throw new TypeError('TLD "'+n+'" contains characters other than [A-Z0-9]');else if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");else u=new RegExp(s(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(u,n);else throw new TypeError("cannot set TLD empty");return this.build(!t),this},f.directory=function(n,t){var r,i;if(this._parts.urn)return n===undefined?"":this;if(n===undefined||n===!0)return!this._parts.path&&!this._parts.hostname?"":this._parts.path==="/"?"/":(r=this._parts.path.length-this.filename().length-1,i=this._parts.path.substring(0,r)||(this._parts.hostname?"/":""),n?u.decodePath(i):i);var f=this._parts.path.length-this.filename().length,e=this._parts.path.substring(0,f),o=new RegExp("^"+s(e));return this.is("relative")||(n||(n="/"),n.charAt(0)!=="/"&&(n="/"+n)),n&&n.charAt(n.length-1)!=="/"&&(n+="/"),n=u.recodePath(n),this._parts.path=this._parts.path.replace(o,n),this.build(!t),this},f.filename=function(n,t){var f,i,r,e;return this._parts.urn?n===undefined?"":this:typeof n!="string"?!this._parts.path||this._parts.path==="/"?"":(f=this._parts.path.lastIndexOf("/"),i=this._parts.path.substring(f+1),n?u.decodePathSegment(i):i):(r=!1,n.charAt(0)==="/"&&(n=n.substring(1)),n.match(/\.?\//)&&(r=!0),e=new RegExp(s(this.filename())+"$"),n=u.recodePath(n),this._parts.path=this._parts.path.replace(e,n),r?this.normalizePath(t):this.build(!t),this)},f.suffix=function(n,t){var r,f,e,o,i,h;if(this._parts.urn)return n===undefined?"":this;if(n===undefined||n===!0)return!this._parts.path||this._parts.path==="/"?"":(r=this.filename(),f=r.lastIndexOf("."),f===-1)?"":(e=r.substring(f+1),o=/^[a-z0-9%]+$/i.test(e)?e:"",n?u.decodePathSegment(o):o);if(n.charAt(0)==="."&&(n=n.substring(1)),i=this.suffix(),i)h=n?new RegExp(s(i)+"$"):new RegExp(s("."+i)+"$");else{if(!n)return this;this._parts.path+="."+u.recodePath(n)}return h&&(n=u.recodePath(n),this._parts.path=this._parts.path.replace(h,n)),this.build(!t),this},f.segment=function(n,t,i){var f=this._parts.urn?":":"/",o=this.path(),s=o.substring(0,1)==="/",r=o.split(f),u,h;if(n!==undefined&&typeof n!="number"&&(i=t,t=n,n=undefined),n!==undefined&&typeof n!="number")throw new Error('Bad segment "'+n+'", must be 0-based integer');if(s&&r.shift(),n<0&&(n=Math.max(r.length+n,0)),t===undefined)return n===undefined?r:r[n];if(n===null||r[n]===undefined)if(e(t))for(r=[],u=0,h=t.length;u<h;u++)(t[u].length||r.length&&r[r.length-1].length)&&(r.length&&!r[r.length-1].length&&r.pop(),r.push(w(t[u])));else(t||typeof t=="string")&&(t=w(t),r[r.length-1]===""?r[r.length-1]=t:r.push(t));else t?r[n]=w(t):r.splice(n,1);return s&&r.unshift(""),this.path(r.join(f),i)},f.segmentCoded=function(n,t,i){var f,r,o;if(typeof n!="number"&&(i=t,t=n,n=undefined),t===undefined){if(f=this.segment(n,t,i),e(f))for(r=0,o=f.length;r<o;r++)f[r]=u.decode(f[r]);else f=f!==undefined?u.decode(f):undefined;return f}if(e(t))for(r=0,o=t.length;r<o;r++)t[r]=u.encode(t[r]);else t=typeof t=="string"||t instanceof String?u.encode(t):t;return this.segment(n,t,i)},nt=f.query,f.query=function(n,t){if(n===!0)return u.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof n=="function"){var i=u.parseQuery(this._parts.query,this._parts.escapeQuerySpace),r=n.call(this,i);return this._parts.query=u.buildQuery(r||i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return n!==undefined&&typeof n!="string"?(this._parts.query=u.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):nt.call(this,n,t)},f.setQuery=function(n,t,i){var f=u.parseQuery(this._parts.query,this._parts.escapeQuerySpace),r;if(typeof n=="string"||n instanceof String)f[n]=t!==undefined?t:null;else if(typeof n=="object")for(r in n)o.call(n,r)&&(f[r]=n[r]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=u.buildQuery(f,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof n!="string"&&(i=t),this.build(!i),this},f.addQuery=function(n,t,i){var r=u.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return u.addQuery(r,n,t===undefined?null:t),this._parts.query=u.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof n!="string"&&(i=t),this.build(!i),this},f.removeQuery=function(n,t,i){var r=u.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return u.removeQuery(r,n,t),this._parts.query=u.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof n!="string"&&(i=t),this.build(!i),this},f.hasQuery=function(n,t,i){var r=u.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return u.hasQuery(r,n,t,i)},f.setSearch=f.setQuery,f.addSearch=f.addQuery,f.removeSearch=f.removeQuery,f.hasSearch=f.hasQuery,f.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},f.normalizeProtocol=function(n){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!n)),this},f.normalizeHostname=function(i){return this._parts.hostname&&(this.is("IDN")&&n?this._parts.hostname=n.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!i)),this},f.normalizePort=function(n){return typeof this._parts.protocol=="string"&&this._parts.port===u.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!n)),this},f.normalizePath=function(n){var t=this._parts.path,e,i,r,f;if(!t)return this;if(this._parts.urn)return this._parts.path=u.recodeUrnPath(this._parts.path),this.build(!n),this;if(this._parts.path==="/")return this;for(t=u.recodePath(t),i="",t.charAt(0)!=="/"&&(e=!0,t="/"+t),(t.slice(-3)==="/.."||t.slice(-2)==="/.")&&(t+="/"),t=t.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),e&&(i=t.substring(1).match(/^(\.\.\/)+/)||"",i&&(i=i[0]));;){if(r=t.search(/\/\.\.(\/|$)/),r===-1)break;else if(r===0){t=t.substring(3);continue}f=t.substring(0,r).lastIndexOf("/");f===-1&&(f=r);t=t.substring(0,f)+t.substring(r+3)}return e&&this.is("relative")&&(t=i+t.substring(1)),this._parts.path=t,this.build(!n),this},f.normalizePathname=f.normalizePath,f.normalizeQuery=function(n){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(u.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!n)),this},f.normalizeFragment=function(n){return this._parts.fragment||(this._parts.fragment=null,this.build(!n)),this},f.normalizeSearch=f.normalizeQuery,f.normalizeHash=f.normalizeFragment,f.iso8859=function(){var n=u.encode,t=u.decode;u.encode=escape;u.decode=decodeURIComponent;try{this.normalize()}finally{u.encode=n;u.decode=t}return this},f.unicode=function(){var n=u.encode,t=u.decode;u.encode=b;u.decode=unescape;try{this.normalize()}finally{u.encode=n;u.decode=t}return this},f.readable=function(){var t=this.clone(),i,r,f;if(t.username("").password("").normalize(),i="",t._parts.protocol&&(i+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&n?(i+=n.toUnicode(t._parts.hostname),t._parts.port&&(i+=":"+t._parts.port)):i+=t.host()),t._parts.hostname&&t._parts.path&&t._parts.path.charAt(0)!=="/"&&(i+="/"),i+=t.path(!0),t._parts.query){r="";for(var e=0,o=t._parts.query.split("&"),s=o.length;e<s;e++)f=(o[e]||"").split("="),r+="&"+u.decodeQuery(f[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),f[1]!==undefined&&(r+="="+u.decodeQuery(f[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"));i+="?"+r.substring(1)}return i+u.decodeQuery(t.hash(),!0)},f.absoluteTo=function(n){var t=this.clone(),e=["protocol","username","password","hostname","port"],i,r,f;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if((n instanceof u||(n=new u(n)),t._parts.protocol)||(t._parts.protocol=n._parts.protocol,this._parts.hostname))return t;for(r=0;f=e[r];r++)t._parts[f]=n._parts[f];return t._parts.path?(t._parts.path.substring(-2)===".."&&(t._parts.path+="/"),t.path().charAt(0)!=="/"&&(i=n.directory(),i=i?i:n.path().indexOf("/")===0?"/":"",t._parts.path=(i?i+"/":"")+t._parts.path,t.normalizePath())):(t._parts.path=n._parts.path,t._parts.query||(t._parts.query=n._parts.query)),t.build(),t},f.relativeTo=function(n){var i=this.clone().normalize(),t,r,f,e,o,s;if(i._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(n=new u(n).normalize(),t=i._parts,r=n._parts,e=i.path(),o=n.path(),e.charAt(0)!=="/")throw new Error("URI is already relative");if(o.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if((t.protocol===r.protocol&&(t.protocol=null),t.username!==r.username||t.password!==r.password)||t.protocol!==null||t.username!==null||t.password!==null)return i.build();if(t.hostname===r.hostname&&t.port===r.port)t.hostname=null,t.port=null;else return i.build();return e===o?(t.path="",i.build()):(f=u.commonPath(e,o),!f)?i.build():(s=r.path.substring(f.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../"),t.path=s+t.path.substring(f.length)||"./",i.build())},f.equals=function(n){var r=this.clone(),f=new u(n),i={},s={},l={},h,c,t;if(r.normalize(),f.normalize(),r.toString()===f.toString())return!0;if((h=r.query(),c=f.query(),r.query(""),f.query(""),r.toString()!==f.toString())||h.length!==c.length)return!1;i=u.parseQuery(h,this._parts.escapeQuerySpace);s=u.parseQuery(c,this._parts.escapeQuerySpace);for(t in i)if(o.call(i,t)){if(e(i[t])){if(!d(i[t],s[t]))return!1}else if(i[t]!==s[t])return!1;l[t]=!0}for(t in s)if(o.call(s,t)&&!l[t])return!1;return!0},f.preventInvalidHostname=function(n){return this._parts.preventInvalidHostname=!!n,this},f.duplicateQueryParameters=function(n){return this._parts.duplicateQueryParameters=!!n,this},f.escapeQuerySpace=function(n){return this._parts.escapeQuerySpace=!!n,this},u}),function(){function t(t,i,r){n.biginteger_used=1;null!=t&&("number"==typeof t&&"undefined"==typeof i?this.fromInt(t):"number"==typeof t?this.fromNumber(t,i,r):null==i&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,i))}function i(){return new t(null,void 0,void 0)}function et(n,t,i,r,u,f){for(;0<=--f;){var e=t*this[n++]+i[r]+u;u=Math.floor(e/67108864);i[r++]=e&67108863}return u}function ot(n,t,i,r,u,f){var o=t&32767;for(t>>=15;0<=--f;){var e=this[n]&32767,s=this[n++]>>15,h=t*e+s*o,e=o*e+((h&32767)<<15)+i[r]+(u&1073741823);u=(e>>>30)+(h>>>15)+t*s+(u>>>30);i[r++]=e&1073741823}return u}function st(n,t,i,r,u,f){var o=t&16383;for(t>>=14;0<=--f;){var e=this[n]&16383,s=this[n++]>>14,h=t*e+s*o,e=o*e+((h&16383)<<14)+i[r]+u;u=(e>>28)+(h>>14)+t*s;i[r++]=e&268435455}return u}function nt(n,t){var i=a[n.charCodeAt(t)];return null==i?-1:i}function o(n){var t=i();return t.fromInt(n),t}function v(n){var i=1,t;return 0!=(t=n>>>16)&&(n=t,i+=16),0!=(t=n>>8)&&(n=t,i+=8),0!=(t=n>>4)&&(n=t,i+=4),0!=(t=n>>2)&&(n=t,i+=2),0!=n>>1&&(i+=1),i}function s(n){this.m=n}function h(n){this.m=n;this.mp=n.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<n.DB-15)-1;this.mt2=2*n.t}function ht(n,t){return n&t}function d(n,t){return n|t}function tt(n,t){return n^t}function it(n,t){return n&~t}function l(){}function rt(n){return n}function c(n){this.r2=i();this.q3=i();t.ONE.dlShiftTo(2*n.t,this.r2);this.mu=this.r2.divide(n);this.m=n}var n={use_lines:!0,use_xyz:!1},y=!1,u,r,p,g,w,b,k,ut,a,e,f,ft;for("undefined"!=typeof module&&module.exports?(module.exports=n,y=!0):"undefined"!=typeof document?window.ClipperLib=n:self.ClipperLib=n,y?(r="chrome",u="Netscape"):(r=navigator.userAgent.toString().toLowerCase(),u=navigator.appName),p=-1!=r.indexOf("chrome")&&-1==r.indexOf("chromium")?1:0,y=-1!=r.indexOf("chromium")?1:0,g=-1!=r.indexOf("safari")&&-1==r.indexOf("chrome")&&-1==r.indexOf("chromium")?1:0,w=-1!=r.indexOf("firefox")?1:0,r.indexOf("firefox/17"),r.indexOf("firefox/15"),r.indexOf("firefox/3"),b=-1!=r.indexOf("opera")?1:0,r.indexOf("msie 10"),r.indexOf("msie 9"),k=-1!=r.indexOf("msie 8")?1:0,ut=-1!=r.indexOf("msie 7")?1:0,r=-1!=r.indexOf("msie ")?1:0,n.biginteger_used=null,"Microsoft Internet Explorer"==u?(t.prototype.am=ot,u=30):"Netscape"!=u?(t.prototype.am=et,u=26):(t.prototype.am=st,u=28),t.prototype.DB=u,t.prototype.DM=(1<<u)-1,t.prototype.DV=1<<u,t.prototype.FV=Math.pow(2,52),t.prototype.F1=52-u,t.prototype.F2=2*u-52,a=[],u=48,e=0;9>=e;++e)a[u++]=e;for(u=97,e=10;36>e;++e)a[u++]=e;for(u=65,e=10;36>e;++e)a[u++]=e;s.prototype.convert=function(n){return 0>n.s||0<=n.compareTo(this.m)?n.mod(this.m):n};s.prototype.revert=function(n){return n};s.prototype.reduce=function(n){n.divRemTo(this.m,null,n)};s.prototype.mulTo=function(n,t,i){n.multiplyTo(t,i);this.reduce(i)};s.prototype.sqrTo=function(n,t){n.squareTo(t);this.reduce(t)};h.prototype.convert=function(n){var r=i();return n.abs().dlShiftTo(this.m.t,r),r.divRemTo(this.m,null,r),0>n.s&&0<r.compareTo(t.ZERO)&&this.m.subTo(r,r),r};h.prototype.revert=function(n){var t=i();return n.copyTo(t),this.reduce(t),t};h.prototype.reduce=function(n){for(var t;n.t<=this.mt2;)n[n.t++]=0;for(t=0;t<this.m.t;++t){var i=n[t]&32767,r=i*this.mpl+((i*this.mph+(n[t]>>15)*this.mpl&this.um)<<15)&n.DM,i=t+this.m.t;for(n[i]+=this.m.am(0,r,n,t,0,this.m.t);n[i]>=n.DV;)n[i]-=n.DV,n[++i]++}n.clamp();n.drShiftTo(this.m.t,n);0<=n.compareTo(this.m)&&n.subTo(this.m,n)};h.prototype.mulTo=function(n,t,i){n.multiplyTo(t,i);this.reduce(i)};h.prototype.sqrTo=function(n,t){n.squareTo(t);this.reduce(t)};t.prototype.copyTo=function(n){for(var t=this.t-1;0<=t;--t)n[t]=this[t];n.t=this.t;n.s=this.s};t.prototype.fromInt=function(n){this.t=1;this.s=0>n?-1:0;0<n?this[0]=n:-1>n?this[0]=n+this.DV:this.t=0};t.prototype.fromString=function(n,i){var u,f;if(16==i)u=4;else if(8==i)u=3;else if(256==i)u=8;else if(2==i)u=1;else if(32==i)u=5;else if(4==i)u=2;else{this.fromRadix(n,i);return}this.s=this.t=0;for(var e=n.length,o=!1,r=0;0<=--e;)f=8==u?n[e]&255:nt(n,e),0>f?"-"==n.charAt(e)&&(o=!0):(o=!1,0==r?this[this.t++]=f:r+u>this.DB?(this[this.t-1]|=(f&(1<<this.DB-r)-1)<<r,this[this.t++]=f>>this.DB-r):this[this.t-1]|=f<<r,r+=u,r>=this.DB&&(r-=this.DB));8==u&&0!=(n[0]&128)&&(this.s=-1,0<r&&(this[this.t-1]|=(1<<this.DB-r)-1<<r));this.clamp();o&&t.ZERO.subTo(this,this)};t.prototype.clamp=function(){for(var n=this.s&this.DM;0<this.t&&this[this.t-1]==n;)--this.t};t.prototype.dlShiftTo=function(n,t){for(var i=this.t-1;0<=i;--i)t[i+n]=this[i];for(i=n-1;0<=i;--i)t[i]=0;t.t=this.t+n;t.s=this.s};t.prototype.drShiftTo=function(n,t){for(var i=n;i<this.t;++i)t[i-n]=this[i];t.t=Math.max(this.t-n,0);t.s=this.s};t.prototype.lShiftTo=function(n,t){for(var u=n%this.DB,e=this.DB-u,o=(1<<e)-1,r=Math.floor(n/this.DB),f=this.s<<u&this.DM,i=this.t-1;0<=i;--i)t[i+r+1]=this[i]>>e|f,f=(this[i]&o)<<u;for(i=r-1;0<=i;--i)t[i]=0;t[r]=f;t.t=this.t+r+1;t.s=this.s;t.clamp()};t.prototype.rShiftTo=function(n,t){var i,r;if(t.s=this.s,i=Math.floor(n/this.DB),i>=this.t)t.t=0;else{var u=n%this.DB,f=this.DB-u,e=(1<<u)-1;for(t[0]=this[i]>>u,r=i+1;r<this.t;++r)t[r-i-1]|=(this[r]&e)<<f,t[r-i]=this[r]>>u;0<u&&(t[this.t-i-1]|=(this.s&e)<<f);t.t=this.t-i;t.clamp()}};t.prototype.subTo=function(n,t){for(var r=0,i=0,u=Math.min(n.t,this.t);r<u;)i+=this[r]-n[r],t[r++]=i&this.DM,i>>=this.DB;if(n.t<this.t){for(i-=n.s;r<this.t;)i+=this[r],t[r++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;r<n.t;)i-=n[r],t[r++]=i&this.DM,i>>=this.DB;i-=n.s}t.s=0>i?-1:0;-1>i?t[r++]=this.DV+i:0<i&&(t[r++]=i);t.t=r;t.clamp()};t.prototype.multiplyTo=function(n,i){var u=this.abs(),f=n.abs(),r=u.t;for(i.t=r+f.t;0<=--r;)i[r]=0;for(r=0;r<f.t;++r)i[r+u.t]=u.am(0,f[r],i,r,0,u.t);i.s=0;i.clamp();this.s!=n.s&&t.ZERO.subTo(i,i)};t.prototype.squareTo=function(n){for(var r,i=this.abs(),t=n.t=2*i.t;0<=--t;)n[t]=0;for(t=0;t<i.t-1;++t)r=i.am(t,i[t],n,2*t,0,1),(n[t+i.t]+=i.am(t+1,2*i[t],n,2*t+1,r,i.t-t-1))>=i.DV&&(n[t+i.t]-=i.DV,n[t+i.t+1]=1);0<n.t&&(n[n.t-1]+=i.am(t,i[t],n,2*t,0,1));n.s=0;n.clamp()};t.prototype.divRemTo=function(n,r,u){var f=n.abs(),o,e,y,h,a;if(!(0>=f.t))if(o=this.abs(),o.t<f.t)null!=r&&r.fromInt(0),null!=u&&this.copyTo(u);else if(null==u&&(u=i()),e=i(),y=this.s,n=n.s,h=this.DB-v(f[f.t-1]),0<h?(f.lShiftTo(h,e),o.lShiftTo(h,u)):(f.copyTo(e),o.copyTo(u)),f=e.t,o=e[f-1],0!=o){var p=o*(1<<this.F1)+(1<f?e[f-2]>>this.F2:0),w=this.FV/p,p=(1<<this.F1)/p,b=1<<this.F2,c=u.t,l=c-f,s=null==r?i():r;for(e.dlShiftTo(l,s),0<=u.compareTo(s)&&(u[u.t++]=1,u.subTo(s,u)),t.ONE.dlShiftTo(f,s),s.subTo(e,e);e.t<f;)e[e.t++]=0;for(;0<=--l;)if(a=u[--c]==o?this.DM:Math.floor(u[c]*w+(u[c-1]+b)*p),(u[c]+=e.am(0,a,u,l,0,f))<a)for(e.dlShiftTo(l,s),u.subTo(s,u);u[c]<--a;)u.subTo(s,u);null!=r&&(u.drShiftTo(f,r),y!=n&&t.ZERO.subTo(r,r));u.t=f;u.clamp();0<h&&u.rShiftTo(h,u);0>y&&t.ZERO.subTo(u,u)}};t.prototype.invDigit=function(){var t;if(1>this.t||(t=this[0],0==(t&1)))return 0;var n=t&3,n=n*(2-(t&15)*n)&15,n=n*(2-(t&255)*n)&255,n=n*(2-((t&65535)*n&65535))&65535,n=n*(2-t*n%this.DV)%this.DV;return 0<n?this.DV-n:-n};t.prototype.isEven=function(){return 0==(0<this.t?this[0]&1:this.s)};t.prototype.exp=function(n,r){if(4294967295<n||1>n)return t.ONE;var u=i(),f=i(),e=r.convert(this),o=v(n)-1;for(e.copyTo(u);0<=--o;)if(r.sqrTo(u,f),0<(n&1<<o))r.mulTo(f,e,u);else var s=u,u=f,f=s;return r.revert(u)};t.prototype.toString=function(n){if(0>this.s)return"-"+this.negate().toString(n);if(16==n)n=4;else if(8==n)n=3;else if(2==n)n=1;else if(32==n)n=5;else if(4==n)n=2;else return this.toRadix(n);var e=(1<<n)-1,r,u=!1,f="",i=this.t,t=this.DB-i*this.DB%n;if(0<i--)for(t<this.DB&&0<(r=this[i]>>t)&&(u=!0,f="0123456789abcdefghijklmnopqrstuvwxyz".charAt(r));0<=i;)t<n?(r=(this[i]&(1<<t)-1)<<n-t,r|=this[--i]>>(t+=this.DB-n)):(r=this[i]>>(t-=n)&e,0>=t&&(t+=this.DB,--i)),0<r&&(u=!0),u&&(f+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(r));return u?f:"0"};t.prototype.negate=function(){var n=i();return t.ZERO.subTo(this,n),n};t.prototype.abs=function(){return 0>this.s?this.negate():this};t.prototype.compareTo=function(n){var t=this.s-n.s,i;if(0!=t)return t;if(i=this.t,t=i-n.t,0!=t)return 0>this.s?-t:t;for(;0<=--i;)if(0!=(t=this[i]-n[i]))return t;return 0};t.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+v(this[this.t-1]^this.s&this.DM)};t.prototype.mod=function(n){var r=i();return this.abs().divRemTo(n,null,r),0>this.s&&0<r.compareTo(t.ZERO)&&n.subTo(r,r),r};t.prototype.modPowInt=function(n,t){var i;return i=256>n||t.isEven()?new s(t):new h(t),this.exp(n,i)};t.ZERO=o(0);t.ONE=o(1);l.prototype.convert=rt;l.prototype.revert=rt;l.prototype.mulTo=function(n,t,i){n.multiplyTo(t,i)};l.prototype.sqrTo=function(n,t){n.squareTo(t)};c.prototype.convert=function(n){if(0>n.s||n.t>2*this.m.t)return n.mod(this.m);if(0>n.compareTo(this.m))return n;var t=i();return n.copyTo(t),this.reduce(t),t};c.prototype.revert=function(n){return n};c.prototype.reduce=function(n){for(n.drShiftTo(this.m.t-1,this.r2),n.t>this.m.t+1&&(n.t=this.m.t+1,n.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>n.compareTo(this.r2);)n.dAddOffset(1,this.m.t+1);for(n.subTo(this.r2,n);0<=n.compareTo(this.m);)n.subTo(this.m,n)};c.prototype.mulTo=function(n,t,i){n.multiplyTo(t,i);this.reduce(i)};c.prototype.sqrTo=function(n,t){n.squareTo(t);this.reduce(t)};f=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997];ft=67108864/f[f.length-1];t.prototype.chunkSize=function(n){return Math.floor(Math.LN2*this.DB/Math.log(n))};t.prototype.toRadix=function(n){if(null==n&&(n=10),0==this.signum()||2>n||36<n)return"0";var u=this.chunkSize(n),u=Math.pow(n,u),e=o(u),t=i(),r=i(),f="";for(this.divRemTo(e,t,r);0<t.signum();)f=(u+r.intValue()).toString(n).substr(1)+f,t.divRemTo(e,t,r);return r.intValue().toString(n)+f};t.prototype.fromRadix=function(n,i){var e;this.fromInt(0);null==i&&(i=10);for(var o=this.chunkSize(i),h=Math.pow(i,o),s=!1,u=0,r=0,f=0;f<n.length;++f)e=nt(n,f),0>e?"-"==n.charAt(f)&&0==this.signum()&&(s=!0):(r=i*r+e,++u>=o&&(this.dMultiply(h),this.dAddOffset(r,0),r=u=0));0<u&&(this.dMultiply(Math.pow(i,u)),this.dAddOffset(r,0));s&&t.ZERO.subTo(this,this)};t.prototype.fromNumber=function(n,i,r){if("number"==typeof i)if(2>n)this.fromInt(1);else for(this.fromNumber(n,r),this.testBit(n-1)||this.bitwiseTo(t.ONE.shiftLeft(n-1),d,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(i);)this.dAddOffset(2,0),this.bitLength()>n&&this.subTo(t.ONE.shiftLeft(n-1),this);else{r=[];var u=n&7;r.length=(n>>3)+1;i.nextBytes(r);r[0]=0<u?r[0]&(1<<u)-1:0;this.fromString(r,256)}};t.prototype.bitwiseTo=function(n,t,i){for(var u,f=Math.min(n.t,this.t),r=0;r<f;++r)i[r]=t(this[r],n[r]);if(n.t<this.t){for(u=n.s&this.DM,r=f;r<this.t;++r)i[r]=t(this[r],u);i.t=this.t}else{for(u=this.s&this.DM,r=f;r<n.t;++r)i[r]=t(u,n[r]);i.t=n.t}i.s=t(this.s,n.s);i.clamp()};t.prototype.changeBit=function(n,i){var r=t.ONE.shiftLeft(n);return this.bitwiseTo(r,i,r),r};t.prototype.addTo=function(n,t){for(var r=0,i=0,u=Math.min(n.t,this.t);r<u;)i+=this[r]+n[r],t[r++]=i&this.DM,i>>=this.DB;if(n.t<this.t){for(i+=n.s;r<this.t;)i+=this[r],t[r++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;r<n.t;)i+=n[r],t[r++]=i&this.DM,i>>=this.DB;i+=n.s}t.s=0>i?-1:0;0<i?t[r++]=i:-1>i&&(t[r++]=this.DV+i);t.t=r;t.clamp()};t.prototype.dMultiply=function(n){this[this.t]=this.am(0,n-1,this,0,0,this.t);++this.t;this.clamp()};t.prototype.dAddOffset=function(n,t){if(0!=n){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=n;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}};t.prototype.multiplyLowerTo=function(n,t,i){var r=Math.min(this.t+n.t,t),u;for(i.s=0,i.t=r;0<r;)i[--r]=0;for(u=i.t-this.t;r<u;++r)i[r+this.t]=this.am(0,n[r],i,r,0,this.t);for(u=Math.min(n.t,t);r<u;++r)this.am(0,n[r],i,r,0,t-r);i.clamp()};t.prototype.multiplyUpperTo=function(n,t,i){--t;var r=i.t=this.t+n.t-t;for(i.s=0;0<=--r;)i[r]=0;for(r=Math.max(t-this.t,0);r<n.t;++r)i[this.t+r-t]=this.am(t-r,n[r],i,0,0,this.t+r-t);i.clamp();i.drShiftTo(1,i)};t.prototype.modInt=function(n){var r,t,i;if(0>=n)return 0;if(r=this.DV%n,t=0>this.s?n-1:0,0<this.t)if(0==r)t=this[0]%n;else for(i=this.t-1;0<=i;--i)t=(r*t+this[i])%n;return t};t.prototype.millerRabin=function(n){var u=this.subtract(t.ONE),e=u.getLowestSetBit(),h,o,s,r,c;if(0>=e)return!1;for(h=u.shiftRight(e),n=n+1>>1,n>f.length&&(n=f.length),o=i(),s=0;s<n;++s)if(o.fromInt(f[Math.floor(Math.random()*f.length)]),r=o.modPow(h,this),0!=r.compareTo(t.ONE)&&0!=r.compareTo(u)){for(c=1;c++<e&&0!=r.compareTo(u);)if(r=r.modPowInt(2,this),0==r.compareTo(t.ONE))return!1;if(0!=r.compareTo(u))return!1}return!0};t.prototype.clone=function(){var n=i();return this.copyTo(n),n};t.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]};t.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24};t.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16};t.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?0:1};t.prototype.toByteArray=function(){var i=this.t,u=[],n,t,r;if(u[0]=this.s,n=this.DB-i*this.DB%8,r=0,0<i--)for(n<this.DB&&(t=this[i]>>n)!=(this.s&this.DM)>>n&&(u[r++]=t|this.s<<this.DB-n);0<=i;)(8>n?(t=(this[i]&(1<<n)-1)<<8-n,t|=this[--i]>>(n+=this.DB-8)):(t=this[i]>>(n-=8)&255,0>=n&&(n+=this.DB,--i)),0!=(t&128)&&(t|=-256),0==r&&(this.s&128)!=(t&128)&&++r,0<r||t!=this.s)&&(u[r++]=t);return u};t.prototype.equals=function(n){return 0==this.compareTo(n)};t.prototype.min=function(n){return 0>this.compareTo(n)?this:n};t.prototype.max=function(n){return 0<this.compareTo(n)?this:n};t.prototype.and=function(n){var t=i();return this.bitwiseTo(n,ht,t),t};t.prototype.or=function(n){var t=i();return this.bitwiseTo(n,d,t),t};t.prototype.xor=function(n){var t=i();return this.bitwiseTo(n,tt,t),t};t.prototype.andNot=function(n){var t=i();return this.bitwiseTo(n,it,t),t};t.prototype.not=function(){for(var n=i(),t=0;t<this.t;++t)n[t]=this.DM&~this[t];return n.t=this.t,n.s=~this.s,n};t.prototype.shiftLeft=function(n){var t=i();return 0>n?this.rShiftTo(-n,t):this.lShiftTo(n,t),t};t.prototype.shiftRight=function(n){var t=i();return 0>n?this.lShiftTo(-n,t):this.rShiftTo(n,t),t};t.prototype.getLowestSetBit=function(){for(var i,t,n=0;n<this.t;++n)if(0!=this[n])return i=n*this.DB,n=this[n],0==n?n=-1:(t=0,0==(n&65535)&&(n>>=16,t+=16),0==(n&255)&&(n>>=8,t+=8),0==(n&15)&&(n>>=4,t+=4),0==(n&3)&&(n>>=2,t+=2),0==(n&1)&&++t,n=t),i+n;return 0>this.s?this.t*this.DB:-1};t.prototype.bitCount=function(){for(var n,i,r=0,u=this.s&this.DM,t=0;t<this.t;++t){for(n=this[t]^u,i=0;0!=n;)n&=n-1,++i;r+=i}return r};t.prototype.testBit=function(n){var t=Math.floor(n/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<n%this.DB)};t.prototype.setBit=function(n){return this.changeBit(n,d)};t.prototype.clearBit=function(n){return this.changeBit(n,it)};t.prototype.flipBit=function(n){return this.changeBit(n,tt)};t.prototype.add=function(n){var t=i();return this.addTo(n,t),t};t.prototype.subtract=function(n){var t=i();return this.subTo(n,t),t};t.prototype.multiply=function(n){var t=i();return this.multiplyTo(n,t),t};t.prototype.divide=function(n){var t=i();return this.divRemTo(n,t,null),t};t.prototype.remainder=function(n){var t=i();return this.divRemTo(n,null,t),t};t.prototype.divideAndRemainder=function(n){var t=i(),r=i();return this.divRemTo(n,t,r),[t,r]};t.prototype.modPow=function(n,t){var r=n.bitLength(),w,f=o(1),e;if(0>=r)return f;w=18>r?1:48>r?3:144>r?4:768>r?5:6;e=8>r?new s(t):t.isEven()?new c(t):new h(t);var y=[],u=3,b=w-1,k=(1<<w)-1;if(y[1]=e.convert(this),1<w)for(r=i(),e.sqrTo(y[1],r);u<=k;)y[u]=i(),e.mulTo(r,y[u-2],y[u]),u+=2;for(var l=n.t-1,p,d=!0,a=i(),r=v(n[l])-1;0<=l;){for(r>=b?p=n[l]>>r-b&k:(p=(n[l]&(1<<r+1)-1)<<b-r,0<l&&(p|=n[l-1]>>this.DB+r-b)),u=w;0==(p&1);)p>>=1,--u;if(0>(r-=u)&&(r+=this.DB,--l),d)y[p].copyTo(f),d=!1;else{for(;1<u;)e.sqrTo(f,a),e.sqrTo(a,f),u-=2;0<u?e.sqrTo(f,a):(u=f,f=a,a=u);e.mulTo(a,y[p],f)}for(;0<=l&&0==(n[l]&1<<r);)e.sqrTo(f,a),u=f,f=a,a=u,0>--r&&(r=this.DB-1,--l)}return e.revert(f)};t.prototype.modInverse=function(n){var h=n.isEven();if(this.isEven()&&h||0==n.signum())return t.ZERO;for(var u=n.clone(),f=this.clone(),e=o(1),r=o(0),s=o(0),i=o(1);0!=u.signum();){for(;u.isEven();)u.rShiftTo(1,u),h?(e.isEven()&&r.isEven()||(e.addTo(this,e),r.subTo(n,r)),e.rShiftTo(1,e)):r.isEven()||r.subTo(n,r),r.rShiftTo(1,r);for(;f.isEven();)f.rShiftTo(1,f),h?(s.isEven()&&i.isEven()||(s.addTo(this,s),i.subTo(n,i)),s.rShiftTo(1,s)):i.isEven()||i.subTo(n,i),i.rShiftTo(1,i);0<=u.compareTo(f)?(u.subTo(f,u),h&&e.subTo(s,e),r.subTo(i,r)):(f.subTo(u,f),h&&s.subTo(e,s),i.subTo(r,i))}if(0!=f.compareTo(t.ONE))return t.ZERO;if(0<=i.compareTo(n))return i.subtract(n);if(0>i.signum())i.addTo(n,i);else return i;return 0>i.signum()?i.add(n):i};t.prototype.pow=function(n){return this.exp(n,new l)};t.prototype.gcd=function(n){var t=0>this.s?this.negate():this.clone(),i,r;if(n=0>n.s?n.negate():n.clone(),0>t.compareTo(n)&&(i=t,t=n,n=i),i=t.getLowestSetBit(),r=n.getLowestSetBit(),0>r)return t;for(i<r&&(r=i),0<r&&(t.rShiftTo(r,t),n.rShiftTo(r,n));0<t.signum();)0<(i=t.getLowestSetBit())&&t.rShiftTo(i,t),0<(i=n.getLowestSetBit())&&n.rShiftTo(i,n),0<=t.compareTo(n)?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return 0<r&&n.lShiftTo(r,n),n};t.prototype.isProbablePrime=function(n){var t,i=this.abs(),r,u;if(1==i.t&&i[0]<=f[f.length-1]){for(t=0;t<f.length;++t)if(i[0]==f[t])return!0;return!1}if(i.isEven())return!1;for(t=1;t<f.length;){for(r=f[t],u=t+1;u<f.length&&r<ft;)r*=f[u++];for(r=i.modInt(r);t<u;)if(0==r%f[t++])return!1}return i.millerRabin(n)};t.prototype.square=function(){var n=i();return this.squareTo(n),n};t.prototype.IsNegative=function(){return-1==this.compareTo(t.ZERO)?!0:!1};t.op_Equality=function(n,t){return 0==n.compareTo(t)?!0:!1};t.op_Inequality=function(n,t){return 0!=n.compareTo(t)?!0:!1};t.op_GreaterThan=function(n,t){return 0<n.compareTo(t)?!0:!1};t.op_LessThan=function(n,t){return 0>n.compareTo(t)?!0:!1};t.op_Addition=function(n,i){return new t(n).add(new t(i))};t.op_Subtraction=function(n,i){return new t(n).subtract(new t(i))};t.Int128Mul=function(n,i){return new t(n).multiply(new t(i))};t.op_Division=function(n,t){return n.divide(t)};t.prototype.ToDouble=function(){return parseFloat(this.toString())};u=function(n,t){var i,u,r;if("undefined"==typeof Object.getOwnPropertyNames)for(i in t.prototype)("undefined"==typeof n.prototype[i]||n.prototype[i]==Object.prototype[i])&&(n.prototype[i]=t.prototype[i]);else for(u=Object.getOwnPropertyNames(t.prototype),r=0;r<u.length;r++)"undefined"==typeof Object.getOwnPropertyDescriptor(n.prototype,u[r])&&Object.defineProperty(n.prototype,u[r],Object.getOwnPropertyDescriptor(t.prototype,u[r]));for(i in t)"undefined"==typeof n[i]&&(n[i]=t[i]);n.$baseCtor=t};n.Path=function(){return[]};n.Paths=function(){return[]};n.DoublePoint=function(){var n=arguments;this.Y=this.X=0;1==n.length?(this.X=n[0].X,this.Y=n[0].Y):2==n.length&&(this.X=n[0],this.Y=n[1])};n.DoublePoint0=function(){this.Y=this.X=0};n.DoublePoint1=function(n){this.X=n.X;this.Y=n.Y};n.DoublePoint2=function(n,t){this.X=n;this.Y=t};n.PolyNode=function(){this.m_Parent=null;this.m_polygon=new n.Path;this.m_endtype=this.m_jointype=this.m_Index=0;this.m_Childs=[];this.IsOpen=!1};n.PolyNode.prototype.IsHoleNode=function(){for(var n=!0,t=this.m_Parent;null!==t;)n=!n,t=t.m_Parent;return n};n.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length};n.PolyNode.prototype.Contour=function(){return this.m_polygon};n.PolyNode.prototype.AddChild=function(n){var t=this.m_Childs.length;this.m_Childs.push(n);n.m_Parent=this;n.m_Index=t};n.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()};n.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]};n.PolyNode.prototype.Childs=function(){return this.m_Childs};n.PolyNode.prototype.Parent=function(){return this.m_Parent};n.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()};n.PolyTree=function(){this.m_AllPolys=[];n.PolyNode.call(this)};n.PolyTree.prototype.Clear=function(){for(var n=0,t=this.m_AllPolys.length;n<t;n++)this.m_AllPolys[n]=null;this.m_AllPolys.length=0;this.m_Childs.length=0};n.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null};n.PolyTree.prototype.Total=function(){var n=this.m_AllPolys.length;return 0<n&&this.m_Childs[0]!=this.m_AllPolys[0]&&n--,n};u(n.PolyTree,n.PolyNode);n.Math_Abs_Int64=n.Math_Abs_Int32=n.Math_Abs_Double=function(n){return Math.abs(n)};n.Math_Max_Int32_Int32=function(n,t){return Math.max(n,t)};n.Cast_Int32=r||b||g?function(n){return n|0}:function(n){return~~n};n.Cast_Int64=p?function(n){return-2147483648>n||2147483647<n?0>n?Math.ceil(n):Math.floor(n):~~n}:w&&"function"==typeof Number.toInteger?function(n){return Number.toInteger(n)}:ut||k?function(n){return parseInt(n,10)}:r?function(n){return-2147483648>n||2147483647<n?0>n?Math.ceil(n):Math.floor(n):n|0}:function(n){return 0>n?Math.ceil(n):Math.floor(n)};n.Clear=function(n){n.length=0};n.PI=3.1415926535897931;n.PI2=6.2831853071795862;n.IntPoint=function(){var t=arguments,i=t.length;this.Y=this.X=0;n.use_xyz?(this.Z=0,3==i?(this.X=t[0],this.Y=t[1],this.Z=t[2]):2==i?(this.X=t[0],this.Y=t[1],this.Z=0):1==i?t[0]instanceof n.DoublePoint?(t=t[0],this.X=n.Clipper.Round(t.X),this.Y=n.Clipper.Round(t.Y),this.Z=0):(t=t[0],"undefined"==typeof t.Z&&(t.Z=0),this.X=t.X,this.Y=t.Y,this.Z=t.Z):this.Z=this.Y=this.X=0):2==i?(this.X=t[0],this.Y=t[1]):1==i?t[0]instanceof n.DoublePoint?(t=t[0],this.X=n.Clipper.Round(t.X),this.Y=n.Clipper.Round(t.Y)):(t=t[0],this.X=t.X,this.Y=t.Y):this.Y=this.X=0};n.IntPoint.op_Equality=function(n,t){return n.X==t.X&&n.Y==t.Y};n.IntPoint.op_Inequality=function(n,t){return n.X!=t.X||n.Y!=t.Y};n.use_xyz?(n.IntPoint0=function(){this.Z=this.Y=this.X=0},n.IntPoint1=function(n){this.X=n.X;this.Y=n.Y;this.Z=n.Z},n.IntPoint1dp=function(t){this.X=n.Clipper.Round(t.X);this.Y=n.Clipper.Round(t.Y);this.Z=0},n.IntPoint2=function(n,t){this.X=n;this.Y=t;this.Z=0},n.IntPoint3=function(n,t,i){this.X=n;this.Y=t;this.Z=i}):(n.IntPoint0=function(){this.Y=this.X=0},n.IntPoint1=function(n){this.X=n.X;this.Y=n.Y},n.IntPoint1dp=function(t){this.X=n.Clipper.Round(t.X);this.Y=n.Clipper.Round(t.Y)},n.IntPoint2=function(n,t){this.X=n;this.Y=t});n.IntRect=function(){var n=arguments,t=n.length;4==t?(this.left=n[0],this.top=n[1],this.right=n[2],this.bottom=n[3]):1==t?(this.left=ir.left,this.top=ir.top,this.right=ir.right,this.bottom=ir.bottom):this.bottom=this.right=this.top=this.left=0};n.IntRect0=function(){this.bottom=this.right=this.top=this.left=0};n.IntRect1=function(n){this.left=n.left;this.top=n.top;this.right=n.right;this.bottom=n.bottom};n.IntRect4=function(n,t,i,r){this.left=n;this.top=t;this.right=i;this.bottom=r};n.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};n.PolyType={ptSubject:0,ptClip:1};n.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};n.JoinType={jtSquare:0,jtRound:1,jtMiter:2};n.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4};n.EdgeSide={esLeft:0,esRight:1};n.Direction={dRightToLeft:0,dLeftToRight:1};n.TEdge=function(){this.Bot=new n.IntPoint;this.Curr=new n.IntPoint;this.Top=new n.IntPoint;this.Delta=new n.IntPoint;this.Dx=0;this.PolyTyp=n.PolyType.ptSubject;this.Side=n.EdgeSide.esLeft;this.OutIdx=this.WindCnt2=this.WindCnt=this.WindDelta=0;this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=this.Next=null};n.IntersectNode=function(){this.Edge2=this.Edge1=null;this.Pt=new n.IntPoint};n.MyIntersectNodeSort=function(){};n.MyIntersectNodeSort.Compare=function(n,t){var i=t.Pt.Y-n.Pt.Y;return 0<i?1:0>i?-1:0};n.LocalMinima=function(){this.Y=0;this.Next=this.RightBound=this.LeftBound=null};n.Scanbeam=function(){this.Y=0;this.Next=null};n.OutRec=function(){this.Idx=0;this.IsOpen=this.IsHole=!1;this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null};n.OutPt=function(){this.Idx=0;this.Pt=new n.IntPoint;this.Prev=this.Next=null};n.Join=function(){this.OutPt2=this.OutPt1=null;this.OffPt=new n.IntPoint};n.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null;this.m_edges=[];this.PreserveCollinear=this.m_HasOpenPaths=this.m_UseFullRange=!1;this.m_CurrentLM=this.m_MinimaList=null;this.m_HasOpenPaths=this.m_UseFullRange=!1};n.ClipperBase.horizontal=-9007199254740992;n.ClipperBase.Skip=-2;n.ClipperBase.Unassigned=-1;n.ClipperBase.tolerance=1e-20;n.ClipperBase.loRange=47453132;n.ClipperBase.hiRange=0xfffffffffffff;n.ClipperBase.near_zero=function(t){return t>-n.ClipperBase.tolerance&&t<n.ClipperBase.tolerance};n.ClipperBase.IsHorizontal=function(n){return 0===n.Delta.Y};n.ClipperBase.prototype.PointIsVertex=function(t,i){var r=i;do{if(n.IntPoint.op_Equality(r.Pt,t))return!0;r=r.Next}while(r!=i);return!1};n.ClipperBase.prototype.PointOnLineSegment=function(n,i,r,u){return u?n.X==i.X&&n.Y==i.Y||n.X==r.X&&n.Y==r.Y||n.X>i.X==n.X<r.X&&n.Y>i.Y==n.Y<r.Y&&t.op_Equality(t.Int128Mul(n.X-i.X,r.Y-i.Y),t.Int128Mul(r.X-i.X,n.Y-i.Y)):n.X==i.X&&n.Y==i.Y||n.X==r.X&&n.Y==r.Y||n.X>i.X==n.X<r.X&&n.Y>i.Y==n.Y<r.Y&&(n.X-i.X)*(r.Y-i.Y)==(r.X-i.X)*(n.Y-i.Y)};n.ClipperBase.prototype.PointOnPolygon=function(n,t,i){for(var r=t;;){if(this.PointOnLineSegment(n,r.Pt,r.Next.Pt,i))return!0;if(r=r.Next,r==t)break}return!1};n.ClipperBase.prototype.SlopesEqual=n.ClipperBase.SlopesEqual=function(){var u=arguments,r=u.length,i,f,e;return 3==r?(r=u[0],i=u[1],(u=u[2])?t.op_Equality(t.Int128Mul(r.Delta.Y,i.Delta.X),t.Int128Mul(r.Delta.X,i.Delta.Y)):n.Cast_Int64(r.Delta.Y*i.Delta.X)==n.Cast_Int64(r.Delta.X*i.Delta.Y)):4==r?(r=u[0],i=u[1],f=u[2],(u=u[3])?t.op_Equality(t.Int128Mul(r.Y-i.Y,i.X-f.X),t.Int128Mul(r.X-i.X,i.Y-f.Y)):0==n.Cast_Int64((r.Y-i.Y)*(i.X-f.X))-n.Cast_Int64((r.X-i.X)*(i.Y-f.Y))):(r=u[0],i=u[1],f=u[2],e=u[3],(u=u[4])?t.op_Equality(t.Int128Mul(r.Y-i.Y,f.X-e.X),t.Int128Mul(r.X-i.X,f.Y-e.Y)):0==n.Cast_Int64((r.Y-i.Y)*(f.X-e.X))-n.Cast_Int64((r.X-i.X)*(f.Y-e.Y)))};n.ClipperBase.SlopesEqual3=function(i,r,u){return u?t.op_Equality(t.Int128Mul(i.Delta.Y,r.Delta.X),t.Int128Mul(i.Delta.X,r.Delta.Y)):n.Cast_Int64(i.Delta.Y*r.Delta.X)==n.Cast_Int64(i.Delta.X*r.Delta.Y)};n.ClipperBase.SlopesEqual4=function(i,r,u,f){return f?t.op_Equality(t.Int128Mul(i.Y-r.Y,r.X-u.X),t.Int128Mul(i.X-r.X,r.Y-u.Y)):0==n.Cast_Int64((i.Y-r.Y)*(r.X-u.X))-n.Cast_Int64((i.X-r.X)*(r.Y-u.Y))};n.ClipperBase.SlopesEqual5=function(i,r,u,f,e){return e?t.op_Equality(t.Int128Mul(i.Y-r.Y,u.X-f.X),t.Int128Mul(i.X-r.X,u.Y-f.Y)):0==n.Cast_Int64((i.Y-r.Y)*(u.X-f.X))-n.Cast_Int64((i.X-r.X)*(u.Y-f.Y))};n.ClipperBase.prototype.Clear=function(){var t,r,i,u;for(this.DisposeLocalMinimaList(),t=0,r=this.m_edges.length;t<r;++t){for(i=0,u=this.m_edges[t].length;i<u;++i)this.m_edges[t][i]=null;n.Clear(this.m_edges[t])}n.Clear(this.m_edges);this.m_HasOpenPaths=this.m_UseFullRange=!1};n.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var n=this.m_MinimaList.Next;this.m_MinimaList=null;this.m_MinimaList=n}this.m_CurrentLM=null};n.ClipperBase.prototype.RangeTest=function(t,i){i.Value?(t.X>n.ClipperBase.hiRange||t.Y>n.ClipperBase.hiRange||-t.X>n.ClipperBase.hiRange||-t.Y>n.ClipperBase.hiRange)&&n.Error("Coordinate outside allowed range in RangeTest()."):(t.X>n.ClipperBase.loRange||t.Y>n.ClipperBase.loRange||-t.X>n.ClipperBase.loRange||-t.Y>n.ClipperBase.loRange)&&(i.Value=!0,this.RangeTest(t,i))};n.ClipperBase.prototype.InitEdge=function(t,i,r,u){t.Next=i;t.Prev=r;t.Curr.X=u.X;t.Curr.Y=u.Y;n.use_xyz&&(t.Curr.Z=u.Z);t.OutIdx=-1};n.ClipperBase.prototype.InitEdge2=function(t,i){t.Curr.Y>=t.Next.Curr.Y?(t.Bot.X=t.Curr.X,t.Bot.Y=t.Curr.Y,n.use_xyz&&(t.Bot.Z=t.Curr.Z),t.Top.X=t.Next.Curr.X,t.Top.Y=t.Next.Curr.Y,n.use_xyz&&(t.Top.Z=t.Next.Curr.Z)):(t.Top.X=t.Curr.X,t.Top.Y=t.Curr.Y,n.use_xyz&&(t.Top.Z=t.Curr.Z),t.Bot.X=t.Next.Curr.X,t.Bot.Y=t.Next.Curr.Y,n.use_xyz&&(t.Bot.Z=t.Next.Curr.Z));this.SetDx(t);t.PolyTyp=i};n.ClipperBase.prototype.FindNextLocMin=function(t){for(var i;;){for(;n.IntPoint.op_Inequality(t.Bot,t.Prev.Bot)||n.IntPoint.op_Equality(t.Curr,t.Top);)t=t.Next;if(t.Dx!=n.ClipperBase.horizontal&&t.Prev.Dx!=n.ClipperBase.horizontal)break;for(;t.Prev.Dx==n.ClipperBase.horizontal;)t=t.Prev;for(i=t;t.Dx==n.ClipperBase.horizontal;)t=t.Next;if(t.Top.Y!=t.Prev.Bot.Y){i.Prev.Bot.X<t.Bot.X&&(t=i);break}}return t};n.ClipperBase.prototype.ProcessBound=function(t,i){var u,r=t,f;if(r.OutIdx==n.ClipperBase.Skip){if(t=r,i){for(;t.Top.Y==t.Next.Bot.Y;)t=t.Next;for(;t!=r&&t.Dx==n.ClipperBase.horizontal;)t=t.Prev}else{for(;t.Top.Y==t.Prev.Bot.Y;)t=t.Prev;for(;t!=r&&t.Dx==n.ClipperBase.horizontal;)t=t.Next}return t==r?r=i?t.Next:t.Prev:(t=i?r.Next:r.Prev,u=new n.LocalMinima,u.Next=null,u.Y=t.Bot.Y,u.LeftBound=null,u.RightBound=t,t.WindDelta=0,r=this.ProcessBound(t,i),this.InsertLocalMinima(u)),r}if(t.Dx==n.ClipperBase.horizontal&&(u=i?t.Prev:t.Next,u.OutIdx!=n.ClipperBase.Skip&&(u.Dx==n.ClipperBase.horizontal?u.Bot.X!=t.Bot.X&&u.Top.X!=t.Bot.X&&this.ReverseHorizontal(t):u.Bot.X!=t.Bot.X&&this.ReverseHorizontal(t))),u=t,i){for(;r.Top.Y==r.Next.Bot.Y&&r.Next.OutIdx!=n.ClipperBase.Skip;)r=r.Next;if(r.Dx==n.ClipperBase.horizontal&&r.Next.OutIdx!=n.ClipperBase.Skip){for(f=r;f.Prev.Dx==n.ClipperBase.horizontal;)f=f.Prev;f.Prev.Top.X==r.Next.Top.X?i||(r=f.Prev):f.Prev.Top.X>r.Next.Top.X&&(r=f.Prev)}for(;t!=r;)t.NextInLML=t.Next,t.Dx==n.ClipperBase.horizontal&&t!=u&&t.Bot.X!=t.Prev.Top.X&&this.ReverseHorizontal(t),t=t.Next;t.Dx==n.ClipperBase.horizontal&&t!=u&&t.Bot.X!=t.Prev.Top.X&&this.ReverseHorizontal(t);r=r.Next}else{for(;r.Top.Y==r.Prev.Bot.Y&&r.Prev.OutIdx!=n.ClipperBase.Skip;)r=r.Prev;if(r.Dx==n.ClipperBase.horizontal&&r.Prev.OutIdx!=n.ClipperBase.Skip){for(f=r;f.Next.Dx==n.ClipperBase.horizontal;)f=f.Next;f.Next.Top.X==r.Prev.Top.X?i||(r=f.Next):f.Next.Top.X>r.Prev.Top.X&&(r=f.Next)}for(;t!=r;)t.NextInLML=t.Prev,t.Dx==n.ClipperBase.horizontal&&t!=u&&t.Bot.X!=t.Next.Top.X&&this.ReverseHorizontal(t),t=t.Prev;t.Dx==n.ClipperBase.horizontal&&t!=u&&t.Bot.X!=t.Next.Top.X&&this.ReverseHorizontal(t);r=r.Prev}return r};n.ClipperBase.prototype.AddPath=function(t,i,r){var u,f,e,s,o;if(n.use_lines?r||i!=n.PolyType.ptClip||n.Error("AddPath: Open paths must be subject."):r||n.Error("AddPath: Open paths have been disabled."),u=t.length-1,r)for(;0<u&&n.IntPoint.op_Equality(t[u],t[0]);)--u;for(;0<u&&n.IntPoint.op_Equality(t[u],t[u-1]);)--u;if(r&&2>u||!r&&1>u)return!1;for(f=[],e=0;e<=u;e++)f.push(new n.TEdge);for(s=!0,f[1].Curr.X=t[1].X,f[1].Curr.Y=t[1].Y,n.use_xyz&&(f[1].Curr.Z=t[1].Z),o={Value:this.m_UseFullRange},this.RangeTest(t[0],o),this.m_UseFullRange=o.Value,o.Value=this.m_UseFullRange,this.RangeTest(t[u],o),this.m_UseFullRange=o.Value,this.InitEdge(f[0],f[1],f[u],t[0]),this.InitEdge(f[u],f[0],f[u-1],t[u]),e=u-1;1<=e;--e)o.Value=this.m_UseFullRange,this.RangeTest(t[e],o),this.m_UseFullRange=o.Value,this.InitEdge(f[e],f[e+1],f[e-1],t[e]);for(e=t=u=f[0];;)if(t.Curr==t.Next.Curr&&(r||t.Next!=u)){if(t==t.Next)break;t==u&&(u=t.Next);e=t=this.RemoveEdge(t)}else{if(t.Prev==t.Next)break;else if(r&&n.ClipperBase.SlopesEqual(t.Prev.Curr,t.Curr,t.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(t.Prev.Curr,t.Curr,t.Next.Curr))){t==u&&(u=t.Next);t=this.RemoveEdge(t);e=t=t.Prev;continue}if(t=t.Next,t==e||!r&&t.Next==u)break}if(!r&&t==t.Next||r&&t.Prev==t.Next)return!1;r||(this.m_HasOpenPaths=!0,u.Prev.OutIdx=n.ClipperBase.Skip);t=u;do this.InitEdge2(t,i),t=t.Next,s&&t.Curr.Y!=u.Curr.Y&&(s=!1);while(t!=u);if(s){if(r)return!1;for(t.Prev.OutIdx=n.ClipperBase.Skip,t.Prev.Bot.X<t.Prev.Top.X&&this.ReverseHorizontal(t.Prev),i=new n.LocalMinima,i.Next=null,i.Y=t.Bot.Y,i.LeftBound=null,i.RightBound=t,i.RightBound.Side=n.EdgeSide.esRight,i.RightBound.WindDelta=0;t.Next.OutIdx!=n.ClipperBase.Skip;)t.NextInLML=t.Next,t.Bot.X!=t.Prev.Top.X&&this.ReverseHorizontal(t),t=t.Next;return this.InsertLocalMinima(i),this.m_edges.push(f),!0}for(this.m_edges.push(f),s=null,n.IntPoint.op_Equality(t.Prev.Bot,t.Prev.Top)&&(t=t.Next);;){if(t=this.FindNextLocMin(t),t==s)break;else null==s&&(s=t);i=new n.LocalMinima;i.Next=null;i.Y=t.Bot.Y;t.Dx<t.Prev.Dx?(i.LeftBound=t.Prev,i.RightBound=t,f=!1):(i.LeftBound=t,i.RightBound=t.Prev,f=!0);i.LeftBound.Side=n.EdgeSide.esLeft;i.RightBound.Side=n.EdgeSide.esRight;i.LeftBound.WindDelta=r?i.LeftBound.Next==i.RightBound?-1:1:0;i.RightBound.WindDelta=-i.LeftBound.WindDelta;t=this.ProcessBound(i.LeftBound,f);t.OutIdx==n.ClipperBase.Skip&&(t=this.ProcessBound(t,f));u=this.ProcessBound(i.RightBound,!f);u.OutIdx==n.ClipperBase.Skip&&(u=this.ProcessBound(u,!f));i.LeftBound.OutIdx==n.ClipperBase.Skip?i.LeftBound=null:i.RightBound.OutIdx==n.ClipperBase.Skip&&(i.RightBound=null);this.InsertLocalMinima(i);f||(t=u)}return!0};n.ClipperBase.prototype.AddPaths=function(n,t,i){for(var u=!1,r=0,f=n.length;r<f;++r)this.AddPath(n[r],t,i)&&(u=!0);return u};n.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(t,i,r){return n.IntPoint.op_Equality(t,r)||n.IntPoint.op_Equality(t,i)||n.IntPoint.op_Equality(r,i)?!1:t.X!=r.X?i.X>t.X==i.X<r.X:i.Y>t.Y==i.Y<r.Y};n.ClipperBase.prototype.RemoveEdge=function(n){n.Prev.Next=n.Next;n.Next.Prev=n.Prev;var t=n.Next;return n.Prev=null,t};n.ClipperBase.prototype.SetDx=function(t){t.Delta.X=t.Top.X-t.Bot.X;t.Delta.Y=t.Top.Y-t.Bot.Y;t.Dx=0===t.Delta.Y?n.ClipperBase.horizontal:t.Delta.X/t.Delta.Y};n.ClipperBase.prototype.InsertLocalMinima=function(n){if(null===this.m_MinimaList)this.m_MinimaList=n;else if(n.Y>=this.m_MinimaList.Y)n.Next=this.m_MinimaList,this.m_MinimaList=n;else{for(var t=this.m_MinimaList;null!==t.Next&&n.Y<t.Next.Y;)t=t.Next;n.Next=t.Next;t.Next=n}};n.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)};n.ClipperBase.prototype.ReverseHorizontal=function(t){var i=t.Top.X;t.Top.X=t.Bot.X;t.Bot.X=i;n.use_xyz&&(i=t.Top.Z,t.Top.Z=t.Bot.Z,t.Bot.Z=i)};n.ClipperBase.prototype.Reset=function(){var i,t;if(this.m_CurrentLM=this.m_MinimaList,null!=this.m_CurrentLM)for(i=this.m_MinimaList;null!=i;)t=i.LeftBound,null!=t&&(t.Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,n.use_xyz&&(t.Curr.Z=t.Bot.Z),t.Side=n.EdgeSide.esLeft,t.OutIdx=n.ClipperBase.Unassigned),t=i.RightBound,null!=t&&(t.Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,n.use_xyz&&(t.Curr.Z=t.Bot.Z),t.Side=n.EdgeSide.esRight,t.OutIdx=n.ClipperBase.Unassigned),i=i.Next};n.Clipper=function(t){"undefined"==typeof t&&(t=0);this.m_PolyOuts=null;this.m_ClipType=n.ClipType.ctIntersection;this.m_IntersectNodeComparer=this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_ExecuteLocked=!1;this.m_SubjFillType=this.m_ClipFillType=n.PolyFillType.pftEvenOdd;this.m_GhostJoins=this.m_Joins=null;this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1;n.ClipperBase.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_IntersectList=[];this.m_IntersectNodeComparer=n.MyIntersectNodeSort.Compare;this.m_UsingPolyTree=this.m_ExecuteLocked=!1;this.m_PolyOuts=[];this.m_Joins=[];this.m_GhostJoins=[];this.ReverseSolution=0!=(1&t);this.StrictlySimple=0!=(2&t);this.PreserveCollinear=0!=(4&t);n.use_xyz&&(this.ZFillFunction=null)};n.Clipper.ioReverseSolution=1;n.Clipper.ioStrictlySimple=2;n.Clipper.ioPreserveCollinear=4;n.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),n.ClipperBase.prototype.Clear.call(this))};n.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var n=this.m_Scanbeam.Next;this.m_Scanbeam=null;this.m_Scanbeam=n}};n.Clipper.prototype.Reset=function(){n.ClipperBase.prototype.Reset.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;for(var t=this.m_MinimaList;null!==t;)this.InsertScanbeam(t.Y),t=t.Next};n.Clipper.prototype.InsertScanbeam=function(t){var i,r;if(null===this.m_Scanbeam)this.m_Scanbeam=new n.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=t;else if(t>this.m_Scanbeam.Y)i=new n.Scanbeam,i.Y=t,i.Next=this.m_Scanbeam,this.m_Scanbeam=i;else{for(r=this.m_Scanbeam;null!==r.Next&&t<=r.Next.Y;)r=r.Next;t!=r.Y&&(i=new n.Scanbeam,i.Y=t,i.Next=r.Next,r.Next=i)}};n.Clipper.prototype.Execute=function(){var t=arguments,i=t.length,r=t[1]instanceof n.PolyTree,f;if(4!=i||r){if(4==i&&r){var i=t[0],u=t[1],r=t[2],t=t[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;this.m_SubjFillType=r;this.m_ClipFillType=t;this.m_ClipType=i;this.m_UsingPolyTree=!0;try{(f=this.ExecuteInternal())&&this.BuildResult2(u)}finally{this.DisposeAllPolyPts();this.m_ExecuteLocked=!1}return f}if(2==i&&!r||2==i&&r)return i=t[0],u=t[1],this.Execute(i,u,n.PolyFillType.pftEvenOdd,n.PolyFillType.pftEvenOdd)}else{if(i=t[0],u=t[1],r=t[2],t=t[3],this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&n.Error("Error: PolyTree struct is need for open path clipping.");this.m_ExecuteLocked=!0;n.Clear(u);this.m_SubjFillType=r;this.m_ClipFillType=t;this.m_ClipType=i;this.m_UsingPolyTree=!1;try{f=this.ExecuteInternal();f&&this.BuildResult(u)}finally{this.DisposeAllPolyPts();this.m_ExecuteLocked=!1}return f}};n.Clipper.prototype.FixHoleLinkage=function(n){if(null!==n.FirstLeft&&(n.IsHole==n.FirstLeft.IsHole||null===n.FirstLeft.Pts)){for(var t=n.FirstLeft;null!==t&&(t.IsHole==n.IsHole||null===t.Pts);)t=t.FirstLeft;n.FirstLeft=t}};n.Clipper.prototype.ExecuteInternal=function(){var r,t,u,i;try{if(this.Reset(),null===this.m_CurrentLM)return!1;t=this.PopScanbeam();do{if(this.InsertLocalMinimaIntoAEL(t),n.Clear(this.m_GhostJoins),this.ProcessHorizontals(!1),null===this.m_Scanbeam)break;if(r=this.PopScanbeam(),!this.ProcessIntersections(r))return!1;this.ProcessEdgesAtTopOfScanbeam(r);t=r}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);for(t=0,u=this.m_PolyOuts.length;t<u;t++)i=this.m_PolyOuts[t],null===i.Pts||i.IsOpen||(i.IsHole^this.ReverseSolution)==0<this.Area(i)&&this.ReversePolyPtLinks(i.Pts);for(this.JoinCommonEdges(),t=0,u=this.m_PolyOuts.length;t<u;t++)i=this.m_PolyOuts[t],null===i.Pts||i.IsOpen||this.FixupOutPolygon(i);return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{n.Clear(this.m_Joins);n.Clear(this.m_GhostJoins)}};n.Clipper.prototype.PopScanbeam=function(){var n=this.m_Scanbeam.Y;return this.m_Scanbeam=this.m_Scanbeam.Next,n};n.Clipper.prototype.DisposeAllPolyPts=function(){for(var t=0,i=this.m_PolyOuts.length;t<i;++t)this.DisposeOutRec(t);n.Clear(this.m_PolyOuts)};n.Clipper.prototype.DisposeOutRec=function(n){this.m_PolyOuts[n].Pts=null;this.m_PolyOuts[n]=null};n.Clipper.prototype.AddJoin=function(t,i,r){var u=new n.Join;u.OutPt1=t;u.OutPt2=i;u.OffPt.X=r.X;u.OffPt.Y=r.Y;n.use_xyz&&(u.OffPt.Z=r.Z);this.m_Joins.push(u)};n.Clipper.prototype.AddGhostJoin=function(t,i){var r=new n.Join;r.OutPt1=t;r.OffPt.X=i.X;r.OffPt.Y=i.Y;n.use_xyz&&(r.OffPt.Z=i.Z);this.m_GhostJoins.push(r)};n.Clipper.prototype.SetZ=function(t,i,r){null!==this.ZFillFunction&&0==t.Z&&null!==this.ZFillFunction&&(n.IntPoint.op_Equality(t,i.Bot)?t.Z=i.Bot.Z:n.IntPoint.op_Equality(t,i.Top)?t.Z=i.Top.Z:n.IntPoint.op_Equality(t,r.Bot)?t.Z=r.Bot.Z:n.IntPoint.op_Equality(t,r.Top)?t.Z=r.Top.Z:this.ZFillFunction(i.Bot,i.Top,r.Bot,r.Top,t))};n.Clipper.prototype.InsertLocalMinimaIntoAEL=function(t){for(var i,r,u,f,o,e;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==t;)if(i=this.m_CurrentLM.LeftBound,r=this.m_CurrentLM.RightBound,this.PopLocalMinima(),u=null,null===i?(this.InsertEdgeIntoAEL(r,null),this.SetWindingCount(r),this.IsContributing(r)&&(u=this.AddOutPt(r,r.Bot))):(null==r?(this.InsertEdgeIntoAEL(i,null),this.SetWindingCount(i),this.IsContributing(i)&&(u=this.AddOutPt(i,i.Bot))):(this.InsertEdgeIntoAEL(i,null),this.InsertEdgeIntoAEL(r,i),this.SetWindingCount(i),r.WindCnt=i.WindCnt,r.WindCnt2=i.WindCnt2,this.IsContributing(i)&&(u=this.AddLocalMinPoly(i,r,i.Bot))),this.InsertScanbeam(i.Top.Y)),null!=r&&(n.ClipperBase.IsHorizontal(r)?this.AddEdgeToSEL(r):this.InsertScanbeam(r.Top.Y)),null!=i&&null!=r){if(null!==u&&n.ClipperBase.IsHorizontal(r)&&0<this.m_GhostJoins.length&&0!==r.WindDelta)for(f=0,o=this.m_GhostJoins.length;f<o;f++)e=this.m_GhostJoins[f],this.HorzSegmentsOverlap(e.OutPt1.Pt.X,e.OffPt.X,r.Bot.X,r.Top.X)&&this.AddJoin(e.OutPt1,u,e.OffPt);if(0<=i.OutIdx&&null!==i.PrevInAEL&&i.PrevInAEL.Curr.X==i.Bot.X&&0<=i.PrevInAEL.OutIdx&&n.ClipperBase.SlopesEqual(i.PrevInAEL,i,this.m_UseFullRange)&&0!==i.WindDelta&&0!==i.PrevInAEL.WindDelta&&(f=this.AddOutPt(i.PrevInAEL,i.Bot),this.AddJoin(u,f,i.Top)),i.NextInAEL!=r&&(0<=r.OutIdx&&0<=r.PrevInAEL.OutIdx&&n.ClipperBase.SlopesEqual(r.PrevInAEL,r,this.m_UseFullRange)&&0!==r.WindDelta&&0!==r.PrevInAEL.WindDelta&&(f=this.AddOutPt(r.PrevInAEL,r.Bot),this.AddJoin(u,f,r.Top)),u=i.NextInAEL,null!==u))for(;u!=r;)this.IntersectEdges(r,u,i.Curr,!1),u=u.NextInAEL}};n.Clipper.prototype.InsertEdgeIntoAEL=function(n,t){if(null===this.m_ActiveEdges)n.PrevInAEL=null,n.NextInAEL=null,this.m_ActiveEdges=n;else if(null===t&&this.E2InsertsBeforeE1(this.m_ActiveEdges,n))n.PrevInAEL=null,n.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=n;else{for(null===t&&(t=this.m_ActiveEdges);null!==t.NextInAEL&&!this.E2InsertsBeforeE1(t.NextInAEL,n);)t=t.NextInAEL;n.NextInAEL=t.NextInAEL;null!==t.NextInAEL&&(t.NextInAEL.PrevInAEL=n);n.PrevInAEL=t;t.NextInAEL=n}};n.Clipper.prototype.E2InsertsBeforeE1=function(t,i){return i.Curr.X==t.Curr.X?i.Top.Y>t.Top.Y?i.Top.X<n.Clipper.TopX(t,i.Top.Y):t.Top.X>n.Clipper.TopX(i,t.Top.Y):i.Curr.X<t.Curr.X};n.Clipper.prototype.IsEvenOddFillType=function(t){return t.PolyTyp==n.PolyType.ptSubject?this.m_SubjFillType==n.PolyFillType.pftEvenOdd:this.m_ClipFillType==n.PolyFillType.pftEvenOdd};n.Clipper.prototype.IsEvenOddAltFillType=function(t){return t.PolyTyp==n.PolyType.ptSubject?this.m_ClipFillType==n.PolyFillType.pftEvenOdd:this.m_SubjFillType==n.PolyFillType.pftEvenOdd};n.Clipper.prototype.IsContributing=function(t){var r,i;t.PolyTyp==n.PolyType.ptSubject?(r=this.m_SubjFillType,i=this.m_ClipFillType):(r=this.m_ClipFillType,i=this.m_SubjFillType);switch(r){case n.PolyFillType.pftEvenOdd:if(0===t.WindDelta&&1!=t.WindCnt)return!1;break;case n.PolyFillType.pftNonZero:if(1!=Math.abs(t.WindCnt))return!1;break;case n.PolyFillType.pftPositive:if(1!=t.WindCnt)return!1;break;default:if(-1!=t.WindCnt)return!1}switch(this.m_ClipType){case n.ClipType.ctIntersection:switch(i){case n.PolyFillType.pftEvenOdd:case n.PolyFillType.pftNonZero:return 0!==t.WindCnt2;case n.PolyFillType.pftPositive:return 0<t.WindCnt2;default:return 0>t.WindCnt2}case n.ClipType.ctUnion:switch(i){case n.PolyFillType.pftEvenOdd:case n.PolyFillType.pftNonZero:return 0===t.WindCnt2;case n.PolyFillType.pftPositive:return 0>=t.WindCnt2;default:return 0<=t.WindCnt2}case n.ClipType.ctDifference:if(t.PolyTyp==n.PolyType.ptSubject)switch(i){case n.PolyFillType.pftEvenOdd:case n.PolyFillType.pftNonZero:return 0===t.WindCnt2;case n.PolyFillType.pftPositive:return 0>=t.WindCnt2;default:return 0<=t.WindCnt2}else switch(i){case n.PolyFillType.pftEvenOdd:case n.PolyFillType.pftNonZero:return 0!==t.WindCnt2;case n.PolyFillType.pftPositive:return 0<t.WindCnt2;default:return 0>t.WindCnt2}case n.ClipType.ctXor:if(0===t.WindDelta)switch(i){case n.PolyFillType.pftEvenOdd:case n.PolyFillType.pftNonZero:return 0===t.WindCnt2;case n.PolyFillType.pftPositive:return 0>=t.WindCnt2;default:return 0<=t.WindCnt2}}return!0};n.Clipper.prototype.SetWindingCount=function(t){for(var u,r,i=t.PrevInAEL;null!==i&&(i.PolyTyp!=t.PolyTyp||0===i.WindDelta);)i=i.PrevInAEL;if(null===i)t.WindCnt=0===t.WindDelta?1:t.WindDelta,t.WindCnt2=0,i=this.m_ActiveEdges;else{if(0===t.WindDelta&&this.m_ClipType!=n.ClipType.ctUnion)t.WindCnt=1;else if(this.IsEvenOddFillType(t))if(0===t.WindDelta){for(u=!0,r=i.PrevInAEL;null!==r;)r.PolyTyp==i.PolyTyp&&0!==r.WindDelta&&(u=!u),r=r.PrevInAEL;t.WindCnt=u?0:1}else t.WindCnt=t.WindDelta;else t.WindCnt=0>i.WindCnt*i.WindDelta?1<Math.abs(i.WindCnt)?0>i.WindDelta*t.WindDelta?i.WindCnt:i.WindCnt+t.WindDelta:0===t.WindDelta?1:t.WindDelta:0===t.WindDelta?0>i.WindCnt?i.WindCnt-1:i.WindCnt+1:0>i.WindDelta*t.WindDelta?i.WindCnt:i.WindCnt+t.WindDelta;t.WindCnt2=i.WindCnt2;i=i.NextInAEL}if(this.IsEvenOddAltFillType(t))for(;i!=t;)0!==i.WindDelta&&(t.WindCnt2=0===t.WindCnt2?1:0),i=i.NextInAEL;else for(;i!=t;)t.WindCnt2+=i.WindDelta,i=i.NextInAEL};n.Clipper.prototype.AddEdgeToSEL=function(n){null===this.m_SortedEdges?(this.m_SortedEdges=n,n.PrevInSEL=null,n.NextInSEL=null):(n.NextInSEL=this.m_SortedEdges,n.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=n)};n.Clipper.prototype.CopyAELToSEL=function(){var n=this.m_ActiveEdges;for(this.m_SortedEdges=n;null!==n;)n.PrevInSEL=n.PrevInAEL,n=n.NextInSEL=n.NextInAEL};n.Clipper.prototype.SwapPositionsInAEL=function(n,t){var i,r;n.NextInAEL!=n.PrevInAEL&&t.NextInAEL!=t.PrevInAEL&&(n.NextInAEL==t?(i=t.NextInAEL,null!==i&&(i.PrevInAEL=n),r=n.PrevInAEL,null!==r&&(r.NextInAEL=t),t.PrevInAEL=r,t.NextInAEL=n,n.PrevInAEL=t,n.NextInAEL=i):t.NextInAEL==n?(i=n.NextInAEL,null!==i&&(i.PrevInAEL=t),r=t.PrevInAEL,null!==r&&(r.NextInAEL=n),n.PrevInAEL=r,n.NextInAEL=t,t.PrevInAEL=n,t.NextInAEL=i):(i=n.NextInAEL,r=n.PrevInAEL,n.NextInAEL=t.NextInAEL,null!==n.NextInAEL&&(n.NextInAEL.PrevInAEL=n),n.PrevInAEL=t.PrevInAEL,null!==n.PrevInAEL&&(n.PrevInAEL.NextInAEL=n),t.NextInAEL=i,null!==t.NextInAEL&&(t.NextInAEL.PrevInAEL=t),t.PrevInAEL=r,null!==t.PrevInAEL&&(t.PrevInAEL.NextInAEL=t)),null===n.PrevInAEL?this.m_ActiveEdges=n:null===t.PrevInAEL&&(this.m_ActiveEdges=t))};n.Clipper.prototype.SwapPositionsInSEL=function(n,t){var i,r;(null!==n.NextInSEL||null!==n.PrevInSEL)&&(null!==t.NextInSEL||null!==t.PrevInSEL)&&(n.NextInSEL==t?(i=t.NextInSEL,null!==i&&(i.PrevInSEL=n),r=n.PrevInSEL,null!==r&&(r.NextInSEL=t),t.PrevInSEL=r,t.NextInSEL=n,n.PrevInSEL=t,n.NextInSEL=i):t.NextInSEL==n?(i=n.NextInSEL,null!==i&&(i.PrevInSEL=t),r=t.PrevInSEL,null!==r&&(r.NextInSEL=n),n.PrevInSEL=r,n.NextInSEL=t,t.PrevInSEL=n,t.NextInSEL=i):(i=n.NextInSEL,r=n.PrevInSEL,n.NextInSEL=t.NextInSEL,null!==n.NextInSEL&&(n.NextInSEL.PrevInSEL=n),n.PrevInSEL=t.PrevInSEL,null!==n.PrevInSEL&&(n.PrevInSEL.NextInSEL=n),t.NextInSEL=i,null!==t.NextInSEL&&(t.NextInSEL.PrevInSEL=t),t.PrevInSEL=r,null!==t.PrevInSEL&&(t.PrevInSEL.NextInSEL=t)),null===n.PrevInSEL?this.m_SortedEdges=n:null===t.PrevInSEL&&(this.m_SortedEdges=t))};n.Clipper.prototype.AddLocalMaxPoly=function(n,t,i){this.AddOutPt(n,i);0==t.WindDelta&&this.AddOutPt(t,i);n.OutIdx==t.OutIdx?(n.OutIdx=-1,t.OutIdx=-1):n.OutIdx<t.OutIdx?this.AppendPolygon(n,t):this.AppendPolygon(t,n)};n.Clipper.prototype.AddLocalMinPoly=function(t,i,r){var f,u;return n.ClipperBase.IsHorizontal(i)||t.Dx>i.Dx?(f=this.AddOutPt(t,r),i.OutIdx=t.OutIdx,t.Side=n.EdgeSide.esLeft,i.Side=n.EdgeSide.esRight,u=t,t=u.PrevInAEL==i?i.PrevInAEL:u.PrevInAEL):(f=this.AddOutPt(i,r),t.OutIdx=i.OutIdx,t.Side=n.EdgeSide.esRight,i.Side=n.EdgeSide.esLeft,u=i,t=u.PrevInAEL==t?t.PrevInAEL:u.PrevInAEL),null!==t&&0<=t.OutIdx&&n.Clipper.TopX(t,r.Y)==n.Clipper.TopX(u,r.Y)&&n.ClipperBase.SlopesEqual(u,t,this.m_UseFullRange)&&0!==u.WindDelta&&0!==t.WindDelta&&(r=this.AddOutPt(t,r),this.AddJoin(f,r,u.Top)),f};n.Clipper.prototype.CreateOutRec=function(){var t=new n.OutRec;return t.Idx=-1,t.IsHole=!1,t.IsOpen=!1,t.FirstLeft=null,t.Pts=null,t.BottomPt=null,t.PolyNode=null,this.m_PolyOuts.push(t),t.Idx=this.m_PolyOuts.length-1,t};n.Clipper.prototype.AddOutPt=function(t,i){var e=t.Side==n.EdgeSide.esLeft,r,u,f;if(0>t.OutIdx)u=this.CreateOutRec(),u.IsOpen=0===t.WindDelta,r=new n.OutPt,u.Pts=r,r.Idx=u.Idx,r.Pt.X=i.X,r.Pt.Y=i.Y,n.use_xyz&&(r.Pt.Z=i.Z),r.Next=r,r.Prev=r,u.IsOpen||this.SetHoleState(t,u),t.OutIdx=u.Idx;else{if(u=this.m_PolyOuts[t.OutIdx],f=u.Pts,e&&n.IntPoint.op_Equality(i,f.Pt))return f;if(!e&&n.IntPoint.op_Equality(i,f.Prev.Pt))return f.Prev;r=new n.OutPt;r.Idx=u.Idx;r.Pt.X=i.X;r.Pt.Y=i.Y;n.use_xyz&&(r.Pt.Z=i.Z);r.Next=f;r.Prev=f.Prev;r.Prev.Next=r;f.Prev=r;e&&(u.Pts=r)}return r};n.Clipper.prototype.SwapPoints=function(t,i){var r=new n.IntPoint(t.Value);t.Value.X=i.Value.X;t.Value.Y=i.Value.Y;n.use_xyz&&(t.Value.Z=i.Value.Z);i.Value.X=r.X;i.Value.Y=r.Y;n.use_xyz&&(i.Value.Z=r.Z)};n.Clipper.prototype.HorzSegmentsOverlap=function(n,t,i,r){var u;return n>t&&(u=n,n=t,t=u),i>r&&(u=i,i=r,r=u),n<r&&i<t};n.Clipper.prototype.SetHoleState=function(n,t){for(var r=!1,i=n.PrevInAEL;null!==i;)0<=i.OutIdx&&0!=i.WindDelta&&(r=!r,null===t.FirstLeft&&(t.FirstLeft=this.m_PolyOuts[i.OutIdx])),i=i.PrevInAEL;r&&(t.IsHole=!0)};n.Clipper.prototype.GetDx=function(t,i){return t.Y==i.Y?n.ClipperBase.horizontal:(i.X-t.X)/(i.Y-t.Y)};n.Clipper.prototype.FirstIsBottomPt=function(t,i){for(var u,f,e,r=t.Prev;n.IntPoint.op_Equality(r.Pt,t.Pt)&&r!=t;)r=r.Prev;for(u=Math.abs(this.GetDx(t.Pt,r.Pt)),r=t.Next;n.IntPoint.op_Equality(r.Pt,t.Pt)&&r!=t;)r=r.Next;for(f=Math.abs(this.GetDx(t.Pt,r.Pt)),r=i.Prev;n.IntPoint.op_Equality(r.Pt,i.Pt)&&r!=i;)r=r.Prev;for(e=Math.abs(this.GetDx(i.Pt,r.Pt)),r=i.Next;n.IntPoint.op_Equality(r.Pt,i.Pt)&&r!=i;)r=r.Next;return r=Math.abs(this.GetDx(i.Pt,r.Pt)),u>=e&&u>=r||f>=e&&f>=r};n.Clipper.prototype.GetBottomPt=function(t){for(var r=null,i=t.Next;i!=t;)i.Pt.Y>t.Pt.Y?(t=i,r=null):i.Pt.Y==t.Pt.Y&&i.Pt.X<=t.Pt.X&&(i.Pt.X<t.Pt.X?(r=null,t=i):i.Next!=t&&i.Prev!=t&&(r=i)),i=i.Next;if(null!==r)for(;r!=i;)for(this.FirstIsBottomPt(i,r)||(t=r),r=r.Next;n.IntPoint.op_Inequality(r.Pt,t.Pt);)r=r.Next;return t};n.Clipper.prototype.GetLowermostRec=function(n,t){null===n.BottomPt&&(n.BottomPt=this.GetBottomPt(n.Pts));null===t.BottomPt&&(t.BottomPt=this.GetBottomPt(t.Pts));var i=n.BottomPt,r=t.BottomPt;return i.Pt.Y>r.Pt.Y?n:i.Pt.Y<r.Pt.Y?t:i.Pt.X<r.Pt.X?n:i.Pt.X>r.Pt.X?t:i.Next==i?t:r.Next==r?n:this.FirstIsBottomPt(i,r)?n:t};n.Clipper.prototype.Param1RightOfParam2=function(n,t){do if(n=n.FirstLeft,n==t)return!0;while(null!==n);return!1};n.Clipper.prototype.GetOutRec=function(n){for(n=this.m_PolyOuts[n];n!=this.m_PolyOuts[n.Idx];)n=this.m_PolyOuts[n.Idx];return n};n.Clipper.prototype.AppendPolygon=function(t,i){var u=this.m_PolyOuts[t.OutIdx],f=this.m_PolyOuts[i.OutIdx],h=this.Param1RightOfParam2(u,f)?f:this.Param1RightOfParam2(f,u)?u:this.GetLowermostRec(u,f);var e=u.Pts,o=e.Prev,r=f.Pts,s=r.Prev;for(t.Side==n.EdgeSide.esLeft?(i.Side==n.EdgeSide.esLeft?(this.ReversePolyPtLinks(r),r.Next=e,e.Prev=r,o.Next=s,s.Prev=o,u.Pts=s):(s.Next=e,e.Prev=s,r.Prev=o,o.Next=r,u.Pts=r),e=n.EdgeSide.esLeft):(i.Side==n.EdgeSide.esRight?(this.ReversePolyPtLinks(r),o.Next=s,s.Prev=o,r.Next=e,e.Prev=r):(o.Next=r,r.Prev=o,e.Prev=s,s.Next=e),e=n.EdgeSide.esRight),u.BottomPt=null,h==f&&(f.FirstLeft!=u&&(u.FirstLeft=f.FirstLeft),u.IsHole=f.IsHole),f.Pts=null,f.BottomPt=null,f.FirstLeft=u,h=t.OutIdx,o=i.OutIdx,t.OutIdx=-1,i.OutIdx=-1,r=this.m_ActiveEdges;null!==r;){if(r.OutIdx==o){r.OutIdx=h;r.Side=e;break}r=r.NextInAEL}f.Idx=u.Idx};n.Clipper.prototype.ReversePolyPtLinks=function(n){if(null!==n){var t,i;t=n;do i=t.Next,t.Next=t.Prev,t=t.Prev=i;while(t!=n)}};n.Clipper.SwapSides=function(n,t){var i=n.Side;n.Side=t.Side;t.Side=i};n.Clipper.SwapPolyIndexes=function(n,t){var i=n.OutIdx;n.OutIdx=t.OutIdx;t.OutIdx=i};n.Clipper.prototype.IntersectEdges=function(t,i,r){var e=0<=t.OutIdx,o=0<=i.OutIdx,s,u,f,h;if(n.use_xyz&&this.SetZ(r,t,i),n.use_lines&&(0===t.WindDelta||0===i.WindDelta))(0!=t.WindDelta||0!=i.WindDelta)&&(t.PolyTyp==i.PolyTyp&&t.WindDelta!=i.WindDelta&&this.m_ClipType==n.ClipType.ctUnion?0===t.WindDelta?o&&(this.AddOutPt(t,r),e&&(t.OutIdx=-1)):e&&(this.AddOutPt(i,r),o&&(i.OutIdx=-1)):t.PolyTyp!=i.PolyTyp&&(0!==t.WindDelta||1!=Math.abs(i.WindCnt)||this.m_ClipType==n.ClipType.ctUnion&&0!==i.WindCnt2?0!==i.WindDelta||1!=Math.abs(t.WindCnt)||this.m_ClipType==n.ClipType.ctUnion&&0!==t.WindCnt2||(this.AddOutPt(i,r),o&&(i.OutIdx=-1)):(this.AddOutPt(t,r),e&&(t.OutIdx=-1))));else{t.PolyTyp==i.PolyTyp?this.IsEvenOddFillType(t)?(s=t.WindCnt,t.WindCnt=i.WindCnt,i.WindCnt=s):(t.WindCnt=0===t.WindCnt+i.WindDelta?-t.WindCnt:t.WindCnt+i.WindDelta,i.WindCnt=0==i.WindCnt-t.WindDelta?-i.WindCnt:i.WindCnt-t.WindDelta):(this.IsEvenOddFillType(i)?t.WindCnt2=0===t.WindCnt2?1:0:t.WindCnt2+=i.WindDelta,this.IsEvenOddFillType(t)?i.WindCnt2=0===i.WindCnt2?1:0:i.WindCnt2-=t.WindDelta);t.PolyTyp==n.PolyType.ptSubject?(u=this.m_SubjFillType,h=this.m_ClipFillType):(u=this.m_ClipFillType,h=this.m_SubjFillType);i.PolyTyp==n.PolyType.ptSubject?(f=this.m_SubjFillType,s=this.m_ClipFillType):(f=this.m_ClipFillType,s=this.m_SubjFillType);switch(u){case n.PolyFillType.pftPositive:u=t.WindCnt;break;case n.PolyFillType.pftNegative:u=-t.WindCnt;break;default:u=Math.abs(t.WindCnt)}switch(f){case n.PolyFillType.pftPositive:f=i.WindCnt;break;case n.PolyFillType.pftNegative:f=-i.WindCnt;break;default:f=Math.abs(i.WindCnt)}if(e&&o)0!=u&&1!=u||0!=f&&1!=f||t.PolyTyp!=i.PolyTyp&&this.m_ClipType!=n.ClipType.ctXor?this.AddLocalMaxPoly(t,i,r):(this.AddOutPt(t,r),this.AddOutPt(i,r),n.Clipper.SwapSides(t,i),n.Clipper.SwapPolyIndexes(t,i));else if(e)(0===f||1==f)&&(this.AddOutPt(t,r),n.Clipper.SwapSides(t,i),n.Clipper.SwapPolyIndexes(t,i));else if(o)(0===u||1==u)&&(this.AddOutPt(i,r),n.Clipper.SwapSides(t,i),n.Clipper.SwapPolyIndexes(t,i));else if(!(0!=u&&1!=u||0!=f&&1!=f)){switch(h){case n.PolyFillType.pftPositive:e=t.WindCnt2;break;case n.PolyFillType.pftNegative:e=-t.WindCnt2;break;default:e=Math.abs(t.WindCnt2)}switch(s){case n.PolyFillType.pftPositive:o=i.WindCnt2;break;case n.PolyFillType.pftNegative:o=-i.WindCnt2;break;default:o=Math.abs(i.WindCnt2)}if(t.PolyTyp!=i.PolyTyp)this.AddLocalMinPoly(t,i,r);else if(1==u&&1==f)switch(this.m_ClipType){case n.ClipType.ctIntersection:0<e&&0<o&&this.AddLocalMinPoly(t,i,r);break;case n.ClipType.ctUnion:0>=e&&0>=o&&this.AddLocalMinPoly(t,i,r);break;case n.ClipType.ctDifference:(t.PolyTyp==n.PolyType.ptClip&&0<e&&0<o||t.PolyTyp==n.PolyType.ptSubject&&0>=e&&0>=o)&&this.AddLocalMinPoly(t,i,r);break;case n.ClipType.ctXor:this.AddLocalMinPoly(t,i,r)}else n.Clipper.SwapSides(t,i)}}};n.Clipper.prototype.DeleteFromAEL=function(n){var i=n.PrevInAEL,t=n.NextInAEL;(null!==i||null!==t||n==this.m_ActiveEdges)&&(null!==i?i.NextInAEL=t:this.m_ActiveEdges=t,null!==t&&(t.PrevInAEL=i),n.NextInAEL=null,n.PrevInAEL=null)};n.Clipper.prototype.DeleteFromSEL=function(n){var i=n.PrevInSEL,t=n.NextInSEL;(null!==i||null!==t||n==this.m_SortedEdges)&&(null!==i?i.NextInSEL=t:this.m_SortedEdges=t,null!==t&&(t.PrevInSEL=i),n.NextInSEL=null,n.PrevInSEL=null)};n.Clipper.prototype.UpdateEdgeIntoAEL=function(t){null===t.NextInLML&&n.Error("UpdateEdgeIntoAEL: invalid call");var i=t.PrevInAEL,r=t.NextInAEL;return t.NextInLML.OutIdx=t.OutIdx,null!==i?i.NextInAEL=t.NextInLML:this.m_ActiveEdges=t.NextInLML,null!==r&&(r.PrevInAEL=t.NextInLML),t.NextInLML.Side=t.Side,t.NextInLML.WindDelta=t.WindDelta,t.NextInLML.WindCnt=t.WindCnt,t.NextInLML.WindCnt2=t.WindCnt2,t=t.NextInLML,t.Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,n.use_xyz&&(t.Curr.Z=t.Bot.Z),t.PrevInAEL=i,t.NextInAEL=r,n.ClipperBase.IsHorizontal(t)||this.InsertScanbeam(t.Top.Y),t};n.Clipper.prototype.ProcessHorizontals=function(n){for(var t=this.m_SortedEdges;null!==t;)this.DeleteFromSEL(t),this.ProcessHorizontal(t,n),t=this.m_SortedEdges};n.Clipper.prototype.GetHorzDirection=function(t,i){t.Bot.X<t.Top.X?(i.Left=t.Bot.X,i.Right=t.Top.X,i.Dir=n.Direction.dLeftToRight):(i.Left=t.Top.X,i.Right=t.Bot.X,i.Dir=n.Direction.dRightToLeft)};n.Clipper.prototype.ProcessHorizontal=function(t,i){var r={Dir:null,Left:null,Right:null},l,f,c;this.GetHorzDirection(t,r);for(var u=r.Dir,o=r.Left,h=r.Right,s=t,e=null;null!==s.NextInLML&&n.ClipperBase.IsHorizontal(s.NextInLML);)s=s.NextInLML;for(null===s.NextInLML&&(e=this.GetMaximaPair(s));;){for(l=t==s,f=this.GetNextInAEL(t,u);null!==f&&!(f.Curr.X==t.Top.X&&null!==t.NextInLML&&f.Dx<t.NextInLML.Dx);){if(r=this.GetNextInAEL(f,u),u==n.Direction.dLeftToRight&&f.Curr.X<=h||u==n.Direction.dRightToLeft&&f.Curr.X>=o){if(f==e&&l){if(0<=t.OutIdx){for(u=this.AddOutPt(t,t.Top),r=this.m_SortedEdges;null!==r;)0<=r.OutIdx&&this.HorzSegmentsOverlap(t.Bot.X,t.Top.X,r.Bot.X,r.Top.X)&&(o=this.AddOutPt(r,r.Bot),this.AddJoin(o,u,r.Top)),r=r.NextInSEL;this.AddGhostJoin(u,t.Bot);this.AddLocalMaxPoly(t,e,t.Top)}this.DeleteFromAEL(t);this.DeleteFromAEL(e);return}u==n.Direction.dLeftToRight?(c=new n.IntPoint(f.Curr.X,t.Curr.Y),this.IntersectEdges(t,f,c)):(c=new n.IntPoint(f.Curr.X,t.Curr.Y),this.IntersectEdges(f,t,c));this.SwapPositionsInAEL(t,f)}else if(u==n.Direction.dLeftToRight&&f.Curr.X>=h||u==n.Direction.dRightToLeft&&f.Curr.X<=o)break;f=r}if(null!==t.NextInLML&&n.ClipperBase.IsHorizontal(t.NextInLML))t=this.UpdateEdgeIntoAEL(t),0<=t.OutIdx&&this.AddOutPt(t,t.Bot),r={Dir:u,Left:o,Right:h},this.GetHorzDirection(t,r),u=r.Dir,o=r.Left,h=r.Right;else break}null!==t.NextInLML?0<=t.OutIdx?(u=this.AddOutPt(t,t.Top),i&&this.AddGhostJoin(u,t.Bot),t=this.UpdateEdgeIntoAEL(t),0!==t.WindDelta&&(e=t.PrevInAEL,r=t.NextInAEL,null!==e&&e.Curr.X==t.Bot.X&&e.Curr.Y==t.Bot.Y&&0!==e.WindDelta&&0<=e.OutIdx&&e.Curr.Y>e.Top.Y&&n.ClipperBase.SlopesEqual(t,e,this.m_UseFullRange)?(o=this.AddOutPt(e,t.Bot),this.AddJoin(u,o,t.Top)):null!==r&&r.Curr.X==t.Bot.X&&r.Curr.Y==t.Bot.Y&&0!==r.WindDelta&&0<=r.OutIdx&&r.Curr.Y>r.Top.Y&&n.ClipperBase.SlopesEqual(t,r,this.m_UseFullRange)&&(o=this.AddOutPt(r,t.Bot),this.AddJoin(u,o,t.Top)))):this.UpdateEdgeIntoAEL(t):(0<=t.OutIdx&&this.AddOutPt(t,t.Top),this.DeleteFromAEL(t))};n.Clipper.prototype.GetNextInAEL=function(t,i){return i==n.Direction.dLeftToRight?t.NextInAEL:t.PrevInAEL};n.Clipper.prototype.IsMinima=function(n){return null!==n&&n.Prev.NextInLML!=n&&n.Next.NextInLML!=n};n.Clipper.prototype.IsMaxima=function(n,t){return null!==n&&n.Top.Y==t&&null===n.NextInLML};n.Clipper.prototype.IsIntermediate=function(n,t){return n.Top.Y==t&&null!==n.NextInLML};n.Clipper.prototype.GetMaximaPair=function(t){var i=null;return n.IntPoint.op_Equality(t.Next.Top,t.Top)&&null===t.Next.NextInLML?i=t.Next:n.IntPoint.op_Equality(t.Prev.Top,t.Top)&&null===t.Prev.NextInLML&&(i=t.Prev),null===i||-2!=i.OutIdx&&(i.NextInAEL!=i.PrevInAEL||n.ClipperBase.IsHorizontal(i))?i:null};n.Clipper.prototype.ProcessIntersections=function(t){if(null==this.m_ActiveEdges)return!0;try{if(this.BuildIntersectList(t),0==this.m_IntersectList.length)return!0;if(1==this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1}catch(i){this.m_SortedEdges=null;this.m_IntersectList.length=0;n.Error("ProcessIntersections error")}return this.m_SortedEdges=null,!0};n.Clipper.prototype.BuildIntersectList=function(t){var i,r,u;if(null!==this.m_ActiveEdges){for(i=this.m_ActiveEdges,this.m_SortedEdges=i;null!==i;)i.PrevInSEL=i.PrevInAEL,i.NextInSEL=i.NextInAEL,i.Curr.X=n.Clipper.TopX(i,t),i=i.NextInAEL;for(r=!0;r&&null!==this.m_SortedEdges;){for(r=!1,i=this.m_SortedEdges;null!==i.NextInSEL;)t=i.NextInSEL,u=new n.IntPoint,i.Curr.X>t.Curr.X?(this.IntersectPoint(i,t,u),r=new n.IntersectNode,r.Edge1=i,r.Edge2=t,r.Pt.X=u.X,r.Pt.Y=u.Y,n.use_xyz&&(r.Pt.Z=u.Z),this.m_IntersectList.push(r),this.SwapPositionsInSEL(i,t),r=!0):i=t;if(null!==i.PrevInSEL)i.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=null}};n.Clipper.prototype.EdgesAdjacent=function(n){return n.Edge1.NextInSEL==n.Edge2||n.Edge1.PrevInSEL==n.Edge2};n.Clipper.IntersectNodeSort=function(n,t){return t.Pt.Y-n.Pt.Y};n.Clipper.prototype.FixupIntersectionOrder=function(){var i,n,t,r;for(this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL(),i=this.m_IntersectList.length,n=0;n<i;n++){if(!this.EdgesAdjacent(this.m_IntersectList[n])){for(t=n+1;t<i&&!this.EdgesAdjacent(this.m_IntersectList[t]);)t++;if(t==i)return!1;r=this.m_IntersectList[n];this.m_IntersectList[n]=this.m_IntersectList[t];this.m_IntersectList[t]=r}this.SwapPositionsInSEL(this.m_IntersectList[n].Edge1,this.m_IntersectList[n].Edge2)}return!0};n.Clipper.prototype.ProcessIntersectList=function(){for(var n,t=0,i=this.m_IntersectList.length;t<i;t++)n=this.m_IntersectList[t],this.IntersectEdges(n.Edge1,n.Edge2,n.Pt),this.SwapPositionsInAEL(n.Edge1,n.Edge2);this.m_IntersectList.length=0};p=function(n){return 0>n?Math.ceil(n-.5):Math.round(n)};w=function(n){return 0>n?Math.ceil(n-.5):Math.floor(n+.5)};b=function(n){return 0>n?-Math.round(Math.abs(n)):Math.round(n)};k=function(n){return 0>n?(n-=.5,-2147483648>n?Math.ceil(n):n|0):(n+=.5,2147483647<n?Math.floor(n):n|0)};n.Clipper.Round=r?p:y?b:g?k:w;n.Clipper.TopX=function(t,i){return i==t.Top.Y?t.Top.X:t.Bot.X+n.Clipper.Round(t.Dx*(i-t.Bot.Y))};n.Clipper.prototype.IntersectPoint=function(t,i,r){var u,f,e;if(r.X=0,r.Y=0,t.Dx==i.Dx)r.Y=t.Curr.Y,r.X=n.Clipper.TopX(t,r.Y);else{if(0===t.Delta.X?(r.X=t.Bot.X,n.ClipperBase.IsHorizontal(i)?r.Y=i.Bot.Y:(f=i.Bot.Y-i.Bot.X/i.Dx,r.Y=n.Clipper.Round(r.X/i.Dx+f))):0===i.Delta.X?(r.X=i.Bot.X,n.ClipperBase.IsHorizontal(t)?r.Y=t.Bot.Y:(u=t.Bot.Y-t.Bot.X/t.Dx,r.Y=n.Clipper.Round(r.X/t.Dx+u))):(u=t.Bot.X-t.Bot.Y*t.Dx,f=i.Bot.X-i.Bot.Y*i.Dx,e=(f-u)/(t.Dx-i.Dx),r.Y=n.Clipper.Round(e),r.X=Math.abs(t.Dx)<Math.abs(i.Dx)?n.Clipper.Round(t.Dx*e+u):n.Clipper.Round(i.Dx*e+f)),r.Y<t.Top.Y||r.Y<i.Top.Y){if(t.Top.Y>i.Top.Y)return r.Y=t.Top.Y,r.X=n.Clipper.TopX(i,t.Top.Y),r.X<t.Top.X;r.Y=i.Top.Y;r.X=Math.abs(t.Dx)<Math.abs(i.Dx)?n.Clipper.TopX(t,r.Y):n.Clipper.TopX(i,r.Y)}r.Y>t.Curr.Y&&(r.Y=t.Curr.Y,r.X=Math.abs(t.Dx)>Math.abs(i.Dx)?n.Clipper.TopX(i,r.Y):n.Clipper.TopX(t,r.Y))}};n.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(t){for(var u,r,f,i=this.m_ActiveEdges;null!==i;)u=this.IsMaxima(i,t),u&&(u=this.GetMaximaPair(i),u=null===u||!n.ClipperBase.IsHorizontal(u)),u?(r=i.PrevInAEL,this.DoMaxima(i),i=null===r?this.m_ActiveEdges:r.NextInAEL):(this.IsIntermediate(i,t)&&n.ClipperBase.IsHorizontal(i.NextInLML)?(i=this.UpdateEdgeIntoAEL(i),0<=i.OutIdx&&this.AddOutPt(i,i.Bot),this.AddEdgeToSEL(i)):(i.Curr.X=n.Clipper.TopX(i,t),i.Curr.Y=t),this.StrictlySimple&&(r=i.PrevInAEL,0<=i.OutIdx&&0!==i.WindDelta&&null!==r&&0<=r.OutIdx&&r.Curr.X==i.Curr.X&&0!==r.WindDelta)&&(f=new n.IntPoint(i.Curr),n.use_xyz&&this.SetZ(f,r,i),u=this.AddOutPt(r,f),r=this.AddOutPt(i,f),this.AddJoin(u,r,f)),i=i.NextInAEL);for(this.ProcessHorizontals(!0),i=this.m_ActiveEdges;null!==i;)this.IsIntermediate(i,t)&&(u=null,0<=i.OutIdx&&(u=this.AddOutPt(i,i.Top)),i=this.UpdateEdgeIntoAEL(i),r=i.PrevInAEL,f=i.NextInAEL,null!==r&&r.Curr.X==i.Bot.X&&r.Curr.Y==i.Bot.Y&&null!==u&&0<=r.OutIdx&&r.Curr.Y>r.Top.Y&&n.ClipperBase.SlopesEqual(i,r,this.m_UseFullRange)&&0!==i.WindDelta&&0!==r.WindDelta?(r=this.AddOutPt(r,i.Bot),this.AddJoin(u,r,i.Top)):null!==f&&f.Curr.X==i.Bot.X&&f.Curr.Y==i.Bot.Y&&null!==u&&0<=f.OutIdx&&f.Curr.Y>f.Top.Y&&n.ClipperBase.SlopesEqual(i,f,this.m_UseFullRange)&&0!==i.WindDelta&&0!==f.WindDelta&&(r=this.AddOutPt(f,i.Bot),this.AddJoin(u,r,i.Top))),i=i.NextInAEL};n.Clipper.prototype.DoMaxima=function(t){var i=this.GetMaximaPair(t),r;if(null===i)0<=t.OutIdx&&this.AddOutPt(t,t.Top),this.DeleteFromAEL(t);else{for(r=t.NextInAEL;null!==r&&r!=i;)this.IntersectEdges(t,r,t.Top),this.SwapPositionsInAEL(t,r),r=t.NextInAEL;-1==t.OutIdx&&-1==i.OutIdx?(this.DeleteFromAEL(t),this.DeleteFromAEL(i)):0<=t.OutIdx&&0<=i.OutIdx?(0<=t.OutIdx&&this.AddLocalMaxPoly(t,i,t.Top),this.DeleteFromAEL(t),this.DeleteFromAEL(i)):n.use_lines&&0===t.WindDelta?(0<=t.OutIdx&&(this.AddOutPt(t,t.Top),t.OutIdx=-1),this.DeleteFromAEL(t),0<=i.OutIdx&&(this.AddOutPt(i,t.Top),i.OutIdx=-1),this.DeleteFromAEL(i)):n.Error("DoMaxima error")}};n.Clipper.ReversePaths=function(n){for(var t=0,i=n.length;t<i;t++)n[t].reverse()};n.Clipper.Orientation=function(t){return 0<=n.Clipper.Area(t)};n.Clipper.prototype.PointCount=function(n){if(null===n)return 0;var i=0,t=n;do i++,t=t.Next;while(t!=n);return i};n.Clipper.prototype.BuildResult=function(t){var r,o,i,u,e,f;for(n.Clear(t),r=0,o=this.m_PolyOuts.length;r<o;r++)if(i=this.m_PolyOuts[r],null!==i.Pts&&(i=i.Pts.Prev,u=this.PointCount(i),!(2>u))){for(e=Array(u),f=0;f<u;f++)e[f]=i.Pt,i=i.Prev;t.push(e)}};n.Clipper.prototype.BuildResult2=function(t){var r,e,u,f,i,o;for(t.Clear(),r=0,e=this.m_PolyOuts.length;r<e;r++)if(i=this.m_PolyOuts[r],u=this.PointCount(i.Pts),!(i.IsOpen&&2>u||!i.IsOpen&&3>u))for(this.FixHoleLinkage(i),f=new n.PolyNode,t.m_AllPolys.push(f),i.PolyNode=f,f.m_polygon.length=u,i=i.Pts.Prev,o=0;o<u;o++)f.m_polygon[o]=i.Pt,i=i.Prev;for(r=0,e=this.m_PolyOuts.length;r<e;r++)i=this.m_PolyOuts[r],null!==i.PolyNode&&(i.IsOpen?(i.PolyNode.IsOpen=!0,t.AddChild(i.PolyNode)):null!==i.FirstLeft&&null!=i.FirstLeft.PolyNode?i.FirstLeft.PolyNode.AddChild(i.PolyNode):t.AddChild(i.PolyNode))};n.Clipper.prototype.FixupOutPolygon=function(t){var r=null,i;for(t.BottomPt=null,i=t.Pts;;){if(i.Prev==i||i.Prev==i.Next){t.Pts=null;return}if(n.IntPoint.op_Equality(i.Pt,i.Next.Pt)||n.IntPoint.op_Equality(i.Pt,i.Prev.Pt)||n.ClipperBase.SlopesEqual(i.Prev.Pt,i.Pt,i.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(i.Prev.Pt,i.Pt,i.Next.Pt)))r=null,i.Prev.Next=i.Next,i=i.Next.Prev=i.Prev;else if(i==r)break;else null===r&&(r=i),i=i.Next}t.Pts=i};n.Clipper.prototype.DupOutPt=function(t,i){var r=new n.OutPt;return r.Pt.X=t.Pt.X,r.Pt.Y=t.Pt.Y,n.use_xyz&&(r.Pt.Z=t.Pt.Z),r.Idx=t.Idx,i?(r.Next=t.Next,r.Prev=t,t.Next.Prev=r,t.Next=r):(r.Prev=t.Prev,r.Next=t,t.Prev.Next=r,t.Prev=r),r};n.Clipper.prototype.GetOverlap=function(n,t,i,r,u){return n<t?i<r?(u.Left=Math.max(n,i),u.Right=Math.min(t,r)):(u.Left=Math.max(n,r),u.Right=Math.min(t,i)):i<r?(u.Left=Math.max(t,i),u.Right=Math.min(n,r)):(u.Left=Math.max(t,r),u.Right=Math.min(n,i)),u.Left<u.Right};n.Clipper.prototype.JoinHorz=function(t,i,r,u,f,e){var o=t.Pt.X>i.Pt.X?n.Direction.dRightToLeft:n.Direction.dLeftToRight;if(u=r.Pt.X>u.Pt.X?n.Direction.dRightToLeft:n.Direction.dLeftToRight,o==u)return!1;if(o==n.Direction.dLeftToRight){for(;t.Next.Pt.X<=f.X&&t.Next.Pt.X>=t.Pt.X&&t.Next.Pt.Y==f.Y;)t=t.Next;e&&t.Pt.X!=f.X&&(t=t.Next);i=this.DupOutPt(t,!e);n.IntPoint.op_Inequality(i.Pt,f)&&(t=i,t.Pt.X=f.X,t.Pt.Y=f.Y,n.use_xyz&&(t.Pt.Z=f.Z),i=this.DupOutPt(t,!e))}else{for(;t.Next.Pt.X>=f.X&&t.Next.Pt.X<=t.Pt.X&&t.Next.Pt.Y==f.Y;)t=t.Next;e||t.Pt.X==f.X||(t=t.Next);i=this.DupOutPt(t,e);n.IntPoint.op_Inequality(i.Pt,f)&&(t=i,t.Pt.X=f.X,t.Pt.Y=f.Y,n.use_xyz&&(t.Pt.Z=f.Z),i=this.DupOutPt(t,e))}if(u==n.Direction.dLeftToRight){for(;r.Next.Pt.X<=f.X&&r.Next.Pt.X>=r.Pt.X&&r.Next.Pt.Y==f.Y;)r=r.Next;e&&r.Pt.X!=f.X&&(r=r.Next);u=this.DupOutPt(r,!e);n.IntPoint.op_Inequality(u.Pt,f)&&(r=u,r.Pt.X=f.X,r.Pt.Y=f.Y,n.use_xyz&&(r.Pt.Z=f.Z),u=this.DupOutPt(r,!e))}else{for(;r.Next.Pt.X>=f.X&&r.Next.Pt.X<=r.Pt.X&&r.Next.Pt.Y==f.Y;)r=r.Next;e||r.Pt.X==f.X||(r=r.Next);u=this.DupOutPt(r,e);n.IntPoint.op_Inequality(u.Pt,f)&&(r=u,r.Pt.X=f.X,r.Pt.Y=f.Y,n.use_xyz&&(r.Pt.Z=f.Z),u=this.DupOutPt(r,e))}return o==n.Direction.dLeftToRight==e?(t.Prev=r,r.Next=t,i.Next=u,u.Prev=i):(t.Next=r,r.Prev=t,i.Prev=u,u.Next=i),!0};n.Clipper.prototype.JoinPoints=function(t,i,r){var e=t.OutPt1,u,o,f,s,h;if(new n.OutPt,o=t.OutPt2,new n.OutPt,(f=t.OutPt1.Pt.Y==t.OffPt.Y)&&n.IntPoint.op_Equality(t.OffPt,t.OutPt1.Pt)&&n.IntPoint.op_Equality(t.OffPt,t.OutPt2.Pt)){if(i!=r)return!1;for(u=t.OutPt1.Next;u!=e&&n.IntPoint.op_Equality(u.Pt,t.OffPt);)u=u.Next;for(u=u.Pt.Y>t.OffPt.Y,f=t.OutPt2.Next;f!=o&&n.IntPoint.op_Equality(f.Pt,t.OffPt);)f=f.Next;return u==f.Pt.Y>t.OffPt.Y?!1:(u?(u=this.DupOutPt(e,!1),f=this.DupOutPt(o,!0),e.Prev=o,o.Next=e,u.Next=f,f.Prev=u):(u=this.DupOutPt(e,!0),f=this.DupOutPt(o,!1),e.Next=o,o.Prev=e,u.Prev=f,f.Next=u),t.OutPt1=e,t.OutPt2=u,!0)}if(f){for(u=e;e.Prev.Pt.Y==e.Pt.Y&&e.Prev!=u&&e.Prev!=o;)e=e.Prev;for(;u.Next.Pt.Y==u.Pt.Y&&u.Next!=e&&u.Next!=o;)u=u.Next;if(u.Next==e||u.Next==o)return!1;for(f=o;o.Prev.Pt.Y==o.Pt.Y&&o.Prev!=f&&o.Prev!=u;)o=o.Prev;for(;f.Next.Pt.Y==f.Pt.Y&&f.Next!=o&&f.Next!=e;)f=f.Next;return f.Next==o||f.Next==e?!1:(r={Left:null,Right:null},!this.GetOverlap(e.Pt.X,u.Pt.X,o.Pt.X,f.Pt.X,r))?!1:(i=r.Left,s=r.Right,r=new n.IntPoint,e.Pt.X>=i&&e.Pt.X<=s?(r.X=e.Pt.X,r.Y=e.Pt.Y,n.use_xyz&&(r.Z=e.Pt.Z),i=e.Pt.X>u.Pt.X):o.Pt.X>=i&&o.Pt.X<=s?(r.X=o.Pt.X,r.Y=o.Pt.Y,n.use_xyz&&(r.Z=o.Pt.Z),i=o.Pt.X>f.Pt.X):u.Pt.X>=i&&u.Pt.X<=s?(r.X=u.Pt.X,r.Y=u.Pt.Y,n.use_xyz&&(r.Z=u.Pt.Z),i=u.Pt.X>e.Pt.X):(r.X=f.Pt.X,r.Y=f.Pt.Y,n.use_xyz&&(r.Z=f.Pt.Z),i=f.Pt.X>o.Pt.X),t.OutPt1=e,t.OutPt2=o,this.JoinHorz(e,u,o,f,r,i))}for(u=e.Next;n.IntPoint.op_Equality(u.Pt,e.Pt)&&u!=e;)u=u.Next;if(s=u.Pt.Y>e.Pt.Y||!n.ClipperBase.SlopesEqual(e.Pt,u.Pt,t.OffPt,this.m_UseFullRange)){for(u=e.Prev;n.IntPoint.op_Equality(u.Pt,e.Pt)&&u!=e;)u=u.Prev;if(u.Pt.Y>e.Pt.Y||!n.ClipperBase.SlopesEqual(e.Pt,u.Pt,t.OffPt,this.m_UseFullRange))return!1}for(f=o.Next;n.IntPoint.op_Equality(f.Pt,o.Pt)&&f!=o;)f=f.Next;if(h=f.Pt.Y>o.Pt.Y||!n.ClipperBase.SlopesEqual(o.Pt,f.Pt,t.OffPt,this.m_UseFullRange),h){for(f=o.Prev;n.IntPoint.op_Equality(f.Pt,o.Pt)&&f!=o;)f=f.Prev;if(f.Pt.Y>o.Pt.Y||!n.ClipperBase.SlopesEqual(o.Pt,f.Pt,t.OffPt,this.m_UseFullRange))return!1}return u==e||f==o||u==f||i==r&&s==h?!1:(s?(u=this.DupOutPt(e,!1),f=this.DupOutPt(o,!0),e.Prev=o,o.Next=e,u.Next=f,f.Prev=u):(u=this.DupOutPt(e,!0),f=this.DupOutPt(o,!1),e.Next=o,o.Prev=e,u.Prev=f,f.Next=u),t.OutPt1=e,t.OutPt2=u,!0)};n.Clipper.GetBounds=function(t){for(var r,u,e,i=0,f=t.length;i<f&&0==t[i].length;)i++;if(i==f)return new n.IntRect(0,0,0,0);for(r=new n.IntRect,r.left=t[i][0].X,r.right=r.left,r.top=t[i][0].Y,r.bottom=r.top;i<f;i++)for(u=0,e=t[i].length;u<e;u++)t[i][u].X<r.left?r.left=t[i][u].X:t[i][u].X>r.right&&(r.right=t[i][u].X),t[i][u].Y<r.top?r.top=t[i][u].Y:t[i][u].Y>r.bottom&&(r.bottom=t[i][u].Y);return r};n.Clipper.prototype.GetBounds2=function(t){var r=t,i=new n.IntRect;for(i.left=t.Pt.X,i.right=t.Pt.X,i.top=t.Pt.Y,i.bottom=t.Pt.Y,t=t.Next;t!=r;)t.Pt.X<i.left&&(i.left=t.Pt.X),t.Pt.X>i.right&&(i.right=t.Pt.X),t.Pt.Y<i.top&&(i.top=t.Pt.Y),t.Pt.Y>i.bottom&&(i.bottom=t.Pt.Y),t=t.Next;return i};n.Clipper.PointInPolygon=function(n,t){var u=0,o=t.length,r,e,i,f;if(3>o)return 0;for(r=t[0],e=1;e<=o;++e){if(i=e==o?t[0]:t[e],i.Y==n.Y&&(i.X==n.X||r.Y==n.Y&&i.X>n.X==r.X<n.X))return-1;if(r.Y<n.Y!=i.Y<n.Y)if(r.X>=n.X)if(i.X>n.X)u=1-u;else{if(f=(r.X-n.X)*(i.Y-n.Y)-(i.X-n.X)*(r.Y-n.Y),0==f)return-1;0<f==i.Y>r.Y&&(u=1-u)}else if(i.X>n.X){if(f=(r.X-n.X)*(i.Y-n.Y)-(i.X-n.X)*(r.Y-n.Y),0==f)return-1;0<f==i.Y>r.Y&&(u=1-u)}r=i}return u};n.Clipper.prototype.PointInPolygon=function(n,t){var o=0,h=t,r=n.X,u=n.Y,i=t.Pt.X,s=t.Pt.Y,f,e;do{if(t=t.Next,f=t.Pt.X,e=t.Pt.Y,e==u&&(f==r||s==u&&f>r==i<r))return-1;if(s<u!=e<u)if(i>=r)if(f>r)o=1-o;else{if(i=(i-r)*(e-u)-(f-r)*(s-u),0==i)return-1;0<i==e>s&&(o=1-o)}else if(f>r){if(i=(i-r)*(e-u)-(f-r)*(s-u),0==i)return-1;0<i==e>s&&(o=1-o)}i=f;s=e}while(h!=t);return o};n.Clipper.prototype.Poly2ContainsPoly1=function(n,t){var i=n,r;do{if(r=this.PointInPolygon(i.Pt,t),0<=r)return 0<r;i=i.Next}while(i!=n);return!0};n.Clipper.prototype.FixupFirstLefts1=function(n,t){for(var i,r=0,u=this.m_PolyOuts.length;r<u;r++)i=this.m_PolyOuts[r],null!=i.Pts&&null!=i.FirstLeft&&this.ParseFirstLeft(i.FirstLeft)==n&&this.Poly2ContainsPoly1(i.Pts,t.Pts)&&(i.FirstLeft=t)};n.Clipper.prototype.FixupFirstLefts2=function(n,t){for(var i=0,r=this.m_PolyOuts,f=r.length,u=r[i];i<f;i++,u=r[i])u.FirstLeft==n&&(u.FirstLeft=t)};n.Clipper.ParseFirstLeft=function(n){for(;null!=n&&null==n.Pts;)n=n.FirstLeft;return n};n.Clipper.prototype.JoinCommonEdges=function(){for(var r,s,f,e=0,o=this.m_Joins.length;e<o;e++){var u=this.m_Joins[e],i=this.GetOutRec(u.OutPt1.Idx),t=this.GetOutRec(u.OutPt2.Idx);if(null!=i.Pts&&null!=t.Pts&&(r=i==t?i:this.Param1RightOfParam2(i,t)?t:this.Param1RightOfParam2(t,i)?i:this.GetLowermostRec(i,t),this.JoinPoints(u,i,t)))if(i==t){if(i.Pts=u.OutPt1,i.BottomPt=null,t=this.CreateOutRec(),t.Pts=u.OutPt2,this.UpdateOutPtIdxs(t),this.m_UsingPolyTree)for(r=0,s=this.m_PolyOuts.length;r<s-1;r++)f=this.m_PolyOuts[r],null!=f.Pts&&n.Clipper.ParseFirstLeft(f.FirstLeft)==i&&f.IsHole!=i.IsHole&&this.Poly2ContainsPoly1(f.Pts,u.OutPt2)&&(f.FirstLeft=t);this.Poly2ContainsPoly1(t.Pts,i.Pts)?(t.IsHole=!i.IsHole,t.FirstLeft=i,this.m_UsingPolyTree&&this.FixupFirstLefts2(t,i),(t.IsHole^this.ReverseSolution)==0<this.Area(t)&&this.ReversePolyPtLinks(t.Pts)):this.Poly2ContainsPoly1(i.Pts,t.Pts)?(t.IsHole=i.IsHole,i.IsHole=!t.IsHole,t.FirstLeft=i.FirstLeft,i.FirstLeft=t,this.m_UsingPolyTree&&this.FixupFirstLefts2(i,t),(i.IsHole^this.ReverseSolution)==0<this.Area(i)&&this.ReversePolyPtLinks(i.Pts)):(t.IsHole=i.IsHole,t.FirstLeft=i.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(i,t))}else t.Pts=null,t.BottomPt=null,t.Idx=i.Idx,i.IsHole=r.IsHole,r==t&&(i.FirstLeft=t.FirstLeft),t.FirstLeft=i,this.m_UsingPolyTree&&this.FixupFirstLefts2(t,i)}};n.Clipper.prototype.UpdateOutPtIdxs=function(n){var t=n.Pts;do t.Idx=n.Idx,t=t.Prev;while(t!=n.Pts)};n.Clipper.prototype.DoSimplePolygons=function(){for(var t,r,u,i,e,f=0;f<this.m_PolyOuts.length;)if(t=this.m_PolyOuts[f++],r=t.Pts,null!=r&&!t.IsOpen)do{for(u=r.Next;u!=t.Pts;)n.IntPoint.op_Equality(r.Pt,u.Pt)&&u.Next!=r&&u.Prev!=r&&(i=r.Prev,e=u.Prev,r.Prev=e,e.Next=r,u.Prev=i,i.Next=u,t.Pts=r,i=this.CreateOutRec(),i.Pts=u,this.UpdateOutPtIdxs(i),this.Poly2ContainsPoly1(i.Pts,t.Pts)?(i.IsHole=!t.IsHole,i.FirstLeft=t,this.m_UsingPolyTree&&this.FixupFirstLefts2(i,t)):this.Poly2ContainsPoly1(t.Pts,i.Pts)?(i.IsHole=t.IsHole,t.IsHole=!i.IsHole,i.FirstLeft=t.FirstLeft,t.FirstLeft=i,this.m_UsingPolyTree&&this.FixupFirstLefts2(t,i)):(i.IsHole=t.IsHole,i.FirstLeft=t.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(t,i)),u=r),u=u.Next;r=r.Next}while(r!=t.Pts)};n.Clipper.Area=function(n){var i=n.length;if(3>i)return 0;for(var u=0,t=0,r=i-1;t<i;++t)u+=(n[r].X+n[t].X)*(n[r].Y-n[t].Y),r=t;return.5*-u};n.Clipper.prototype.Area=function(n){var t=n.Pts,i;if(null==t)return 0;i=0;do i+=(t.Prev.Pt.X+t.Pt.X)*(t.Prev.Pt.Y-t.Pt.Y),t=t.Next;while(t!=n.Pts);return.5*i};n.Clipper.SimplifyPolygon=function(t,i){var u=[],r=new n.Clipper(0);return r.StrictlySimple=!0,r.AddPath(t,n.PolyType.ptSubject,!0),r.Execute(n.ClipType.ctUnion,u,i,i),u};n.Clipper.SimplifyPolygons=function(t,i){"undefined"==typeof i&&(i=n.PolyFillType.pftEvenOdd);var u=[],r=new n.Clipper(0);return r.StrictlySimple=!0,r.AddPaths(t,n.PolyType.ptSubject,!0),r.Execute(n.ClipType.ctUnion,u,i,i),u};n.Clipper.DistanceSqrd=function(n,t){var i=n.X-t.X,r=n.Y-t.Y;return i*i+r*r};n.Clipper.DistanceFromLineSqrd=function(n,t,i){var r=t.Y-i.Y;return i=i.X-t.X,t=r*t.X+i*t.Y,t=r*n.X+i*n.Y-t,t*t/(r*r+i*i)};n.Clipper.SlopesNearCollinear=function(t,i,r,u){return Math.abs(t.X-i.X)>Math.abs(t.Y-i.Y)?t.X>i.X==t.X<r.X?n.Clipper.DistanceFromLineSqrd(t,i,r)<u:i.X>t.X==i.X<r.X?n.Clipper.DistanceFromLineSqrd(i,t,r)<u:n.Clipper.DistanceFromLineSqrd(r,t,i)<u:t.Y>i.Y==t.Y<r.Y?n.Clipper.DistanceFromLineSqrd(t,i,r)<u:i.Y>t.Y==i.Y<r.Y?n.Clipper.DistanceFromLineSqrd(i,t,r)<u:n.Clipper.DistanceFromLineSqrd(r,t,i)<u};n.Clipper.PointsAreClose=function(n,t,i){var r=n.X-t.X;return n=n.Y-t.Y,r*r+n*n<=i};n.Clipper.ExcludeOp=function(n){var t=n.Prev;return t.Next=n.Next,n.Next.Prev=t,t.Idx=0,t};n.Clipper.CleanPolygon=function(t,i){var f,r,e,u;if("undefined"==typeof i&&(i=1.415),f=t.length,0==f)return[];for(r=Array(f),u=0;u<f;++u)r[u]=new n.OutPt;for(u=0;u<f;++u)r[u].Pt=t[u],r[u].Next=r[(u+1)%f],r[u].Next.Prev=r[u],r[u].Idx=0;for(u=i*i,r=r[0];0==r.Idx&&r.Next!=r.Prev;)n.Clipper.PointsAreClose(r.Pt,r.Prev.Pt,u)?(r=n.Clipper.ExcludeOp(r),f--):n.Clipper.PointsAreClose(r.Prev.Pt,r.Next.Pt,u)?(n.Clipper.ExcludeOp(r.Next),r=n.Clipper.ExcludeOp(r),f-=2):n.Clipper.SlopesNearCollinear(r.Prev.Pt,r.Pt,r.Next.Pt,u)?(r=n.Clipper.ExcludeOp(r),f--):(r.Idx=1,r=r.Next);for(3>f&&(f=0),e=Array(f),u=0;u<f;++u)e[u]=new n.IntPoint(r.Pt),r=r.Next;return e};n.Clipper.CleanPolygons=function(t,i){for(var u=Array(t.length),r=0,f=t.length;r<f;r++)u[r]=n.Clipper.CleanPolygon(t[r],i);return u};n.Clipper.Minkowski=function(t,i,r,u){u=u?1:0;var e=t.length,o=i.length,h=[];if(r)for(r=0;r<o;r++){for(var c=Array(e),f=0,l=t.length,s=t[f];f<l;f++,s=t[f])c[f]=new n.IntPoint(i[r].X+s.X,i[r].Y+s.Y);h.push(c)}else for(r=0;r<o;r++){for(c=Array(e),f=0,l=t.length,s=t[f];f<l;f++,s=t[f])c[f]=new n.IntPoint(i[r].X-s.X,i[r].Y-s.Y);h.push(c)}for(t=[],r=0;r<o-1+u;r++)for(f=0;f<e;f++)i=[],i.push(h[r%o][f%e]),i.push(h[(r+1)%o][f%e]),i.push(h[(r+1)%o][(f+1)%e]),i.push(h[r%o][(f+1)%e]),n.Clipper.Orientation(i)||i.reverse(),t.push(i);return t};n.Clipper.MinkowskiSum=function(t,i,r){var e,o,u,f;if(i[0]instanceof Array){for(u=i,i=new n.Paths,f=new n.Clipper,e=0;e<u.length;++e)o=n.Clipper.Minkowski(t,u[e],!0,r),f.AddPaths(o,n.PolyType.ptSubject,!0),r&&(o=n.Clipper.TranslatePath(u[e],t[0]),f.AddPath(o,n.PolyType.ptClip,!0));return f.Execute(n.ClipType.ctUnion,i,n.PolyFillType.pftNonZero,n.PolyFillType.pftNonZero),i}return u=n.Clipper.Minkowski(t,i,!0,r),f=new n.Clipper,f.AddPaths(u,n.PolyType.ptSubject,!0),f.Execute(n.ClipType.ctUnion,u,n.PolyFillType.pftNonZero,n.PolyFillType.pftNonZero),u};n.Clipper.TranslatePath=function(t,i){for(var u=new n.Path,r=0;r<t.length;r++)u.push(new n.IntPoint(t[r].X+i.X,t[r].Y+i.Y));return u};n.Clipper.MinkowskiDiff=function(t,i){var r=n.Clipper.Minkowski(t,i,!1,!0),u=new n.Clipper;return u.AddPaths(r,n.PolyType.ptSubject,!0),u.Execute(n.ClipType.ctUnion,r,n.PolyFillType.pftNonZero,n.PolyFillType.pftNonZero),r};n.Clipper.PolyTreeToPaths=function(t){var i=[];return n.Clipper.AddPolyNodeToPaths(t,n.Clipper.NodeType.ntAny,i),i};n.Clipper.AddPolyNodeToPaths=function(t,i,r){var u=!0,e,f;switch(i){case n.Clipper.NodeType.ntOpen:return;case n.Clipper.NodeType.ntClosed:u=!t.IsOpen}for(0<t.m_polygon.length&&u&&r.push(t.m_polygon),u=0,t=t.Childs(),e=t.length,f=t[u];u<e;u++,f=t[u])n.Clipper.AddPolyNodeToPaths(f,i,r)};n.Clipper.OpenPathsFromPolyTree=function(t){for(var r=new n.Paths,i=0,u=t.ChildCount();i<u;i++)t.Childs()[i].IsOpen&&r.push(t.Childs()[i].m_polygon);return r};n.Clipper.ClosedPathsFromPolyTree=function(t){var i=new n.Paths;return n.Clipper.AddPolyNodeToPaths(t,n.Clipper.NodeType.ntClosed,i),i};u(n.Clipper,n.ClipperBase);n.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2};n.ClipperOffset=function(t,i){"undefined"==typeof t&&(t=2);"undefined"==typeof i&&(i=n.ClipperOffset.def_arc_tolerance);this.m_destPolys=new n.Paths;this.m_srcPoly=new n.Path;this.m_destPoly=new n.Path;this.m_normals=[];this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0;this.m_lowest=new n.IntPoint;this.m_polyNodes=new n.PolyNode;this.MiterLimit=t;this.ArcTolerance=i;this.m_lowest.X=-1};n.ClipperOffset.two_pi=6.28318530717959;n.ClipperOffset.def_arc_tolerance=.25;n.ClipperOffset.prototype.Clear=function(){n.Clear(this.m_polyNodes.Childs());this.m_lowest.X=-1};n.ClipperOffset.Round=n.Clipper.Round;n.ClipperOffset.prototype.AddPath=function(t,i,r){var e=t.length-1,u,o,f;if(!(0>e)){if(u=new n.PolyNode,u.m_jointype=i,u.m_endtype=r,r==n.EndType.etClosedLine||r==n.EndType.etClosedPolygon)for(;0<e&&n.IntPoint.op_Equality(t[0],t[e]);)e--;for(u.m_polygon.push(t[0]),o=0,i=0,f=1;f<=e;f++)n.IntPoint.op_Inequality(u.m_polygon[o],t[f])&&(o++,u.m_polygon.push(t[f]),t[f].Y>u.m_polygon[i].Y||t[f].Y==u.m_polygon[i].Y&&t[f].X<u.m_polygon[i].X)&&(i=o);r==n.EndType.etClosedPolygon&&2>o||(this.m_polyNodes.AddChild(u),r!=n.EndType.etClosedPolygon)||(0>this.m_lowest.X?this.m_lowest=new n.IntPoint(this.m_polyNodes.ChildCount()-1,i):(t=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],u.m_polygon[i].Y>t.Y||u.m_polygon[i].Y==t.Y&&u.m_polygon[i].X<t.X)&&(this.m_lowest=new n.IntPoint(this.m_polyNodes.ChildCount()-1,i)))}};n.ClipperOffset.prototype.AddPaths=function(n,t,i){for(var r=0,u=n.length;r<u;r++)this.AddPath(n[r],t,i)};n.ClipperOffset.prototype.FixOrientations=function(){var i,t;if(0<=this.m_lowest.X&&!n.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(i=0;i<this.m_polyNodes.ChildCount();i++)t=this.m_polyNodes.Childs()[i],(t.m_endtype==n.EndType.etClosedPolygon||t.m_endtype==n.EndType.etClosedLine&&n.Clipper.Orientation(t.m_polygon))&&t.m_polygon.reverse();else for(i=0;i<this.m_polyNodes.ChildCount();i++)t=this.m_polyNodes.Childs()[i],t.m_endtype!=n.EndType.etClosedLine||n.Clipper.Orientation(t.m_polygon)||t.m_polygon.reverse()};n.ClipperOffset.GetUnitNormal=function(t,i){var r=i.X-t.X,u=i.Y-t.Y,f;return 0==r&&0==u?new n.DoublePoint(0,0):(f=1/Math.sqrt(r*r+u*u),new n.DoublePoint(u*f,-(r*f)))};n.ClipperOffset.prototype.DoOffset=function(t){var e,u,o,f;if(this.m_destPolys=[],this.m_delta=t,n.ClipperBase.near_zero(t))for(e=0;e<this.m_polyNodes.ChildCount();e++)u=this.m_polyNodes.Childs()[e],u.m_endtype==n.EndType.etClosedPolygon&&this.m_destPolys.push(u.m_polygon);else for(this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5,o=3.14159265358979/Math.acos(1-(0>=this.ArcTolerance?n.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(t)*n.ClipperOffset.def_arc_tolerance?Math.abs(t)*n.ClipperOffset.def_arc_tolerance:this.ArcTolerance)/Math.abs(t)),this.m_sin=Math.sin(n.ClipperOffset.two_pi/o),this.m_cos=Math.cos(n.ClipperOffset.two_pi/o),this.m_StepsPerRad=o/n.ClipperOffset.two_pi,0>t&&(this.m_sin=-this.m_sin),e=0;e<this.m_polyNodes.ChildCount();e++)if(u=this.m_polyNodes.Childs()[e],this.m_srcPoly=u.m_polygon,f=this.m_srcPoly.length,!(0==f||0>=t&&(3>f||u.m_endtype!=n.EndType.etClosedPolygon))){if(this.m_destPoly=[],1==f)if(u.m_jointype==n.JoinType.jtRound)for(var u=1,f=0,i=1;i<=o;i++){this.m_destPoly.push(new n.IntPoint(n.ClipperOffset.Round(this.m_srcPoly[0].X+u*t),n.ClipperOffset.Round(this.m_srcPoly[0].Y+f*t)));var r=u,u=u*this.m_cos-this.m_sin*f,f=r*this.m_sin+f*this.m_cos}else for(f=u=-1,i=0;4>i;++i)this.m_destPoly.push(new n.IntPoint(n.ClipperOffset.Round(this.m_srcPoly[0].X+u*t),n.ClipperOffset.Round(this.m_srcPoly[0].Y+f*t))),0>u?u=1:0>f?f=1:u=-1;else{for(i=this.m_normals.length=0;i<f-1;i++)this.m_normals.push(n.ClipperOffset.GetUnitNormal(this.m_srcPoly[i],this.m_srcPoly[i+1]));if(u.m_endtype==n.EndType.etClosedLine||u.m_endtype==n.EndType.etClosedPolygon?this.m_normals.push(n.ClipperOffset.GetUnitNormal(this.m_srcPoly[f-1],this.m_srcPoly[0])):this.m_normals.push(new n.DoublePoint(this.m_normals[f-2])),u.m_endtype==n.EndType.etClosedPolygon)for(r=f-1,i=0;i<f;i++)r=this.OffsetPoint(i,r,u.m_jointype);else if(u.m_endtype==n.EndType.etClosedLine){for(r=f-1,i=0;i<f;i++)r=this.OffsetPoint(i,r,u.m_jointype);for(this.m_destPolys.push(this.m_destPoly),this.m_destPoly=[],r=this.m_normals[f-1],i=f-1;0<i;i--)this.m_normals[i]=new n.DoublePoint(-this.m_normals[i-1].X,-this.m_normals[i-1].Y);for(this.m_normals[0]=new n.DoublePoint(-r.X,-r.Y),r=0,i=f-1;0<=i;i--)r=this.OffsetPoint(i,r,u.m_jointype)}else{for(r=0,i=1;i<f-1;++i)r=this.OffsetPoint(i,r,u.m_jointype);for(u.m_endtype==n.EndType.etOpenButt?(i=f-1,r=new n.IntPoint(n.ClipperOffset.Round(this.m_srcPoly[i].X+this.m_normals[i].X*t),n.ClipperOffset.Round(this.m_srcPoly[i].Y+this.m_normals[i].Y*t)),this.m_destPoly.push(r),r=new n.IntPoint(n.ClipperOffset.Round(this.m_srcPoly[i].X-this.m_normals[i].X*t),n.ClipperOffset.Round(this.m_srcPoly[i].Y-this.m_normals[i].Y*t)),this.m_destPoly.push(r)):(i=f-1,r=f-2,this.m_sinA=0,this.m_normals[i]=new n.DoublePoint(-this.m_normals[i].X,-this.m_normals[i].Y),u.m_endtype==n.EndType.etOpenSquare?this.DoSquare(i,r):this.DoRound(i,r)),i=f-1;0<i;i--)this.m_normals[i]=new n.DoublePoint(-this.m_normals[i-1].X,-this.m_normals[i-1].Y);for(this.m_normals[0]=new n.DoublePoint(-this.m_normals[1].X,-this.m_normals[1].Y),r=f-1,i=r-1;0<i;--i)r=this.OffsetPoint(i,r,u.m_jointype);u.m_endtype==n.EndType.etOpenButt?(r=new n.IntPoint(n.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*t),n.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*t)),this.m_destPoly.push(r),r=new n.IntPoint(n.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*t),n.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*t)),this.m_destPoly.push(r)):(this.m_sinA=0,u.m_endtype==n.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}};n.ClipperOffset.prototype.Execute=function(){var i=arguments,r,t,u;if(i[0]instanceof n.PolyTree)if(r=i[0],t=i[1],r.Clear(),this.FixOrientations(),this.DoOffset(t),i=new n.Clipper(0),i.AddPaths(this.m_destPolys,n.PolyType.ptSubject,!0),0<t)i.Execute(n.ClipType.ctUnion,r,n.PolyFillType.pftPositive,n.PolyFillType.pftPositive);else if(t=n.Clipper.GetBounds(this.m_destPolys),u=new n.Path,u.push(new n.IntPoint(t.left-10,t.bottom+10)),u.push(new n.IntPoint(t.right+10,t.bottom+10)),u.push(new n.IntPoint(t.right+10,t.top-10)),u.push(new n.IntPoint(t.left-10,t.top-10)),i.AddPath(u,n.PolyType.ptSubject,!0),i.ReverseSolution=!0,i.Execute(n.ClipType.ctUnion,r,n.PolyFillType.pftNegative,n.PolyFillType.pftNegative),1==r.ChildCount()&&0<r.Childs()[0].ChildCount())for(i=r.Childs()[0],r.Childs()[0]=i.Childs()[0],r.Childs()[0].m_Parent=r,t=1;t<i.ChildCount();t++)r.AddChild(i.Childs()[t]);else r.Clear();else r=i[0],t=i[1],n.Clear(r),this.FixOrientations(),this.DoOffset(t),i=new n.Clipper(0),i.AddPaths(this.m_destPolys,n.PolyType.ptSubject,!0),0<t?i.Execute(n.ClipType.ctUnion,r,n.PolyFillType.pftPositive,n.PolyFillType.pftPositive):(t=n.Clipper.GetBounds(this.m_destPolys),u=new n.Path,u.push(new n.IntPoint(t.left-10,t.bottom+10)),u.push(new n.IntPoint(t.right+10,t.bottom+10)),u.push(new n.IntPoint(t.right+10,t.top-10)),u.push(new n.IntPoint(t.left-10,t.top-10)),i.AddPath(u,n.PolyType.ptSubject,!0),i.ReverseSolution=!0,i.Execute(n.ClipType.ctUnion,r,n.PolyFillType.pftNegative,n.PolyFillType.pftNegative),0<r.length&&r.splice(0,1))};n.ClipperOffset.prototype.OffsetPoint=function(t,i,r){if(this.m_sinA=this.m_normals[i].X*this.m_normals[t].Y-this.m_normals[t].X*this.m_normals[i].Y,1>Math.abs(this.m_sinA*this.m_delta)){if(0<this.m_normals[i].X*this.m_normals[t].X+this.m_normals[t].Y*this.m_normals[i].Y)return this.m_destPoly.push(new n.IntPoint(n.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[i].X*this.m_delta),n.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[i].Y*this.m_delta))),i}else 1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)this.m_destPoly.push(new n.IntPoint(n.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[i].X*this.m_delta),n.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[i].Y*this.m_delta))),this.m_destPoly.push(new n.IntPoint(this.m_srcPoly[t])),this.m_destPoly.push(new n.IntPoint(n.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[t].X*this.m_delta),n.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[t].Y*this.m_delta)));else switch(r){case n.JoinType.jtMiter:r=1+(this.m_normals[t].X*this.m_normals[i].X+this.m_normals[t].Y*this.m_normals[i].Y);r>=this.m_miterLim?this.DoMiter(t,i,r):this.DoSquare(t,i);break;case n.JoinType.jtSquare:this.DoSquare(t,i);break;case n.JoinType.jtRound:this.DoRound(t,i)}return t};n.ClipperOffset.prototype.DoSquare=function(t,i){var r=Math.tan(Math.atan2(this.m_sinA,this.m_normals[i].X*this.m_normals[t].X+this.m_normals[i].Y*this.m_normals[t].Y)/4);this.m_destPoly.push(new n.IntPoint(n.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_delta*(this.m_normals[i].X-this.m_normals[i].Y*r)),n.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_delta*(this.m_normals[i].Y+this.m_normals[i].X*r))));this.m_destPoly.push(new n.IntPoint(n.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_delta*(this.m_normals[t].X+this.m_normals[t].Y*r)),n.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_delta*(this.m_normals[t].Y-this.m_normals[t].X*r))))};n.ClipperOffset.prototype.DoMiter=function(t,i,r){r=this.m_delta/r;this.m_destPoly.push(new n.IntPoint(n.ClipperOffset.Round(this.m_srcPoly[t].X+(this.m_normals[i].X+this.m_normals[t].X)*r),n.ClipperOffset.Round(this.m_srcPoly[t].Y+(this.m_normals[i].Y+this.m_normals[t].Y)*r)))};n.ClipperOffset.prototype.DoRound=function(t,i){for(var o=Math.max(n.Cast_Int32(n.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(Math.atan2(this.m_sinA,this.m_normals[i].X*this.m_normals[t].X+this.m_normals[i].Y*this.m_normals[t].Y)))),1),r=this.m_normals[i].X,u=this.m_normals[i].Y,f,e=0;e<o;++e)this.m_destPoly.push(new n.IntPoint(n.ClipperOffset.Round(this.m_srcPoly[t].X+r*this.m_delta),n.ClipperOffset.Round(this.m_srcPoly[t].Y+u*this.m_delta))),f=r,r=r*this.m_cos-this.m_sin*u,u=f*this.m_sin+u*this.m_cos;this.m_destPoly.push(new n.IntPoint(n.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[t].X*this.m_delta),n.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[t].Y*this.m_delta)))};n.Error=function(n){try{throw Error(n);}catch(t){alert(t.message)}};n.JS={};n.JS.AreaOfPolygon=function(t,i){return i||(i=1),n.Clipper.Area(t)/(i*i)};n.JS.AreaOfPolygons=function(t,i){i||(i=1);for(var u=0,r=0;r<t.length;r++)u+=n.Clipper.Area(t[r]);return u/(i*i)};n.JS.BoundsOfPath=function(t,i){return n.JS.BoundsOfPaths([t],i)};n.JS.BoundsOfPaths=function(t,i){i||(i=1);var r=n.Clipper.GetBounds(t);return r.left/=i,r.bottom/=i,r.right/=i,r.top/=i,r};n.JS.Clean=function(t,i){var c;if(!(t instanceof Array))return[];if(c=t[0]instanceof Array,t=n.JS.Clone(t),"number"!=typeof i||null===i)return n.Error("Delta is not a number in Clean()."),t;if(0===t.length||1==t.length&&0===t[0].length||0>i)return t;c||(t=[t]);for(var v=t.length,h,r,s,l,u,o,e,f=[],a=0;a<v;a++)if(r=t[a],h=r.length,0!==h)if(3>h)s=r,f.push(s);else{for(s=r,l=i*i,u=r[0],e=o=1;e<h;e++)(r[e].X-u.X)*(r[e].X-u.X)+(r[e].Y-u.Y)*(r[e].Y-u.Y)<=l||(s[o]=r[e],u=r[e],o++);u=r[o-1];(r[0].X-u.X)*(r[0].X-u.X)+(r[0].Y-u.Y)*(r[0].Y-u.Y)<=l&&o--;o<h&&s.splice(o,h-o);s.length&&f.push(s)}return!c&&f.length?f=f[0]:c||0!==f.length?c&&0===f.length&&(f=[[]]):f=[],f};n.JS.Clone=function(n){var u,f,e,t,i,o,r;if(!(n instanceof Array)||0===n.length)return[];if(1==n.length&&0===n[0].length)return[[]];for(u=n[0]instanceof Array,u||(n=[n]),f=n.length,r=Array(f),t=0;t<f;t++){for(e=n[t].length,o=Array(e),i=0;i<e;i++)o[i]={X:n[t][i].X,Y:n[t][i].Y};r[t]=o}return u||(r=r[0]),r};n.JS.Lighten=function(t,i){if(!(t instanceof Array))return[];if("number"!=typeof i||null===i)return n.Error("Tolerance is not a number in Lighten()."),n.JS.Clone(t);if(0===t.length||1==t.length&&0===t[0].length||0>i)return n.JS.Clone(t);t[0]instanceof Array||(t=[t]);for(var u,r,b,f,e,o,h,v,w,k,s,y,c,l,d=t.length,g=i*i,a=[],p=0;p<d;p++)if(r=t[p],e=r.length,0!=e){for(b=0;1e6>b;b++){for(f=[],e=r.length,r[e-1].X!=r[0].X||r[e-1].Y!=r[0].Y?(k=1,r.push({X:r[0].X,Y:r[0].Y}),e=r.length):k=0,w=[],u=0;u<e-2;u++)o=r[u],v=r[u+1],h=r[u+2],c=o.X,l=o.Y,o=h.X-c,s=h.Y-l,(0!==o||0!==s)&&(y=((v.X-c)*o+(v.Y-l)*s)/(o*o+s*s),1<y?(c=h.X,l=h.Y):0<y&&(c+=o*y,l+=s*y)),o=v.X-c,s=v.Y-l,h=o*o+s*s,h<=g&&(w[u+1]=1,u++);for(f.push({X:r[0].X,Y:r[0].Y}),u=1;u<e-1;u++)w[u]||f.push({X:r[u].X,Y:r[u].Y});if(f.push({X:r[e-1].X,Y:r[e-1].Y}),k&&r.pop(),w.length)r=f;else break}e=f.length;f[e-1].X==f[0].X&&f[e-1].Y==f[0].Y&&f.pop();2<f.length&&a.push(f)}return t[0]instanceof Array||(a=a[0]),"undefined"==typeof a&&(a=[[]]),a};n.JS.PerimeterOfPath=function(n,t,i){if("undefined"==typeof n)return 0;var h=Math.sqrt,s=0,r,u,e,o,f=n.length;if(2>f)return 0;for(t&&(n[f]=n[0],f++);--f;)r=n[f],e=r.X,r=r.Y,u=n[f-1],o=u.X,u=u.Y,s+=h((e-o)*(e-o)+(r-u)*(r-u));return t&&n.pop(),s/i};n.JS.PerimeterOfPaths=function(t,i,r){r||(r=1);for(var f=0,u=0;u<t.length;u++)f+=n.JS.PerimeterOfPath(t[u],i,r);return f};n.JS.ScaleDownPath=function(n,t){var i,r;for(t||(t=1),i=n.length;i--;)r=n[i],r.X/=t,r.Y/=t};n.JS.ScaleDownPaths=function(n,t){var i,r,u;for(t||(t=1),i=n.length;i--;)for(r=n[i].length;r--;)u=n[i][r],u.X/=t,u.Y/=t};n.JS.ScaleUpPath=function(n,t){var r,i,u=Math.round;for(t||(t=1),r=n.length;r--;)i=n[r],i.X=u(i.X*t),i.Y=u(i.Y*t)};n.JS.ScaleUpPaths=function(n,t){var r,u,i,f=Math.round;for(t||(t=1),r=n.length;r--;)for(u=n[r].length;u--;)i=n[r][u],i.X=f(i.X*t),i.Y=f(i.Y*t)};n.ExPolygons=function(){return[]};n.ExPolygon=function(){this.holes=this.outer=null};n.JS.AddOuterPolyNodeToExPolygons=function(t,i){var f=new n.ExPolygon,o,s,r,u,e,h,c;for(f.outer=t.Contour(),o=t.Childs(),s=o.length,f.holes=Array(s),u=0;u<s;u++)for(r=o[u],f.holes[u]=r.Contour(),e=0,h=r.Childs(),c=h.length;e<c;e++)r=h[e],n.JS.AddOuterPolyNodeToExPolygons(r,i);i.push(f)};n.JS.ExPolygonsToPaths=function(t){for(var r,e,u=new n.Paths,i=0,f=t.length;i<f;i++)for(u.push(t[i].outer),r=0,e=t[i].holes.length;r<e;r++)u.push(t[i].holes[r]);return u};n.JS.PolyTreeToExPolygons=function(t){var u=new n.ExPolygons,i,r,f;for(i=0,r=t.Childs(),f=r.length;i<f;i++)t=r[i],n.JS.AddOuterPolyNodeToExPolygons(t,u);return u}}();
/*! poly2tri v1.5.0 | (c) 2009-2017 Poly2Tri Contributors */
!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;t.poly2tri=n()}}(function(){return function n(t,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!t[f]){if(h="function"==typeof require&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i||n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e="function"==typeof require&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){t.exports={version:"1.5.0"}},{}],2:[function(n,t){"use strict";var r=function(n,t){this.point=n;this.triangle=t||null;this.next=null;this.prev=null;this.value=n.x},i=function(n,t){this.head_=n;this.tail_=t;this.search_node_=n};i.prototype.head=function(){return this.head_};i.prototype.setHead=function(n){this.head_=n};i.prototype.tail=function(){return this.tail_};i.prototype.setTail=function(n){this.tail_=n};i.prototype.search=function(){return this.search_node_};i.prototype.setSearch=function(n){this.search_node_=n};i.prototype.findSearchNode=function(){return this.search_node_};i.prototype.locateNode=function(n){var t=this.search_node_;if(n<t.value){for(;t=t.prev;)if(n>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(n<t.value)return this.search_node_=t.prev,t.prev;return null};i.prototype.locatePoint=function(n){var i=n.x,t=this.findSearchNode(i),r=t.point.x;if(i===r){if(n!==t.point)if(n===t.prev.point)t=t.prev;else{if(n!==t.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");t=t.next}}else if(i<r)for(;(t=t.prev)&&n!==t.point;);else for(;(t=t.next)&&n!==t.point;);return t&&(this.search_node_=t),t};t.exports=i;t.exports.Node=r},{}],3:[function(n,t){"use strict";function i(n,t){if(!n)throw new Error(t||"Assert Failed");}t.exports=i},{}],4:[function(n,t){"use strict";var r=n("./xy"),i=function(n,t){this.x=+n||0;this.y=+t||0;this._p2t_edge_list=null};i.prototype.toString=function(){return r.toStringBase(this)};i.prototype.toJSON=function(){return{x:this.x,y:this.y}};i.prototype.clone=function(){return new i(this.x,this.y)};i.prototype.set_zero=function(){return this.x=0,this.y=0,this};i.prototype.set=function(n,t){return this.x=+n||0,this.y=+t||0,this};i.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this};i.prototype.add=function(n){return this.x+=n.x,this.y+=n.y,this};i.prototype.sub=function(n){return this.x-=n.x,this.y-=n.y,this};i.prototype.mul=function(n){return this.x*=n,this.y*=n,this};i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};i.prototype.normalize=function(){var n=this.length();return this.x/=n,this.y/=n,n};i.prototype.equals=function(n){return this.x===n.x&&this.y===n.y};i.negate=function(n){return new i(-n.x,-n.y)};i.add=function(n,t){return new i(n.x+t.x,n.y+t.y)};i.sub=function(n,t){return new i(n.x-t.x,n.y-t.y)};i.mul=function(n,t){return new i(n*t.x,n*t.y)};i.cross=function(n,t){return"number"==typeof n?"number"==typeof t?n*t:new i(-n*t.y,n*t.x):"number"==typeof t?new i(t*n.y,-t*n.x):n.x*t.y-n.y*t.x};i.toString=r.toString;i.compare=r.compare;i.cmp=r.compare;i.equals=r.equals;i.dot=function(n,t){return n.x*t.x+n.y*t.y};t.exports=i},{"./xy":11}],5:[function(n,t){"use strict";var r=n("./xy"),i=function(n,t){this.name="PointError";this.points=t=t||[];this.message=n||"Invalid Points!";for(var i=0;i<t.length;i++)this.message+=" "+r.toString(t[i])};i.prototype=new Error;i.prototype.constructor=i;t.exports=i},{"./xy":11}],6:[function(n,t,i){(function(t){"use strict";var u=t.poly2tri,r;i.noConflict=function(){return t.poly2tri=u,i};i.VERSION=n("../dist/version.json").version;i.PointError=n("./pointerror");i.Point=n("./point");i.Triangle=n("./triangle");i.SweepContext=n("./sweepcontext");r=n("./sweep");i.triangulate=r.triangulate;i.sweep={Triangulate:r.triangulate}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(n,t,i){"use strict";function ft(n){n.initTriangulation();n.createAdvancingFront();et(n);ot(n)}function et(n){for(var f=n.pointCount(),t=1;t<f;++t)for(var u=n.getPoint(t),e=st(n,u),i=u._p2t_edge_list,r=0;i&&r<i.length;++r)ht(n,i[r],e)}function ot(n){for(var t=n.front().head().next.triangle,i=n.front().head().next.point;!t.getConstrainedEdgeCW(i);)t=t.neighborCCW(i);n.meshClean(t)}function st(n,t){var i=n.locateNode(t),r=ct(n,t,i);return t.x<=i.point.x+ni&&e(n,i),lt(n,r),r}function ht(n,t,i){n.edge_event.constrained_edge=t;n.edge_event.right=t.p.x>t.q.x;y(i.triangle,t.p,t.q)||(wt(n,t,i),h(n,t.p,t.q,i.triangle,t.q))}function h(n,t,i,f,e){var c,o,l,v;if(!y(f,t,i)){if(c=f.pointCCW(e),o=u(i,c,t),o===r.COLLINEAR)throw new s("poly2tri EdgeEvent: Collinear not supported!",[i,c,t]);if(l=f.pointCW(e),v=u(i,l,t),v===r.COLLINEAR)throw new s("poly2tri EdgeEvent: Collinear not supported!",[i,l,t]);o===v?(f=o===r.CW?f.neighborCCW(e):f.neighborCW(e),h(n,t,i,f,e)):a(n,t,i,f,e)}}function y(n,t,i){var r=n.edgeIndex(t,i),u;return-1!==r?(n.markConstrainedEdgeByIndex(r),u=n.getNeighbor(r),u&&u.markConstrainedEdgeByPoints(t,i),!0):!1}function ct(n,t,i){var u=new it(t,i.point,i.next.point),r;return u.markNeighbor(i.triangle),n.addToMap(u),r=new gt(t),r.next=i.next,r.prev=i,i.next.prev=r,i.next=r,f(n,u)||n.mapTriangleToNodes(u),r}function e(n,t){var i=new it(t.prev.point,t.point,t.next.point);i.markNeighbor(t.prev.triangle);i.markNeighbor(t.triangle);n.addToMap(i);t.prev.next=t.next;t.next.prev=t.prev;f(n,i)||n.mapTriangleToNodes(i)}function lt(n,t){for(var i=t.next;i.next&&!ut(i.point,i.next.point,i.prev.point);)e(n,i),i=i.next;for(i=t.prev;i.prev&&!ut(i.point,i.next.point,i.prev.point);)e(n,i),i=i.prev;t.next&&t.next.next&&at(t)&&yt(n,t)}function at(n){var t=n.point.x-n.next.next.point.x,i=n.point.y-n.next.next.point.y;return v(i>=0,"unordered y"),t>=0||Math.abs(t)<i}function f(n,t){for(var i,h,o,r=0;r<3;++r)if(!t.delaunay_edge[r]&&(i=t.getNeighbor(r),i)){var u=t.getPoint(r),s=i.oppositePoint(t,u),e=i.index(s);if(i.constrained_edge[e]||i.delaunay_edge[e]){t.constrained_edge[r]=i.constrained_edge[e];continue}if(h=vt(u,t.pointCCW(u),t.pointCW(u),s),h)return t.delaunay_edge[r]=!0,i.delaunay_edge[e]=!0,p(t,u,i,s),o=!f(n,t),o&&n.mapTriangleToNodes(t),o=!f(n,i),o&&n.mapTriangleToNodes(i),t.delaunay_edge[r]=!1,i.delaunay_edge[e]=!1,!0}return!1}function vt(n,t,i,r){var u=n.x-r.x,f=n.y-r.y,e=t.x-r.x,o=t.y-r.y,a=u*o,v=e*f,c=a-v;if(c<=0)return!1;var s=i.x-r.x,h=i.y-r.y,y=s*f,p=u*h,l=y-p;return!(l<=0)&&(u*u+f*f)*(e*h-s*o)+(e*e+o*o)*l+(s*s+h*h)*c>0}function p(n,t,i,r){var u,f,e,o,s,h,c,l,a,v,y,p;u=n.neighborCCW(t);f=n.neighborCW(t);e=i.neighborCCW(r);o=i.neighborCW(r);s=n.getConstrainedEdgeCCW(t);h=n.getConstrainedEdgeCW(t);c=i.getConstrainedEdgeCCW(r);l=i.getConstrainedEdgeCW(r);a=n.getDelaunayEdgeCCW(t);v=n.getDelaunayEdgeCW(t);y=i.getDelaunayEdgeCCW(r);p=i.getDelaunayEdgeCW(r);n.legalize(t,r);i.legalize(r,t);i.setDelaunayEdgeCCW(t,a);n.setDelaunayEdgeCW(t,v);n.setDelaunayEdgeCCW(r,y);i.setDelaunayEdgeCW(r,p);i.setConstrainedEdgeCCW(t,s);n.setConstrainedEdgeCW(t,h);n.setConstrainedEdgeCCW(r,c);i.setConstrainedEdgeCW(r,l);n.clearNeighbors();i.clearNeighbors();u&&i.markNeighbor(u);f&&n.markNeighbor(f);e&&n.markNeighbor(e);o&&i.markNeighbor(o);n.markNeighbor(i)}function yt(n,t){for(n.basin.left_node=u(t.point,t.next.point,t.next.next.point)===r.CCW?t.next.next:t.next,n.basin.bottom_node=n.basin.left_node;n.basin.bottom_node.next&&n.basin.bottom_node.point.y>=n.basin.bottom_node.next.point.y;)n.basin.bottom_node=n.basin.bottom_node.next;if(n.basin.bottom_node!==n.basin.left_node){for(n.basin.right_node=n.basin.bottom_node;n.basin.right_node.next&&n.basin.right_node.point.y<n.basin.right_node.next.point.y;)n.basin.right_node=n.basin.right_node.next;n.basin.right_node!==n.basin.bottom_node&&(n.basin.width=n.basin.right_node.point.x-n.basin.left_node.point.x,n.basin.left_highest=n.basin.left_node.point.y>n.basin.right_node.point.y,w(n,n.basin.bottom_node))}}function w(n,t){if(!pt(n,t)&&(e(n,t),t.prev!==n.basin.left_node||t.next!==n.basin.right_node)){if(t.prev===n.basin.left_node){if(u(t.point,t.next.point,t.next.next.point)===r.CW)return;t=t.next}else if(t.next===n.basin.right_node){if(u(t.point,t.prev.point,t.prev.prev.point)===r.CCW)return;t=t.prev}else t=t.prev.point.y<t.next.point.y?t.prev:t.next;w(n,t)}}function pt(n,t){var i;return i=n.basin.left_highest?n.basin.left_node.point.y-t.point.y:n.basin.right_node.point.y-t.point.y,n.basin.width>i}function wt(n,t,i){n.edge_event.right?bt(n,t,i):kt(n,t,i)}function bt(n,t,i){for(;i.next.point.x<t.p.x;)u(t.q,i.next.point,t.p)===r.CCW?b(n,t,i):i=i.next}function b(n,t,i){i.point.x<t.p.x&&(u(i.point,i.next.point,i.next.next.point)===r.CCW?c(n,t,i):(k(n,t,i),b(n,t,i)))}function c(n,t,i){e(n,i.next);i.next.point!==t.p&&u(t.q,i.next.point,t.p)===r.CCW&&u(i.point,i.next.point,i.next.next.point)===r.CCW&&c(n,t,i)}function k(n,t,i){u(i.next.point,i.next.next.point,i.next.next.next.point)===r.CCW?c(n,t,i.next):u(t.q,i.next.next.point,t.p)===r.CCW&&k(n,t,i.next)}function kt(n,t,i){for(;i.prev.point.x>t.p.x;)u(t.q,i.prev.point,t.p)===r.CW?d(n,t,i):i=i.prev}function d(n,t,i){i.point.x>t.p.x&&(u(i.point,i.prev.point,i.prev.prev.point)===r.CW?l(n,t,i):(g(n,t,i),d(n,t,i)))}function g(n,t,i){u(i.prev.point,i.prev.prev.point,i.prev.prev.prev.point)===r.CW?l(n,t,i.prev):u(t.q,i.prev.prev.point,t.p)===r.CW&&g(n,t,i.prev)}function l(n,t,i){e(n,i.prev);i.prev.point!==t.p&&u(t.q,i.prev.point,t.p)===r.CW&&u(i.point,i.prev.point,i.prev.prev.point)===r.CW&&l(n,t,i)}function a(n,t,i,r,e){var o=r.neighborAcross(e),c,l,y;if(v(o,"FLIP failed due to missing triangle!"),c=o.oppositePoint(r,e),r.getConstrainedEdgeAcross(e)){l=r.index(e);throw new s("poly2tri Intersecting Constraints",[e,c,r.getPoint((l+1)%3),r.getPoint((l+2)%3)]);}rt(e,r.pointCCW(e),r.pointCW(e),c)?(p(r,e,o,c),n.mapTriangleToNodes(r),n.mapTriangleToNodes(o),e===i&&c===t)?i===n.edge_event.constrained_edge.q&&t===n.edge_event.constrained_edge.p&&(r.markConstrainedEdgeByPoints(t,i),o.markConstrainedEdgeByPoints(t,i),f(n,r),f(n,o)):(y=u(i,c,t),r=dt(n,y,r,o,e,c),a(n,t,i,r,e)):(tt(n,t,i,r,o,nt(t,i,o,c)),h(n,t,i,r,e))}function dt(n,t,i,u,e,o){var s;return t===r.CCW?(s=u.edgeIndex(e,o),u.delaunay_edge[s]=!0,f(n,u),u.clearDelaunayEdges(),i):(s=i.edgeIndex(e,o),i.delaunay_edge[s]=!0,f(n,i),i.clearDelaunayEdges(),u)}function nt(n,t,i,f){var e=u(t,f,n);if(e===r.CW)return i.pointCCW(f);if(e===r.CCW)return i.pointCW(f);throw new s("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,f,n]);}function tt(n,t,i,r,u,f){var e=u.neighborAcross(f),o;v(e,"FLIP failed due to missing triangle");o=e.oppositePoint(u,f);rt(i,r.pointCCW(i),r.pointCW(i),o)?a(n,i,o,e,o):tt(n,t,i,r,e,nt(t,i,e,o))}var v=n("./assert"),s=n("./pointerror"),it=n("./triangle"),gt=n("./advancingfront").Node,o=n("./utils"),ni=o.EPSILON,r=o.Orientation,u=o.orient2d,rt=o.inScanArea,ut=o.isAngleObtuse;i.triangulate=ft},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(n,t){"use strict";var s=n("./pointerror"),r=n("./point"),h=n("./triangle"),c=n("./sweep"),f=n("./advancingfront"),u=f.Node,l=function(n,t){if(this.p=n,this.q=t,n.y>t.y)this.q=n,this.p=t;else if(n.y===t.y)if(n.x>t.x)this.q=n,this.p=t;else if(n.x===t.x)throw new s("poly2tri Invalid Edge constructor: repeated points!",[n]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]);this.q._p2t_edge_list.push(this)},e=function(){this.left_node=null;this.bottom_node=null;this.right_node=null;this.width=0;this.left_highest=!1},o,i;e.prototype.clear=function(){this.left_node=null;this.bottom_node=null;this.right_node=null;this.width=0;this.left_highest=!1};o=function(){this.constrained_edge=null;this.right=!1};i=function(n,t){t=t||{};this.triangles_=[];this.map_=[];this.points_=t.cloneArrays?n.slice(0):n;this.edge_list=[];this.pmin_=this.pmax_=null;this.front_=null;this.head_=null;this.tail_=null;this.af_head_=null;this.af_middle_=null;this.af_tail_=null;this.basin=new e;this.edge_event=new o;this.initEdges(this.points_)};i.prototype.addHole=function(n){this.initEdges(n);for(var i=n.length,t=0;t<i;t++)this.points_.push(n[t]);return this};i.prototype.AddHole=i.prototype.addHole;i.prototype.addHoles=function(n){for(var i=n.length,t=0;t<i;t++)this.initEdges(n[t]);return this.points_=this.points_.concat.apply(this.points_,n),this};i.prototype.addPoint=function(n){return this.points_.push(n),this};i.prototype.AddPoint=i.prototype.addPoint;i.prototype.addPoints=function(n){return this.points_=this.points_.concat(n),this};i.prototype.triangulate=function(){return c.triangulate(this),this};i.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}};i.prototype.getTriangles=function(){return this.triangles_};i.prototype.GetTriangles=i.prototype.getTriangles;i.prototype.front=function(){return this.front_};i.prototype.pointCount=function(){return this.points_.length};i.prototype.head=function(){return this.head_};i.prototype.setHead=function(n){this.head_=n};i.prototype.tail=function(){return this.tail_};i.prototype.setTail=function(n){this.tail_=n};i.prototype.getMap=function(){return this.map_};i.prototype.initTriangulation=function(){for(var i=this.points_[0].x,u=this.points_[0].x,e=this.points_[0].y,t=this.points_[0].y,h=this.points_.length,n,o,s,f=1;f<h;f++)n=this.points_[f],n.x>i&&(i=n.x),n.x<u&&(u=n.x),n.y>e&&(e=n.y),n.y<t&&(t=n.y);this.pmin_=new r(u,t);this.pmax_=new r(i,e);o=.3*(i-u);s=.3*(e-t);this.head_=new r(i+o,t-s);this.tail_=new r(u-o,t-s);this.points_.sort(r.compare)};i.prototype.initEdges=function(n){for(var i=n.length,t=0;t<i;++t)this.edge_list.push(new l(n[t],n[(t+1)%i]))};i.prototype.getPoint=function(n){return this.points_[n]};i.prototype.addToMap=function(n){this.map_.push(n)};i.prototype.locateNode=function(n){return this.front_.locateNode(n.x)};i.prototype.createAdvancingFront=function(){var i,t,r,n=new h(this.points_[0],this.tail_,this.head_);this.map_.push(n);i=new u(n.getPoint(1),n);t=new u(n.getPoint(0),n);r=new u(n.getPoint(2));this.front_=new f(i,r);i.next=t;t.next=r;t.prev=i;r.prev=t};i.prototype.removeNode=function(){};i.prototype.mapTriangleToNodes=function(n){for(var i,t=0;t<3;++t)n.getNeighbor(t)||(i=this.front_.locatePoint(n.pointCW(n.getPoint(t))),i&&(i.triangle=n))};i.prototype.removeFromMap=function(n){for(var i=this.map_,r=i.length,t=0;t<r;t++)if(i[t]===n){i.splice(t,1);break}};i.prototype.meshClean=function(n){for(var t,i,r=[n];t=r.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),i=0;i<3;i++)t.constrained_edge[i]||r.push(t.getNeighbor(i))};t.exports=i},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(n,t){"use strict";var u=n("./xy"),i=function(n,t,i){this.points_=[n,t,i];this.neighbors_=[null,null,null];this.interior_=!1;this.constrained_edge=[!1,!1,!1];this.delaunay_edge=[!1,!1,!1]},r=u.toString;i.prototype.toString=function(){return"["+r(this.points_[0])+r(this.points_[1])+r(this.points_[2])+"]"};i.prototype.getPoint=function(n){return this.points_[n]};i.prototype.GetPoint=i.prototype.getPoint;i.prototype.getPoints=function(){return this.points_};i.prototype.getNeighbor=function(n){return this.neighbors_[n]};i.prototype.containsPoint=function(n){var t=this.points_;return n===t[0]||n===t[1]||n===t[2]};i.prototype.containsEdge=function(n){return this.containsPoint(n.p)&&this.containsPoint(n.q)};i.prototype.containsPoints=function(n,t){return this.containsPoint(n)&&this.containsPoint(t)};i.prototype.isInterior=function(){return this.interior_};i.prototype.setInterior=function(n){return this.interior_=n,this};i.prototype.markNeighborPointers=function(n,t,i){var r=this.points_;if(n===r[2]&&t===r[1]||n===r[1]&&t===r[2])this.neighbors_[0]=i;else if(n===r[0]&&t===r[2]||n===r[2]&&t===r[0])this.neighbors_[1]=i;else{if(!(n===r[0]&&t===r[1]||n===r[1]&&t===r[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=i}};i.prototype.markNeighbor=function(n){var t=this.points_;n.containsPoints(t[1],t[2])?(this.neighbors_[0]=n,n.markNeighborPointers(t[1],t[2],this)):n.containsPoints(t[0],t[2])?(this.neighbors_[1]=n,n.markNeighborPointers(t[0],t[2],this)):n.containsPoints(t[0],t[1])&&(this.neighbors_[2]=n,n.markNeighborPointers(t[0],t[1],this))};i.prototype.clearNeighbors=function(){this.neighbors_[0]=null;this.neighbors_[1]=null;this.neighbors_[2]=null};i.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1;this.delaunay_edge[1]=!1;this.delaunay_edge[2]=!1};i.prototype.pointCW=function(n){var t=this.points_;return n===t[0]?t[2]:n===t[1]?t[0]:n===t[2]?t[1]:null};i.prototype.pointCCW=function(n){var t=this.points_;return n===t[0]?t[1]:n===t[1]?t[2]:n===t[2]?t[0]:null};i.prototype.neighborCW=function(n){return n===this.points_[0]?this.neighbors_[1]:n===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]};i.prototype.neighborCCW=function(n){return n===this.points_[0]?this.neighbors_[2]:n===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]};i.prototype.getConstrainedEdgeCW=function(n){return n===this.points_[0]?this.constrained_edge[1]:n===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]};i.prototype.getConstrainedEdgeCCW=function(n){return n===this.points_[0]?this.constrained_edge[2]:n===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]};i.prototype.getConstrainedEdgeAcross=function(n){return n===this.points_[0]?this.constrained_edge[0]:n===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]};i.prototype.setConstrainedEdgeCW=function(n,t){n===this.points_[0]?this.constrained_edge[1]=t:n===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t};i.prototype.setConstrainedEdgeCCW=function(n,t){n===this.points_[0]?this.constrained_edge[2]=t:n===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t};i.prototype.getDelaunayEdgeCW=function(n){return n===this.points_[0]?this.delaunay_edge[1]:n===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]};i.prototype.getDelaunayEdgeCCW=function(n){return n===this.points_[0]?this.delaunay_edge[2]:n===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]};i.prototype.setDelaunayEdgeCW=function(n,t){n===this.points_[0]?this.delaunay_edge[1]=t:n===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t};i.prototype.setDelaunayEdgeCCW=function(n,t){n===this.points_[0]?this.delaunay_edge[2]=t:n===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t};i.prototype.neighborAcross=function(n){return n===this.points_[0]?this.neighbors_[0]:n===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]};i.prototype.oppositePoint=function(n,t){var i=n.pointCW(t);return this.pointCW(i)};i.prototype.legalize=function(n,t){var i=this.points_;if(n===i[0])i[1]=i[0],i[0]=i[2],i[2]=t;else if(n===i[1])i[2]=i[1],i[1]=i[0],i[0]=t;else{if(n!==i[2])throw new Error("poly2tri Invalid Triangle.legalize() call");i[0]=i[2];i[2]=i[1];i[1]=t}};i.prototype.index=function(n){var t=this.points_;if(n===t[0])return 0;if(n===t[1])return 1;if(n===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call");};i.prototype.edgeIndex=function(n,t){var i=this.points_;if(n===i[0]){if(t===i[1])return 2;if(t===i[2])return 1}else if(n===i[1]){if(t===i[2])return 0;if(t===i[0])return 2}else if(n===i[2]){if(t===i[0])return 1;if(t===i[1])return 0}return-1};i.prototype.markConstrainedEdgeByIndex=function(n){this.constrained_edge[n]=!0};i.prototype.markConstrainedEdgeByEdge=function(n){this.markConstrainedEdgeByPoints(n.p,n.q)};i.prototype.markConstrainedEdgeByPoints=function(n,t){var i=this.points_;t===i[0]&&n===i[1]||t===i[1]&&n===i[0]?this.constrained_edge[2]=!0:t===i[0]&&n===i[2]||t===i[2]&&n===i[0]?this.constrained_edge[1]=!0:(t===i[1]&&n===i[2]||t===i[2]&&n===i[1])&&(this.constrained_edge[0]=!0)};t.exports=i},{"./xy":11}],10:[function(n,t,i){"use strict";function f(n,t,i){var e=(n.x-i.x)*(t.y-i.y),o=(n.y-i.y)*(t.x-i.x),f=e-o;return f>-r&&f<r?u.COLLINEAR:f>0?u.CCW:u.CW}function e(n,t,i,u){return!((n.x-t.x)*(u.y-t.y)-(u.x-t.x)*(n.y-t.y)>=-r)&&!((n.x-i.x)*(u.y-i.y)-(u.x-i.x)*(n.y-i.y)<=r)}function o(n,t,i){var r=t.x-n.x,u=t.y-n.y;return r*(i.x-n.x)+u*(i.y-n.y)<0}var r=1e-12,u;i.EPSILON=r;u={CW:1,CCW:-1,COLLINEAR:0};i.Orientation=u;i.orient2d=f;i.inScanArea=e;i.isAngleObtuse=o},{}],11:[function(n,t){"use strict";function i(n){return"("+n.x+";"+n.y+")"}function r(n){var t=n.toString();return"[object Object]"===t?i(n):t}function u(n,t){return n.y===t.y?n.x-t.x:n.y-t.y}function f(n,t){return n.x===t.x&&n.y===t.y}t.exports={toString:r,toStringBase:i,compare:u,equals:f}},{}]},{},[6])(6)}),function(n){if(typeof exports=="object"&&typeof module!="undefined")module.exports=n();else if(typeof define=="function"&&define.amd)define([],n);else{var t;t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:this;t.graphlib=n()}}(function(){var n;return function t(n,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!n[f]){if(h=typeof require=="function"&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};n[f][0].call(s.exports,function(t){var i=n[f][1][t];return u(i?i:t)},s,s.exports,t,n,i,r)}return i[f].exports}for(var e=typeof require=="function"&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){var i=n("./lib");t.exports={Graph:i.Graph,json:n("./lib/json"),alg:n("./lib/alg"),version:i.version}},{"./lib":17,"./lib/alg":8,"./lib/json":18}],2:[function(n,t){function r(n){function r(f){i.has(u,f)||(u[f]=!0,t.push(f),i.each(n.successors(f),r),i.each(n.predecessors(f),r))}var u={},f=[],t;return i.each(n.nodes(),function(n){t=[];r(n);t.length&&f.push(t)}),f}var i=n("../lodash");t.exports=r},{"../lodash":19}],3:[function(n,t){function u(n,t,u){i.isArray(t)||(t=[t]);var e=(n.isDirected()?n.successors:n.neighbors).bind(n),f=[],o={};return i.each(t,function(t){if(!n.hasNode(t))throw new Error("Graph does not have node: "+t);r(n,t,u==="post",o,e,f)}),f}function r(n,t,u,f,e,o){i.has(f,t)||(f[t]=!0,u||o.push(t),i.each(e(t),function(t){r(n,t,u,f,e,o)}),u&&o.push(t))}var i=n("../lodash");t.exports=u},{"../lodash":19}],4:[function(n,t){function u(n,t,u){return r.transform(n.nodes(),function(r,f){r[f]=i(n,f,t,u)},{})}var i=n("./dijkstra"),r=n("../lodash");t.exports=u},{"../lodash":19,"./dijkstra":5}],5:[function(n,t){function f(n,t,r,u){return e(n,String(t),r||i,u||function(t){return n.outEdges(t)})}function e(n,t,i,r){var e={},o=new u,f,s,h=function(n){var h=n.v!==f?n.v:n.w,t=e[h],r=i(n),u=s.distance+r;if(r<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+n+" Weight: "+r);u<t.distance&&(t.distance=u,t.predecessor=f,o.decrease(h,u))};for(n.nodes().forEach(function(n){var i=n===t?0:Number.POSITIVE_INFINITY;e[n]={distance:i};o.add(n,i)});o.size()>0;){if(f=o.removeMin(),s=e[f],s.distance===Number.POSITIVE_INFINITY)break;r(f).forEach(h)}return e}var r=n("../lodash"),u=n("../data/priority-queue"),i;t.exports=f;i=r.constant(1)},{"../data/priority-queue":15,"../lodash":19}],6:[function(n,t){function u(n){return i.filter(r(n),function(t){return t.length>1||t.length===1&&n.hasEdge(t[0],t[0])})}var i=n("../lodash"),r=n("./tarjan");t.exports=u},{"../lodash":19,"./tarjan":13}],7:[function(n,t){function u(n,t,r){return f(n,t||i,r||function(t){return n.outEdges(t)})}function f(n,t,i){var r={},u=n.nodes();return u.forEach(function(n){r[n]={};r[n][n]={distance:0};u.forEach(function(t){n!==t&&(r[n][t]={distance:Number.POSITIVE_INFINITY})});i(n).forEach(function(i){var u=i.v===n?i.w:i.v,f=t(i);r[n][u]={distance:f,predecessor:n}})}),u.forEach(function(n){var t=r[n];u.forEach(function(i){var f=r[i];u.forEach(function(i){var o=f[n],u=t[i],r=f[i],e=o.distance+u.distance;e<r.distance&&(r.distance=e,r.predecessor=u.predecessor)})})}),r}var r=n("../lodash"),i;t.exports=u;i=r.constant(1)},{"../lodash":19}],8:[function(n,t){t.exports={components:n("./components"),dijkstra:n("./dijkstra"),dijkstraAll:n("./dijkstra-all"),findCycles:n("./find-cycles"),floydWarshall:n("./floyd-warshall"),isAcyclic:n("./is-acyclic"),postorder:n("./postorder"),preorder:n("./preorder"),prim:n("./prim"),tarjan:n("./tarjan"),topsort:n("./topsort")}},{"./components":2,"./dijkstra":5,"./dijkstra-all":4,"./find-cycles":6,"./floyd-warshall":7,"./is-acyclic":9,"./postorder":10,"./preorder":11,"./prim":12,"./tarjan":13,"./topsort":14}],9:[function(n,t){function r(n){try{i(n)}catch(t){if(t instanceof i.CycleException)return!1;throw t;}return!0}var i=n("./topsort");t.exports=r},{"./topsort":14}],10:[function(n,t){function r(n,t){return i(n,t,"post")}var i=n("./dfs");t.exports=r},{"./dfs":3}],11:[function(n,t){function r(n,t){return i(n,t,"pre")}var i=n("./dfs");t.exports=r},{"./dfs":3}],12:[function(n,t){function f(n,t){function c(n){var i=n.v===f?n.w:n.v,u=e.priority(i),r;u!==undefined&&(r=t(n),r<u&&(s[i]=f,e.decrease(i,r)))}var o=new r,s={},e=new u,f,h;if(n.nodeCount()===0)return o;for(i.each(n.nodes(),function(n){e.add(n,Number.POSITIVE_INFINITY);o.setNode(n)}),e.decrease(n.nodes()[0],0),h=!1;e.size()>0;){if(f=e.removeMin(),i.has(s,f))o.setEdge(f,s[f]);else if(h)throw new Error("Input graph is not connected: "+n);else h=!0;n.nodeEdges(f).forEach(c)}return o}var i=n("../lodash"),r=n("../graph"),u=n("../data/priority-queue");t.exports=f},{"../data/priority-queue":15,"../graph":16,"../lodash":19}],13:[function(n,t){function r(n){function e(o){var s=t[o]={onStack:!0,lowlink:r,index:r++},c,h;if(u.push(o),n.successors(o).forEach(function(n){i.has(t,n)?t[n].onStack&&(s.lowlink=Math.min(s.lowlink,t[n].index)):(e(n),s.lowlink=Math.min(s.lowlink,t[n].lowlink))}),s.lowlink===s.index){c=[];do h=u.pop(),t[h].onStack=!1,c.push(h);while(o!==h);f.push(c)}}var r=0,u=[],t={},f=[];return n.nodes().forEach(function(n){i.has(t,n)||e(n)}),f}var i=n("../lodash");t.exports=r},{"../lodash":19}],14:[function(n,t){function u(n){function e(o){if(i.has(u,o))throw new r;i.has(t,o)||(u[o]=!0,t[o]=!0,i.each(n.predecessors(o),e),delete u[o],f.push(o))}var t={},u={},f=[];if(i.each(n.sinks(),e),i.size(t)!==n.nodeCount())throw new r;return f}function r(){}var i=n("../lodash");t.exports=u;u.CycleException=r},{"../lodash":19}],15:[function(n,t){function i(){this._arr=[];this._keyIndices={}}var r=n("../lodash");t.exports=i;i.prototype.size=function(){return this._arr.length};i.prototype.keys=function(){return this._arr.map(function(n){return n.key})};i.prototype.has=function(n){return r.has(this._keyIndices,n)};i.prototype.priority=function(n){var t=this._keyIndices[n];if(t!==undefined)return this._arr[t].priority};i.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key};i.prototype.add=function(n,t){var f=this._keyIndices,i,u;return(n=String(n),!r.has(f,n))?(i=this._arr,u=i.length,f[n]=u,i.push({key:n,priority:t}),this._decrease(u),!0):!1};i.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var n=this._arr.pop();return delete this._keyIndices[n.key],this._heapify(0),n.key};i.prototype.decrease=function(n,t){var i=this._keyIndices[n];if(t>this._arr[i].priority)throw new Error("New priority is greater than current priority. Key: "+n+" Old: "+this._arr[i].priority+" New: "+t);this._arr[i].priority=t;this._decrease(i)};i.prototype._heapify=function(n){var i=this._arr,r=2*n,u=r+1,t=n;r<i.length&&(t=i[r].priority<i[t].priority?r:t,u<i.length&&(t=i[u].priority<i[t].priority?u:t),t!==n&&(this._swap(n,t),this._heapify(t)))};i.prototype._decrease=function(n){for(var i=this._arr,r=i[n].priority,t;n!==0;){if(t=n>>1,i[t].priority<r)break;this._swap(n,t);n=t}};i.prototype._swap=function(n,t){var i=this._arr,r=this._keyIndices,u=i[n],f=i[t];i[n]=f;i[t]=u;r[f.key]=n;r[u.key]=t}},{"../lodash":19}],16:[function(n,t){"use strict";function r(n){this._isDirected=i.has(n,"directed")?n.directed:!0;this._isMultigraph=i.has(n,"multigraph")?n.multigraph:!1;this._isCompound=i.has(n,"compound")?n.compound:!1;this._label=undefined;this._defaultNodeLabelFn=i.constant(undefined);this._defaultEdgeLabelFn=i.constant(undefined);this._nodes={};this._isCompound&&(this._parent={},this._children={},this._children[u]={});this._in={};this._preds={};this._out={};this._sucs={};this._edgeObjs={};this._edgeLabels={}}function s(n,t){n[t]?n[t]++:n[t]=1}function h(n,t){--n[t]||delete n[t]}function f(n,t,r,u){var f=""+t,e=""+r,s;return!n&&f>e&&(s=f,f=e,e=s),f+o+e+o+(i.isUndefined(u)?c:u)}function l(n,t,i,r){var u=""+t,f=""+i,o,e;return!n&&u>f&&(o=u,u=f,f=o),e={v:u,w:f},r&&(e.name=r),e}function e(n,t){return f(n,t.v,t.w,t.name)}var i=n("./lodash");t.exports=r;var c="\x00",u="\x00",o="\x01";r.prototype._nodeCount=0;r.prototype._edgeCount=0;r.prototype.isDirected=function(){return this._isDirected};r.prototype.isMultigraph=function(){return this._isMultigraph};r.prototype.isCompound=function(){return this._isCompound};r.prototype.setGraph=function(n){return this._label=n,this};r.prototype.graph=function(){return this._label};r.prototype.setDefaultNodeLabel=function(n){return i.isFunction(n)||(n=i.constant(n)),this._defaultNodeLabelFn=n,this};r.prototype.nodeCount=function(){return this._nodeCount};r.prototype.nodes=function(){return i.keys(this._nodes)};r.prototype.sources=function(){return i.filter(this.nodes(),i.bind(function(n){return i.isEmpty(this._in[n])},this))};r.prototype.sinks=function(){return i.filter(this.nodes(),i.bind(function(n){return i.isEmpty(this._out[n])},this))};r.prototype.setNodes=function(n,t){var r=arguments;return i.each(n,i.bind(function(n){r.length>1?this.setNode(n,t):this.setNode(n)},this)),this};r.prototype.setNode=function(n,t){return i.has(this._nodes,n)?(arguments.length>1&&(this._nodes[n]=t),this):(this._nodes[n]=arguments.length>1?t:this._defaultNodeLabelFn(n),this._isCompound&&(this._parent[n]=u,this._children[n]={},this._children[u][n]=!0),this._in[n]={},this._preds[n]={},this._out[n]={},this._sucs[n]={},++this._nodeCount,this)};r.prototype.node=function(n){return this._nodes[n]};r.prototype.hasNode=function(n){return i.has(this._nodes,n)};r.prototype.removeNode=function(n){var r=this,t;return i.has(this._nodes,n)&&(t=function(n){r.removeEdge(r._edgeObjs[n])},delete this._nodes[n],this._isCompound&&(this._removeFromParentsChildList(n),delete this._parent[n],i.each(this.children(n),i.bind(function(n){this.setParent(n)},this)),delete this._children[n]),i.each(i.keys(this._in[n]),t),delete this._in[n],delete this._preds[n],i.each(i.keys(this._out[n]),t),delete this._out[n],delete this._sucs[n],--this._nodeCount),this};r.prototype.setParent=function(n,t){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(i.isUndefined(t))t=u;else{t+="";for(var r=t;!i.isUndefined(r);r=this.parent(r))if(r===n)throw new Error("Setting "+t+" as parent of "+n+" would create create a cycle");this.setNode(t)}return this.setNode(n),this._removeFromParentsChildList(n),this._parent[n]=t,this._children[t][n]=!0,this};r.prototype._removeFromParentsChildList=function(n){delete this._children[this._parent[n]][n]};r.prototype.parent=function(n){if(this._isCompound){var t=this._parent[n];if(t!==u)return t}};r.prototype.children=function(n){if(i.isUndefined(n)&&(n=u),this._isCompound){var t=this._children[n];if(t)return i.keys(t)}else{if(n===u)return this.nodes();if(this.hasNode(n))return[]}};r.prototype.predecessors=function(n){var t=this._preds[n];if(t)return i.keys(t)};r.prototype.successors=function(n){var t=this._sucs[n];if(t)return i.keys(t)};r.prototype.neighbors=function(n){var t=this.predecessors(n);if(t)return i.union(t,this.successors(n))};r.prototype.filterNodes=function(n){function f(n){var i=u.parent(n);return i===undefined||t.hasNode(i)?(r[n]=i,i):i in r?r[i]:f(i)}var t=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound}),u,r;return t.setGraph(this.graph()),i.each(this._nodes,i.bind(function(i,r){n(r)&&t.setNode(r,i)},this)),i.each(this._edgeObjs,i.bind(function(n){t.hasNode(n.v)&&t.hasNode(n.w)&&t.setEdge(n,this.edge(n))},this)),u=this,r={},this._isCompound&&i.each(t.nodes(),function(n){t.setParent(n,f(n))}),t};r.prototype.setDefaultEdgeLabel=function(n){return i.isFunction(n)||(n=i.constant(n)),this._defaultEdgeLabelFn=n,this};r.prototype.edgeCount=function(){return this._edgeCount};r.prototype.edges=function(){return i.values(this._edgeObjs)};r.prototype.setPath=function(n,t){var r=this,u=arguments;return i.reduce(n,function(n,i){return u.length>1?r.setEdge(n,i,t):r.setEdge(n,i),i}),this};r.prototype.setEdge=function(){var n,t,r,h,c=!1,u=arguments[0],e,o;if(typeof u=="object"&&u!==null&&"v"in u?(n=u.v,t=u.w,r=u.name,arguments.length===2&&(h=arguments[1],c=!0)):(n=u,t=arguments[1],r=arguments[3],arguments.length>2&&(h=arguments[2],c=!0)),n=""+n,t=""+t,i.isUndefined(r)||(r=""+r),e=f(this._isDirected,n,t,r),i.has(this._edgeLabels,e))return c&&(this._edgeLabels[e]=h),this;if(!i.isUndefined(r)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");return this.setNode(n),this.setNode(t),this._edgeLabels[e]=c?h:this._defaultEdgeLabelFn(n,t,r),o=l(this._isDirected,n,t,r),n=o.v,t=o.w,Object.freeze(o),this._edgeObjs[e]=o,s(this._preds[t],n),s(this._sucs[n],t),this._in[t][e]=o,this._out[n][e]=o,this._edgeCount++,this};r.prototype.edge=function(n,t,i){var r=arguments.length===1?e(this._isDirected,arguments[0]):f(this._isDirected,n,t,i);return this._edgeLabels[r]};r.prototype.hasEdge=function(n,t,r){var u=arguments.length===1?e(this._isDirected,arguments[0]):f(this._isDirected,n,t,r);return i.has(this._edgeLabels,u)};r.prototype.removeEdge=function(n,t,i){var r=arguments.length===1?e(this._isDirected,arguments[0]):f(this._isDirected,n,t,i),u=this._edgeObjs[r];return u&&(n=u.v,t=u.w,delete this._edgeLabels[r],delete this._edgeObjs[r],h(this._preds[t],n),h(this._sucs[n],t),delete this._in[t][r],delete this._out[n][r],this._edgeCount--),this};r.prototype.inEdges=function(n,t){var u=this._in[n],r;if(u)return(r=i.values(u),!t)?r:i.filter(r,function(n){return n.v===t})};r.prototype.outEdges=function(n,t){var u=this._out[n],r;if(u)return(r=i.values(u),!t)?r:i.filter(r,function(n){return n.w===t})};r.prototype.nodeEdges=function(n,t){var i=this.inEdges(n,t);if(i)return i.concat(this.outEdges(n,t))}},{"./lodash":19}],17:[function(n,t){t.exports={Graph:n("./graph"),version:n("./version")}},{"./graph":16,"./version":20}],18:[function(n,t){function u(n){var t={options:{directed:n.isDirected(),multigraph:n.isMultigraph(),compound:n.isCompound()},nodes:f(n),edges:e(n)};return i.isUndefined(n.graph())||(t.value=i.clone(n.graph())),t}function f(n){return i.map(n.nodes(),function(t){var u=n.node(t),f=n.parent(t),r={v:t};return i.isUndefined(u)||(r.value=u),i.isUndefined(f)||(r.parent=f),r})}function e(n){return i.map(n.edges(),function(t){var u=n.edge(t),r={v:t.v,w:t.w};return i.isUndefined(t.name)||(r.name=t.name),i.isUndefined(u)||(r.value=u),r})}function o(n){var t=new r(n.options).setGraph(n.value);return i.each(n.nodes,function(n){t.setNode(n.v,n.value);n.parent&&t.setParent(n.v,n.parent)}),i.each(n.edges,function(n){t.setEdge({v:n.v,w:n.w,name:n.name},n.value)}),t}var i=n("./lodash"),r=n("./graph");t.exports={write:u,read:o}},{"./graph":16,"./lodash":19}],19:[function(n,t){var i;if(typeof n=="function")try{i=n("lodash")}catch(r){}i||(i=window._);t.exports=i},{lodash:21}],20:[function(n,t){t.exports="2.1.1"},{}],21:[function(t,i,r){(function(t){(function(){function ks(n,t){return n.set(t[0],t[1]),n}function ds(n,t){return n.add(t),n}function s(n,t,i){var r=i.length;switch(r){case 0:return n.call(t);case 1:return n.call(t,i[0]);case 2:return n.call(t,i[0],i[1]);case 3:return n.call(t,i[0],i[1],i[2])}return n.apply(t,i)}function gs(n,t,i,r){for(var f=-1,e=n?n.length:0,u;++f<e;)u=n[f],t(r,u,i(u),n);return r}function c(n,t){for(var i=-1,r=n?n.length:0;++i<r;)if(t(n[i],i,n)===!1)break;return n}function nh(n,t){for(var i=n?n.length:0;i--;)if(t(n[i],i,n)===!1)break;return n}function vf(n,t){for(var i=-1,r=n?n.length:0;++i<r;)if(!t(n[i],i,n))return!1;return!0}function et(n,t){for(var i=-1,f=n?n.length:0,e=0,u=[],r;++i<f;)r=n[i],t(r,i,n)&&(u[e++]=r);return u}function kr(n,t){var i=n?n.length:0;return!!i&&vt(n,t,0)>-1}function dr(n,t,i){for(var r=-1,u=n?n.length:0;++r<u;)if(i(t,n[r]))return!0;return!1}function o(n,t){for(var i=-1,r=n?n.length:0,u=Array(r);++i<r;)u[i]=t(n[i],i,n);return u}function g(n,t){for(var i=-1,r=t.length,u=n.length;++i<r;)n[u+i]=t[i];return n}function at(n,t,i,r){var u=-1,f=n?n.length:0;for(r&&f&&(i=n[++u]);++u<f;)i=t(i,n[u],u,n);return i}function th(n,t,i,r){var u=n?n.length:0;for(r&&u&&(i=n[--u]);u--;)i=t(i,n[u],u,n);return i}function gr(n,t){for(var i=-1,r=n?n.length:0;++i<r;)if(t(n[i],i,n))return!0;return!1}function yf(n,t,i){var r;return i(n,function(n,i,u){if(t(n,i,u))return r=i,!1}),r}function pf(n,t,i,r){for(var f=n.length,u=i+(r?1:-1);r?u--:++u<f;)if(t(n[u],u,n))return u;return-1}function vt(n,t,i){if(t!==t)return gf(n,i);for(var r=i-1,u=n.length;++r<u;)if(n[r]===t)return r;return-1}function ih(n,t,i,r){for(var u=i-1,f=n.length;++u<f;)if(r(n[u],t))return u;return-1}function wf(n,t){var i=n?n.length:0;return i?nu(n,t)/i:li}function bf(n,t,i,r,u){return u(n,function(n,u,f){i=r?(r=!1,n):t(i,n,u,f)}),i}function rh(n,t){var i=n.length;for(n.sort(t);i--;)n[i]=n[i].value;return n}function nu(n,t){for(var i,f=-1,e=n.length,r;++f<e;)r=t(n[f]),r!==u&&(i=i===u?r:i+r);return i}function tu(n,t){for(var i=-1,r=Array(n);++i<n;)r[i]=t(i);return r}function uh(n,t){return o(t,function(t){return[t,n[t]]})}function rt(n){return function(t){return n(t)}}function iu(n,t){return o(t,function(t){return n[t]})}function gi(n,t){return n.has(t)}function kf(n,t){for(var i=-1,r=n.length;++i<r&&vt(t,n[i],0)>-1;);return i}function df(n,t){for(var i=n.length;i--&&vt(t,n[i],0)>-1;);return i}function ru(n){return n&&n.Object===Object?n:null}function fh(n,t){for(var i=n.length,r=0;i--;)n[i]===t&&r++;return r}function eh(n){return hs[n]}function oh(n){return cs[n]}function sh(n){return"\\"+as[n]}function hh(n,t){return n==null?u:n[t]}function gf(n,t,i){for(var f=n.length,r=t+(i?1:-1),u;i?r--:++r<f;)if(u=n[r],u!==u)return r;return-1}function ei(n){var t=!1;if(n!=null&&typeof n.toString!="function")try{t=!!(n+"")}catch(i){}return t}function ne(n){for(var t,i=[];!(t=n.next()).done;)i.push(t.value);return i}function oi(n){var i=-1,t=Array(n.size);return n.forEach(function(n,r){t[++i]=[r,n]}),t}function ut(n,t){for(var i=-1,f=n.length,e=0,u=[],r;++i<f;)r=n[i],(r===t||r===si)&&(n[i]=si,u[e++]=i);return u}function yt(n){var i=-1,t=Array(n.size);return n.forEach(function(n){t[++i]=n}),t}function ch(n){var i=-1,t=Array(n.size);return n.forEach(function(n){t[++i]=[n,n]}),t}function pt(n){if(!(n&&fi.test(n)))return n.length;for(var t=wr.lastIndex=0;wr.test(n);)t++;return t}function w(n){return n.match(wr)}function lh(n){return ls[n]}function te(n){function t(n){if(br(n)&&!lt(n)&&!(n instanceof ki)){if(n instanceof uf)return n;if(pr.call(n,"__wrapped__"))return ab(n)}return new uf(n)}function al(){}function uf(n,t){this.__wrapped__=n;this.__actions__=[];this.__chain__=!!t;this.__index__=0;this.__values__=u}function ki(n){this.__wrapped__=n;this.__actions__=[];this.__dir__=1;this.__filtered__=!1;this.__iteratees__=[];this.__takeCount__=a;this.__views__=[]}function an(){var n=new ki(this.__wrapped__);return n.__actions__=of(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=of(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=of(this.__views__),n}function vn(){if(this.__filtered__){var n=new ki(this);n.__dir__=-1;n.__filtered__=!0}else n=this.clone(),n.__dir__*=-1;return n}function yn(){var n=this.__wrapped__.value(),e=this.__dir__,o=lt(n),k=e<0,r=o?n.length:0,s=rrt(0,r,this.__views__),h=s.start,c=s.end,t=c-h,l=k?c:h-1,a=this.__iteratees__,d=a.length,v=0,y=yu(t,this.__takeCount__),u,f,i;if(!o||r<wt||r==t&&y==t)return ow(n,this.__actions__);u=[];n:while(t--&&v<y){for(l+=e,f=-1,i=n[l];++f<d;){var p=a[f],g=p.iteratee,w=p.type,b=g(i);if(w==oe)i=b;else if(!b)if(w==eu)continue n;else break n}u[v++]=i}return u}function ls(n){var i=-1,r=n?n.length:0,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function pn(){this.__data__=sc?sc(null):{}}function wn(n){return this.has(n)&&delete this.__data__[n]}function bn(n){var t=this.__data__,i;return sc?(i=t[n],i===nr?u:i):pr.call(t,n)?t[n]:u}function kn(n){var t=this.__data__;return sc?t[n]!==u:pr.call(t,n)}function dn(n,t){var i=this.__data__;return i[n]=sc&&t===u?nr:t,this}function ko(n){var i=-1,r=n?n.length:0,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function gn(){this.__data__=[]}function ntt(n){var t=this.__data__,i=vl(t,n),r;return i<0?!1:(r=t.length-1,i==r?t.pop():el.call(t,i,1),!0)}function ttt(n){var t=this.__data__,i=vl(t,n);return i<0?u:t[i][1]}function itt(n){return vl(this.__data__,n)>-1}function rtt(n,t){var i=this.__data__,r=vl(i,n);return r<0?i.push([n,t]):i[r][1]=t,this}function go(n){var i=-1,r=n?n.length:0,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function utt(){this.__data__={hash:new ls,map:new(hl||ko),string:new ls}}function ftt(n){return oa(this,n)["delete"](n)}function ett(n){return oa(this,n).get(n)}function ott(n){return oa(this,n).has(n)}function stt(n,t){return oa(this,n).set(n,t),this}function as(n){var t=-1,i=n?n.length:0;for(this.__data__=new go;++t<i;)this.add(n[t])}function htt(n){return this.__data__.set(n,nr),this}function ctt(n){return this.__data__.has(n)}function hf(n){this.__data__=new ko(n)}function ltt(){this.__data__=new ko}function att(n){return this.__data__["delete"](n)}function vtt(n){return this.__data__.get(n)}function ytt(n){return this.__data__.has(n)}function ptt(n,t){var i=this.__data__;return i instanceof ko&&i.__data__.length==wt&&(i=this.__data__=new go(i.__data__)),i.set(n,t),this}function nv(n,t,i,r){return n===u||is(n,fc[i])&&!pr.call(r,i)?t:n}function tv(n,t,i){(i===u||is(n[t],i))&&(typeof t!="number"||i!==u||t in n)||(n[t]=i)}function dh(n,t,i){var r=n[t];pr.call(n,t)&&is(r,i)&&(i!==u||t in n)||(n[t]=i)}function vl(n,t){for(var i=n.length;i--;)if(is(n[i][0],t))return i;return-1}function wtt(n,t,i,r){return ns(n,function(n,u,f){t(r,n,i(n),f)}),r}function cp(n,t){return n&&vh(t,wr(t),n)}function iv(n,t){for(var i=-1,e=n==null,r=t.length,f=Array(r);++i<r;)f[i]=e?u:py(n,t[i]);return f}function gh(n,t,i){return n===n&&(i!==u&&(n=n<=i?n:i),t!==u&&(n=n>=t?n:t)),n}function ff(n,t,i,r,e,o,s){var h,a,l,v,y,p;if(r&&(h=o?r(n,e,o,s):r(n)),h!==u)return h;if(!yr(n))return n;if(a=lt(n),a){if(h=urt(n),!t)return of(n,h)}else{if(l=pu(n),v=l==yi||l==ou,aa(n))return hit(n,t);if(l==d||l==ht||v&&!o){if(ei(n))return o?n:{};if(h=frt(v?{}:n),!t)return bit(n,cp(h,n))}else{if(!f[l])return o?n:{};h=ert(n,l,ff,t)}}return(s||(s=new hf),y=s.get(n),y)?y:(s.set(n,h),a||(p=i?irt(n):wr(n)),c(p||n,function(u,f){p&&(f=u,u=n[f]);dh(h,f,ff(u,t,i,r,f,n,s))}),h)}function btt(n){var t=wr(n),i=t.length;return function(r){var f;if(r==null)return!i;for(f=i;f--;){var e=t[f],s=n[e],o=r[e];if(o===u&&!(e in Object(r))||!s(o))return!1}return!0}}function nc(n){return yr(n)?kg(n):{}}function lp(n,t,i){if(typeof n!="function")throw new rf(h);return ec(function(){n.apply(u,i)},t)}function ws(n,t,i,r){var l=-1,s=kr,h=!0,a=n.length,e=[],v=t.length,u,f,c;if(!a)return e;i&&(t=o(t,rt(i)));r?(s=dr,h=!1):t.length>=wt&&(s=gi,h=!1,t=new as(t));n:while(++l<a)if(u=n[l],f=i?i(u):u,u=r||u!==0?u:0,h&&f===f){for(c=v;c--;)if(t[c]===f)continue n;e.push(u)}else s(t,f,r)||e.push(u);return e}function ktt(n,t){var i=!0;return ns(n,function(n,r,u){return i=!!t(n,r,u)}),i}function yl(n,t,i){for(var o=-1,h=n.length,f,r,e,s;++o<h;)f=n[o],r=t(f),r!=null&&(e===u?r===r&&!nf(r):i(r,e))&&(e=r,s=f);return s}function dtt(n,t,i,r){var f=n.length;for(i=bi(i),i<0&&(i=-i>f?0:f+i),r=r===u||r>f?f:bi(r),r<0&&(r+=f),r=i>r?0:hd(r);i<r;)n[i++]=t;return n}function ap(n,t){var i=[];return ns(n,function(n,r,u){t(n,r,u)&&i.push(n)}),i}function ar(n,t,i,r,u){var e=-1,o=n.length,f;for(i||(i=ort),u||(u=[]);++e<o;)f=n[e],t>0&&i(f)?t>1?ar(f,t-1,i,r,u):g(u,f):r||(u[u.length]=f);return u}function lf(n,t){return n&&uv(n,t,wr)}function ev(n,t){return n&&fv(n,t,wr)}function pl(n,t){return et(t,function(t){return sf(n[t])})}function lc(n,t){t=bo(t,n)?[t]:ah(t);for(var i=0,r=t.length;n!=null&&i<r;)n=n[du(t[i++])];return i&&i==r?n:u}function vp(n,t,i){var r=t(n);return lt(n)?r:g(r,i(n))}function ov(n,t){return n>t}function wl(n,t){return n!=null&&(pr.call(n,t)||typeof n=="object"&&t in n&&pc(n)===null)}function gtt(n,t){return n!=null&&t in Object(n)}function nit(n,t,i){return n>=yu(t,i)&&n<ru(t,i)}function sv(n,t,i){for(var w=i?dr:kr,b=n[0].length,l=n.length,r=l,a=Array(l),v=Infinity,c=[],f,y,h,e,s,p;r--;)f=n[r],r&&t&&(f=o(f,rt(t))),v=yu(f.length,v),a[r]=!i&&(t||b>=120&&f.length>=120)?new as(r&&f):u;f=n[0];y=-1;h=a[0];n:while(++y<b&&c.length<v)if(e=f[y],s=t?t(e):e,e=i||e!==0?e:0,!(h?gi(h,s):w(c,s,i))){for(r=l;--r;)if(p=a[r],!(p?gi(p,s):w(n[r],s,i)))continue n;h&&h.push(s);c.push(e)}return c}function tit(n,t,i,r){return lf(n,function(n,u,f){t(r,i(n),u,f)}),r}function ac(n,t,i){bo(t,n)||(t=ah(t),n=uy(n,t),t=gu(t));var r=n==null?n:n[du(t)];return r==null?u:s(r,n,i)}function vc(n,t,i,r,u){return n===t?!0:n==null||t==null||!yr(n)&&!br(t)?n!==n&&t!==t:iit(n,t,vc,i,r,u)}function iit(n,t,i,r,u,f){var c=lt(n),p=lt(t),e=ai,o=ai,s,h,v,y;c||(e=pu(n),e=e==ht?d:e);p||(o=pu(t),o=o==ht?d:o);var l=e==d&&!ei(n),w=o==d&&!ei(t),a=e==o;return a&&!l?(f||(f=new hf),c||gc(n)?ib(n,t,i,r,u,f):nrt(n,t,e,i,r,u,f)):!(u&st)&&(s=l&&pr.call(n,"__wrapped__"),h=w&&pr.call(t,"__wrapped__"),s||h)?(v=s?n.value():n,y=h?t.value():t,f||(f=new hf),i(v,y,r,u,f)):a?(f||(f=new hf),trt(n,t,i,r,u,f)):!1}function hv(n,t,i,r){var e=i.length,l=e,a=!r,f,h,c;if(n==null)return!l;for(n=Object(n);e--;)if(f=i[e],a&&f[2]?f[1]!==n[f[0]]:!(f[0]in n))return!1;while(++e<l){f=i[e];var o=f[0],s=n[o],v=f[1];if(a&&f[2]){if(s===u&&!(o in n))return!1}else if(h=new hf,r&&(c=r(s,v,o,n,t,h)),!(c===u?vc(v,s,r,ci|st,h):c))return!1}return!0}function yp(n){if(!yr(n)||hrt(n))return!1;var t=sf(n)||ei(n)?bg:lo;return t.test(yh(n))}function pp(n){return typeof n=="function"?n:n==null?tf:typeof n=="object"?lt(n)?dp(n[0],n[1]):kp(n):hg(n)}function rit(n){return tn(Object(n))}function wp(n){var t,i;n=n==null?n:Object(n);t=[];for(i in n)t.push(i);return t}function cv(n,t){return n<t}function bp(n,t){var r=-1,i=bu(n)?Array(n.length):[];return ns(n,function(n,u,f){i[++r]=t(n,u,f)}),i}function kp(n){var t=ty(n);return t.length==1&&t[0][2]?cb(t[0][0],t[0][1]):function(i){return i===n||hv(i,n,t)}}function dp(n,t){return bo(n)&&hb(t)?cb(du(n),t):function(i){var r=py(i,n);return r===u&&r===t?yd(i,n):vc(t,r,u,ci|st)}}function bl(n,t,i,r,f){if(n!==t){if(!(lt(t)||gc(t)))var e=cf(t);c(e||t,function(o,s){if(e&&(s=o,o=t[s]),yr(o))f||(f=new hf),uit(n,t,s,i,bl,r,f);else{var h=r?r(n[s],o,s+"",n,t,f):u;h===u&&(h=o);tv(n,s,h)}})}}function uit(n,t,i,r,f,e,o){var c=n[i],s=t[i],a=o.get(s),h,l;if(a){tv(n,i,a);return}h=e?e(c,s,i+"",n,t,o):u;l=h===u;l&&(h=s,lt(s)||gc(s)?lt(c)?h=c:vr(c)?h=of(c):(l=!1,h=ff(s,!0)):ay(s)||ph(s)?ph(c)?h=cd(c):!yr(c)||r&&sf(c)?(l=!1,h=ff(s,!0)):h=c:l=!1);o.set(s,h);l&&f(h,s,r,e,o);o["delete"](s);tv(n,i,h)}function gp(n,t){var i=n.length;if(i)return t+=t<0?i:0,wo(t,i)?n[t]:u}function nw(n,t,r){var f=-1,u;return t=o(t.length?t:[tf],rt(i())),u=bp(n,function(n){var i=o(t,function(t){return t(n)});return{criteria:i,index:++f,value:n}}),rh(u,function(n,t){return wit(n,t,r)})}function tw(n,t){return n=Object(n),at(t,function(t,i){return i in n&&(t[i]=n[i]),t},{})}function iw(n,t){for(var u=-1,f=rb(n),o=f.length,e={},i,r;++u<o;)i=f[u],r=n[i],t(r,i)&&(e[i]=r);return e}function lv(n){return function(t){return t==null?u:t[n]}}function fit(n){return function(t){return lc(t,n)}}function av(n,t,i,r){var h=r?ih:vt,e=-1,c=t.length,u=n;for(n===t&&(t=of(t)),i&&(u=o(n,rt(i)));++e<c;)for(var f=0,s=t[e],l=i?i(s):s;(f=h(u,l,f,r))>-1;)u!==n&&el.call(u,f,1),el.call(n,f,1);return n}function rw(n,t){for(var r=n?t.length:0,o=r-1,i,e,u,f;r--;)i=t[r],(r==o||i!==e)&&(e=i,wo(i)?el.call(n,i,1):bo(i,n)?delete n[du(i)]:(u=ah(i),f=uy(n,u),f!=null&&delete f[du(gu(u))]));return n}function vv(n,t){return n+sl(sp()*(t-n+1))}function eit(n,t,i,r){for(var e=-1,u=ru(ol((t-n)/(i||1)),0),f=Array(u);u--;)f[r?u:++e]=n,n+=i;return f}function yv(n,t){var i="";if(!n||t<1||t>it)return i;do t%2&&(i+=n),t=sl(t/2),t&&(n+=n);while(t);return i}function kl(n,t,i,r){var e,o,h;t=bo(t,n)?[t]:ah(t);for(var s=-1,c=t.length,l=c-1,f=n;f!=null&&++s<c;)e=du(t[s]),yr(f)&&(o=i,s!=l&&(h=f[e],o=r?r(h,e,f):u,o===u&&(o=h==null?wo(t[s+1])?[]:{}:h)),dh(f,e,o)),f=f[e];return n}function af(n,t,i){var u=-1,r=n.length,f;for(t<0&&(t=-t>r?0:r+t),i=i>r?r:i,i<0&&(i+=r),r=t>i?0:i-t>>>0,t>>>=0,f=Array(r);++u<r;)f[u]=n[u+t];return f}function oit(n,t){var i;return ns(n,function(n,r,u){return i=t(n,r,u),!i}),!!i}function dl(n,t,i){var f=0,r=n?n.length:f,e,u;if(typeof t=="number"&&t===t&&r<=le){while(f<r)e=f+r>>>1,u=n[e],u!==null&&!nf(u)&&(i?u<=t:u<t)?f=e+1:r=e;return r}return wv(n,t,tf,i)}function wv(n,t,i,r){var v;t=i(t);for(var s=0,e=n?n.length:0,y=t!==t,p=t===null,w=nf(t),b=t===u;s<e;){var h=sl((s+e)/2),f=i(n[h]),c=f!==u,l=f===null,o=f===f,a=nf(f);v=y?r||o:b?o&&(r||c):p?o&&c&&(r||!l):w?o&&c&&!l&&(r||!a):l||a?!1:r?f<=t:f<t;v?s=h+1:e=h}return yu(e,ce)}function uw(n,t){for(var r=-1,o=n.length,s=0,f=[],i,u,e;++r<o;)i=n[r],u=t?t(i):i,r&&is(u,e)||(e=u,f[s++]=i===0?0:i);return f}function fw(n){return typeof n=="number"?n:nf(n)?li:+n}function ef(n){if(typeof n=="string")return n;if(nf(n))return hp?hp.call(n):"";var t=n+"";return t=="0"&&1/n==-ft?"-0":t}function bs(n,t,i){var l=-1,o=kr,a=n.length,s=!0,e=[],r=e,h,u,f,c;if(i)s=!1,o=dr;else if(a>=wt){if(h=t?null:nb(n),h)return yt(h);s=!1;o=gi;r=new as}else r=t?[]:e;n:while(++l<a)if(u=n[l],f=t?t(u):u,u=i||u!==0?u:0,s&&f===f){for(c=r.length;c--;)if(r[c]===f)continue n;t&&r.push(f);e.push(u)}else o(r,f,i)||(r!==e&&r.push(f),e.push(u));return e}function sit(n,t){t=bo(t,n)?[t]:ah(t);n=uy(n,t);var i=du(gu(t));return!(n!=null&&wl(n,i))||delete n[i]}function ew(n,t,i,r){return kl(n,t,i(lc(n,t)),r)}function gl(n,t,i,r){for(var f=n.length,u=r?f:-1;(r?u--:++u<f)&&t(n[u],u,n););return i?af(n,r?0:u,r?u+1:f):af(n,r?u+1:0,r?f:u)}function ow(n,t){var i=n;return i instanceof ki&&(i=i.value()),at(t,function(n,t){return t.func.apply(t.thisArg,g([n],t.args))},i)}function bv(n,t,i){for(var u=-1,f=n.length,r;++u<f;)r=r?g(ws(r,n[u],t,i),ws(n[u],r,t,i)):n[u];return r&&r.length?bs(r,t,i):[]}function sw(n,t,i){for(var r=-1,o=n.length,s=t.length,f={},e;++r<o;)e=r<s?t[r]:u,i(f,n[r],e);return f}function kv(n){return vr(n)?n:[]}function hw(n){return typeof n=="function"?n:tf}function ah(n){return lt(n)?n:ey(n)}function hs(n,t,i){var r=n.length;return i=i===u?r:i,!t&&i>=r?n:af(n,t,i)}function hit(n,t){if(t)return n.slice();var i=new n.constructor(n.length);return n.copy(i),i}function dv(n){var t=new n.constructor(n.byteLength);return new fl(t).set(new fl(n)),t}function cit(n,t){var i=t?dv(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.byteLength)}function lit(n,t,i){var r=t?i(oi(n),!0):oi(n);return at(r,ks,new n.constructor)}function ait(n){var t=new n.constructor(n.source,au.exec(n));return t.lastIndex=n.lastIndex,t}function vit(n,t,i){var r=t?i(yt(n),!0):yt(n);return at(r,ds,new n.constructor)}function yit(n){return cc?Object(cc.call(n)):{}}function pit(n,t){var i=t?dv(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.length)}function cw(n,t){if(n!==t){var o=n!==u,s=n===null,i=n===n,r=nf(n),h=t!==u,c=t===null,f=t===t,e=nf(t);if(!c&&!e&&!r&&n>t||r&&h&&f&&!c&&!e||s&&h&&f||!o&&f||!i)return 1;if(!s&&!r&&!e&&n<t||e&&o&&i&&!s&&!r||c&&o&&i||!h&&i||!f)return-1}return 0}function wit(n,t,i){for(var r=-1,f=n.criteria,o=t.criteria,s=f.length,h=i.length,u,e;++r<s;)if(u=cw(f[r],o[r]),u)return r>=h?u:(e=i[r],u*(e=="desc"?-1:1));return n.index-t.index}function lw(n,t,i,r){for(var u=-1,o=n.length,s=i.length,f=-1,h=t.length,c=ru(o-s,0),e=Array(h+c),l=!r;++f<h;)e[f]=t[f];while(++u<s)(l||u<o)&&(e[i[u]]=n[u]);while(c--)e[f++]=n[u++];return e}function aw(n,t,i,r){for(var u=-1,s=n.length,h=-1,c=i.length,e=-1,l=t.length,a=ru(s-c,0),f=Array(a+l),v=!r,o;++u<a;)f[u]=n[u];for(o=u;++e<l;)f[o+e]=t[e];while(++h<c)(v||u<s)&&(f[o+i[h]]=n[u++]);return f}function of(n,t){var i=-1,r=n.length;for(t||(t=Array(r));++i<r;)t[i]=n[i];return t}function vh(n,t,i,r){var f,e,u,o;for(i||(i={}),f=-1,e=t.length;++f<e;)u=t[f],o=r?r(i[u],n[u],u,i,n):n[u],dh(i,u,o);return i}function bit(n,t){return vh(n,wc(n),t)}function na(n,t){return function(r,u){var f=lt(r)?gs:wtt,e=t?t():{};return f(r,n,i(u),e)}}function tc(n){return r(function(t,i){var e=-1,r=i.length,f=r>1?i[r-1]:u,s=r>2?i[2]:u,o;for(f=n.length>3&&typeof f=="function"?(r--,f):u,s&&ku(i[0],i[1],s)&&(f=r<3?u:f,r=1),t=Object(t);++e<r;)o=i[e],o&&n(t,o,e,f);return t})}function vw(n,t){return function(i,r){if(i==null)return i;if(!bu(i))return n(i,r);for(var f=i.length,u=t?f:-1,e=Object(i);t?u--:++u<f;)if(r(e[u],u,e)===!1)break;return i}}function yw(n){return function(t,i,r){for(var s=-1,f=Object(t),e=r(t),o=e.length,u;o--;)if(u=e[n?o:++s],i(f[u],u,f)===!1)break;return t}}function kit(n,t,i){function r(){var t=this&&this!==p&&this instanceof r?f:n;return t.apply(u?i:this,arguments)}var u=t&l,f=yc(n);return r}function pw(n){return function(t){t=di(t);var i=fi.test(t)?w(t):u,r=i?i[0]:t.charAt(0),f=i?hs(i,1).join(""):t.slice(1);return r[n]()+f}}function ic(n){return function(t){return at(ig(dd(t).replace(rs,"")),n,"")}}function yc(n){return function(){var t=arguments,i,r;switch(t.length){case 0:return new n;case 1:return new n(t[0]);case 2:return new n(t[0],t[1]);case 3:return new n(t[0],t[1],t[2]);case 4:return new n(t[0],t[1],t[2],t[3]);case 5:return new n(t[0],t[1],t[2],t[3],t[4]);case 6:return new n(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new n(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}return i=nc(n.prototype),r=n.apply(i,t),yr(r)?r:i}}function dit(n,t,i){function r(){for(var e=arguments.length,o=Array(e),h=e,c=rc(r),l,a;h--;)o[h]=arguments[h];return(l=e<3&&o[0]!==c&&o[e-1]!==c?[]:ut(o,c),e-=l.length,e<i)?gw(n,t,ta,r.placeholder,u,o,l,u,u,i-e):(a=this&&this!==p&&this instanceof r?f:n,s(a,this,o))}var f=yc(n);return r}function ww(n){return function(t,r,f){var s=Object(t),e,o;return r=i(r,3),bu(t)||(e=wr(t)),o=n(e||t,function(n,t){return e&&(t=n,n=s[t]),r(n,t,s)},f),o>-1?t[e?e[o]:o]:u}}function bw(n){return r(function(t){var r,i,s,f;t=ar(t,1);var o=t.length,e=o,c=uf.prototype.thru;for(n&&t.reverse();e--;){if(r=t[e],typeof r!="function")throw new rf(h);c&&!i&&ea(r)=="wrapper"&&(i=new uf([],!0))}for(e=i?e:o;++e<o;)r=t[e],s=ea(r),f=s=="wrapper"?fa(r):u,i=f&&ry(f[0])&&f[1]==(tt|b|k|hi)&&!f[4].length&&f[9]==1?i[ea(f[0])].apply(i,f[3]):r.length==1&&ry(r)?i[s]():i.thru(r);return function(){var f=arguments,n=f[0],r,u;if(i&&f.length==1&&lt(n)&&n.length>=wt)return i.plant(n).value();for(r=0,u=o?t[r].apply(this,f):n;++r<o;)u=t[r].call(this,u);return u}})}function ta(n,t,i,r,f,e,o,s,h,c){function v(){for(var l=arguments.length,u=Array(l),nt=l,tt,rt,ft,it,b;nt--;)u[nt]=arguments[nt];return(a&&(tt=rc(v),rt=fh(u,tt)),r&&(u=lw(u,r,f,a)),e&&(u=aw(u,e,o,a)),l-=rt,a&&l<c)?(ft=ut(u,tt),gw(n,t,ta,v.placeholder,i,u,ft,s,h,c-l)):(it=k?i:this,b=y?it[n]:n,l=u.length,s?u=lrt(u,s):d&&l>1&&u.reverse(),w&&h<l&&(u.length=h),this&&this!==p&&this instanceof v&&(b=g||yc(b)),b.apply(it,u))}var w=t&tt,k=t&l,y=t&ot,a=t&(b|bt),d=t&fu,g=y?u:yc(n);return v}function kw(n,t){return function(i,r){return tit(i,n,t(r),{})}}function ia(n){return function(t,i){var r;if(t===u&&i===u)return 0;if(t!==u&&(r=t),i!==u){if(r===u)return i;typeof t=="string"||typeof i=="string"?(t=ef(t),i=ef(i)):(t=fw(t),i=fw(i));r=n(t,i)}return r}}function gv(n){return r(function(t){return t=t.length==1&&lt(t[0])?o(t[0],rt(i())):o(ar(t,1,iy),rt(i())),r(function(i){var r=this;return n(t,function(n){return s(n,r,i)})})})}function ra(n,t){var i,r;return(t=t===u?" ":ef(t),i=t.length,i<2)?i?yv(t,n):t:(r=yv(t,ol(n/pt(t))),fi.test(t)?hs(w(r),0,n).join(""):r.slice(0,n))}function git(n,t,i,r){function u(){for(var l=-1,h=arguments.length,t=-1,c=r.length,o=Array(c+h),a=this&&this!==p&&this instanceof u?e:n;++t<c;)o[t]=r[t];while(h--)o[t++]=arguments[++l];return s(a,f?i:this,o)}var f=t&l,e=yc(n);return u}function dw(n){return function(t,i,r){return r&&typeof r!="number"&&ku(t,i,r)&&(i=r=u),t=vu(t),t=t===t?t:0,i===u?(i=t,t=0):i=vu(i)||0,r=r===u?t<i?1:-1:vu(r)||0,eit(t,i,r,n)}}function ua(n){return function(t,i){return typeof t=="string"&&typeof i=="string"||(t=vu(t),i=vu(i)),n(t,i)}}function gw(n,t,i,r,f,e,o,s,h,c){var a=t&b,p=a?o:u,w=a?u:o,d=a?e:u,g=a?u:e,y,v;return t|=a?k:kt,t&=~(a?kt:k),t&uu||(t&=~(l|ot)),y=[n,t,f,d,p,g,w,s,h,c],v=i.apply(u,y),ry(n)&&fy(v,y),v.placeholder=r,v}function ny(n){var t=bh[n];return function(n,i){if(n=vu(n),i=yu(bi(i),292),i){var r=(di(n)+"e").split("e"),u=t(r[0]+"e"+(+r[1]+i));return r=(di(u)+"e").split("e"),+(r[0]+"e"+(+r[1]-i))}return t(n)}}function tb(n){return function(t){var i=pu(t);return i==v?oi(t):i==y?ch(t):uh(t,n(t))}}function ts(n,t,i,r,f,e,o,s){var y=t&ot,a,p,w,v,c,d,g;if(!y&&typeof n!="function")throw new rf(h);return a=r?r.length:0,a||(t&=~(k|kt),r=f=u),o=o===u?o:ru(bi(o),0),s=s===u?s:bi(s),a-=f?f.length:0,t&kt&&(p=r,w=f,r=f=u),v=y?u:fa(n),c=[n,t,i,r,f,p,w,e,o,s],v&&crt(c,v),n=c[0],t=c[1],i=c[2],r=c[3],f=c[4],s=c[9]=c[9]==null?y?0:n.length:ru(c[9]-a,0),!s&&t&(b|bt)&&(t&=~(b|bt)),d=t&&t!=l?t==b||t==bt?dit(n,t,s):t!=k&&t!=(l|k)||f.length?ta.apply(u,c):git(n,t,i,r):kit(n,t,i),g=v?pv:fy,g(d,c)}function ib(n,t,i,r,f,e){var p=f&st,l=n.length,w=t.length,a,o,h,y;if(l!=w&&!(p&&w>l))return!1;if(a=e.get(n),a)return a==t;var s=-1,c=!0,v=f&ci?new as:u;for(e.set(n,t);++s<l;){if(o=n[s],h=t[s],r&&(y=p?r(h,o,s,t,n,e):r(o,h,s,n,t,e)),y!==u){if(y)continue;c=!1;break}if(v){if(!gr(t,function(n,t){if(!v.has(t)&&(o===n||i(o,n,r,f,e)))return v.add(t)})){c=!1;break}}else if(!(o===h||i(o,h,r,f,e))){c=!1;break}}return e["delete"](n),c}function nrt(n,t,i,r,u,f,e){var o,h,s;switch(i){case ct:if(n.byteLength!=t.byteLength||n.byteOffset!=t.byteOffset)return!1;n=n.buffer;t=t.buffer;case ui:return n.byteLength!=t.byteLength||!r(new fl(n),new fl(t))?!1:!0;case dt:case gt:return+n==+t;case vi:return n.name==t.name&&n.message==t.message;case ni:return n!=+n?t!=+t:n==+t;case ti:case ii:return n==t+"";case v:o=oi;case y:return(h=f&st,o||(o=yt),n.size!=t.size&&!h)?!1:(s=e.get(n),s)?s==t:(f|=ci,e.set(n,t),ib(o(n),o(t),r,u,f,e));case pi:if(cc)return cc.call(n)==cc.call(t)}return!1}function trt(n,t,i,r,f,e){var y=f&st,w=wr(n),b=w.length,g=wr(t),nt=g.length,s,o,k,h,p,c,l,d,a,v;if(b!=nt&&!y)return!1;for(s=b;s--;)if(o=w[s],!(y?o in t:wl(t,o)))return!1;if(k=e.get(n),k)return k==t;for(h=!0,e.set(n,t),p=y;++s<b;){if(o=w[s],c=n[o],l=t[o],r&&(d=y?r(l,c,o,t,n,e):r(c,l,o,n,t,e)),!(d===u?c===l||i(c,l,r,f,e):d)){h=!1;break}p||(p=o=="constructor")}return h&&!p&&(a=n.constructor,v=t.constructor,a!=v&&"constructor"in n&&"constructor"in t&&!(typeof a=="function"&&a instanceof a&&typeof v=="function"&&v instanceof v)&&(h=!1)),e["delete"](n),h}function irt(n){return vp(n,wr,wc)}function rb(n){return vp(n,cf,fb)}function ea(n){for(var t=n.name+"",u=hc[t],f=pr.call(hc,t)?u.length:0,i,r;f--;)if(i=u[f],r=i.func,r==null||r==n)return i.name;return t}function rc(n){var i=pr.call(t,"placeholder")?t:n;return i.placeholder}function i(){var n=t.iteratee||dy;return n=n===dy?pp:n,arguments.length?n(arguments[0],arguments[1]):n}function oa(n,t){var i=n.__data__;return srt(t)?i[typeof t=="string"?"string":"hash"]:i.map}function ty(n){for(var t=wr(n),i=t.length,r,u;i--;)r=t[i],u=n[r],t[i]=[r,u,hb(u)];return t}function uc(n,t){var i=hh(n,t);return yp(i)?i:u}function pc(n){return dg(Object(n))}function wc(n){return wa(Object(n))}function pu(n){return wu.call(n)}function rrt(n,t,i){for(var f=-1,e=i.length,u,r;++f<e;){u=i[f];r=u.size;switch(u.type){case"drop":n+=r;break;case"dropRight":t-=r;break;case"take":t=yu(t,n+r);break;case"takeRight":n=ru(n,t-r)}}return{start:n,end:t}}function eb(n,t,i){var f,e,u,r;for(t=bo(t,n)?[t]:ah(t),e=-1,r=t.length;++e<r;){if(u=du(t[e]),!(f=n!=null&&i(n,u)))break;n=n[u]}return f?f:(r=n?n.length:0,!!r&&dc(r)&&wo(u,r)&&(lt(n)||wh(n)||ph(n)))}function urt(n){var i=n.length,t=n.constructor(i);return i&&typeof n[0]=="string"&&pr.call(n,"index")&&(t.index=n.index,t.input=n.input),t}function frt(n){return typeof n.constructor=="function"&&!bc(n)?nc(pc(n)):{}}function ert(n,t,i,r){var u=n.constructor;switch(t){case ui:return dv(n);case dt:case gt:return new u(+n);case ct:return cit(n,r);case tr:case ir:case rr:case ur:case fr:case er:case or:case sr:case hr:return pit(n,r);case v:return lit(n,r,i);case ni:case ii:return new u(n);case ti:return ait(n);case y:return vit(n,r,i);case pi:return yit(n)}}function ob(n){var t=n?n.length:u;return dc(t)&&(lt(n)||wh(n)||ph(n))?tu(t,String):null}function ort(n){return lt(n)||ph(n)}function iy(n){return lt(n)&&!(n.length==2&&!sf(n[0]))}function wo(n,t){return t=t==null?it:t,!!t&&(typeof n=="number"||vo.test(n))&&n>-1&&n%1==0&&n<t}function ku(n,t,i){if(!yr(i))return!1;var r=typeof t;return(r=="number"?bu(i)&&wo(t,i.length):r=="string"&&t in i)?is(i[t],n):!1}function bo(n,t){if(lt(n))return!1;var i=typeof n;return i=="number"||i=="symbol"||i=="boolean"||n==null||nf(n)?!0:no.test(n)||!ge.test(n)||t!=null&&n in Object(t)}function srt(n){var t=typeof n;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?n!=="__proto__":n===null}function ry(n){var u=ea(n),i=t[u],r;return typeof i!="function"||!(u in ki.prototype)?!1:n===i?!0:(r=fa(i),!!r&&n===r[0])}function hrt(n){return!!up&&up in n}function bc(n){var t=n&&n.constructor,i=typeof t=="function"&&t.prototype||fc;return n===i}function hb(n){return n===n&&!yr(n)}function cb(n,t){return function(i){return i==null?!1:i[n]===t&&(t!==u||n in Object(i))}}function crt(n,t){var f=n[1],u=t[1],e=f|u,o=e<(l|ot|tt),s=u==tt&&f==b||u==tt&&f==hi&&n[7].length<=t[8]||u==(tt|hi)&&t[7].length<=t[8]&&f==b,i,r;return(o||s)?(u&l&&(n[2]=t[2],e|=f&l?0:uu),i=t[3],i&&(r=n[3],n[3]=r?lw(r,i,t[4]):i,n[4]=r?ut(n[3],si):t[4]),i=t[5],i&&(r=n[5],n[5]=r?aw(r,i,t[6]):i,n[6]=r?ut(n[5],si):t[6]),i=t[7],i&&(n[7]=i),u&tt&&(n[8]=n[8]==null?t[8]:yu(n[8],t[8])),n[9]==null&&(n[9]=t[9]),n[0]=t[0],n[1]=e,n):n}function lb(n,t,i,r,f,e){return yr(n)&&yr(t)&&bl(n,t,u,lb,e.set(t,n)),n}function uy(n,t){return t.length==1?n:lc(n,af(t,0,-1))}function lrt(n,t){for(var f=n.length,i=yu(t.length,f),e=of(n),r;i--;)r=t[i],n[i]=wo(r,f)?e[r]:u;return n}function du(n){if(typeof n=="string"||nf(n))return n;var t=n+"";return t=="0"&&1/n==-ft?"-0":t}function yh(n){if(n!=null){try{return rl.call(n)}catch(t){}try{return n+""}catch(t){}}return""}function ab(n){if(n instanceof ki)return n.clone();var t=new uf(n.__wrapped__,n.__chain__);return t.__actions__=of(n.__actions__),t.__index__=n.__index__,t.__values__=n.__values__,t}function art(n,t,i){var r;if(t=(i?ku(n,t,i):t===u)?1:ru(bi(t),0),r=n?n.length:0,!r||t<1)return[];for(var f=0,o=0,e=Array(ol(r/t));f<r;)e[o++]=af(n,f,f+=t);return e}function vrt(n){for(var i=-1,u=n?n.length:0,f=0,r=[],t;++i<u;)t=n[i],t&&(r[f++]=t);return r}function yrt(){for(var n=arguments.length,r=Array(n?n-1:0),t=arguments[0],i=n;i--;)r[i-1]=arguments[i];return n?g(lt(t)?of(t):[t],ar(r,1)):[]}function vb(n,t,i){var r=n?n.length:0;return r?(t=i||t===u?1:bi(t),af(n,t<0?0:t,r)):[]}function yb(n,t,i){var r=n?n.length:0;return r?(t=i||t===u?1:bi(t),t=r-t,af(n,0,t<0?0:t)):[]}function krt(n,t){return n&&n.length?gl(n,i(t,3),!0,!0):[]}function drt(n,t){return n&&n.length?gl(n,i(t,3),!0):[]}function grt(n,t,i,r){var u=n?n.length:0;return u?(i&&typeof i!="number"&&ku(n,t,i)&&(i=0,r=u),dtt(n,t,i,r)):[]}function pb(n,t,r){var f=n?n.length:0,u;return f?(u=r==null?0:bi(r),u<0&&(u=ru(f+u,0)),pf(n,i(t,3),u)):-1}function wb(n,t,r){var e=n?n.length:0,f;return e?(f=e-1,r!==u&&(f=bi(r),f=r<0?ru(e+f,0):yu(f,e-1)),pf(n,i(t,3),f,!0)):-1}function nut(n){var t=n?n.length:0;return t?ar(n,1):[]}function tut(n){var t=n?n.length:0;return t?ar(n,ft):[]}function iut(n,t){var i=n?n.length:0;return i?(t=t===u?1:bi(t),ar(n,t)):[]}function rut(n){for(var i=-1,u=n?n.length:0,r={},t;++i<u;)t=n[i],r[t[0]]=t[1];return r}function bb(n){return n&&n.length?n[0]:u}function uut(n,t,i){var u=n?n.length:0,r;return u?(r=i==null?0:bi(i),r<0&&(r=ru(u+r,0)),vt(n,t,r)):-1}function fut(n){return yb(n,1)}function hut(n,t){return n?nn.call(n,t):""}function gu(n){var t=n?n.length:0;return t?n[t-1]:u}function cut(n,t,i){var f=n?n.length:0,r;if(!f)return-1;if(r=f,i!==u&&(r=bi(i),r=(r<0?ru(f+r,0):yu(r,f-1))+1),t!==t)return gf(n,r-1,!0);while(r--)if(n[r]===t)return r;return-1}function lut(n,t){return n&&n.length?gp(n,bi(t)):u}function db(n,t){return n&&n.length&&t&&t.length?av(n,t):n}function aut(n,t,r){return n&&n.length&&t&&t.length?av(n,t,i(r)):n}function vut(n,t,i){return n&&n.length&&t&&t.length?av(n,t,u,i):n}function yut(n,t){var u=[],f;if(!(n&&n.length))return u;var r=-1,e=[],o=n.length;for(t=i(t,3);++r<o;)f=n[r],t(f,r,n)&&(u.push(f),e.push(r));return rw(n,e),u}function oy(n){return n?fn.call(n):n}function put(n,t,i){var r=n?n.length:0;return r?(i&&typeof i!="number"&&ku(n,t,i)?(t=0,i=r):(t=t==null?0:bi(t),i=i===u?r:bi(i)),af(n,t,i)):[]}function wut(n,t){return dl(n,t)}function but(n,t,r){return wv(n,t,i(r))}function kut(n,t){var r=n?n.length:0,i;return r&&(i=dl(n,t),i<r&&is(n[i],t))?i:-1}function dut(n,t){return dl(n,t,!0)}function gut(n,t,r){return wv(n,t,i(r),!0)}function nft(n,t){var r=n?n.length:0,i;return r&&(i=dl(n,t,!0)-1,is(n[i],t))?i:-1}function tft(n){return n&&n.length?uw(n):[]}function ift(n,t){return n&&n.length?uw(n,i(t)):[]}function rft(n){return vb(n,1)}function uft(n,t,i){return(n&&n.length)?(t=i||t===u?1:bi(t),af(n,0,t<0?0:t)):[]}function fft(n,t,i){var r=n?n.length:0;return r?(t=i||t===u?1:bi(t),t=r-t,af(n,t<0?0:t,r)):[]}function eft(n,t){return n&&n.length?gl(n,i(t,3),!1,!0):[]}function oft(n,t){return n&&n.length?gl(n,i(t,3)):[]}function lft(n){return n&&n.length?bs(n):[]}function aft(n,t){return n&&n.length?bs(n,i(t)):[]}function vft(n,t){return n&&n.length?bs(n,u,t):[]}function sy(n){if(!(n&&n.length))return[];var t=0;return n=et(n,function(n){if(vr(n))return t=ru(n.length,t),!0}),tu(t,function(t){return o(n,lv(t))})}function nk(n,t){if(!(n&&n.length))return[];var i=sy(n);return t==null?i:o(i,function(n){return s(t,u,n)})}function dft(n,t){return sw(n||[],t||[],dh)}function gft(n,t){return sw(n||[],t||[],kl)}function ik(n){var i=t(n);return i.__chain__=!0,i}function net(n,t){return t(n),n}function sa(n,t){return t(n)}function tet(){return ik(this)}function iet(){return new uf(this.value(),this.__chain__)}function ret(){this.__values__===u&&(this.__values__=yy(this.value()));var n=this.__index__>=this.__values__.length,t=n?u:this.__values__[this.__index__++];return{done:n,value:t}}function uet(){return this}function fet(n){for(var r,i=this,t,f;i instanceof al;)t=ab(i),t.__index__=0,t.__values__=u,r?f.__wrapped__=t:r=t,f=t,i=i.__wrapped__;return f.__wrapped__=n,r}function eet(){var t=this.__wrapped__,n;return t instanceof ki?(n=t,this.__actions__.length&&(n=new ki(this)),n=n.reverse(),n.__actions__.push({func:sa,args:[oy],thisArg:u}),new uf(n,this.__chain__)):this.thru(oy)}function oet(){return ow(this.__wrapped__,this.__actions__)}function set(n,t,r){var f=lt(n)?vf:ktt;return r&&ku(n,t,r)&&(t=u),f(n,i(t,3))}function het(n,t){var r=lt(n)?et:ap;return r(n,i(t,3))}function cet(n,t){return ar(ha(n,t),1)}function aet(n,t){return ar(ha(n,t),ft)}function vet(n,t,i){return i=i===u?1:bi(i),ar(ha(n,t),i)}function ok(n,t){var r=lt(n)?c:ns;return r(n,i(t,3))}function sk(n,t){var r=lt(n)?nh:rv;return r(n,i(t,3))}function yet(n,t,i,r){n=bu(n)?n:va(n);i=i&&!r?bi(i):0;var u=n.length;return i<0&&(i=ru(u+i,0)),wh(n)?i<=u&&n.indexOf(t,i)>-1:!!u&&vt(n,t,i)>-1}function ha(n,t){var r=lt(n)?o:bp;return r(n,i(t,3))}function pet(n,t,i,r){return n==null?[]:(lt(t)||(t=t==null?[]:[t]),i=r?u:i,lt(i)||(i=i==null?[]:[i]),nw(n,t,i))}function wet(n,t,r){var u=lt(n)?at:bf,f=arguments.length<3;return u(n,i(t,4),r,f,ns)}function bet(n,t,r){var u=lt(n)?th:bf,f=arguments.length<3;return u(n,i(t,4),r,f,rv)}function ket(n,t){var r=lt(n)?et:ap;return t=i(t,3),r(n,function(n,i,r){return!t(n,i,r)})}function det(n){var t=bu(n)?n:va(n),i=t.length;return i>0?t[vv(0,i-1)]:u}function vk(n,t,i){var f=-1,r=yy(n),o=r.length,h=o-1,e,s;for(t=(i?ku(n,t,i):t===u)?1:gh(bi(t),0,o);++f<t;)e=vv(f,h),s=r[e],r[e]=r[f],r[f]=s;return r.length=t,r}function get(n){return vk(n,a)}function not(n){var t,i;return n==null?0:bu(n)?(t=n.length,t&&wh(n)?pt(n):t):br(n)&&(i=pu(n),i==v||i==y)?n.size:wr(n).length}function tot(n,t,r){var f=lt(n)?gr:oit;return r&&ku(n,t,r)&&(t=u),f(n,i(t,3))}function kc(){return vg.now()}function iot(n,t){if(typeof t!="function")throw new rf(h);return n=bi(n),function(){if(--n<1)return t.apply(this,arguments)}}function pk(n,t,i){return t=i?u:t,t=n&&t==null?n.length:t,ts(n,tt,u,u,u,u,t)}function wk(n,t){var i;if(typeof t!="function")throw new rf(h);return n=bi(n),function(){return--n>0&&(i=t.apply(this,arguments)),n<=1&&(t=u),i}}function bk(n,t,i){t=i?u:t;var r=ts(n,b,u,u,u,u,u,t);return r.placeholder=bk.placeholder,r}function kk(n,t,i){t=i?u:t;var r=ts(n,bt,u,u,u,u,u,t);return r.placeholder=kk.placeholder,r}function dk(n,t,i){function p(t){var i=e,r=s;return e=s=u,c=t,o=n.apply(r,i)}function g(n){return c=n,r=ec(v,t),b?p(n):o}function nt(n){var r=n-f,u=n-c,i=t-r;return l?yu(i,a-u):i}function k(n){var i=n-f,r=n-c;return f===u||i>=t||i<0||l&&r>=a}function v(){var n=kc();if(k(n))return d(n);r=ec(v,nt(n))}function d(n){return(r=u,y&&e)?p(n):(e=s=u,o)}function tt(){c=0;e=f=s=r=u}function it(){return r===u?o:d(kc())}function w(){var n=kc(),i=k(n);if(e=arguments,s=this,f=n,i){if(r===u)return g(f);if(l)return r=ec(v,t),p(f)}return r===u&&(r=ec(v,t)),o}var e,s,a,o,r,f,c=0,b=!1,l=!1,y=!0;if(typeof n!="function")throw new rf(h);return t=vu(t)||0,yr(i)&&(b=!!i.leading,l="maxWait"in i,a=l?ru(vu(i.maxWait)||0,t):a,y="trailing"in i?!!i.trailing:y),w.cancel=tt,w.flush=it,w}function rot(n){return ts(n,fu)}function la(n,t){if(typeof n!="function"||t&&typeof t!="function")throw new rf(h);var i=function(){var r=arguments,u=t?t.apply(this,r):r[0],f=i.cache,e;return f.has(u)?f.get(u):(e=n.apply(this,r),i.cache=f.set(u,e),e)};return i.cache=new(la.Cache||go),i}function uot(n){if(typeof n!="function")throw new rf(h);return function(){return!n.apply(this,arguments)}}function fot(n){return wk(2,n)}function r(n,t){if(typeof n!="function")throw new rf(h);return t=ru(t===u?n.length-1:bi(t),0),function(){for(var r=arguments,i=-1,e=ru(r.length-t,0),u=Array(e),f;++i<e;)u[i]=r[t+i];switch(t){case 0:return n.call(this,u);case 1:return n.call(this,r[0],u);case 2:return n.call(this,r[0],r[1],u)}for(f=Array(t+1),i=-1;++i<t;)f[i]=r[i];return f[t]=u,s(n,this,f)}}function sot(n,t){if(typeof n!="function")throw new rf(h);return t=t===u?0:ru(bi(t),0),r(function(i){var r=i[t],u=hs(i,0,t);return r&&g(u,r),s(n,this,u)})}function hot(n,t,i){var r=!0,u=!0;if(typeof n!="function")throw new rf(h);return yr(i)&&(r="leading"in i?!!i.leading:r,u="trailing"in i?!!i.trailing:u),dk(n,t,{leading:r,maxWait:t,trailing:u})}function cot(n){return pk(n,1)}function lot(n,t){return t=t==null?tf:t,cy(t,n)}function aot(){if(!arguments.length)return[];var n=arguments[0];return lt(n)?n:[n]}function vot(n){return ff(n,!1,!0)}function yot(n,t){return ff(n,!1,!0,t)}function pot(n){return ff(n,!0,!0)}function wot(n,t){return ff(n,!0,!0,t)}function is(n,t){return n===t||n!==n&&t!==t}function ph(n){return vr(n)&&pr.call(n,"callee")&&(!ba.call(n,"callee")||wu.call(n)==ht)}function bot(n){return br(n)&&wu.call(n)==ui}function bu(n){return n!=null&&dc(ub(n))&&!sf(n)}function vr(n){return br(n)&&bu(n)}function kot(n){return n===!0||n===!1||br(n)&&wu.call(n)==dt}function dot(n){return br(n)&&wu.call(n)==gt}function got(n){return!!n&&n.nodeType===1&&br(n)&&!ay(n)}function nst(n){var t,i;if(bu(n)&&(lt(n)||wh(n)||sf(n.splice)||ph(n)||aa(n)))return!n.length;if(br(n)&&(t=pu(n),t==v||t==y))return!n.size;for(i in n)if(pr.call(n,i))return!1;return!(ga&&wr(n).length)}function tst(n,t){return vc(n,t)}function ist(n,t,i){i=typeof i=="function"?i:u;var r=i?i(n,t):u;return r===u?vc(n,t,i):!!r}function ly(n){return br(n)?wu.call(n)==vi||typeof n.message=="string"&&typeof n.name=="string":!1}function rst(n){return typeof n=="number"&&gg(n)}function sf(n){var t=yr(n)?wu.call(n):"";return t==yi||t==ou}function ud(n){return typeof n=="number"&&n==bi(n)}function dc(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=it}function yr(n){var t=typeof n;return!!n&&(t=="object"||t=="function")}function br(n){return!!n&&typeof n=="object"}function ust(n){return br(n)&&pu(n)==v}function fst(n,t){return n===t||hv(n,t,ty(t))}function est(n,t,i){return i=typeof i=="function"?i:u,hv(n,t,ty(t),i)}function ost(n){return fd(n)&&n!=+n}function sst(n){if(sb(n))throw new ip("This method is not supported with `core-js`. Try https://github.com/es-shims.");return yp(n)}function hst(n){return n===null}function cst(n){return n==null}function fd(n){return typeof n=="number"||br(n)&&wu.call(n)==ni}function ay(n){var i,t;return!br(n)||wu.call(n)!=d||ei(n)?!1:(i=pc(n),i===null)?!0:(t=pr.call(i,"constructor")&&i.constructor,typeof t=="function"&&t instanceof t&&rl.call(t)==pg)}function vy(n){return yr(n)&&wu.call(n)==ti}function lst(n){return ud(n)&&n>=-it&&n<=it}function ast(n){return br(n)&&pu(n)==y}function wh(n){return typeof n=="string"||!lt(n)&&br(n)&&wu.call(n)==ii}function nf(n){return typeof n=="symbol"||br(n)&&wu.call(n)==pi}function gc(n){return br(n)&&dc(n.length)&&!!e[wu.call(n)]}function vst(n){return n===u}function yst(n){return br(n)&&pu(n)==ri}function pst(n){return br(n)&&wu.call(n)==ae}function yy(n){if(!n)return[];if(bu(n))return wh(n)?w(n):of(n);if(cs&&n[cs])return ne(n[cs]());var t=pu(n),i=t==v?oi:t==y?yt:va;return i(n)}function sd(n){if(!n)return n===0?n:0;if(n=vu(n),n===ft||n===-ft){var t=n<0?-1:1;return t*he}return n===n?n:0}function bi(n){var t=sd(n),i=t%1;return t===t?i?t-i:t:0}function hd(n){return n?gh(bi(n),0,a):0}function vu(n){var t,i;return typeof n=="number"?n:nf(n)?li:(yr(n)&&(t=sf(n.valueOf)?n.valueOf():n,n=yr(t)?t+"":t),typeof n!="string")?n===0?n:+n:(n=n.replace(lr,""),i=co.test(n),i||ao.test(n)?ys(n.slice(2),i?2:8):ho.test(n)?li:+n)}function cd(n){return vh(n,cf(n))}function wst(n){return gh(bi(n),-it,it)}function di(n){return n==null?"":ef(n)}function gst(n,t){var i=nc(n);return t?cp(i,t):i}function nht(n,t){return yf(n,i(t,3),lf)}function tht(n,t){return yf(n,i(t,3),ev)}function iht(n,t){return n==null?n:uv(n,i(t,3),cf)}function rht(n,t){return n==null?n:fv(n,i(t,3),cf)}function uht(n,t){return n&&lf(n,i(t,3))}function fht(n,t){return n&&ev(n,i(t,3))}function eht(n){return n==null?[]:pl(n,wr(n))}function oht(n){return n==null?[]:pl(n,cf(n))}function py(n,t,i){var r=n==null?u:lc(n,t);return r===u?i:r}function sht(n,t){return n!=null&&eb(n,t,wl)}function yd(n,t){return n!=null&&eb(n,t,gtt)}function wr(n){var r=bc(n),t;if(!(r||bu(n)))return rit(n);var u=ob(n),f=!!u,i=u||[],e=i.length;for(t in n)!wl(n,t)||f&&(t=="length"||wo(t,e))||r&&t=="constructor"||i.push(t);return i}function cf(n){for(var r=-1,e=bc(n),u=wp(n),o=u.length,f=ob(n),s=!!f,i=f||[],h=i.length,t;++r<o;)t=u[r],s&&(t=="length"||wo(t,h))||t=="constructor"&&(e||!pr.call(n,t))||i.push(t);return i}function aht(n,t){var r={};return t=i(t,3),lf(n,function(n,i,u){r[t(n,i,u)]=n}),r}function vht(n,t){var r={};return t=i(t,3),lf(n,function(n,i,u){r[i]=t(n,i,u)}),r}function wht(n,t){return t=i(t),iw(n,function(n,i){return!t(n,i)})}function bht(n,t){return n==null?{}:iw(n,i(t))}function kht(n,t,i){var e,f,r;for(t=bo(t,n)?[t]:ah(t),e=-1,f=t.length,f||(n=u,f=1);++e<f;)r=n==null?u:n[du(t[e])],r===u&&(e=f,r=i),n=sf(r)?r.call(n):r;return n}function dht(n,t,i){return n==null?n:kl(n,t,i)}function ght(n,t,i,r){return r=typeof r=="function"?r:u,n==null?n:kl(n,t,i,r)}function nct(n,t,r){var u=lt(n)||gc(n),f;return t=i(t,4),r==null&&(u||yr(n)?(f=n.constructor,r=u?lt(n)?new f:[]:sf(f)?nc(pc(n)):{}):r={}),(u?c:lf)(n,function(n,i,u){return t(r,n,i,u)}),r}function tct(n,t){return n==null?!0:sit(n,t)}function ict(n,t,i){return n==null?n:ew(n,t,hw(i))}function rct(n,t,i,r){return r=typeof r=="function"?r:u,n==null?n:ew(n,t,hw(i),r)}function va(n){return n?iu(n,wr(n)):[]}function uct(n){return n==null?[]:iu(n,cf(n))}function fct(n,t,i){return i===u&&(i=t,t=u),i!==u&&(i=vu(i),i=i===i?i:0),t!==u&&(t=vu(t),t=t===t?t:0),gh(vu(n),t,i)}function ect(n,t,i){return t=vu(t)||0,i===u?(i=t,t=0):i=vu(i)||0,n=vu(n),nit(n,t,i)}function oct(n,t,i){var f,r;return(i&&typeof i!="boolean"&&ku(n,t,i)&&(t=i=u),i===u&&(typeof t=="boolean"?(i=t,t=u):typeof n=="boolean"&&(i=n,n=u)),n===u&&t===u?(n=0,t=1):(n=vu(n)||0,t===u?(t=n,n=0):t=vu(t)||0),n>t&&(f=n,n=t,t=f),i||n%1||t%1)?(r=sp(),yu(n+r*(t-n+vs("1e-"+((r+"").length-1))),t)):vv(n,t)}function kd(n){return ya(di(n).toLowerCase())}function dd(n){return n=di(n),n&&n.replace(yo,eh).replace(us,"")}function sct(n,t,i){n=di(n);t=ef(t);var r=n.length;return i=i===u?r:gh(bi(i),0,r),i-=t.length,i>=0&&n.indexOf(t,i)==i}function hct(n){return n=di(n),n&&be.test(n)?n.replace(cu,oh):n}function cct(n){return n=di(n),n&&io.test(n)?n.replace(cr,"\\$&"):n}function yct(n,t,i){var r,u;return(n=di(n),t=bi(t),r=t?pt(n):0,!t||r>=t)?n:(u=(t-r)/2,ra(sl(u),i)+n+ra(ol(u),i))}function pct(n,t,i){n=di(n);t=bi(t);var r=t?pt(n):0;return t&&r<t?n+ra(t-r,i):n}function wct(n,t,i){n=di(n);t=bi(t);var r=t?pt(n):0;return t&&r<t?ra(t-r,i)+n:n}function bct(n,t,i){return i||t==null?t=0:t&&(t=+t),n=di(n).replace(lr,""),rn(n,t||(so.test(n)?16:10))}function kct(n,t,i){return t=(i?ku(n,t,i):t===u)?1:bi(t),yv(di(n),t)}function dct(){var n=arguments,t=di(n[0]);return n.length<3?t:un.call(t,n[1],n[2])}function gct(n,t,i){return(i&&typeof i!="number"&&ku(n,t,i)&&(t=i=u),i=i===u?a:i>>>0,!i)?[]:(n=di(n),n&&(typeof t=="string"||t!=null&&!vy(t))&&(t=ef(t),t==""&&fi.test(n)))?hs(w(n),0,i):en.call(n,t,i)}function nlt(n,t,i){return n=di(n),i=gh(bi(i),0,n.length),n.lastIndexOf(ef(t),i)==i}function tlt(n,i,r){var h=t.templateSettings,o,e;r&&ku(n,i,r)&&(i=u);n=di(n);i=nl({},i,h,nv);var c=nl({},i.imports,h.imports,nv),l=wr(c),p=iu(c,l),a,s,v=0,y=i.interpolate||wi,f="__p += '",w=pa((i.escape||wi).source+"|"+y.source+"|"+(y===lu?oo:wi).source+"|"+(i.evaluate||wi).source+"|$","g"),b="//# sourceURL="+("sourceURL"in i?i.sourceURL:"lodash.templateSources["+ ++ss+"]")+"\n";if(n.replace(w,function(t,i,r,u,e,o){return r||(r=u),f+=n.slice(v,o).replace(po,sh),i&&(a=!0,f+="' +\n__e("+i+") +\n'"),e&&(s=!0,f+="';\n"+e+";\n__p += '"),r&&(f+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),v=o+t.length,t}),f+="';\n",o=i.variable,o||(f="with (obj) {\n"+f+"\n}\n"),f=(s?f.replace(ve,""):f).replace(ye,"$1").replace(pe,"$1;"),f="function("+(o||"obj")+") {\n"+(o?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}",e=ky(function(){return Function(l,b+"return "+f).apply(u,p)}),e.source=f,ly(e))throw e;return e}function ilt(n){return di(n).toLowerCase()}function rlt(n){return di(n).toUpperCase()}function ult(n,t,i){if(n=di(n),n&&(i||t===u))return n.replace(lr,"");if(!n||!(t=ef(t)))return n;var r=w(n),f=w(t),e=kf(r,f),o=df(r,f)+1;return hs(r,e,o).join("")}function flt(n,t,i){if(n=di(n),n&&(i||t===u))return n.replace(uo,"");if(!n||!(t=ef(t)))return n;var r=w(n),f=df(r,w(t))+1;return hs(r,0,f).join("")}function elt(n,t,i){if(n=di(n),n&&(i||t===u))return n.replace(ro,"");if(!n||!(t=ef(t)))return n;var r=w(n),f=kf(r,w(t));return hs(r,f).join("")}function olt(n,t){var s=re,e=ue,i,h,o,r,f,a,v,c,l;if(yr(t)&&(i="separator"in t?t.separator:i,s="length"in t?bi(t.length):s,e="omission"in t?ef(t.omission):e),n=di(n),h=n.length,fi.test(n)&&(o=w(n),h=o.length),s>=h)return n;if(r=s-pt(e),r<1)return e;if(f=o?hs(o,0,r).join(""):n.slice(0,r),i===u)return f+e;if(o&&(r+=f.length-r),vy(i)){if(n.slice(r).search(i)){for(v=f,i.global||(i=pa(i.source,di(au.exec(i))+"g")),i.lastIndex=0;a=i.exec(v);)c=a.index;f=f.slice(0,c===u?r:c)}}else n.indexOf(ef(i),r)!=r&&(l=f.lastIndexOf(i),l>-1&&(f=f.slice(0,l)));return f+e}function slt(n){return n=di(n),n&&we.test(n)?n.replace(hu,lh):n}function ig(n,t,i){return n=di(n),t=i?u:t,t===u&&(t=es.test(n)?fs:fo),n.match(t)||[]}function hlt(n){var t=n?n.length:0,u=i();return n=t?o(n,function(n){if(typeof n[1]!="function")throw new rf(h);return[u(n[0]),n[1]]}):[],r(function(i){for(var u=-1,r;++u<t;)if(r=n[u],s(r[0],this,i))return s(r[1],this,i)})}function clt(n){return btt(ff(n,!0))}function ug(n){return function(){return n}}function tf(n){return n}function dy(n){return pp(typeof n=="function"?n:ff(n,!0))}function llt(n){return kp(ff(n,!0))}function alt(n,t){return dp(n,ff(t,!0))}function gy(n,t,i){var u=wr(t),r=pl(t,u),f,e;return i!=null||yr(t)&&(r.length||!u.length)||(i=t,t=n,n=this,r=pl(t,wr(t))),f=!(yr(i)&&"chain"in i)||!!i.chain,e=sf(n),c(r,function(i){var r=t[i];n[i]=r;e&&(n.prototype[i]=function(){var i=this.__chain__,t,u;return f||i?(t=n(this.__wrapped__),u=t.__actions__=of(this.__actions__),u.push({func:r,args:arguments,thisArg:n}),t.__chain__=i,t):r.apply(n,g([this.value()],arguments))})}),n}function vlt(){return p._===this&&(p._=wg),this}function np(){}function ylt(n){return n=bi(n),r(function(t){return gp(t,n)})}function hg(n){return bo(n)?lv(du(n)):fit(n)}function klt(n){return function(t){return n==null?u:lc(n,t)}}function ag(){return[]}function tp(){return!1}function dlt(){return{}}function glt(){return""}function nat(){return!0}function tat(n,t){var r,u,f;if(n=bi(n),n<1||n>it)return[];for(r=a,u=yu(n,a),t=i(t),n-=a,f=tu(u,t);++r<n;)t(r);return f}function iat(n){return lt(n)?o(n,du):nf(n)?[n]:of(ey(n))}function rat(n){var t=++yg;return di(n)+t}function sat(n){return n&&n.length?yl(n,tf,ov):u}function hat(n,t){return n&&n.length?yl(n,i(t),ov):u}function cat(n){return wf(n,tf)}function lat(n,t){return wf(n,i(t))}function aat(n){return n&&n.length?yl(n,tf,cv):u}function vat(n,t){return n&&n.length?yl(n,i(t),cv):u}function bat(n){return n&&n.length?nu(n,tf):0}function kat(n,t){return n&&n.length?nu(n,i(t)):0}var ns,rv,uv,fv,pv,nb,fa,ub,fb,sb,fy,ey,kb,gb,tk,rk,uk,fk,ek,hk,ck,lk,ak,yk,ca,hy,gk,nd,id,rd,lt,aa,ed,od,ad,vd,wd,wy,by,bd,gd,ng,tg,ya,ky,rg,fg,eg,og,sg,cg,lg;n=n?nt.defaults({},n,nt.pick(p,os)):p;var vg=n.Date,ip=n.Error,bh=n.Math,pa=n.RegExp,rf=n.TypeError,tl=n.Array.prototype,fc=n.Object.prototype,rp=n.String.prototype,il=n["__core-js_shared__"],up=function(){var n=/[^.]+$/.exec(il&&il.keys&&il.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),rl=n.Function.prototype.toString,pr=fc.hasOwnProperty,yg=0,pg=rl.call(Object),wu=fc.toString,wg=p._,bg=pa("^"+rl.call(pr).replace(cr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),fp=ps?n.Buffer:u,ep=n.Reflect,ul=n.Symbol,fl=n.Uint8Array,op=ep?ep.enumerate:u,wa=Object.getOwnPropertySymbols,cs=typeof(cs=ul&&ul.iterator)=="symbol"?cs:u,kg=Object.create,ba=fc.propertyIsEnumerable,el=tl.splice,ec=function(t,i){return n.setTimeout.call(p,t,i)},ol=bh.ceil,sl=bh.floor,dg=Object.getPrototypeOf,gg=n.isFinite,nn=tl.join,tn=Object.keys,ru=bh.max,yu=bh.min,rn=n.parseInt,sp=bh.random,un=rp.replace,fn=tl.reverse,en=rp.split,ka=uc(n,"DataView"),hl=uc(n,"Map"),da=uc(n,"Promise"),kh=uc(n,"Set"),oc=uc(n,"WeakMap"),sc=uc(Object,"create"),cl=oc&&new oc,ga=!ba.call({valueOf:1},"valueOf"),hc={},on=yh(ka),sn=yh(hl),hn=yh(da),cn=yh(kh),ln=yh(oc),ll=ul?ul.prototype:u,cc=ll?ll.valueOf:u,hp=ll?ll.toString:u;t.templateSettings={escape:ke,evaluate:de,interpolate:lu,variable:"",imports:{_:t}};t.prototype=al.prototype;t.prototype.constructor=t;uf.prototype=nc(al.prototype);uf.prototype.constructor=uf;ki.prototype=nc(al.prototype);ki.prototype.constructor=ki;ls.prototype.clear=pn;ls.prototype["delete"]=wn;ls.prototype.get=bn;ls.prototype.has=kn;ls.prototype.set=dn;ko.prototype.clear=gn;ko.prototype["delete"]=ntt;ko.prototype.get=ttt;ko.prototype.has=itt;ko.prototype.set=rtt;go.prototype.clear=utt;go.prototype["delete"]=ftt;go.prototype.get=ett;go.prototype.has=ott;go.prototype.set=stt;as.prototype.add=as.prototype.push=htt;as.prototype.has=ctt;hf.prototype.clear=ltt;hf.prototype["delete"]=att;hf.prototype.get=vtt;hf.prototype.has=ytt;hf.prototype.set=ptt;ns=vw(lf);rv=vw(ev,!0);uv=yw();fv=yw(!0);op&&!ba.call({valueOf:1},"valueOf")&&(wp=function(n){return ne(op(n))});pv=cl?function(n,t){return cl.set(n,t),n}:tf;nb=(kh&&1/yt(new kh([,-0]))[1]==ft)?function(n){return new kh(n)}:np;fa=cl?function(n){return cl.get(n)}:np;ub=lv("length");wa||(wc=ag);fb=wa?function(n){for(var t=[];n;)g(t,wc(n)),n=pc(n);return t}:wc;(ka&&pu(new ka(new ArrayBuffer(1)))!=ct||hl&&pu(new hl)!=v||da&&pu(da.resolve())!=su||kh&&pu(new kh)!=y||oc&&pu(new oc)!=ri)&&(pu=function(n){var t=wu.call(n),i=t==d?n.constructor:u,r=i?yh(i):u;if(r)switch(r){case on:return ct;case sn:return v;case hn:return su;case cn:return y;case ln:return ri}return t});sb=il?sf:tp;fy=function(){var n=0,t=0;return function(i,r){var u=kc(),f=ee-(u-t);if(t=u,f>0){if(++n>=fe)return i}else n=0;return pv(i,r)}}();ey=la(function(n){var t=[];return di(n).replace(to,function(n,i,r,u){t.push(r?u.replace(eo,"$1"):i||n)}),t});var prt=r(function(n,t){return vr(n)?ws(n,ar(t,1,vr,!0)):[]}),wrt=r(function(n,t){var r=gu(t);return vr(r)&&(r=u),vr(n)?ws(n,ar(t,1,vr,!0),i(r)):[]}),brt=r(function(n,t){var i=gu(t);return vr(i)&&(i=u),vr(n)?ws(n,ar(t,1,vr,!0),u,i):[]});var eut=r(function(n){var t=o(n,kv);return t.length&&t[0]===n[0]?sv(t):[]}),out=r(function(n){var r=gu(n),t=o(n,kv);return r===gu(t)?r=u:t.pop(),t.length&&t[0]===n[0]?sv(t,i(r)):[]}),sut=r(function(n){var i=gu(n),t=o(n,kv);return i===gu(t)?i=u:t.pop(),t.length&&t[0]===n[0]?sv(t,u,i):[]});kb=r(db);gb=r(function(n,t){t=ar(t,1);var i=n?n.length:0,r=iv(n,t);return rw(n,o(t,function(n){return wo(n,i)?+n:n}).sort(cw)),r});var sft=r(function(n){return bs(ar(n,1,vr,!0))}),hft=r(function(n){var t=gu(n);return vr(t)&&(t=u),bs(ar(n,1,vr,!0),i(t))}),cft=r(function(n){var t=gu(n);return vr(t)&&(t=u),bs(ar(n,1,vr,!0),u,t)});var yft=r(function(n,t){return vr(n)?ws(n,t):[]}),pft=r(function(n){return bv(et(n,vr))}),wft=r(function(n){var t=gu(n);return vr(t)&&(t=u),bv(et(n,vr),i(t))}),bft=r(function(n){var t=gu(n);return vr(t)&&(t=u),bv(et(n,vr),u,t)}),kft=r(sy);tk=r(function(n){var i=n.length,t=i>1?n[i-1]:u;return t=typeof t=="function"?(n.pop(),t):u,nk(n,t)});rk=r(function(n){n=ar(n,1);var i=n.length,r=i?n[0]:0,t=this.__wrapped__,f=function(t){return iv(t,n)};return i>1||this.__actions__.length||!(t instanceof ki)||!wo(r)?this.thru(f):(t=t.slice(r,+r+(i?1:0)),t.__actions__.push({func:sa,args:[f],thisArg:u}),new uf(t,this.__chain__).thru(function(n){return i&&!n.length&&n.push(u),n}))});uk=na(function(n,t,i){pr.call(n,i)?++n[i]:n[i]=1});fk=ww(pb);ek=ww(wb);hk=na(function(n,t,i){pr.call(n,i)?n[i].push(t):n[i]=[t]});ck=r(function(n,t,i){var f=-1,e=typeof t=="function",o=bo(t),r=bu(n)?Array(n.length):[];return ns(n,function(n){var h=e?t:o&&n!=null?n[t]:u;r[++f]=h?s(h,n,i):ac(n,t,i)}),r});lk=na(function(n,t,i){n[i]=t});ak=na(function(n,t,i){n[i?0:1].push(t)},function(){return[[],[]]});yk=r(function(n,t){if(n==null)return[];var i=t.length;return i>1&&ku(n,t[0],t[1])?t=[]:i>2&&ku(t[0],t[1],t[2])&&(t=[t[0]]),t=t.length==1&&lt(t[0])?t[0]:ar(t,1,iy),nw(n,t,[])});ca=r(function(n,t,i){var r=l,u;return i.length&&(u=ut(i,rc(ca)),r|=k),ts(n,r,t,i,u)});hy=r(function(n,t,i){var r=l|ot,u;return i.length&&(u=ut(i,rc(hy)),r|=k),ts(t,r,n,i,u)});gk=r(function(n,t){return lp(n,1,t)});nd=r(function(n,t,i){return lp(n,vu(t)||0,i)});la.Cache=go;var eot=r(function(n,t){t=t.length==1&&lt(t[0])?o(t[0],rt(i())):o(ar(t,1,iy),rt(i()));var u=t.length;return r(function(i){for(var r=-1,f=yu(i.length,u);++r<f;)i[r]=t[r].call(this,i[r]);return s(n,this,i)})}),cy=r(function(n,t){var i=ut(t,rc(cy));return ts(n,k,u,t,i)}),td=r(function(n,t){var i=ut(t,rc(td));return ts(n,kt,u,t,i)}),oot=r(function(n,t){return ts(n,hi,u,u,u,ar(t,1))});id=ua(ov);rd=ua(function(n,t){return n>=t});lt=Array.isArray;aa=fp?function(n){return n instanceof fp}:tp;ed=ua(cv);od=ua(function(n,t){return n<=t});var bst=tc(function(n,t){if(ga||bc(t)||bu(t)){vh(t,wr(t),n);return}for(var i in t)pr.call(t,i)&&dh(n,i,t[i])}),ld=tc(function(n,t){if(ga||bc(t)||bu(t)){vh(t,cf(t),n);return}for(var i in t)dh(n,i,t[i])}),nl=tc(function(n,t,i,r){vh(t,cf(t),n,r)}),kst=tc(function(n,t,i,r){vh(t,wr(t),n,r)}),dst=r(function(n,t){return iv(n,ar(t,1))});ad=r(function(n){return n.push(u,nv),s(nl,u,n)});vd=r(function(n){return n.push(u,lb),s(pd,u,n)});var hht=kw(function(n,t,i){n[t]=i},ug(tf)),cht=kw(function(n,t,i){pr.call(n,t)?n[t].push(i):n[t]=[i]},i),lht=r(ac);var yht=tc(function(n,t,i){bl(n,t,i)}),pd=tc(function(n,t,i,r){bl(n,t,i,r)}),pht=r(function(n,t){return n==null?{}:(t=o(ar(t,1),du),tw(n,ws(rb(n),t)))});wd=r(function(n,t){return n==null?{}:tw(n,o(ar(t,1),du))});wy=tb(wr);by=tb(cf);bd=ic(function(n,t,i){return t=t.toLowerCase(),n+(i?kd(t):t)});var lct=ic(function(n,t,i){return n+(i?"-":"")+t.toLowerCase()}),act=ic(function(n,t,i){return n+(i?" ":"")+t.toLowerCase()}),vct=pw("toLowerCase");gd=ic(function(n,t,i){return n+(i?"_":"")+t.toLowerCase()});ng=ic(function(n,t,i){return n+(i?" ":"")+ya(t)});tg=ic(function(n,t,i){return n+(i?" ":"")+t.toUpperCase()});ya=pw("toUpperCase");ky=r(function(n,t){try{return s(n,u,t)}catch(i){return ly(i)?i:new ip(i)}});rg=r(function(n,t){return c(ar(t,1),function(t){t=du(t);n[t]=ca(n[t],n)}),n});fg=bw();eg=bw(!0);og=r(function(n,t){return function(i){return ac(i,n,t)}});sg=r(function(n,t){return function(i){return ac(n,i,t)}});var plt=gv(o),wlt=gv(vf),blt=gv(gr);cg=dw();lg=dw(!0);var uat=ia(function(n,t){return n+t}),fat=ny("ceil"),eat=ia(function(n,t){return n/t}),oat=ny("floor");var yat=ia(function(n,t){return n*t}),pat=ny("round"),wat=ia(function(n,t){return n-t});return t.after=iot,t.ary=pk,t.assign=bst,t.assignIn=ld,t.assignInWith=nl,t.assignWith=kst,t.at=dst,t.before=wk,t.bind=ca,t.bindAll=rg,t.bindKey=hy,t.castArray=aot,t.chain=ik,t.chunk=art,t.compact=vrt,t.concat=yrt,t.cond=hlt,t.conforms=clt,t.constant=ug,t.countBy=uk,t.create=gst,t.curry=bk,t.curryRight=kk,t.debounce=dk,t.defaults=ad,t.defaultsDeep=vd,t.defer=gk,t.delay=nd,t.difference=prt,t.differenceBy=wrt,t.differenceWith=brt,t.drop=vb,t.dropRight=yb,t.dropRightWhile=krt,t.dropWhile=drt,t.fill=grt,t.filter=het,t.flatMap=cet,t.flatMapDeep=aet,t.flatMapDepth=vet,t.flatten=nut,t.flattenDeep=tut,t.flattenDepth=iut,t.flip=rot,t.flow=fg,t.flowRight=eg,t.fromPairs=rut,t.functions=eht,t.functionsIn=oht,t.groupBy=hk,t.initial=fut,t.intersection=eut,t.intersectionBy=out,t.intersectionWith=sut,t.invert=hht,t.invertBy=cht,t.invokeMap=ck,t.iteratee=dy,t.keyBy=lk,t.keys=wr,t.keysIn=cf,t.map=ha,t.mapKeys=aht,t.mapValues=vht,t.matches=llt,t.matchesProperty=alt,t.memoize=la,t.merge=yht,t.mergeWith=pd,t.method=og,t.methodOf=sg,t.mixin=gy,t.negate=uot,t.nthArg=ylt,t.omit=pht,t.omitBy=wht,t.once=fot,t.orderBy=pet,t.over=plt,t.overArgs=eot,t.overEvery=wlt,t.overSome=blt,t.partial=cy,t.partialRight=td,t.partition=ak,t.pick=wd,t.pickBy=bht,t.property=hg,t.propertyOf=klt,t.pull=kb,t.pullAll=db,t.pullAllBy=aut,t.pullAllWith=vut,t.pullAt=gb,t.range=cg,t.rangeRight=lg,t.rearg=oot,t.reject=ket,t.remove=yut,t.rest=r,t.reverse=oy,t.sampleSize=vk,t.set=dht,t.setWith=ght,t.shuffle=get,t.slice=put,t.sortBy=yk,t.sortedUniq=tft,t.sortedUniqBy=ift,t.split=gct,t.spread=sot,t.tail=rft,t.take=uft,t.takeRight=fft,t.takeRightWhile=eft,t.takeWhile=oft,t.tap=net,t.throttle=hot,t.thru=sa,t.toArray=yy,t.toPairs=wy,t.toPairsIn=by,t.toPath=iat,t.toPlainObject=cd,t.transform=nct,t.unary=cot,t.union=sft,t.unionBy=hft,t.unionWith=cft,t.uniq=lft,t.uniqBy=aft,t.uniqWith=vft,t.unset=tct,t.unzip=sy,t.unzipWith=nk,t.update=ict,t.updateWith=rct,t.values=va,t.valuesIn=uct,t.without=yft,t.words=ig,t.wrap=lot,t.xor=pft,t.xorBy=wft,t.xorWith=bft,t.zip=kft,t.zipObject=dft,t.zipObjectDeep=gft,t.zipWith=tk,t.entries=wy,t.entriesIn=by,t.extend=ld,t.extendWith=nl,gy(t,t),t.add=uat,t.attempt=ky,t.camelCase=bd,t.capitalize=kd,t.ceil=fat,t.clamp=fct,t.clone=vot,t.cloneDeep=pot,t.cloneDeepWith=wot,t.cloneWith=yot,t.deburr=dd,t.divide=eat,t.endsWith=sct,t.eq=is,t.escape=hct,t.escapeRegExp=cct,t.every=set,t.find=fk,t.findIndex=pb,t.findKey=nht,t.findLast=ek,t.findLastIndex=wb,t.findLastKey=tht,t.floor=oat,t.forEach=ok,t.forEachRight=sk,t.forIn=iht,t.forInRight=rht,t.forOwn=uht,t.forOwnRight=fht,t.get=py,t.gt=id,t.gte=rd,t.has=sht,t.hasIn=yd,t.head=bb,t.identity=tf,t.includes=yet,t.indexOf=uut,t.inRange=ect,t.invoke=lht,t.isArguments=ph,t.isArray=lt,t.isArrayBuffer=bot,t.isArrayLike=bu,t.isArrayLikeObject=vr,t.isBoolean=kot,t.isBuffer=aa,t.isDate=dot,t.isElement=got,t.isEmpty=nst,t.isEqual=tst,t.isEqualWith=ist,t.isError=ly,t.isFinite=rst,t.isFunction=sf,t.isInteger=ud,t.isLength=dc,t.isMap=ust,t.isMatch=fst,t.isMatchWith=est,t.isNaN=ost,t.isNative=sst,t.isNil=cst,t.isNull=hst,t.isNumber=fd,t.isObject=yr,t.isObjectLike=br,t.isPlainObject=ay,t.isRegExp=vy,t.isSafeInteger=lst,t.isSet=ast,t.isString=wh,t.isSymbol=nf,t.isTypedArray=gc,t.isUndefined=vst,t.isWeakMap=yst,t.isWeakSet=pst,t.join=hut,t.kebabCase=lct,t.last=gu,t.lastIndexOf=cut,t.lowerCase=act,t.lowerFirst=vct,t.lt=ed,t.lte=od,t.max=sat,t.maxBy=hat,t.mean=cat,t.meanBy=lat,t.min=aat,t.minBy=vat,t.stubArray=ag,t.stubFalse=tp,t.stubObject=dlt,t.stubString=glt,t.stubTrue=nat,t.multiply=yat,t.nth=lut,t.noConflict=vlt,t.noop=np,t.now=kc,t.pad=yct,t.padEnd=pct,t.padStart=wct,t.parseInt=bct,t.random=oct,t.reduce=wet,t.reduceRight=bet,t.repeat=kct,t.replace=dct,t.result=kht,t.round=pat,t.runInContext=te,t.sample=det,t.size=not,t.snakeCase=gd,t.some=tot,t.sortedIndex=wut,t.sortedIndexBy=but,t.sortedIndexOf=kut,t.sortedLastIndex=dut,t.sortedLastIndexBy=gut,t.sortedLastIndexOf=nft,t.startCase=ng,t.startsWith=nlt,t.subtract=wat,t.sum=bat,t.sumBy=kat,t.template=tlt,t.times=tat,t.toFinite=sd,t.toInteger=bi,t.toLength=hd,t.toLower=ilt,t.toNumber=vu,t.toSafeInteger=wst,t.toString=di,t.toUpper=rlt,t.trim=ult,t.trimEnd=flt,t.trimStart=elt,t.truncate=olt,t.unescape=slt,t.uniqueId=rat,t.upperCase=tg,t.upperFirst=ya,t.each=ok,t.eachRight=sk,t.first=bb,gy(t,function(){var n={};return lf(t,function(i,r){pr.call(t.prototype,r)||(n[r]=i)}),n}(),{chain:!1}),t.VERSION=ie,c(["bind","bindKey","curry","curryRight","partial","partialRight"],function(n){t[n].placeholder=t}),c(["drop","take"],function(n,t){ki.prototype[n]=function(i){var f=this.__filtered__,r;return f&&!t?new ki(this):(i=i===u?1:ru(bi(i),0),r=this.clone(),f?r.__takeCount__=yu(i,r.__takeCount__):r.__views__.push({size:yu(i,a),type:n+(r.__dir__<0?"Right":"")}),r)};ki.prototype[n+"Right"]=function(t){return this.reverse()[n](t).reverse()}}),c(["filter","map","takeWhile"],function(n,t){var r=t+1,u=r==eu||r==se;ki.prototype[n]=function(n){var t=this.clone();return t.__iteratees__.push({iteratee:i(n,3),type:r}),t.__filtered__=t.__filtered__||u,t}}),c(["head","last"],function(n,t){var i="take"+(t?"Right":"");ki.prototype[n]=function(){return this[i](1).value()[0]}}),c(["initial","tail"],function(n,t){var i="drop"+(t?"":"Right");ki.prototype[n]=function(){return this.__filtered__?new ki(this):this[i](1)}}),ki.prototype.compact=function(){return this.filter(tf)},ki.prototype.find=function(n){return this.filter(n).head()},ki.prototype.findLast=function(n){return this.reverse().find(n)},ki.prototype.invokeMap=r(function(n,t){return typeof n=="function"?new ki(this):this.map(function(i){return ac(i,n,t)})}),ki.prototype.reject=function(n){return n=i(n,3),this.filter(function(t){return!n(t)})},ki.prototype.slice=function(n,t){n=bi(n);var i=this;return i.__filtered__&&(n>0||t<0)?new ki(i):(n<0?i=i.takeRight(-n):n&&(i=i.drop(n)),t!==u&&(t=bi(t),i=t<0?i.dropRight(-t):i.take(t-n)),i)},ki.prototype.takeRightWhile=function(n){return this.reverse().takeWhile(n).reverse()},ki.prototype.toArray=function(){return this.take(a)},lf(ki.prototype,function(n,i){var o=/^(?:filter|find|map|reject)|While$/.test(i),r=/^(?:head|last)$/.test(i),f=t[r?"take"+(i=="last"?"Right":""):i],e=r||/^find/.test(i);f&&(t.prototype[i]=function(){var s=this.__wrapped__,h=r?[1]:arguments,c=s instanceof ki,v=h[0],l=c||lt(s),y=function(n){var i=f.apply(t,g([n],h));return r&&a?i[0]:i},i;l&&o&&typeof v=="function"&&v.length!=1&&(c=l=!1);var a=this.__chain__,b=!!this.__actions__.length,p=e&&!a,w=c&&!b;return!e&&l?(s=w?s:new ki(this),i=n.apply(s,h),i.__actions__.push({func:sa,args:[y],thisArg:u}),new uf(i,a)):p&&w?n.apply(this,h):(i=this.thru(y),p?r?i.value()[0]:i.value():i)})}),c(["pop","push","shift","sort","splice","unshift"],function(n){var i=tl[n],r=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",u=/^(?:pop|shift)$/.test(n);t.prototype[n]=function(){var t=arguments,n;return u&&!this.__chain__?(n=this.value(),i.apply(lt(n)?n:[],t)):this[r](function(n){return i.apply(lt(n)?n:[],t)})}}),lf(ki.prototype,function(n,i){var r=t[i],u,f;r&&(u=r.name+"",f=hc[u]||(hc[u]=[]),f.push({name:i,func:r}))}),hc[ta(u,ot).name]=[{name:"wrapper",func:u}],ki.prototype.clone=an,ki.prototype.reverse=vn,ki.prototype.value=yn,t.prototype.at=rk,t.prototype.chain=tet,t.prototype.commit=iet,t.prototype.next=ret,t.prototype.plant=fet,t.prototype.reverse=eet,t.prototype.toJSON=t.prototype.valueOf=t.prototype.value=oet,cs&&(t.prototype[cs]=uet),t}var u,ie="4.13.1",wt=200,h="Expected a function",nr="__lodash_hash_undefined__",si="__lodash_placeholder__",l=1,ot=2,uu=4,b=8,bt=16,k=32,kt=64,tt=128,hi=256,fu=512,ci=1,st=2,re=30,ue="...",fe=150,ee=16,eu=1,oe=2,se=3,ft=1/0,it=9007199254740991,he=17976931348623157e292,li=NaN,a=4294967295,ce=a-1,le=a>>>1,ht="[object Arguments]",ai="[object Array]",dt="[object Boolean]",gt="[object Date]",vi="[object Error]",yi="[object Function]",ou="[object GeneratorFunction]",v="[object Map]",ni="[object Number]",d="[object Object]",su="[object Promise]",ti="[object RegExp]",y="[object Set]",ii="[object String]",pi="[object Symbol]",ri="[object WeakMap]",ae="[object WeakSet]",ui="[object ArrayBuffer]",ct="[object DataView]",tr="[object Float32Array]",ir="[object Float64Array]",rr="[object Int8Array]",ur="[object Int16Array]",fr="[object Int32Array]",er="[object Uint8Array]",or="[object Uint8ClampedArray]",sr="[object Uint16Array]",hr="[object Uint32Array]",ve=/\b__p \+= '';/g,ye=/\b(__p \+=) '' \+/g,pe=/(__e\(.*?\)|\b__t\)) \+\n'';/g,hu=/&(?:amp|lt|gt|quot|#39|#96);/g,cu=/[&<>"'`]/g,we=RegExp(hu.source),be=RegExp(cu.source),ke=/<%-([\s\S]+?)%>/g,de=/<%([\s\S]+?)%>/g,lu=/<%=([\s\S]+?)%>/g,ge=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,no=/^\w*$/,to=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(\.|\[\])(?:\4|$))/g,cr=/[\\^$.*+?()[\]{}|]/g,io=RegExp(cr.source),lr=/^\s+|\s+$/g,ro=/^\s+/,uo=/\s+$/,fo=/[a-zA-Z0-9]+/g,eo=/\\(\\)?/g,oo=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,au=/\w*$/,so=/^0x/i,ho=/^[-+]0x[0-9a-f]+$/i,co=/^0b[01]+$/i,lo=/^\[object .+?Constructor\]$/,ao=/^0o[0-7]+$/i,vo=/^(?:0|[1-9]\d*)$/,yo=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,wi=/($^)/,po=/['\n\r\u2028\u2029\\]/g,bi="\\ud800-\\udfff",vu="\\u0300-\\u036f\\ufe20-\\ufe23",yu="\\u20d0-\\u20f0",pu="\\u2700-\\u27bf",wu="a-z\\xdf-\\xf6\\xf8-\\xff",bu="A-Z\\xc0-\\xd6\\xd8-\\xde",ku="\\ufe0e\\ufe0f",du="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ar="['’]",wo="["+bi+"]",gu="["+du+"]",ki="["+vu+yu+"]",nf="\\d+",bo="["+pu+"]",tf="["+wu+"]",rf="[^"+bi+du+nf+pu+wu+bu+"]",vr="\\ud83c[\\udffb-\\udfff]",ko="(?:"+ki+"|"+vr+")",uf="[^"+bi+"]",yr="(?:\\ud83c[\\udde6-\\uddff]){2}",pr="[\\ud800-\\udbff][\\udc00-\\udfff]",lt="["+bu+"]",ff="\\u200d",ef="(?:"+tf+"|"+rf+")",go="(?:"+lt+"|"+rf+")",of="(?:"+ar+"(?:d|ll|m|re|s|t|ve))?",sf="(?:"+ar+"(?:D|LL|M|RE|S|T|VE))?",hf=ko+"?",cf="["+ku+"]?",ns="(?:"+ff+"(?:"+[uf,yr,pr].join("|")+")"+cf+hf+")*",lf=cf+hf+ns,ts="(?:"+[bo,yr,pr].join("|")+")"+lf,is="(?:"+[uf+ki+"?",ki,yr,pr,wo].join("|")+")",rs=RegExp(ar,"g"),us=RegExp(ki,"g"),wr=RegExp(vr+"(?="+vr+")|"+is+lf,"g"),fs=RegExp([lt+"?"+tf+"+"+of+"(?="+[gu,lt,"$"].join("|")+")",go+"+"+sf+"(?="+[gu,lt+ef,"$"].join("|")+")",lt+"?"+ef+"+"+of,lt+"+"+sf,nf,ts].join("|"),"g"),fi=RegExp("["+ff+bi+vu+yu+ku+"]"),es=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,os=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","Reflect","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","isFinite","parseInt","setTimeout"],ss=-1,e={},f,nt;e[tr]=e[ir]=e[rr]=e[ur]=e[fr]=e[er]=e[or]=e[sr]=e[hr]=!0;e[ht]=e[ai]=e[ui]=e[dt]=e[ct]=e[gt]=e[vi]=e[yi]=e[v]=e[ni]=e[d]=e[ti]=e[y]=e[ii]=e[ri]=!1;f={};f[ht]=f[ai]=f[ui]=f[ct]=f[dt]=f[gt]=f[tr]=f[ir]=f[rr]=f[ur]=f[fr]=f[v]=f[ni]=f[d]=f[ti]=f[y]=f[ii]=f[pi]=f[er]=f[or]=f[sr]=f[hr]=!0;f[vi]=f[yi]=f[ri]=!1;var hs={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},cs={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},ls={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},as={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},vs=parseFloat,ys=parseInt,br=typeof r=="object"&&r,di=br&&typeof i=="object"&&i,ps=di&&di.exports===br,ws=ru(typeof t=="object"&&t),af=ru(typeof self=="object"&&self),bs=ru(typeof this=="object"&&this),p=ws||af||bs||Function("return this")();nt=te();(af||{})._=nt;typeof n=="function"&&typeof n.amd=="object"&&n.amd?n(function(){return nt}):di?((di.exports=nt)._=nt,br._=nt):p._=nt}).call(this)}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}]},{},[1])(1)}),function(n){n.Constants=BABYLON.Constants;n.Color3=BABYLON.Color3;n.Color4=BABYLON.Color4;n.Vector2=BABYLON.Vector2;n.Vector3=BABYLON.Vector3;n.Vector4=BABYLON.Vector4;n.Matrix=BABYLON.Matrix;n.Quaternion=BABYLON.Quaternion;n.Viewport=BABYLON.Viewport;n.Plane=BABYLON.Plane;n.Size=BABYLON.Size;n.Frustum=BABYLON.Frustum;n.Observable=BABYLON.Observable;n.Observer=BABYLON.Observer;n.IntersectionInfo=BABYLON.IntersectionInfo;n.BoundingBox=BABYLON.BoundingBox;n.BoundingInfo=BABYLON.BoundingInfo;n.BoundingSphere=BABYLON.BoundingSphere;n.Ray=BABYLON.Ray}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){function i(n,t){return n>t?1:n<t?-1:0}var e,t,o,s,h,c,r,u,f,l,a,v,y,p,w,b;n.g_compareTo=i;e=function(){function n(){n.BIg++;this.BJv=n.BIg.toString()}return n.prototype.hashKey=function(){return this.BJv},n.prototype.equals=function(n){return this===n},n.GenericEquals=function(n,t){return typeof n=="object"?n.equals(t):n===t},n.GenericToString=function(n){return n?(typeof n=="object",n.toString()):""},n.NumberCompareTo=function(n,t){return i(n,t)},n.StringCompareTo=function(n,t){return i(n,t)},n.GenericHashKey=function(n){return!n||!n.hashKey?n:n.hashKey()},n.BIg=0,n}();n.TObject=e;t=function(){function n(n){n===void 0&&(n="");this.message=n}return n.prototype.toString=function(){return"Exception: "+this.message},n}();n.Exception=t;o=function(n){function t(t){return t===void 0&&(t="Not implemented"),n.call(this,t)||this}return __extends(t,n),t}(t);n.NotImplementedException=o;s=function(){function n(){}return n.IndexOfAny=function(n,t){for(var u,r,i=0;i<n.length;++i)for(u=n.charCodeAt(i),r=0;r<t.length;++r)if(u==t[r])return i;return-1},n.Replace=function(n,t,i){var r=t.constructor===Number?String.fromCharCode(t):t,f=i.constructor===Number?String.fromCharCode(i):i,u=-1;do{if(n=n.replace(r,f),!n)return"";u=n.indexOf(r)}while(u>=0);return n},n.Substring=function(n,t,i){return i===void 0&&(i=-1),i<0?n.substring(t):n.substring(t,t+i)},n.Remove=function(n,t,i){return typeof i===undefined?n.substring(t):n.substring(0,t-1)+n.substring(t+i)},n.Trim=function(n){return n?n.replace(/(^\s+)|(\s+$)/g,""):n},n.Contains=function(n,t){return n?n.indexOf(t)>=0:!1},n.BKK=function(n,t){var r,i;if(n.length<t)for(r=t-n.length,i=0;i<r;i++)n="0"+n;return n},n.FormatNumber=function(t,i,r){if(r===void 0&&(r=0),r===0)return n.BKK(t.toFixed(0),i);var f=Math.floor(t),e=(t-f).toFixed(r),u=f.toString();return u.length<i&&(u=n.BKK(u,i)),u+e.substring(1,e.length)},n.Join=function(n,t){return n+this.Concat(t)},n.Concat=function(n){var t,i;if(n===undefined||!n)return"";for(t="",i=0;i<n.length;i++)t=t+n[i];return t},n.Split=function(n,t,i){var r;return(typeof t=="string"?r=this.BFK(n,t,i):t.length!==undefined&&(r=t.length===1?n.split(String.fromCharCode(t[0]),i):this.SplitByChars(n,t,i)),r===undefined)?null:r},n.BFK=function(n,t,i){return n.split(t,i)},n.SplitByChars=function(n,t,i){var r=[],f,u,h,e,c,o,s;for(r.push(n),f=0;f<t.length;f++){for(u=[],h=String.fromCharCode(t[f]),e=0;e<r.length;e++)c=r[e].split(h),u=u.concat(c);for(r=[],o=0;o<u.length;o++)s=u[o],!s||r.push(s);if(arguments.length==3&&r.length>i)break}return r.length<1&&r.push(n),r},n.FromChars=function(n){for(var i="",t=0;t<n.length;t++)i+=String.fromCharCode(n[t]);return i},n.ToCharArray=function(n){for(var i=[],t=0;t<n.length;t++)i[t]=n.charCodeAt(t);return i},n.GetCharCountChineseAsTwo=function(n){for(var i=0,t=0;t<n.length;t++)i+=n.charCodeAt(t)>255?2:1;return i},n.Empty="",n}();n.TString=s;h=function(){function n(n){n===void 0&&(n=null);this.value=n}return Object.defineProperty(n.prototype,"hasValue",{get:function(){return!!this.value},enumerable:!1,configurable:!0}),n.prototype.getValueOrDefault=function(){return this.value?this.value:null},n}();n.NullableValue=h;c=function(){function n(n){n===void 0&&(n=null);this.value=n}return n}();n.RefValue=c;r=function(){function n(){}return Object.defineProperty(n.prototype,"position",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"length",{get:function(){return 0},enumerable:!1,configurable:!0}),n.prototype.toArray=function(){return null},n.prototype.readByte=function(){return 0},n.prototype.readBytes=function(){return null},n}();n.Stream=r;u=function(n){function t(t){var i=n.call(this)||this;return i._i=0,i._d=t,i}return __extends(t,n),Object.defineProperty(t.prototype,"position",{get:function(){return this._i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._d.length},enumerable:!1,configurable:!0}),t.prototype.toArray=function(){return this._d},t.prototype.readByte=function(){return this._i<this._d.length?this._d[this._i++]:-1},t.prototype.readBytes=function(n){var t;n=Math.min(n,this._d.length-this._i);var i=new Uint8Array(n),r=this._d,u=this._i;for(t=0;t<n;t++)i[t]=r[u++];return this._i+=n,i},t}(r);n.MemoryStream=u;f=function(){function i(n){this._l=0;this._i=0;this.baseStream=n;this._d=n.toArray();this._l=this._d.length;this.BEu=this._d.buffer&&this._d.buffer.slice!==undefined;this.BJG=new DataView(this._d.buffer)}return i.prototype.isEof=function(){return this._i>=this._l},i.prototype.readInt32=function(){var n=this.BJG.getInt32(this._i,!0);return this._i+=4,n},i.prototype.readInt16=function(){var n=this.BJG.getInt16(this._i,!0);return this._i+=2,n},i.prototype.readSingle=function(){var n=this.BJG.getFloat32(this._i,!0);return this._i+=4,n},i.prototype.readDouble=function(){var n=this.BJG.getFloat64(this._i,!0);return this._i+=8,n},i.prototype.readByte=function(){return this._d[this._i++]},i.prototype.read=function(n,i,r){var f,e,o,u;if(this._i>=this._l)throw new t("out of total length");for(r=Math.min(r,this._d.length-this._i),f=this._i,this._i+=r,e=n,o=this._d,u=0;u<r;u++)e[u+i]=o[f+u]},i.prototype.readBytes=function(n){var r,u,f,i;if(this._i>=this._l)throw new t("out of total length");if(n=Math.min(n,this._d.length-this._i),r=this._i,this._i+=n,n>32&&this.BEu)return new Uint8Array(this._d.buffer.slice(r,r+n));for(u=new Uint8Array(n),f=this._d,i=0;i<n;i++)u[i]=f[r+i];return u},i.prototype.readBytesToEnd=function(){return this.readBytes(this._l-this._i)},i.prototype.close=function(){},i.prototype.readString=function(){var i,r;if(this._i>=this._l)throw new t("out of total length");return(i=this.BJD(),i<=0)?"":(r=this.readBytes(i),n.EncodingHelper.GetUtf8String(r,r.length))},i.prototype.BJD=function(){for(var r=0,u=[],f,n,t,e,i;;)if(f=this.readByte(),u.push(f),f<127)break;for(n=u.length-1;n>=0;n--){for(t=1,e=0;e<n;e++)t*=127;i=u[n];i>127&&(i-=127);t*=i;r=r+t}return r},i}();n.BinaryReader=f;l=function(n){function t(t){return n.call(this,new u(t))||this}return __extends(t,n),t.prototype.readFloats=function(n){var t=this.readBytes(n*4);return new Float32Array(t.buffer)},t.prototype.readInt32s=function(n){var t=this.readBytes(n*4);return new Int32Array(t.buffer)},t.prototype.readInt16s=function(n){var t=this.readBytes(n*2);return new Int16Array(t.buffer)},t}(f);n.MemoryBinaryReader=l;a=function(){function n(){this.BJJ=[]}return n.prototype.append=function(n){var t=n.constructor==Number?String.fromCharCode(n):n;this.BJJ.push(t)},n.prototype.appendLine=function(n){n===void 0&&(n=null);n&&this.BJJ.push(n);this.BJJ.push("\n")},n.prototype.toString=function(){return this.BJJ.join("")},Object.defineProperty(n.prototype,"length",{get:function(){for(var t=0,n=0;n<this.BJJ.length;n++)t+=this.BJJ[n].length;return t},enumerable:!1,configurable:!0}),n.prototype.getAt=function(n){for(var t,i=0,r=0;r<this.BJJ.length;++r){if(t=this.BJJ[r],n<i+t.length)return t.charCodeAt(n-i);i+=t.length}return 0},n}();n.StringBuilder=a;v=function(){function n(){}return n.Next=function(){return(n.BJa++).toString()},n.BJa=1,n}();n.Guid=v;y=function(){function t(t,i){t===void 0&&(t=1e3);this.BIa=0;this.BIr=0;i||(i=n.SystemTime._FrameNow());this.BIa=i;this.BFk(t)}return t.prototype.BFk=function(n){this.BIr=n},t.prototype.isWorkTime=function(t){var i,r;return(t||(t=n.SystemTime._FrameNow()),i=t-this.BIa,i<=this.BIr)?!1:(r=Math.floor(i/this.BIr),this.BIa+=r*this.BIr,!0)},t}();n.CycleTimer=y;p=function(){function i(t){t===void 0&&(t=0);this.Pm=0;this.BJl=0;this.BJS=0;this.BJb=!1;this.BJQ=0;this.Pm=n.SystemTime.Now();this.BJS=t;this.BJb=!1}return i.prototype.setCondition=function(t){t===0?(this.BJS=0,this.BJb=!1):(this.Pm=n.SystemTime.Now(),this.BJS=t,this.BJb=!1)},i.prototype.isTimeOut=function(){return 0===this.BJS?!1:this.BJb?!0:(this.BJl=n.SystemTime.Now(),this.BJQ=this.BJl-this.Pm,this.BJb=this.BJQ>this.BJS,this.BJb||(this.BJQ=0),this.BJb)},i.prototype.timeOutQuit=function(){if(this.isTimeOut())throw new t(this.BJQ.toString());},i.prototype.getTimeOutTick=function(){return this.BJQ},i.prototype.getTimeLeft=function(){return this.BJS-(this.BJl-this.Pm)},i}();n.ProcessTimer=p;w=function(){function n(n,t,i){n===void 0&&(n=0);t===void 0&&(t=0);i===void 0&&(i=0);this.level=n;this.x=t;this.y=i}return n.prototype.hashKey=function(){return this.BHD||(this.BHD=this.level+"_"+this.x+"_"+this.y),this.BHD},n.prototype.clone=function(){return new n(this.level,this.x,this.y)},n}();n.QuadtreeHandle=w;b=function(){function n(n){this.invokeFunc=n;this.BKX=!1}return n.prototype.tryInvoke=function(){this.BKX||(this.BKX=!0,this.invokeFunc())},n.prototype.onThen=function(){this.BKX=!1},n}();n.PromiseDelegate=b}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var u=function(){function n(n){(this._array=[],n)&&arguments.length==1&&n.constructor!==Number&&this.addRange(n)}return n.prototype.add=function(n){this._array.push(n)},n.prototype.addRange=function(n){var r,t,i;if(n)if(n.length!==undefined)for(r=n.length,t=0;t<r;t++)this.add(n[t]);else if(i=n.getEnumerator(),i!==undefined)while(i.moveNext())this.add(i.current)},Object.defineProperty(n.prototype,"count",{get:function(){return this._array.length},enumerable:!1,configurable:!0}),n.prototype.getAt=function(n){var t=this._array[n];return t!==undefined?t:null},n.prototype.setAt=function(n,t){this._array[n]=t},n.prototype.getEnumerator=function(){return new t(this._array)},n.prototype.removeAt=function(n){this._array.splice(n,1)},n.prototype.removeRange=function(n,t){this._array.splice(n,t)},n.prototype.remove=function(n){for(var t=0;t<this._array.length;t++)if(n===this._array[t]){this._array.splice(t,1);break}},n.prototype.insert=function(n,t){this._array.splice(n,0,t)},n.prototype.clear=function(){this._array=[]},n.prototype.toArray=function(){return this._array},n.prototype.reverse=function(){this._array.reverse()},n.prototype.indexOf=function(n){return this._array.indexOf(n)},n.prototype.sort=function(n){arguments.length!=0&&n?this._array.sort(function(t,i){return n.compare(t,i)}):this._array.sort()},n.prototype.contains=function(n){return this._array.indexOf(n)>=0},n}(),f,t,e,i,o,s,h,r,c,l,a;n.ListRoot=u;f=function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.add=function(n){n&&n.clone?this._array.push(n.clone()):this._array.push(n)},t.prototype.getAt=function(n){var t=this._array[n];return t!==undefined&&t?t.clone?t.clone():t:null},t.prototype.setAt=function(n,t){this._array[n]=t.clone?t.clone():t},t}(u);n.CloneList=f;t=function(){function n(n){this.BHC=-1;this.BIQ=0;n&&(this.BIA=n,this.BIQ=this.BIA.length)}return n.prototype.moveNext=function(){return this.BHC++,this.BHC<this.BIQ},Object.defineProperty(n.prototype,"current",{get:function(){return this.BIA[this.BHC]},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){},n}();n.Array_Enumerator=t;e=function(){function n(n){this.BIA=n}return n.prototype.getEnumerator=function(){return new t(this.BIA)},n}();n.Array_Enumerable=e;i=function(){function t(n){this.BBi={};this.BCQ={};this.BHK=0;n&&this.unionWith(n)}return Object.defineProperty(t.prototype,"count",{get:function(){return this.BHK},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keys",{get:function(){var n=[];for(var t in this.BBi)n.push(this.BBi[t]);return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){var n=[];for(var t in this.BCQ)n.push(this.BCQ[t]);return n},enumerable:!1,configurable:!0}),t.prototype._hashKey=function(t){return n.TObject.GenericHashKey(t)},t.prototype.getValue=function(n){var t=this.BCQ[this._hashKey(n)];return t===undefined?null:t},t.prototype.add=function(n,t){var i=this._hashKey(n);this.BBi[i]===undefined&&this.BHK++;this.BBi[i]=n;this.BCQ[i]=t},t.prototype.containsKey=function(n){var t=this.BCQ[this._hashKey(n)];return t===undefined?!1:!0},t.prototype.tryGetValue=function(n,t){return t.value=this.getValue(n),!!t.value},t.prototype.remove=function(n){var t=this._hashKey(n);return this.BBi[t]!==undefined&&this.BHK--,delete this.BCQ[t],delete this.BBi[t],!0},t.prototype.clear=function(){this.BCQ={};this.BBi={};this.BHK=0},t.prototype.unionWith=function(n){for(var i,r=n.keys,t=0;t<r.length;t++)i=r[t],this.add(i,n.getValue(i))},t}();n.Dictionary=i;o=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype._hashKey=function(n){return n},t}(i);n.IntKeyDictionary=o;s=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype._hashKey=function(n){return n},t}(i);n.StringKeyDictionary=s;h=function(){function r(n){if(this.BIC=new i,n)for(var t=n.getEnumerator();t.moveNext();)this.add(t.current)}return Object.defineProperty(r.prototype,"count",{get:function(){return this.BIC.count},enumerable:!1,configurable:!0}),r.prototype.add=function(n){this.BIC.add(n,n)},r.prototype.remove=function(n){this.BIC.remove(n)},r.prototype.getEnumerator=function(){return new t(this.BIC.values)},r.prototype.contains=function(n){return this.BIC.containsKey(n)},r.prototype.unionWith=function(n){for(var t=n.getEnumerator();t.moveNext();)this.add(t.current)},r.prototype.symmetricExceptWith=function(n){for(var r=[],u=this.BIC,f=n.getEnumerator(),t,i;f.moveNext();)t=f.current,u.containsKey(t)?r.push(t):this.add(t);for(i=0;i<r.length;i++)u.remove(r[i])},r.prototype.exceptWith=function(n){for(var i=[],u=this.BIC,f=n.getEnumerator(),r,t;f.moveNext();)r=f.current,u.containsKey(r)&&i.push(r);for(t=0;t<i.length;t++)u.remove(i[t])},r.prototype.intersectWith=function(n){for(var i=[],f=this.BIC,e=n.getEnumerator(),r,t,u;e.moveNext();)r=e.current,f.containsKey(r)&&i.push(r);for(this.clear(),t=0;t<i.length;t++)u=i[t],f.add(u,u)},r.prototype.clear=function(){this.BIC.clear()},r.prototype.enumValues=function(){return n.ArrayHelper.CloneArray(this)},r}();n.HashSet=h;r=function(){function i(n){if(this.Gz=[],n)for(var t=n.getEnumerator();t.moveNext();)this.add(t.current)}return Object.defineProperty(i.prototype,"count",{get:function(){return Object.keys(this.Gz).length},enumerable:!1,configurable:!0}),i.prototype.add=function(n){this.Gz[n]=n},i.prototype.remove=function(n){this.Gz[n]!==undefined&&delete this.Gz[n]},i.prototype.getEnumerator=function(){for(var i=Object.keys(this.Gz),r=[],n=0;n<i.length;n++)r.push(this.Gz[i[n]]);return new t(r)},i.prototype.contains=function(n){return this.Gz[n]!==undefined},i.prototype.unionWith=function(n){for(var t=n.getEnumerator();t.moveNext();)this.add(t.current)},i.prototype.clear=function(){this.Gz=[]},i.prototype.enumValues=function(){return n.ArrayHelper.CloneArray(this)},i}();n.DirectHashSet=r;c=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(r);n.IntHashSet=c;l=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(r);n.StringHashSet=l;a=function(){function t(t){(this.onCollectionChanged=new n.Observable,this.BHa=[],t)&&(this.BHa=n.ArrayHelper.CloneArray(t))}return Object.defineProperty(t.prototype,"count",{get:function(){return this.BHa.length},enumerable:!1,configurable:!0}),t.prototype.getAt=function(n){return this.BHa[n]},t.prototype.setAt=function(t,i){this.BHa[t]=i;this.onCollectionChanged.notifyObservers(new n.EventArgs)},t.prototype.getEnumerator=function(){return n.ArrayHelper.CreateEnumerator(this.BHa).getEnumerator()},t.prototype.add=function(t){this.BHa.push(t);this.onCollectionChanged.notifyObservers(new n.EventArgs)},t.prototype.removeAt=function(t){this.BHa.splice(t,1);this.onCollectionChanged.notifyObservers(new n.EventArgs)},t.prototype.toArray=function(){return this.BHa},t.prototype.clear=function(){n.ArrayHelper.Clear(this.BHa);this.onCollectionChanged.notifyObservers(new n.EventArgs)},t}();n.ObservableCollection=a}(Drawsee||(Drawsee={})),function(n){function v(){return navigator.userAgent.indexOf("Firefox")!=-1||navigator.userAgent.indexOf("Chrome")>-1}function c(){i&&(i.style.visibility="hidden")}function y(n){if(!i){var t=document.createElement("div");document.body.appendChild(t);t.innerHTML=a;document.getElementById("_devMessageCloseButton").onclick=function(){c()};i=t;l=document.getElementById("_devMessageText")}i.style.visibility="visible";l.value=n}var t=function(){function t(){}return t.GetMemoryLimitMBytes=function(){var t=1024,n=window.performance;return n&&n.memory&&n.memory.jsHeapSizeLimit&&(t=Math.floor(n.memory.jsHeapSizeLimit/1048576)),t},t.NullObject=function(){return null},t.NewObject=function(n){return n.indexOf(".")<0&&(n="Drawsee."+n),eval("new "+n+"()")},t.FreeDispose=function(n){if(n){var t=n;t.dispose&&t.dispose()}return null},t.NewList=function(n){return u.CloneArray(n)},t.CastObject=function(n){return n},t.QueryInterface=function(n){return n},t.ToInt=function(n){return parseInt(n)},t.CharArrayToInt=function(n,t,i){for(var r="",u=t;u<t+i;u++)r=r+String.fromCharCode(n[u]);return parseInt(r)},t.CopyAttrFromJson=function(n,i){if(n&&i){var r=JSON.parse(i);return t.CopyAttrFromJsonObject(n,r)}},t.ParseJsonFromBytes=function(n){if(!n||n.length<=0)return null;var t=f.DecodingGb2String(n);return JSON.parse(t)},t.BGz=function(n){var t=n.charAt(0).toLowerCase();return t+n.substr(1,n.length-1)},t.CopyAttrFromJsonObject=function(n,i){var r,u;if(n&&i&&n instanceof Object&&i instanceof Object)for(r in i)i.hasOwnProperty(r)&&(u=this.BGz(r),n[u]=t.CloneObject(i[r]))},t.CloneObject=function(n){var i,r,f,u,o,e;if(null==n||"object"!=typeof n)return n;if(n instanceof Date)return i=new Date,i.setTime(n.getTime()),i;if(n instanceof Array){for(i=[],r=0,f=n.length;r<f;r++)i[r]=t.CloneObject(n[r]);return i}if(n instanceof Object){i={};for(u in n)o=u.charAt(0).toLowerCase(),e=this.BGz(u),n.hasOwnProperty(u)&&(i[e]=t.CloneObject(n[u]));return i}throw new Error("Unable to copy obj! Its type isn't supported.");},t.BIp=function(n){return n.indexOf(".")<0&&(n="Drawsee."+n),n},t.CreateFromJson=function(n,i){n=t.BIp(n);var r=eval("new "+n+"();");return t.CopyAttrFromJson(r,i),r},t.CreateFromJsonArray=function(n,i){var r,u;n=t.BIp(n);var f=JSON.parse(i),o=f.length,e=[];for(r=0;r<o;r++)u=eval("new "+n+"();"),t.CopyAttrFromJsonObject(u,f[r]),e.push(u);return e},t.EnumerableToList=function(n){return u.CloneArray(n)},t.ParseImageUrl=function(n){var t,i,r;return n?(t=n,i=n.indexOf(";component"),i>0&&(r=n.replace(";component",""),t="./component"+r),encodeURI(t)):""},t.ConvertDateTime=function(n){return n},t.BJO=function(){var n=navigator.userAgent,t=navigator.appVersion;return{trident:n.indexOf("Trident")>-1,presto:n.indexOf("Presto")>-1,webKit:n.indexOf("AppleWebKit")>-1,gecko:n.indexOf("Gecko")>-1&&n.indexOf("KHTML")==-1,mobile:!!n.match(/AppleWebKit.*Mobile.*/),ios:!!n.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:n.indexOf("Android")>-1||n.indexOf("Linux")>-1,iPhone:n.indexOf("iPhone")>-1||n.indexOf("Mac")>-1,iPad:n.indexOf("iPad")>-1,webApp:n.indexOf("Safari")==-1}},t.IsMobileBrowser=function(){if(!this.BHz){var n=this.BJO();this.BKG=n.mobile||n.android||n.iPhone;this.BHz=!0}return this.BKG},t.EncodeArrayBufferTobase64=function(n){for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h="",o,u,f,c,l,s,e,t=0,i=new Uint8Array(n);t<i.length;)o=i[t++],u=t<i.length?i[t++]:Number.NaN,f=t<i.length?i[t++]:Number.NaN,c=o>>2,l=(o&3)<<4|u>>4,s=(u&15)<<2|f>>6,e=f&63,isNaN(u)?s=e=64:isNaN(f)&&(e=64),h+=r.charAt(c)+r.charAt(l)+r.charAt(s)+r.charAt(e);return"data:image/png;base64,"+h},t._SetTrialVersion=function(){this.BJV=!0},t._IsTrialVersion=function(){return this.BJV},t.GetLocalHostIp=function(){return this.BJV?"http://www.drawsee.com/":"http://"+document.location.host+"//"},t._SetCurrentScriptSrc=function(){document.currentScript&&(t.BJR=document.currentScript.src)},t.CreateWorker=function(i){var u,f,e,s,o;return i=r.ExtractFileNameWithoutSuffix(i),f=Math.random().toString(),n.CustomWorkerUrl?u=n.CustomWorkerUrl:t._IsTrialVersion()?u="./worker/":n._UseDebugThreadUrl&&(e=t.BJR,e&&(s=e.indexOf("/src/"),s>0&&(u=e.substring(0,s),u+="/ext/Thread/",f=""))),u||(u=r.ExtractDirectoryOnly(t.BJR)+"worker/",f=""),this.BHk||(o=BABYLON.DracoCompression.Configuration.decoder,o.wasmUrl=u+"draco_wasm_wrapper_gltf.js",o.wasmBinaryUrl=u+"draco_decoder_gltf.wasm",o.fallbackUrl=u+"draco_decoder_gltf.js",this.BHk=!0),new Worker(u+i+".js?"+f)},t.ToAbsoluteUrl=function(n){var i=t.BJX;return i||(i=document.createElement("a"),t.BJX=i),i.href=n,i.href},t.IsCompressedData=function(n){return!n||n.length<4?!1:n[0]===31&&n[1]===139&&n[2]===8&&n[3]===0},t.Uncompress=function(n){if(!this.IsCompressedData(n))return n;try{var t=new Zlib.Gunzip(n);return t.decompress()}catch(i){return n}},t.ByteToStream=function(t){return new n.MemoryStream(t)},t.FireEvent=function(n,t){n&&n.notifyObservers(t)},t.ToBase64String=function(i){if(!i||i.length<=0)return"";for(var r=0,e=0,u=new n.StringBuilder,o=i.length,f=t.BJc;r<o;){switch(o-r){case 1:u.append(f[i[r]>>2&63]);u.append(f[i[r]<<4&48]);u.append("==");break;case 2:u.append(f[i[r]>>2&63]);u.append(f[(i[r]<<4&48)+(i[r+1]>>4&15)]);u.append(f[i[r+1]<<2&60]);u.append("=");break;default:u.append(f[i[r]>>2&63]);u.append(f[(i[r]<<4&48)+(i[r+1]>>4&15)]);u.append(f[(i[r+1]<<2&60)+(i[r+2]>>6&3)]);u.append(f[i[r+2]&63])}e=e+4;r=r+3}return u.toString()},t.BJY=function(){var n;if(!t.BIh){for(t.BIh=new Uint8Array(128),n=0;n<128;n++)t.BIh[n]=0;for(n=0;n<t.BJc.length;n++)t.BIh[t.BJc[n]]=n}},t.FromBase64String=function(n){var e,o,s;try{t.BJY();for(var u=[],f=n.length,i=0,r=t.BIh;i<f;){while(i<f&&(n.charCodeAt(i)===13||n.charCodeAt(i)===10))i=i+1;i<f&&(e=(r[n.charCodeAt(i)]<<2&252)+(r[n.charCodeAt(i+1)]>>4&3),u.push(e),n.charCodeAt(i+2)!==61&&(o=(r[n.charCodeAt(i+1)]<<4&240)+(r[n.charCodeAt(i+2)]>>2&15),u.push(o)),n.charCodeAt(i+3)!==61&&(s=(r[n.charCodeAt(i+2)]<<6&192)+r[n.charCodeAt(i+3)],u.push(s)),i=i+4)}return new Uint8Array(u)}catch(h){if(h.constructor===Object)return null;throw h;}},t.BHz=!1,t.BKG=!1,t.BJV=!1,t.BJc=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],t}(),e,r,u,o,f,s,h,i,l,a,p;n.SystemHelper=t;e=function(){function t(){}return t.ToInt=function(i){var r=new n.RefValue(0);return t.TryParse(i,r),r.value},t.ToDouble=function(i){var r=new n.RefValue(0);return t.TryParse(i,r),r.value},t.RestrictPrecision=function(i,r){r===void 0&&(r=3);var u=t.ToString(i),f=u.indexOf(String.fromCharCode(46));return f<0?i:(u=n.TString.Substring(u,0,Math.min(u.length,f+1+r)),t.ToDouble(u))},t.DegreeToDecimal=function(n,t,i){return n+t/60+i/3600},t.DecimalToDegree=function(n,t,i,r){t.value=n;i.value=(n-t.value)*60;r.value=((n-t.value)*60-i.value)*60},t.VerifyRange=function(n,t,i){return n>i&&(n=i),n<t&&(n=t),n},t.ToPowerOfTwo=function(n){for(var t=1,i=0;i<32;i++){if(t>=n)break;t=t<<1}return t},t.BytesToMb=function(n){return n*95367431640625e-20},t.TryParse=function(n,t){try{return t.value=parseFloat(n),isNaN(t.value)&&(t.value=0),!0}catch(i){return t.value=0,!1}},t.ToString=function(n){return n.toString()},t.BIt=95367431640625e-20,t}();n.NumberHelper=e;r=function(){function i(){}return i.BJZ=function(n){var t=n.lastIndexOf(String.fromCharCode(92));return t>=0?t:n.lastIndexOf(String.fromCharCode(47))},i.BJy=function(n){return n.lastIndexOf(String.fromCharCode(46))},i.BJT=function(t,r,u,f){var s,e,o;f.value=s="";u.value=s=s;r.value=s;!t||(e=i.BJZ(t),e>=0?(r.value=n.TString.Substring(t,0,e+1),u.value=n.TString.Substring(t,e+1,t.length-e-1)):u.value=t,o=i.BJy(u.value),o>=0&&(f.value=n.TString.Substring(u.value,o,u.value.length-o),u.value=n.TString.Substring(u.value,0,o)))},i.ExtractDirectoryOnly=function(t){var r=new n.RefValue(null),u=new n.RefValue(null),f=new n.RefValue(null);return i.BJT(t,r,u,f),r.value},i.ExtractFinalDirectoryNamePart=function(n){var t=i.SplitFilterEmpty(n,i.BKC);return!t||t.length<=0?"":t[t.length-1]},i.ExtractFileName=function(t){var f=new n.RefValue(null),r=new n.RefValue(null),u=new n.RefValue(null);return i.BJT(t,f,r,u),r.value+u.value},i.ExtractFileSuffix=function(t){var u=new n.RefValue(null),f=new n.RefValue(null),r=new n.RefValue(null);return i.BJT(t,u,f,r),r.value},i.ExtractFileNameWithoutSuffix=function(t){var u=new n.RefValue(null),r=new n.RefValue(null),f=new n.RefValue(null);return i.BJT(t,u,r,f),r.value},i.RegulatePath=function(t){if(!t)return t;var i=t.toLowerCase();return n.TString.Replace(t,92,47),t=n.TString.Trim(t),t.length>0&&t[t.length-1]!="/"&&(t+="/"),t},i.MergeFullUrl=function(n,t){if(t.indexOf("../")===0){t=t.substr(3);var r=i.ExtractFinalDirectoryNamePart(n);return n=i.CutLastPart(n,r),i.MergeFullUrl(n,t)}return t=t.replace("./",""),n+t},i.ExtractFirstLine=function(t){if(!t)return"";var i=n.TString.Split(t,[13,10]);return i&&i.length>0?i[0]:t},i.CutLastPart=function(t,i){if(!t||!i)return t;var r=t.lastIndexOf(i);return r>=0&&(t=n.TString.Substring(t,0,r)),t},i.ToMultipleLines=function(t,i){var u,f,r,e,o,s;if(i===void 0&&(i=32),!t)return null;if(u=t.length/i+1,u<=1)return t;for(f=new n.StringBuilder,r=0;r<u;r++){if(e=r*i,o=Math.min(i,t.length-e),o<=0)break;s=n.TString.Substring(t,e,o);f.append(s+"\r")}return f.toString()},i.ReduceSize=function(n){return n},i.SplitFilterEmpty=function(t,i){var f,r,e,o,u,s,h;if(!t)return null;if(!i||i.length<=0)return f=[],f.push(t),f;if(r=n.TString.Split(t,i),e=[],r&&r.length>0)for(o=r,u=0;u<o.length;u++)s=o[u],h=n.TString.Trim(s),!h||e.push(s);return e},i.SplitNoCase=function(t,i,r,u){var e,f,o;return(i=i.toLowerCase(),e=t.toLowerCase(),f=e.indexOf(i),f>=0)?(r.value=n.TString.Trim(n.TString.Substring(t,0,f)),u.value=n.TString.Trim(n.TString.Substring(t,f+i.length,t.length-f-i.length)),!0):(r.value=o="",u.value=o,!1)},i.FillPrefixChar=function(t,i,r){var u=t;if(u.length>=r)return n.TString.Substring(u,0,r);while(u.length<r)u=i+u;return u},i.FillSuffixChar=function(t,i,r){var u=t;if(u.length>=r)return n.TString.Substring(u,0,r);while(u.length<r)u=u+i;return u},i.FilterEmptyParts=function(t){var r,i,f,u;if(!t)return[];for(r=[],i=0;i<t.length;i++)f=t[i],u=n.TString.Trim(f),!u||r.push(u);return r},i.ParseDouble=function(t,i,r){var e=new Float64Array(r),f=n.TString.Split(t,i),u,o;if(f)for(r=Math.min(r,f.length),u=0;u<r;u++){o=f[u];try{e[u]=parseFloat(o)}catch(s){if(!(s instanceof n.Exception))throw s;}}return e},i.ParseFloat=function(t,i,r){var e=new Float32Array(r),f=n.TString.Split(t,i),u,o;if(f)for(r=Math.min(r,f.length),u=0;u<r;u++){o=f[u];try{e[u]=parseFloat(o)}catch(s){if(!(s instanceof n.Exception))throw s;}}return e},i.ParseInt=function(i,r,u){var o=new Int32Array(u),e=n.TString.Split(i,r),f,s;if(e)for(u=Math.min(u,e.length),f=0;f<u;f++)s=e[f],o[f]=t.ToInt(s);return o},i.FormatLengthString=function(n,t){return(t===void 0&&(t=!0),n<=0&&t)?"":n<1e3?n.toFixed(2)+"米":n<1e4?n.toFixed(1)+"米":(n*.001).toFixed(2)+"公里"},i.FormatAreaString=function(n,t){return(t===void 0&&(t=!0),n<=0&&t)?"":n<1e4?n.toFixed(1)+"平方米":n<1e6?n.toFixed(0)+"平方米":n<1e8?(n*1e-6).toFixed(3)+"平方公里":(n*1e-6).toFixed(1)+"平方公里"},i.FormatVector3Array=function(n,t,i){var u,r,f;for(t===void 0&&(t=9),i===void 0&&(i=2),u="",r=0;r<n.length;r++)f=n[r],u+="["+f.x.toFixed(t)+","+f.y.toFixed(i)+","+f.z.toFixed(t)+"]",r<n.length-1&&(u+=",");return"["+u+"]"},i.BKC=[92,47],i}();n.StringHelper=r;u=function(){function t(){}return t.CloneArray=function(n,i){var r,u;if(i===void 0&&(i=!1),r=[],i)for(u=0;u<n.length;u++)r.push(n[u].clone());else n&&n.constructor!==Number&&t.AddRange(r,n);return r},t.CloneArray2=function(n,t){var e,r,u,f,i;for(t===void 0&&(t=!1),e=[],r=0;r<n.length;r++){for(u=n[r],f=[],i=0;i<u.length;i++)t?f.push(u[i].clone()):f.push(u[i]);e.push(f)}return e},t.CreateEnumerator=function(t){return new n.Array_Enumerable(t)},t.AddRange=function(n,t){var u,i,r;if(t&&t)if(t.length!==undefined)for(u=t.length,i=0;i<u;i++)n.push(t[i]);else if(r=t.getEnumerator(),r!==undefined)while(r.moveNext())n.push(r.current)},t.RemoveByItem=function(n,t){for(var i=0;i<n.length;i++)if(t===this[i]){n.splice(i,1);break}},t.Clear=function(n){n.length=0},t.Sort=function(n,t){arguments.length!=0&&t?n.sort(function(n,i){return t.compare(n,i)}):n.sort()},t.ToHashSet=function(t){for(var u,r=new n.HashSet,i=0;i<t.length;i++)u=t[i],r.add(u);return r},t.ToList=function(n){var i=[],t=n.getEnumerator(),r;try{while(t.moveNext())r=t.current,i.push(r)}finally{t.dispose()}return i},t.ExcludeList=function(n,i){return t.Exclude(n,t.CreateEnumerator(i))},t.Exclude=function(i,r){var f,o,u,e;if(!r)return t.CloneArray(i);for(f=[],o=new n.HashSet(r),u=0;u<i.length;u++)e=i[u],o.contains(e)||f.push(e);return f},t.Union=function(n,i){for(var u,f=t.CloneArray(n),e=t.ToHashSet(n),r=0;r<i.length;r++)u=i[r],e.contains(u)||f.push(u);return f},t.PickTopItems=function(n,t,i){var s,f,e,o,u,h,c,r;if(i===void 0&&(i=0),!n||n.length<=0)return[];for(s=[],i<=0&&(i=n.length),i=Math.min(i,n.length),f=new Array(n.length),u=0;u<f.length;u++)f[u]=!1;for(e=n[0],o=0,u=0;u<i;u++){for(h=!1,r=0;r<n.length;r++)f[r]||(c=n[r],t.compare(e,c)>0&&(e=c,o=r,h=!0));if(f[o]=!0,s.push(e),!h)for(r=0;r<n.length;r++)if(!f[r]){e=n[r];o=r;break}}return s},t.Copy=function(n,t,i,r,u){if(null!=n&&null!=i)for(var f=0;f<Math.min(n.length,u);f++)i[f+r]=n[f+t]},t.CloneDataArray=function(n){return this.BJf(n)},t.CloneDataArray2=function(n){var r,i,t;if(null==n)return null;for(r=0,t=0;t<n.length;t++)n[t]&&(r=n[t].length);if(r<=0)return null;if(i=this.CreateDataArray2(n.length,r),n&&i&&n.length===i.length)for(t=0;t<n.length;t++)i[t]=this.BJf(n[t]);return i},t.BJf=function(n){var u,i,r,t;if(n){if(u=n[0].clone!==undefined,i=n.length,u){for(r=new Array(i),t=0;t<i;t++)r[t]=n[t].clone();return r}return n instanceof Uint8Array?new Uint8Array(n):n instanceof Uint16Array?new Uint16Array(n):n instanceof Uint32Array?new Uint32Array(n):n instanceof Int8Array?new Int8Array(n):n instanceof Int16Array?new Int16Array(n):n instanceof Int32Array?new Int32Array(n):n instanceof Float32Array?new Float32Array(n):n instanceof Float64Array?new Float64Array(n):n.slice(0)}},t.CreateDataArray=function(n){for(var i=[],t=0;t<n;t++)i[t]=null;return i},t.CreateDataArray2=function(n,t){for(var i,r,f=[],u=0;u<n;u++){for(i=new Array(t),r=0;r<i.length;r++)i[r]=null;f[u]=i}return f},t}();n.ArrayHelper=u;o=function(){function t(){}return t.Now=function(){return performance.now()-this.BKH},t._UpdateFrameMs=function(){var n=this.Now();this.BKQ=n-this.BIq;this.BIq=n;this.BKA()},t._FrameNow=function(){return this.BIq},t._FrameSpanMs=function(){return this.BKQ},t.BKA=function(){t.BJe();t.BDU||(t.BDU=new n.CycleTimer(50));t.BDU.isWorkTime()&&(t._IsTimer50=!0,t.BHR++,t.BHR%2==0&&(t._IsTimer100=!0),t.BHR%4==0&&(t._IsTimer200=!0),t.BHR%10==0&&(t._IsTimer500=!0),t.BHR%20==0&&(t._IsTimer1000=!0),t.BHR%40==0&&(t._IsTimer2k=!0),t.BHR%100==0&&(t._IsTimer5k=!0));t.BHR>100&&(t.BHR=0)},t.BJe=function(){t._IsTimer50=!1;t._IsTimer100=!1;t._IsTimer200=!1;t._IsTimer500=!1;t._IsTimer1000=!1;t._IsTimer2k=!1;t._IsTimer5k=!1},t.BKH=performance.now(),t.BIq=0,t.BKQ=16.7,t._IsTimer5k=!1,t._IsTimer2k=!1,t._IsTimer1000=!1,t._IsTimer500=!1,t._IsTimer200=!1,t._IsTimer100=!1,t._IsTimer50=!1,t.BHR=0,t}();n.SystemTime=o;f=function(){function n(){}return n.DecodingGb2String=function(n){var i,u,r,f,e,t;if(!n)return"";for(i="",e=n.length,t=0;t<e;t++)(u=n[t])<161?u<128?i+=String.fromCharCode(u):(i+="-",t+=1):(r=u-161,i+=(f=n[t+1]-161)>=0?r-15>=0?this.BKL.charAt((r-15)*94+f):this.BJh.charAt(r*94+f):String.fromCharCode(r,f),t+=1);return i},n.StringFromBytes=function(n){var r;if(!n)return"";var i="",t="",u=n.length;for(r=0;r<u;r++)t+=String.fromCharCode(n[r]),t.length>10240&&(i=i.concat(t),t="");i=i.concat(t)},n.Unicode2Gb=function(n){if(this.BKT||this.BJA(),n<256)return n;var t=this.BKT[n];return t!==undefined?t:0},n.Gb2Unicode=function(n){if(this.BKT||this.BJA(),n<256)return n;var t=this.BJk[n];return t!==undefined?t:0},n.BJA=function(){var n,t;if(!this.BKT)for(this.BKT=new Uint32Array(65536),this.BJk=new Uint32Array(65536),n=0;n<94;n++)for(t=0;t<94;t++){var u=n*94+t,i=this.BKL.charCodeAt(u),r=(n+161+15)*256+(t+161);this.BKT[i]=r;this.BJk[r]=i}},n.BHN=function(){if(!this.BJg){if(v())try{this.BJM=eval("new TextDecoder('utf-8')")}catch(n){}this.BJg=!0}},n.GetUtf8String=function(n,t){if(!n)return"";if(this.BHN(),t||(t=n.length),this.BJM)return this.BJM.decode(n);var r=void 0,i=void 0,e=void 0,u=void 0,f=void 0,o=void 0;for(r="",e=Math.min(n.length,t),i=0;i<e;){u=n[i++];switch(u>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(n[i-1]);break;case 12:case 13:f=n[i++];r+=String.fromCharCode((u&31)<<6|f&63);break;case 14:f=n[i++];o=n[i++];r+=String.fromCharCode((u&15)<<12|(f&63)<<6|(o&63)<<0)}}return r},n.BJh="　、。·ˉˇ¨〃々—～‖…‘’“”〔〕〈〉《》「」『』〖〗【】±×÷∶∧∨∑∏∪∩∈∷√⊥∥∠⌒⊙∫∮≡≌≈∽∝≠≮≯≤≥∞∵∴♂♀°′″℃＄¤￠￡‰§№☆★○●◎◇◆□■△▲※→←↑↓〓ⅰⅱⅲⅳⅴⅵⅶⅷⅸⅹ⒈⒉⒊⒋⒌⒍⒎⒏⒐⒑⒒⒓⒔⒕⒖⒗⒘⒙⒚⒛⑴⑵⑶⑷⑸⑹⑺⑻⑼⑽⑾⑿⒀⒁⒂⒃⒄⒅⒆⒇①②③④⑤⑥⑦⑧⑨⑩㈠㈡㈢㈣㈤㈥㈦㈧㈨㈩ⅠⅡⅢⅣⅤⅥⅦⅧⅨⅩⅪⅫ！＂＃￥％＆＇（）＊＋，－．／０１２３４５６７８９：；＜＝＞？＠ＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ［＼］＾＿｀ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚ｛｜｝￣ぁあぃいぅうぇえぉおかがきぎくぐけげこごさざしじすずせぜそぞただちぢっつづてでとどなにぬねのはばぱひびぴふぶぷへべぺほぼぽまみむめもゃやゅゆょよらりるれろゎわゐゑをんァアィイゥウェエォオカガキギクグケゲコゴサザシジスズセゼソゾタダチヂッツヅテデトドナニヌネノハバパヒビピフブプヘベペホボポマミムメモャヤュユョヨラリルレロヮワヰヱヲンヴヵヶΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩαβγδεζηθικλμνξοπρστυφχψω︵︶︹︺︿﹀︽︾﹁﹂﹃﹄︻︼︷︸︱︳︴АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдеёжзийклмнопрстуфхцчшщъыьэюяāáǎàēéěèīíǐìōóǒòūúǔùǖǘǚǜüêɑńňɡㄅㄆㄇㄈㄉㄊㄋㄌㄍㄎㄏㄐㄑㄒㄓㄔㄕㄖㄗㄘㄙㄚㄛㄜㄝㄞㄟㄠㄡㄢㄣㄤㄥㄦㄧㄨㄩ─━│┃┄┅┆┇┈┉┊┋┌┍┎┏┐┑┒┓└┕┖┗┘┙┚┛├┝┞┟┠┡┢┣┤┥┦┧┨┩┪┫┬┭┮┯┰┱┲┳┴┵┶┷┸┹┺┻┼┽┾┿╀╁╂╃╄╅╆╇╈╉╊╋",n.BKL="啊阿埃挨哎唉哀皑癌蔼矮艾碍爱隘鞍氨安俺按暗岸胺案肮昂盎凹敖熬翱袄傲奥懊澳芭捌扒叭吧笆八疤巴拔跋靶把耙坝霸罢爸白柏百摆佰败拜稗斑班搬扳般颁板版扮拌伴瓣半办绊邦帮梆榜膀绑棒磅蚌镑傍谤苞胞包褒剥薄雹保堡饱宝抱报暴豹鲍爆杯碑悲卑北辈背贝钡倍狈备惫焙被奔苯本笨崩绷甭泵蹦迸逼鼻比鄙笔彼碧蓖蔽毕毙毖币庇痹闭敝弊必辟壁臂避陛鞭边编贬扁便变卞辨辩辫遍标彪膘表鳖憋别瘪彬斌濒滨宾摈兵冰柄丙秉饼炳病并玻菠播拨钵波博勃搏铂箔伯帛舶脖膊渤泊驳捕卜哺补埠不布步簿部怖擦猜裁材才财睬踩采彩菜蔡餐参蚕残惭惨灿苍舱仓沧藏操糙槽曹草厕策侧册测层蹭插叉茬茶查碴搽察岔差诧拆柴豺搀掺蝉馋谗缠铲产阐颤昌猖场尝常长偿肠厂敞畅唱倡超抄钞朝嘲潮巢吵炒车扯撤掣彻澈郴臣辰尘晨忱沉陈趁衬撑称城橙成呈乘程惩澄诚承逞骋秤吃痴持匙池迟弛驰耻齿侈尺赤翅斥炽充冲虫崇宠抽酬畴踌稠愁筹仇绸瞅丑臭初出橱厨躇锄雏滁除楚础储矗搐触处揣川穿椽传船喘串疮窗幢床闯创吹炊捶锤垂春椿醇唇淳纯蠢戳绰疵茨磁雌辞慈瓷词此刺赐次聪葱囱匆从丛凑粗醋簇促蹿篡窜摧崔催脆瘁粹淬翠村存寸磋撮搓措挫错搭达答瘩打大呆歹傣戴带殆代贷袋待逮怠耽担丹单郸掸胆旦氮但惮淡诞弹蛋当挡党荡档刀捣蹈倒岛祷导到稻悼道盗德得的蹬灯登等瞪凳邓堤低滴迪敌笛狄涤翟嫡抵底地蒂第帝弟递缔颠掂滇碘点典靛垫电佃甸店惦奠淀殿碉叼雕凋刁掉吊钓调跌爹碟蝶迭谍叠丁盯叮钉顶鼎锭定订丢东冬董懂动栋侗恫冻洞兜抖斗陡豆逗痘都督毒犊独读堵睹赌杜镀肚度渡妒端短锻段断缎堆兑队对墩吨蹲敦顿囤钝盾遁掇哆多夺垛躲朵跺舵剁惰堕蛾峨鹅俄额讹娥恶厄扼遏鄂饿恩而儿耳尔饵洱二贰发罚筏伐乏阀法珐藩帆番翻樊矾钒繁凡烦反返范贩犯饭泛坊芳方肪房防妨仿访纺放菲非啡飞肥匪诽吠肺废沸费芬酚吩氛分纷坟焚汾粉奋份忿愤粪丰封枫蜂峰锋风疯烽逢冯缝讽奉凤佛否夫敷肤孵扶拂辐幅氟符伏俘服浮涪福袱弗甫抚辅俯釜斧脯腑府腐赴副覆赋复傅付阜父腹负富讣附妇缚咐噶嘎该改概钙盖溉干甘杆柑竿肝赶感秆敢赣冈刚钢缸肛纲岗港杠篙皋高膏羔糕搞镐稿告哥歌搁戈鸽胳疙割革葛格蛤阁隔铬个各给根跟耕更庚羹埂耿梗工攻功恭龚供躬公宫弓巩汞拱贡共钩勾沟苟狗垢构购够辜菇咕箍估沽孤姑鼓古蛊骨谷股故顾固雇刮瓜剐寡挂褂乖拐怪棺关官冠观管馆罐惯灌贯光广逛瑰规圭硅归龟闺轨鬼诡癸桂柜跪贵刽辊滚棍锅郭国果裹过哈骸孩海氦亥害骇酣憨邯韩含涵寒函喊罕翰撼捍旱憾悍焊汗汉夯杭航壕嚎豪毫郝好耗号浩呵喝荷菏核禾和何合盒貉阂河涸赫褐鹤贺嘿黑痕很狠恨哼亨横衡恒轰哄烘虹鸿洪宏弘红喉侯猴吼厚候后呼乎忽瑚壶葫胡蝴狐糊湖弧虎唬护互沪户花哗华猾滑画划化话槐徊怀淮坏欢环桓还缓换患唤痪豢焕涣宦幻荒慌黄磺蝗簧皇凰惶煌晃幌恍谎灰挥辉徽恢蛔回毁悔慧卉惠晦贿秽会烩汇讳诲绘荤昏婚魂浑混豁活伙火获或惑霍货祸击圾基机畸稽积箕肌饥迹激讥鸡姬绩缉吉极棘辑籍集及急疾汲即嫉级挤几脊己蓟技冀季伎祭剂悸济寄寂计记既忌际妓继纪嘉枷夹佳家加荚颊贾甲钾假稼价架驾嫁歼监坚尖笺间煎兼肩艰奸缄茧检柬碱硷拣捡简俭剪减荐槛鉴践贱见键箭件健舰剑饯渐溅涧建僵姜将浆江疆蒋桨奖讲匠酱降蕉椒礁焦胶交郊浇骄娇嚼搅铰矫侥脚狡角饺缴绞剿教酵轿较叫窖揭接皆秸街阶截劫节桔杰捷睫竭洁结解姐戒藉芥界借介疥诫届巾筋斤金今津襟紧锦仅谨进靳晋禁近烬浸尽劲荆兢茎睛晶鲸京惊精粳经井警景颈静境敬镜径痉靖竟竞净炯窘揪究纠玖韭久灸九酒厩救旧臼舅咎就疚鞠拘狙疽居驹菊局咀矩举沮聚拒据巨具距踞锯俱句惧炬剧捐鹃娟倦眷卷绢撅攫抉掘倔爵觉决诀绝均菌钧军君峻俊竣浚郡骏喀咖卡咯开揩楷凯慨刊堪勘坎砍看康慷糠扛抗亢炕考拷烤靠坷苛柯棵磕颗科壳咳可渴克刻客课肯啃垦恳坑吭空恐孔控抠口扣寇枯哭窟苦酷库裤夸垮挎跨胯块筷侩快宽款匡筐狂框矿眶旷况亏盔岿窥葵奎魁傀馈愧溃坤昆捆困括扩廓阔垃拉喇蜡腊辣啦莱来赖蓝婪栏拦篮阑兰澜谰揽览懒缆烂滥琅榔狼廊郎朗浪捞劳牢老佬姥酪烙涝勒乐雷镭蕾磊累儡垒擂肋类泪棱楞冷厘梨犁黎篱狸离漓理李里鲤礼莉荔吏栗丽厉励砾历利傈例俐痢立粒沥隶力璃哩俩联莲连镰廉怜涟帘敛脸链恋炼练粮凉梁粱良两辆量晾亮谅撩聊僚疗燎寥辽潦了撂镣廖料列裂烈劣猎琳林磷霖临邻鳞淋凛赁吝拎玲菱零龄铃伶羚凌灵陵岭领另令溜琉榴硫馏留刘瘤流柳六龙聋咙笼窿隆垄拢陇楼娄搂篓漏陋芦卢颅庐炉掳卤虏鲁麓碌露路赂鹿潞禄录陆戮驴吕铝侣旅履屡缕虑氯律率滤绿峦挛孪滦卵乱掠略抡轮伦仑沦纶论萝螺罗逻锣箩骡裸落洛骆络妈麻玛码蚂马骂嘛吗埋买麦卖迈脉瞒馒蛮满蔓曼慢漫谩芒茫盲氓忙莽猫茅锚毛矛铆卯茂冒帽貌贸么玫枚梅酶霉煤没眉媒镁每美昧寐妹媚门闷们萌蒙檬盟锰猛梦孟眯醚靡糜迷谜弥米秘觅泌蜜密幂棉眠绵冕免勉娩缅面苗描瞄藐秒渺庙妙蔑灭民抿皿敏悯闽明螟鸣铭名命谬摸摹蘑模膜磨摩魔抹末莫墨默沫漠寞陌谋牟某拇牡亩姆母墓暮幕募慕木目睦牧穆拿哪呐钠那娜纳氖乃奶耐奈南男难囊挠脑恼闹淖呢馁内嫩能妮霓倪泥尼拟你匿腻逆溺蔫拈年碾撵捻念娘酿鸟尿捏聂孽啮镊镍涅您柠狞凝宁拧泞牛扭钮纽脓浓农弄奴努怒女暖虐疟挪懦糯诺哦欧鸥殴藕呕偶沤啪趴爬帕怕琶拍排牌徘湃派攀潘盘磐盼畔判叛乓庞旁耪胖抛咆刨炮袍跑泡呸胚培裴赔陪配佩沛喷盆砰抨烹澎彭蓬棚硼篷膨朋鹏捧碰坯砒霹批披劈琵毗啤脾疲皮匹痞僻屁譬篇偏片骗飘漂瓢票撇瞥拼频贫品聘乒坪苹萍平凭瓶评屏坡泼颇婆破魄迫粕剖扑铺仆莆葡菩蒲埔朴圃普浦谱曝瀑期欺栖戚妻七凄漆柒沏其棋奇歧畦崎脐齐旗祈祁骑起岂乞企启契砌器气迄弃汽泣讫掐恰洽牵扦钎铅千迁签仟谦乾黔钱钳前潜遣浅谴堑嵌欠歉枪呛腔羌墙蔷强抢橇锹敲悄桥瞧乔侨巧鞘撬翘峭俏窍切茄且怯窃钦侵亲秦琴勤芹擒禽寝沁青轻氢倾卿清擎晴氰情顷请庆琼穷秋丘邱球求囚酋泅趋区蛆曲躯屈驱渠取娶龋趣去圈颧权醛泉全痊拳犬券劝缺炔瘸却鹊榷确雀裙群然燃冉染瓤壤攘嚷让饶扰绕惹热壬仁人忍韧任认刃妊纫扔仍日戎茸蓉荣融熔溶容绒冗揉柔肉茹蠕儒孺如辱乳汝入褥软阮蕊瑞锐闰润若弱撒洒萨腮鳃塞赛三叁伞散桑嗓丧搔骚扫嫂瑟色涩森僧莎砂杀刹沙纱傻啥煞筛晒珊苫杉山删煽衫闪陕擅赡膳善汕扇缮墒伤商赏晌上尚裳梢捎稍烧芍勺韶少哨邵绍奢赊蛇舌舍赦摄射慑涉社设砷申呻伸身深娠绅神沈审婶甚肾慎渗声生甥牲升绳省盛剩胜圣师失狮施湿诗尸虱十石拾时什食蚀实识史矢使屎驶始式示士世柿事拭誓逝势是嗜噬适仕侍释饰氏市恃室视试收手首守寿授售受瘦兽蔬枢梳殊抒输叔舒淑疏书赎孰熟薯暑曙署蜀黍鼠属术述树束戍竖墅庶数漱恕刷耍摔衰甩帅栓拴霜双爽谁水睡税吮瞬顺舜说硕朔烁斯撕嘶思私司丝死肆寺嗣四伺似饲巳松耸怂颂送宋讼诵搜艘擞嗽苏酥俗素速粟僳塑溯宿诉肃酸蒜算虽隋随绥髓碎岁穗遂隧祟孙损笋蓑梭唆缩琐索锁所塌他它她塔獭挞蹋踏胎苔抬台泰酞太态汰坍摊贪瘫滩坛檀痰潭谭谈坦毯袒碳探叹炭汤塘搪堂棠膛唐糖倘躺淌趟烫掏涛滔绦萄桃逃淘陶讨套特藤腾疼誊梯剔踢锑提题蹄啼体替嚏惕涕剃屉天添填田甜恬舔腆挑条迢眺跳贴铁帖厅听烃汀廷停亭庭挺艇通桐酮瞳同铜彤童桶捅筒统痛偷投头透凸秃突图徒途涂屠土吐兔湍团推颓腿蜕褪退吞屯臀拖托脱鸵陀驮驼椭妥拓唾挖哇蛙洼娃瓦袜歪外豌弯湾玩顽丸烷完碗挽晚皖惋宛婉万腕汪王亡枉网往旺望忘妄威巍微危韦违桅围唯惟为潍维苇萎委伟伪尾纬未蔚味畏胃喂魏位渭谓尉慰卫瘟温蚊文闻纹吻稳紊问嗡翁瓮挝蜗涡窝我斡卧握沃巫呜钨乌污诬屋无芜梧吾吴毋武五捂午舞伍侮坞戊雾晤物勿务悟误昔熙析西硒矽晰嘻吸锡牺稀息希悉膝夕惜熄烯溪汐犀檄袭席习媳喜铣洗系隙戏细瞎虾匣霞辖暇峡侠狭下厦夏吓掀锨先仙鲜纤咸贤衔舷闲涎弦嫌显险现献县腺馅羡宪陷限线相厢镶香箱襄湘乡翔祥详想响享项巷橡像向象萧硝霄削哮嚣销消宵淆晓小孝校肖啸笑效楔些歇蝎鞋协挟携邪斜胁谐写械卸蟹懈泄泻谢屑薪芯锌欣辛新忻心信衅星腥猩惺兴刑型形邢行醒幸杏性姓兄凶胸匈汹雄熊休修羞朽嗅锈秀袖绣墟戌需虚嘘须徐许蓄酗叙旭序畜恤絮婿绪续轩喧宣悬旋玄选癣眩绚靴薛学穴雪血勋熏循旬询寻驯巡殉汛训讯逊迅压押鸦鸭呀丫芽牙蚜崖衙涯雅哑亚讶焉咽阉烟淹盐严研蜒岩延言颜阎炎沿奄掩眼衍演艳堰燕厌砚雁唁彦焰宴谚验殃央鸯秧杨扬佯疡羊洋阳氧仰痒养样漾邀腰妖瑶摇尧遥窑谣姚咬舀药要耀椰噎耶爷野冶也页掖业叶曳腋夜液一壹医揖铱依伊衣颐夷遗移仪胰疑沂宜姨彝椅蚁倚已乙矣以艺抑易邑屹亿役臆逸肄疫亦裔意毅忆义益溢诣议谊译异翼翌绎茵荫因殷音阴姻吟银淫寅饮尹引隐印英樱婴鹰应缨莹萤营荧蝇迎赢盈影颖硬映哟拥佣臃痈庸雍踊蛹咏泳涌永恿勇用幽优悠忧尤由邮铀犹油游酉有友右佑釉诱又幼迂淤于盂榆虞愚舆余俞逾鱼愉渝渔隅予娱雨与屿禹宇语羽玉域芋郁吁遇喻峪御愈欲狱育誉浴寓裕预豫驭鸳渊冤元垣袁原援辕园员圆猿源缘远苑愿怨院曰约越跃钥岳粤月悦阅耘云郧匀陨允运蕴酝晕韵孕匝砸杂栽哉灾宰载再在咱攒暂赞赃脏葬遭糟凿藻枣早澡蚤躁噪造皂灶燥责择则泽贼怎增憎曾赠扎喳渣札轧铡闸眨栅榨咋乍炸诈摘斋宅窄债寨瞻毡詹粘沾盏斩辗崭展蘸栈占战站湛绽樟章彰漳张掌涨杖丈帐账仗胀瘴障招昭找沼赵照罩兆肇召遮折哲蛰辙者锗蔗这浙珍斟真甄砧臻贞针侦枕疹诊震振镇阵蒸挣睁征狰争怔整拯正政帧症郑证芝枝支吱蜘知肢脂汁之织职直植殖执值侄址指止趾只旨纸志挚掷至致置帜峙制智秩稚质炙痔滞治窒中盅忠钟衷终种肿重仲众舟周州洲诌粥轴肘帚咒皱宙昼骤珠株蛛朱猪诸诛逐竹烛煮拄瞩嘱主著柱助蛀贮铸筑住注祝驻抓爪拽专砖转撰赚篆桩庄装妆撞壮状椎锥追赘坠缀谆准捉拙卓桌琢茁酌啄着灼浊兹咨资姿滋淄孜紫仔籽滓子自渍字鬃棕踪宗综总纵邹走奏揍租足卒族祖诅阻组钻纂嘴醉最罪尊遵昨左佐柞做作坐座亍丌兀丐廿卅丕亘丞鬲孬噩丨禺丿匕乇夭爻卮氐囟胤馗毓睾鼗丶亟鼐乜乩亓芈孛啬嘏仄厍厝厣厥厮靥赝匚叵匦匮匾赜卦卣刂刈刎刭刳刿剀剌剞剡剜蒯剽劂劁劐劓冂罔亻仃仉仂仨仡仫仞伛仳伢佤仵伥伧伉伫佞佧攸佚佝佟佗伲伽佶佴侑侉侃侏佾佻侪佼侬侔俦俨俪俅俚俣俜俑俟俸倩偌俳倬倏倮倭俾倜倌倥倨偾偃偕偈偎偬偻傥傧傩傺僖儆僭僬僦僮儇儋仝氽佘佥俎龠汆籴兮巽黉馘冁夔勹匍訇匐凫夙兕亠兖亳衮袤亵脔裒禀嬴蠃羸冫冱冽冼凇冖冢冥讠讦讧讪讴讵讷诂诃诋诏诎诒诓诔诖诘诙诜诟诠诤诨诩诮诰诳诶诹诼诿谀谂谄谇谌谏谑谒谔谕谖谙谛谘谝谟谠谡谥谧谪谫谮谯谲谳谵谶卩卺阝阢阡阱阪阽阼陂陉陔陟陧陬陲陴隈隍隗隰邗邛邝邙邬邡邴邳邶邺邸邰郏郅邾郐郄郇郓郦郢郜郗郛郫郯郾鄄鄢鄞鄣鄱鄯鄹酃酆刍奂劢劬劭劾哿勐勖勰叟燮矍廴凵凼鬯厶弁畚巯坌垩垡塾墼壅壑圩圬圪圳圹圮圯坜圻坂坩垅坫垆坼坻坨坭坶坳垭垤垌垲埏垧垴垓垠埕埘埚埙埒垸埴埯埸埤埝堋堍埽埭堀堞堙塄堠塥塬墁墉墚墀馨鼙懿艹艽艿芏芊芨芄芎芑芗芙芫芸芾芰苈苊苣芘芷芮苋苌苁芩芴芡芪芟苄苎芤苡茉苷苤茏茇苜苴苒苘茌苻苓茑茚茆茔茕苠苕茜荑荛荜茈莒茼茴茱莛荞茯荏荇荃荟荀茗荠茭茺茳荦荥荨茛荩荬荪荭荮莰荸莳莴莠莪莓莜莅荼莶莩荽莸荻莘莞莨莺莼菁萁菥菘堇萘萋菝菽菖萜萸萑萆菔菟萏萃菸菹菪菅菀萦菰菡葜葑葚葙葳蒇蒈葺蒉葸萼葆葩葶蒌蒎萱葭蓁蓍蓐蓦蒽蓓蓊蒿蒺蓠蒡蒹蒴蒗蓥蓣蔌甍蔸蓰蔹蔟蔺蕖蔻蓿蓼蕙蕈蕨蕤蕞蕺瞢蕃蕲蕻薤薨薇薏蕹薮薜薅薹薷薰藓藁藜藿蘧蘅蘩蘖蘼廾弈夼奁耷奕奚奘匏尢尥尬尴扌扪抟抻拊拚拗拮挢拶挹捋捃掭揶捱捺掎掴捭掬掊捩掮掼揲揸揠揿揄揞揎摒揆掾摅摁搋搛搠搌搦搡摞撄摭撖摺撷撸撙撺擀擐擗擤擢攉攥攮弋忒甙弑卟叱叽叩叨叻吒吖吆呋呒呓呔呖呃吡呗呙吣吲咂咔呷呱呤咚咛咄呶呦咝哐咭哂咴哒咧咦哓哔呲咣哕咻咿哌哙哚哜咩咪咤哝哏哞唛哧唠哽唔哳唢唣唏唑唧唪啧喏喵啉啭啁啕唿啐唼唷啖啵啶啷唳唰啜喋嗒喃喱喹喈喁喟啾嗖喑啻嗟喽喾喔喙嗪嗷嗉嘟嗑嗫嗬嗔嗦嗝嗄嗯嗥嗲嗳嗌嗍嗨嗵嗤辔嘞嘈嘌嘁嘤嘣嗾嘀嘧嘭噘嘹噗嘬噍噢噙噜噌噔嚆噤噱噫噻噼嚅嚓嚯囔囗囝囡囵囫囹囿圄圊圉圜帏帙帔帑帱帻帼帷幄幔幛幞幡岌屺岍岐岖岈岘岙岑岚岜岵岢岽岬岫岱岣峁岷峄峒峤峋峥崂崃崧崦崮崤崞崆崛嵘崾崴崽嵬嵛嵯嵝嵫嵋嵊嵩嵴嶂嶙嶝豳嶷巅彳彷徂徇徉後徕徙徜徨徭徵徼衢彡犭犰犴犷犸狃狁狎狍狒狨狯狩狲狴狷猁狳猃狺狻猗猓猡猊猞猝猕猢猹猥猬猸猱獐獍獗獠獬獯獾舛夥飧夤夂饣饧饨饩饪饫饬饴饷饽馀馄馇馊馍馐馑馓馔馕庀庑庋庖庥庠庹庵庾庳赓廒廑廛廨廪膺忄忉忖忏怃忮怄忡忤忾怅怆忪忭忸怙怵怦怛怏怍怩怫怊怿怡恸恹恻恺恂恪恽悖悚悭悝悃悒悌悛惬悻悱惝惘惆惚悴愠愦愕愣惴愀愎愫慊慵憬憔憧憷懔懵忝隳闩闫闱闳闵闶闼闾阃阄阆阈阊阋阌阍阏阒阕阖阗阙阚丬爿戕氵汔汜汊沣沅沐沔沌汨汩汴汶沆沩泐泔沭泷泸泱泗沲泠泖泺泫泮沱泓泯泾洹洧洌浃浈洇洄洙洎洫浍洮洵洚浏浒浔洳涑浯涞涠浞涓涔浜浠浼浣渚淇淅淞渎涿淠渑淦淝淙渖涫渌涮渫湮湎湫溲湟溆湓湔渲渥湄滟溱溘滠漭滢溥溧溽溻溷滗溴滏溏滂溟潢潆潇漤漕滹漯漶潋潴漪漉漩澉澍澌潸潲潼潺濑濉澧澹澶濂濡濮濞濠濯瀚瀣瀛瀹瀵灏灞宀宄宕宓宥宸甯骞搴寤寮褰寰蹇謇辶迓迕迥迮迤迩迦迳迨逅逄逋逦逑逍逖逡逵逶逭逯遄遑遒遐遨遘遢遛暹遴遽邂邈邃邋彐彗彖彘尻咫屐屙孱屣屦羼弪弩弭艴弼鬻屮妁妃妍妩妪妣妗姊妫妞妤姒妲妯姗妾娅娆姝娈姣姘姹娌娉娲娴娑娣娓婀婧婊婕娼婢婵胬媪媛婷婺媾嫫媲嫒嫔媸嫠嫣嫱嫖嫦嫘嫜嬉嬗嬖嬲嬷孀尕尜孚孥孳孑孓孢驵驷驸驺驿驽骀骁骅骈骊骐骒骓骖骘骛骜骝骟骠骢骣骥骧纟纡纣纥纨纩纭纰纾绀绁绂绉绋绌绐绔绗绛绠绡绨绫绮绯绱绲缍绶绺绻绾缁缂缃缇缈缋缌缏缑缒缗缙缜缛缟缡缢缣缤缥缦缧缪缫缬缭缯缰缱缲缳缵幺畿巛甾邕玎玑玮玢玟珏珂珑玷玳珀珉珈珥珙顼琊珩珧珞玺珲琏琪瑛琦琥琨琰琮琬琛琚瑁瑜瑗瑕瑙瑷瑭瑾璜璎璀璁璇璋璞璨璩璐璧瓒璺韪韫韬杌杓杞杈杩枥枇杪杳枘枧杵枨枞枭枋杷杼柰栉柘栊柩枰栌柙枵柚枳柝栀柃枸柢栎柁柽栲栳桠桡桎桢桄桤梃栝桕桦桁桧桀栾桊桉栩梵梏桴桷梓桫棂楮棼椟椠棹椤棰椋椁楗棣椐楱椹楠楂楝榄楫榀榘楸椴槌榇榈槎榉楦楣楹榛榧榻榫榭槔榱槁槊槟榕槠榍槿樯槭樗樘橥槲橄樾檠橐橛樵檎橹樽樨橘橼檑檐檩檗檫猷獒殁殂殇殄殒殓殍殚殛殡殪轫轭轱轲轳轵轶轸轷轹轺轼轾辁辂辄辇辋辍辎辏辘辚軎戋戗戛戟戢戡戥戤戬臧瓯瓴瓿甏甑甓攴旮旯旰昊昙杲昃昕昀炅曷昝昴昱昶昵耆晟晔晁晏晖晡晗晷暄暌暧暝暾曛曜曦曩贲贳贶贻贽赀赅赆赈赉赇赍赕赙觇觊觋觌觎觏觐觑牮犟牝牦牯牾牿犄犋犍犏犒挈挲掰搿擘耄毪毳毽毵毹氅氇氆氍氕氘氙氚氡氩氤氪氲攵敕敫牍牒牖爰虢刖肟肜肓肼朊肽肱肫肭肴肷胧胨胩胪胛胂胄胙胍胗朐胝胫胱胴胭脍脎胲胼朕脒豚脶脞脬脘脲腈腌腓腴腙腚腱腠腩腼腽腭腧塍媵膈膂膑滕膣膪臌朦臊膻臁膦欤欷欹歃歆歙飑飒飓飕飙飚殳彀毂觳斐齑斓於旆旄旃旌旎旒旖炀炜炖炝炻烀炷炫炱烨烊焐焓焖焯焱煳煜煨煅煲煊煸煺熘熳熵熨熠燠燔燧燹爝爨灬焘煦熹戾戽扃扈扉礻祀祆祉祛祜祓祚祢祗祠祯祧祺禅禊禚禧禳忑忐怼恝恚恧恁恙恣悫愆愍慝憩憝懋懑戆肀聿沓泶淼矶矸砀砉砗砘砑斫砭砜砝砹砺砻砟砼砥砬砣砩硎硭硖硗砦硐硇硌硪碛碓碚碇碜碡碣碲碹碥磔磙磉磬磲礅磴礓礤礞礴龛黹黻黼盱眄眍盹眇眈眚眢眙眭眦眵眸睐睑睇睃睚睨睢睥睿瞍睽瞀瞌瞑瞟瞠瞰瞵瞽町畀畎畋畈畛畲畹疃罘罡罟詈罨罴罱罹羁罾盍盥蠲钅钆钇钋钊钌钍钏钐钔钗钕钚钛钜钣钤钫钪钭钬钯钰钲钴钶钷钸钹钺钼钽钿铄铈铉铊铋铌铍铎铐铑铒铕铖铗铙铘铛铞铟铠铢铤铥铧铨铪铩铫铮铯铳铴铵铷铹铼铽铿锃锂锆锇锉锊锍锎锏锒锓锔锕锖锘锛锝锞锟锢锪锫锩锬锱锲锴锶锷锸锼锾锿镂锵镄镅镆镉镌镎镏镒镓镔镖镗镘镙镛镞镟镝镡镢镤镥镦镧镨镩镪镫镬镯镱镲镳锺矧矬雉秕秭秣秫稆嵇稃稂稞稔稹稷穑黏馥穰皈皎皓皙皤瓞瓠甬鸠鸢鸨鸩鸪鸫鸬鸲鸱鸶鸸鸷鸹鸺鸾鹁鹂鹄鹆鹇鹈鹉鹋鹌鹎鹑鹕鹗鹚鹛鹜鹞鹣鹦鹧鹨鹩鹪鹫鹬鹱鹭鹳疒疔疖疠疝疬疣疳疴疸痄疱疰痃痂痖痍痣痨痦痤痫痧瘃痱痼痿瘐瘀瘅瘌瘗瘊瘥瘘瘕瘙瘛瘼瘢瘠癀瘭瘰瘿瘵癃瘾瘳癍癞癔癜癖癫癯翊竦穸穹窀窆窈窕窦窠窬窨窭窳衤衩衲衽衿袂袢裆袷袼裉裢裎裣裥裱褚裼裨裾裰褡褙褓褛褊褴褫褶襁襦襻疋胥皲皴矜耒耔耖耜耠耢耥耦耧耩耨耱耋耵聃聆聍聒聩聱覃顸颀颃颉颌颍颏颔颚颛颞颟颡颢颥颦虍虔虬虮虿虺虼虻蚨蚍蚋蚬蚝蚧蚣蚪蚓蚩蚶蛄蚵蛎蚰蚺蚱蚯蛉蛏蚴蛩蛱蛲蛭蛳蛐蜓蛞蛴蛟蛘蛑蜃蜇蛸蜈蜊蜍蜉蜣蜻蜞蜥蜮蜚蜾蝈蜴蜱蜩蜷蜿螂蜢蝽蝾蝻蝠蝰蝌蝮螋蝓蝣蝼蝤蝙蝥螓螯螨蟒蟆螈螅螭螗螃螫蟥螬螵螳蟋蟓螽蟑蟀蟊蟛蟪蟠蟮蠖蠓蟾蠊蠛蠡蠹蠼缶罂罄罅舐竺竽笈笃笄笕笊笫笏筇笸笪笙笮笱笠笥笤笳笾笞筘筚筅筵筌筝筠筮筻筢筲筱箐箦箧箸箬箝箨箅箪箜箢箫箴篑篁篌篝篚篥篦篪簌篾篼簏簖簋簟簪簦簸籁籀臾舁舂舄臬衄舡舢舣舭舯舨舫舸舻舳舴舾艄艉艋艏艚艟艨衾袅袈裘裟襞羝羟羧羯羰羲籼敉粑粝粜粞粢粲粼粽糁糇糌糍糈糅糗糨艮暨羿翎翕翥翡翦翩翮翳糸絷綦綮繇纛麸麴赳趄趔趑趱赧赭豇豉酊酐酎酏酤酢酡酰酩酯酽酾酲酴酹醌醅醐醍醑醢醣醪醭醮醯醵醴醺豕鹾趸跫踅蹙蹩趵趿趼趺跄跖跗跚跞跎跏跛跆跬跷跸跣跹跻跤踉跽踔踝踟踬踮踣踯踺蹀踹踵踽踱蹉蹁蹂蹑蹒蹊蹰蹶蹼蹯蹴躅躏躔躐躜躞豸貂貊貅貘貔斛觖觞觚觜觥觫觯訾謦靓雩雳雯霆霁霈霏霎霪霭霰霾龀龃龅龆龇龈龉龊龌黾鼋鼍隹隼隽雎雒瞿雠銎銮鋈錾鍪鏊鎏鐾鑫鱿鲂鲅鲆鲇鲈稣鲋鲎鲐鲑鲒鲔鲕鲚鲛鲞鲟鲠鲡鲢鲣鲥鲦鲧鲨鲩鲫鲭鲮鲰鲱鲲鲳鲴鲵鲶鲷鲺鲻鲼鲽鳄鳅鳆鳇鳊鳋鳌鳍鳎鳏鳐鳓鳔鳕鳗鳘鳙鳜鳝鳟鳢靼鞅鞑鞒鞔鞯鞫鞣鞲鞴骱骰骷鹘骶骺骼髁髀髅髂髋髌髑魅魃魇魉魈魍魑飨餍餮饕饔髟髡髦髯髫髻髭髹鬈鬏鬓鬟鬣麽麾縻麂麇麈麋麒鏖麝麟黛黜黝黠黟黢黩黧黥黪黯鼢鼬鼯鼹鼷鼽鼾齄",n.BJg=!1,n.BJM=null,n}();n.EncodingHelper=f;s=function(){function t(){}return t.FormDirectedIdPair=function(t,i){return new n.QuadtreeHandle(t,i)},t.FormNonDirectedIdPair=function(t,i){var r=Math.min(t,i),u=Math.max(t,i);return new n.QuadtreeHandle(r,u)},t.GetIdHigh=function(n){return n.x},t.GetIdLow=function(n){return n.y},t}();n.IdPairHelper=s;h=function(){function n(){}return n.ToBytes=function(){return null},n.FromBytes=function(){return t.NullObject()},n.ToString=function(){return null},n.FromStringTyped=function(t){return n.FromString(t)},n.Clone=function(){return null},n.FromString=function(n){var i=JSON.parse(n),r;return i?(r=t.NewObject("Drawsee."+i.ClassName),t.CopyAttrFromJsonObject(r,i.Data),r):null},n}();n.ObjectSerializeHelper=h;n._g_hideDevMessage=c;a='<div id="_devMessageDiv" style="position:absolute;top:4px;right:2px; width:500px;height:224px;background-color:black;color:white; opacity:0.7;">             <div style="position:absolute; right:10px;">开发员信息<\/div>             <input type="button" value="X" id="_devMessageCloseButton" style="position:absolute; left:0px;top:2px; color:white;             background-color:black;border-width:0px;cursor:pointer;" />             <textarea id="_devMessageText" readonly="readonly" disabled="disabled" style="position:absolute; top:24px;left:0px; width:500px;height:200px;font-size:14px;                 color:white;background-color:black; resize:none;border-color:lightgray;"><\/textarea>             <\/div>';n._g_showDevMessage=y;p=function(){function n(n,t,i){this.line=n;this.hightlight=t;this.bkColor=i}return n}();t._SetCurrentScriptSrc()}(Drawsee||(Drawsee={})),function(n){var h=function(){function t(n,t,i,r){n===void 0&&(n=0);t===void 0&&(t=0);i===void 0&&(i=0);r===void 0&&(r=1);this.r=n;this.g=t;this.b=i;this.a=r}return t.prototype.copyFrom=function(n){this.r=n.r;this.g=n.g;this.b=n.b;this.a=n.a},t.FromIntRgba=function(n,i,r,u){return new t(n/255,i/255,r/255,u/255)},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.toVector4=function(){var t=n.Vector4.Zero();return this.toVector4ToRef(t),t},t.prototype.toVector4ToRef=function(n){n.set(this.r,this.g,this.b,this.a)},t.IsTransparentFloatAlpha=function(n){return n<.99},t.IsTransparentIntAlpha=function(n){return n<255},t.prototype.toColorString=function(){return this.BKE||(this.BKE="rgba("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+","+this.a+")"),this.BKE},t.prototype.equals=function(n){return n?this.r===n.r&&this.g===n.g&&this.b===n.b&&this.a===n.a:!1},t.BDX=function(n){var i=1/255,r=((n&4278190080)>>24)*i,u=((n&16711680)>>16)*i,f=((n&65280)>>8)*i,e=(n&255)*i;return r<0&&(r=1),new t(u,f,e,r)},Object.defineProperty(t,"Black",{get:function(){return this.BIy.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Blue",{get:function(){return this.BKb.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Brown",{get:function(){return this.BLj.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Cyan",{get:function(){return this.BLP.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DarkGray",{get:function(){return this.BMD.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Gray",{get:function(){return this.BLO.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Green",{get:function(){return this.BKs.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LightGray",{get:function(){return this.BMQ.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Magenta",{get:function(){return this.BKa.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Orange",{get:function(){return this.BLH.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Purple",{get:function(){return this.BME.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Red",{get:function(){return this.BFq.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Transparent",{get:function(){return this.BKD.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"White",{get:function(){return this.BHu.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Yellow",{get:function(){return this.BKp.clone()},enumerable:!1,configurable:!0}),t.FloatToColor=function(n,i,r,u){return t.FromIntRgba(n*255,i*255,r*255,u*255)},t.ColorToInt=function(n){return n.a<<24&-16777216|n.r<<16&16711680|n.g<<8&65280|n.b},t.ColorToTextureInt=function(n){return n.a<<24&-16777216|n.b<<16&16711680|n.g<<8&65280|n.r},t.IntToColor=function(n){return t.FromIntRgba(n>>16&255,n>>8&255,n&255,n>>24&255)},t.Lerp=function(n,i,r){r<0&&(r=0);r>1&&(r=1);var u=n.a+(i.a-n.a)*r,f=n.r+(i.r-n.r)*r,e=n.g+(i.g-n.g)*r,o=n.b+(i.b-n.b)*r;return new t(f,e,o,u)},t.BKn=function(){t.BLx||(t.BLx=new Array(32),t.BLx[0]=t.FromIntRgba(0,0,255,255),t.BLx[1]=t.FromIntRgba(0,32,255,255),t.BLx[2]=t.FromIntRgba(0,64,255,255),t.BLx[3]=t.FromIntRgba(0,96,255,255),t.BLx[4]=t.FromIntRgba(0,128,255,255),t.BLx[5]=t.FromIntRgba(0,160,255,255),t.BLx[6]=t.FromIntRgba(0,192,255,255),t.BLx[7]=t.FromIntRgba(0,224,255,255),t.BLx[8]=t.FromIntRgba(0,255,255,255),t.BLx[9]=t.FromIntRgba(0,255,224,255),t.BLx[10]=t.FromIntRgba(0,255,192,255),t.BLx[11]=t.FromIntRgba(0,255,160,255),t.BLx[12]=t.FromIntRgba(0,255,128,255),t.BLx[13]=t.FromIntRgba(0,255,96,255),t.BLx[14]=t.FromIntRgba(0,255,64,255),t.BLx[15]=t.FromIntRgba(0,255,32,255),t.BLx[16]=t.FromIntRgba(0,255,0,255),t.BLx[17]=t.FromIntRgba(32,255,0,255),t.BLx[18]=t.FromIntRgba(64,255,0,255),t.BLx[19]=t.FromIntRgba(96,255,0,255),t.BLx[20]=t.FromIntRgba(128,255,0,255),t.BLx[21]=t.FromIntRgba(160,255,0,255),t.BLx[22]=t.FromIntRgba(192,255,0,255),t.BLx[23]=t.FromIntRgba(228,255,0,255),t.BLx[24]=t.FromIntRgba(255,255,0,255),t.BLx[25]=t.FromIntRgba(255,224,0,255),t.BLx[26]=t.FromIntRgba(255,192,0,255),t.BLx[27]=t.FromIntRgba(255,160,0,255),t.BLx[28]=t.FromIntRgba(255,128,0,255),t.BLx[29]=t.FromIntRgba(255,96,0,255),t.BLx[30]=t.FromIntRgba(255,64,0,255),t.BLx[31]=t.FromIntRgba(255,0,0,255))},t.GetSystemColor=function(n){return t.BKn(),n<0&&(n=0),n>=32&&(n=31),t.BLx[n].clone()},t.BIy=t.BDX(4278190080),t.BKb=t.BDX(4278190335),t.BLj=t.BDX(4289014314),t.BLP=t.BDX(4278255615),t.BMD=t.BDX(4289309097),t.BLO=t.BDX(4286611584),t.BKs=t.BDX(4278222848),t.BMQ=t.BDX(4292072403),t.BKa=t.BDX(4294902015),t.BLH=t.BDX(4294944e3),t.BME=t.BDX(4286578816),t.BFq=t.BDX(4294901760),t.BKD=t.BDX(16777215),t.BHu=t.BDX(4294967295),t.BKp=t.BDX(4294967040),t.BKS=.003921569,t.BIj=32,t}(),i,f,r,e,o,t,s,u;n.Color=h;i=function(){function t(n,t,i,r){n===void 0&&(n=0);t===void 0&&(t=0);i===void 0&&(i=0);r===void 0&&(r=0);this.x=n;this.y=t;this.width=i;this.height=r}return t.prototype.copyFrom=function(n){this.x=n.x;this.y=n.y;this.width=n.width;this.height=n.height},t.prototype.set=function(n,t,i,r){this.x=n;this.y=t;this.width=i;this.height=r},Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return new n.Vector2(this.x+this.width*.5,this.y+this.height*.5)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this.width<0},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.equals=function(n){return n?this.x===n.x&&this.y===n.y&&this.width===n.width&&this.height===n.height:!1},t.prototype.normalize=function(){this.width<0&&(this.x=this.x+this.width,this.width=-this.width);this.height<0&&(this.y=this.y+this.height,this.height=-this.height)},t.prototype.inflate=function(n,i){return new t(this.x-n,this.y-i,this.width+2*n,this.height+2*i)},t.prototype.inflateInPlace=function(n,t){this.x-=n;this.y-=t;this.width+=2*n;this.height+=2*t},t.prototype.contains=function(n){return this.BGr(n.x,n.y)},t.prototype.intersectInPlace=function(n){if(this.intersects(n)){var t=Math.max(this.x,n.x),i=Math.max(this.y,n.y);this.width=Math.max(Math.min(this.x+this.width,n.x+n.width)-t,0);this.height=Math.max(Math.min(this.y+this.height,n.y+n.height)-i,0);this.x=t;this.y=i}else this.x=this.y=this.width=this.height=0},t.prototype.intersect=function(n){var i=new t(this.x,this.y,this.width,this.height);return i.intersectInPlace(n),i},t.prototype.union=function(n){var i=new t(this.x,this.y,this.width,this.height);return i.unionInPlace(n),i},t.prototype.unionInPlace=function(n){if(!(n.width<0))if(this.width<0)this.x=n.x,this.y=n.y,this.width=n.width,this.height=n.height;else{var t=this.x+this.width,i=this.y+this.height;this.x=Math.min(this.x,n.x);this.y=Math.min(this.y,n.y);this.width=Math.max(t,n.x+n.width)-this.x;this.height=Math.max(i,n.y+n.height)-this.y}},t.prototype.unionPointInPlace=function(n){if(this.width<0)this.x=n.x,this.y=n.y,this.width=0,this.height=0;else{var t=this.x+this.width,i=this.y+this.height;this.x=Math.min(this.x,n.x);this.y=Math.min(this.y,n.y);this.width=Math.max(t,n.x)-this.x;this.height=Math.max(i,n.y)-this.y}},t.prototype.BGr=function(n,t){return n>=this.x&&n-this.width<=this.x&&t>=this.y&&t-this.height<=this.y},t.prototype.intersects=function(n){return this.width>=0&&n.width>=0&&n.x<=this.x+this.width&&n.x+n.width>=this.x&&n.y<=this.y+this.height&&n.y+n.height>=this.y},t.BFz=function(){var n=new t;return n.x=Infinity,n.y=Infinity,n.width=-Infinity,n.height=-Infinity,n},Object.defineProperty(t,"Empty",{get:function(){return this.BIL.clone()},enumerable:!1,configurable:!0}),t.CalcRange=function(n){var i;if(!n||n.length<=0)return new t(0,0,0,0);var r=0,u=r=17976931348623157e292,f=0,e=f=-17976931348623157e292;for(i=0;i<n.length;i++)r=Math.min(r,n[i].x),u=Math.min(u,n[i].y),f=Math.max(f,n[i].x),e=Math.max(e,n[i].y);return new t(r,u,f-r,e-u)},t.CreateFromPoint=function(n,i){var r=Math.min(n.x,i.x),u=Math.min(n.y,i.y),f=Math.abs(n.x-i.x),e=Math.abs(n.y-i.y);return new t(r,u,f,e)},t.BIL=t.BFz(),t}();n.Rect=i;f=function(){function t(){this.m11=0;this.m12=0;this.xOffset=0;this.m21=0;this.m22=0;this.yOffset=0;this.makeIdentity()}return Object.defineProperty(t,"Identity",{get:function(){var n=new t;return n.makeIdentity(),n},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return t.Create(this.m11,this.m12,this.xOffset,this.m21,this.m22,this.yOffset)},t.Create=function(n,i,r,u,f,e){var o=new t;return o.m11=n,o.m12=i,o.xOffset=r,o.m21=u,o.m22=f,o.yOffset=e,o},t.CreateTranslation=function(n,i){var r=new t;return r.makeIdentity(),r.xOffset=n,r.yOffset=i,r},t.CreateRotation=function(n){var i=new t,r,u;return i.makeIdentity(),r=Math.sin(n),u=Math.cos(n),i.m11=u,i.m21=-r,i.m12=r,i.m22=u,i},t.CreateScale=function(n,i){var r=new t;return r.makeIdentity(),r.m11=n,r.m22=i,r},t.CreateFromPoint2=function(i,r,u,f){var e=u.x-i.x,o=u.y-i.y;if(n.MathHelper.NearZero(e)||n.MathHelper.NearZero(o))return t.Identity;var s=(f.x-r.x)/e,h=(f.y-r.y)/o,c=r.x-i.x*s,l=r.y-i.y*h;return this.Create(s,0,c,0,h,l)},t.CreateFromPoint3=function(n,i,r,u,f,e){var o=n.x*(r.y-f.y)+r.x*(f.y-n.y)+f.x*(n.y-r.y),y=null,s,h,c,l,a,v;return 0===o?y=t.Identity:(s=i.x*(r.y-f.y)+u.x*(f.y-n.y)+e.x*(n.y-r.y),s=s/o,h=i.x*(f.x-r.x)+u.x*(n.x-f.x)+e.x*(r.x-n.x),h=h/o,c=i.x*r.x*f.y-i.x*f.x*r.y+u.x*f.x*n.y-u.x*n.x*f.y+e.x*n.x*r.y-e.x*r.x*n.y,c=c/o,l=i.y*(r.y-f.y)+u.y*(f.y-n.y)+e.y*(n.y-r.y),l=l/o,a=i.y*(f.x-r.x)+u.y*(n.x-f.x)+e.y*(r.x-n.x),a=a/o,v=i.y*r.x*f.y-i.y*f.x*r.y+u.y*f.x*n.y-u.y*n.x*f.y+e.y*n.x*r.y-e.y*r.x*n.y,v=v/o,y=t.Create(s,l,c,h,a,v)),y},t.prototype.makeIdentity=function(){this.m11=this.m22=1;this.xOffset=0;this.yOffset=0},t.prototype.isIdentity=function(){return this.m11===1&&this.m22===1&&this.xOffset===0&&this.yOffset===0},t.prototype.isZero=function(){return this.m11===0&&this.m22===0&&this.xOffset===0&&this.yOffset===0},t.prototype.copyFrom=function(n){this.m11=n.m11;this.m12=n.m12;this.xOffset=n.xOffset;this.m21=n.m21;this.m22=n.m22;this.yOffset=n.yOffset},t.prototype.multiplyInPlace=function(n){var t=this.clone();this.m11=t.m11*n.m11+t.m12*n.m21;this.m12=t.m11*n.m12+t.m12*n.m22;this.xOffset=t.m11*n.xOffset+t.m12*n.yOffset+t.xOffset;this.m21=t.m21*n.m11+t.m22*n.m21;this.m22=t.m21*n.m12+t.m22*n.m22;this.yOffset=t.m21*n.xOffset+t.m22*n.yOffset+t.yOffset},t.prototype.translateInPlace=function(n,i){var r=t.CreateTranslation(n,i);this.multiplyInPlace(r)},t.prototype.rotateInplace=function(n){var i=t.CreateRotation(n);this.multiplyInPlace(i)},t.prototype.scaleInPlace=function(n,i){var r=t.CreateScale(n,i);this.multiplyInPlace(r)},t.prototype.invertInPlace=function(){var n=this.determinant();if(Math.abs(n)<=-17976931348623157e292)return!1;var t=this.m11,i=this.m12,r=this.xOffset,u=this.m21,f=this.m22,e=this.yOffset;return this.m11=f/n,this.m21=-u/n,this.m12=-i/n,this.m22=t/n,this.xOffset=(i*e-f*r)/n,this.yOffset=(u*r-t*e)/n,!0},t.prototype.determinant=function(){return this.m11*this.m22-this.m12*this.m21},t.prototype.transform=function(t){var i=new n.Vector2;return this.transformToRef(t,i),i},t.prototype.transformToRef=function(n,t){var i=n.x,r=n.y;t.x=this.m11*i+this.m12*r+this.xOffset;t.y=this.m21*i+this.m22*r+this.yOffset},t.prototype.transformRect=function(t){var r=this.transform(new n.Vector2(t.left,t.top)),u=this.transform(new n.Vector2(t.right,t.bottom));return i.CreateFromPoint(r,u)},t.prototype.transformPoints=function(n){var r,t;if(!n)return null;for(r=new Array(n.length),t=0;t<n.length;t++){var i=n[t].clone(),u=i.x,f=i.y;i.x=this.m11*u+this.m12*f+this.xOffset;i.y=this.m21*u+this.m22*f+this.yOffset;r[t]=i.clone()}return r},t}();n.Matrix2=f;r=function(){function t(n,t,i){arguments.length===1?(this.x=n,this.y=n,this.z=n):arguments.length===3?(this.x=n,this.y=t,this.z=i):arguments.length===2&&(this.x=n,this.y=t,this.z=t)}return Object.defineProperty(t.prototype,"min",{get:function(){return Math.min(this.x,Math.min(this.y,this.z))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){return Math.max(this.x,Math.max(this.y,this.z))},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.equals=function(n){return this.x===n.x&&this.y===n.y&&this.z===n.z},t.prototype.toVector3=function(){return new n.Vector3(this.x,this.y,this.z)},t}();n.Size3=r;e=function(){function n(n,t,i){n===void 0&&(n=0);t===void 0&&(t=0);i===void 0&&(i=0);this.v0=n;this.v1=t;this.v2=i}return n.prototype.clone=function(){return new n(this.v0,this.v1,this.v2)},n.ToIndexArray=function(n){for(var f=n.length,i=new Int32Array(f*3),t=0,r=0,u;r<f;)u=n[r].clone(),i[t]=u.v0,i[t+1]=u.v1,i[t+2]=u.v2,r=r+1,t=t+3;return i},n}();n.Triangle3=e;o=function(){function n(n,t,i,r,u,f,e,o){n===void 0&&(n=0);t===void 0&&(t=0);i===void 0&&(i=0);r===void 0&&(r=0);u===void 0&&(u=0);f===void 0&&(f=0);e===void 0&&(e=0);o===void 0&&(o=0);this.x=n;this.y=t;this.z=i;this.nx=r;this.ny=u;this.nz=f;this.u=e;this.v=o}return n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.nx,this.ny,this.nz,this.u,this.v)},n}();n.Vertex3=o;t=function(){function t(t,i){t===void 0&&(t=n.Vector3.Zero());i===void 0&&(i=n.Vector3.Zero());this.min=t;this.max=i}return Object.defineProperty(t.prototype,"size",{get:function(){return new r(this.max.x-this.min.x,this.max.y-this.min.y,this.max.z-this.min.z)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return this.KB||(this.KB=new n.Vector3((this.min.x+this.max.x)*.5,(this.min.y+this.max.y)*.5,(this.min.z+this.max.z)*.5)),this.KB},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this.Db||(this.Db=Math.sqrt(t.BIK(this.min,this.max))*.5),this.Db},enumerable:!1,configurable:!0}),t.prototype.toRect=function(){return new i(this.min.x,this.min.z,this.max.x-this.min.x,this.max.z-this.min.z)},t.prototype.toBoundingPoints=function(){var t=[],i=this.min.x,r=this.min.y,u=this.min.z,f=this.max.x,e=this.max.y,o=this.max.z;return t.push(new n.Vector3(i,r,u)),t.push(new n.Vector3(i,r,o)),t.push(new n.Vector3(f,r,o)),t.push(new n.Vector3(f,r,u)),t.push(new n.Vector3(i,e,u)),t.push(new n.Vector3(i,e,o)),t.push(new n.Vector3(f,e,o)),t.push(new n.Vector3(f,e,u)),t},t.prototype.clone=function(){return new t(new n.Vector3(this.min.x,this.min.y,this.min.z),new n.Vector3(this.max.x,this.max.y,this.max.z))},t.prototype.contains=function(n){return n.x>=this.min.x&&n.x<=this.max.x&&n.y>=this.min.y&&n.y<=this.max.y&&n.z>=this.min.z&&n.z<=this.max.z},t.prototype.unionInPlace=function(n){this.min.set(Math.min(this.min.x,n.min.x),Math.min(this.min.y,n.min.y),Math.min(this.min.z,n.min.z));this.max.set(Math.max(this.max.x,n.max.x),Math.max(this.max.y,n.max.y),Math.max(this.max.z,n.max.z))},t.CreateFromDouble=function(i,r,u,f,e,o){return new t(new n.Vector3(i,r,u),new n.Vector3(f,e,o))},t.Union=function(n,i){return t.CreateFromDouble(Math.min(n.min.x,i.min.x),Math.min(n.min.y,i.min.y),Math.min(n.min.z,i.min.z),Math.max(n.max.x,i.max.x),Math.max(n.max.y,i.max.y),Math.max(n.max.z,i.max.z))},t.CalcRange=function(i){var s,r;if(!i||i.length<=0)return new t(n.Vector3.Zero(),n.Vector3.Zero());var u=0,f=0,h=f=u=17976931348623157e292,e=0,o=0,c=o=e=-17976931348623157e292;for(s=0;s<i.length;s++)r=i[s].clone(),h=Math.min(h,r.x),f=Math.min(f,r.y),u=Math.min(u,r.z),c=Math.max(c,r.x),o=Math.max(o,r.y),e=Math.max(e,r.z);return new t(new n.Vector3(h,f,u),new n.Vector3(c,o,e))},t.CalcRangeFromArray=function(i){var l;if(!i||i.length<=0)return new t(n.Vector3.Zero(),n.Vector3.Zero());var r=0,u=0,s=u=r=17976931348623157e292,f=0,e=0,h=e=f=-17976931348623157e292,c=i.data,p=i.length,o=0;for(l=0;l<p;l++){var a=c[o],v=c[o+1],y=c[o+2];s=Math.min(s,a);u=Math.min(u,v);r=Math.min(r,y);h=Math.max(h,a);e=Math.max(e,v);f=Math.max(f,y);o+=3}return new t(new n.Vector3(s,u,r),new n.Vector3(h,e,f))},t.BIK=function(n,t){var i=n.x-t.x,r=n.y-t.y,u=n.z-t.z;return i*i+r*r+u*u},t.IntersectsMinMax=function(n,t,i,r){var u=i.x,f=i.y,e=i.z,o=r.x,s=r.y,h=r.z,c=n.x,l=n.y,a=n.z,v=t.x,y=t.y,p=t.z;return o<c||u>v?!1:s<l||f>y?!1:h<a||e>p?!1:!0},t.Intersects=function(n,i){return t.IntersectsMinMax(n.min,n.max,i.min,i.max)},t.FromBoundingBox=function(n){return new t(n.minimum,n.maximum)},t}();n.Box=t;s=function(){function t(t,i){t===void 0&&(t=n.Vector3.Zero());i===void 0&&(i=n.Vector3.Zero());this.start=t.clone();this.end=i.clone()}return t.prototype.copyFrom=function(n){this.start=n.start.clone();this.end=n.end.clone()},t.DistancePL2=function(t,i,r){var u=i.end.subtract(i.start),f=t.subtract(i.start),e=n.Vector3.Dot(f,u),o=n.Vector3.Dot(u,u),s=e/o;return r.copyFrom(i.start.add(u.scale(s))),t.subtract(r).length()},t.DistancePL=function(i,r){var u=new n.Vector3;return t.DistancePL2(i,r,u)},t.DistanceLL2=function(i,r,u){var f=i.end.subtract(i.start),e=r.end.subtract(r.start),l=i.start.subtract(r.start),p=n.Vector3.Dot(f,f),o=n.Vector3.Dot(f,e),s=n.Vector3.Dot(e,e),a=n.Vector3.Dot(f,l),v=n.Vector3.Dot(e,l),y=p*s-o*o,h=0,c=0,w,b;return y<1e-13?(h=0,c=o>s?a/o:v/s):(h=(o*v-s*a)/y,c=(p*v-o*a)/y),w=i.start.add(f.scale(h)),b=r.start.add(e.scale(c)),u.copyFrom(new t(w,b)),l.add(f.scale(h)).subtract(e.scale(c)).length()},t.DistanceLL=function(n,i){var r;return t.DistanceLL2(n,i,r)},t.BKy=function(n,t,i){var r=n.x*(t.y*i.z-t.z*i.y)+n.y*(t.z*i.x-t.x*i.z)+n.z*(t.x*i.y-t.y*i.x);return r<0?1:r>0?-1:0},t.prototype.intersectsTriangle=function(i,r,f,e){var c=n.Plane.FromPoints(i,r,f),w=new n.RefValue(0);if(u.IntersectSegmentPlane(this.start,this.end,c,e,w)){var o=0,s=0,l=0;if(Math.abs(c.d)>1e-13)o=t.BKy(e,f,i),s=t.BKy(e,i,r),l=t.BKy(e,r,f);else{var h=c.normal.clone(),a=e.add(h),v=i.add(h),y=r.add(h),p=f.add(h);o=t.BKy(a,p,v);s=t.BKy(a,v,y);l=t.BKy(a,y,p)}return o===s&&s===l&&o!==0}return!1},t}();n.Segment3=s;u=function(){function i(){}return i.TransformByQuaternion=function(t,i){var u=2*(i.y*t.z-i.z*t.y),f=2*(i.z*t.x-i.x*t.z),e=2*(i.x*t.y-i.y*t.x),r=new n.Vector3;return r.x=t.x+u*i.w+(i.y*e-i.z*f),r.y=t.y+f*i.w+(i.z*u-i.x*e),r.z=t.z+e*i.w+(i.x*f-i.y*u),r},i.TransformPoints=function(t,i,r){for(var u,f=0;f<t.length;f++)u=t[f],r[f]=new n.Vector3(u.x*i.m[0]+u.y*i.m[4]+u.z*i.m[8]+i.m[12],u.x*i.m[1]+u.y*i.m[5]+u.z*i.m[9]+i.m[13],u.x*i.m[2]+u.y*i.m[6]+u.z*i.m[10]+i.m[14])},i.ToVector3=function(t){return new n.Vector3(t.x,0,t.y)},i.ToVector2=function(t){return new n.Vector2(t.x,t.z)},i.ToVector2Array=function(t){var r,i;if(!t)return[];for(r=[],i=0;i<t.length;i++)r.push(new n.Vector2(t[i].x,t[i].z));return r},i.ToVector3Array=function(t){var r,i;if(!t)return[];for(r=[],i=0;i<t.length;i++)r.push(new n.Vector3(t[i].x,0,t[i].y));return r},i.CloneVector3Array=function(n){var i,t;if(!n)return[];for(i=[],t=0;t<n.length;t++)i.push(n[t].clone());return i},i.ToLocalVector3Array=function(t,i){var u,r;if(!t)return[];for(u=[],i||(i=t[0]),r=0;r<t.length;r++)u.push(new n.Vector3(t[r].x-i.x,t[r].y-i.y,t[r].z-i.z));return u},i.FloatToVector3Array=function(t){var r;if(!t)return[];var u=[],f=Math.floor(t.length/3),i=0;for(r=0;r<f;r++)u.push(new n.Vector3(t[i],t[i+1],t[i+2])),i+=3;return u},i.FloatToVector2Array=function(t){var r;if(!t)return[];var u=[],f=Math.floor(t.length/3),i=0;for(r=0;r<f;r++)u.push(new n.Vector2(t[i],t[i+1])),i+=2;return u},i.Vector3ArrayFromXyzArray=function(t,i){for(var r,f,e=[],u=0;u<t.length;u++)r=t[u],f=new n.Vector3(r[0],r[1],r[2]),i!==undefined&&(f.y=i),e.push(f);return e},i.VectorzArrayFromXyArray=function(t){for(var r,u=[],i=0;i<t.length;i++)r=t[i],u.push(new n.Vector2(r[0],r[1]));return u},i.CreateRay=function(t,i){var r=i.subtract(t);return r.normalize(),new n.Ray(t,r)},i.CreateBoundingSphere=function(t,i){return t===void 0&&(t=n.Vector3.Zero()),i===void 0&&(i=0),new n.BoundingSphere(new n.Vector3(t.x-i,t.y-i,t.z-i),new n.Vector3(t.x+i,t.y+i,t.z+i))},i.CreateBoundingBox=function(t,i){return new n.BoundingBox(new n.Vector3(t.x,t.y,t.z),new n.Vector3(i.x,i.y,i.z))},i.CreateBoundingBoxFromCenter=function(t,i){return t===void 0&&(t=n.Vector3.Zero()),i===void 0&&(i=0),new n.BoundingBox(new n.Vector3(t.x-i,t.y-i,t.z-i),new n.Vector3(t.x+i,t.y+i,t.z+i))},i.CreateBoxFromCenter=function(i,r){return i===void 0&&(i=n.Vector3.Zero()),r===void 0&&(r=0),new t(new n.Vector3(i.x-r,i.y-r,i.z-r),new n.Vector3(i.x+r,i.y+r,i.z+r))},i.CreateBoundingInfo=function(t,i){return new n.BoundingInfo(new n.Vector3(t.x,t.y,t.z),new n.Vector3(i.x,i.y,i.z))},i.FilterDuplicatedVector3=function(t,i,r){var u,s,f,o,e;if(i===void 0&&(i=1e-9),r===void 0&&(r=!1),u=[],!t||t.length<=0)return null;for(s=t.length,f=t[0],u.push(f),o=1;o<s;o++)e=t[o].clone(),(Math.abs(e.x-f.x)>i||Math.abs(e.y-f.y)>i||Math.abs(e.z-f.z)>i)&&(u.push(e),f=e);return r&&u.length>3&&n.Math3.NearEqual(u[0],u[u.length-1],1e-13)&&u.splice(u.length-1,1),u},i.FilterDuplicatedVector2=function(t,i,r){var u,s,f,o,e;if(i===void 0&&(i=1e-9),r===void 0&&(r=!1),u=[],!t||t.length<=0)return null;for(s=t.length,f=t[0],u.push(f),o=1;o<s;o++)e=t[o].clone(),(Math.abs(e.x-f.x)>i||Math.abs(e.y-f.y)>i)&&(u.push(e),f=e);return r&&u.length>3&&n.Math2.NearEqual(u[0],u[u.length-1],1e-13)&&u.splice(u.length-1,1),u},i.MinVector=function(n,t){var i=n.clone();return t.x<i.x&&(i.x=t.x),t.y<i.y&&(i.y=t.y),t.z<i.z&&(i.z=t.z),i},i.MaxVector=function(n,t){var i=n.clone();return t.x>i.x&&(i.x=t.x),t.y>i.y&&(i.y=t.y),t.z>i.z&&(i.z=t.z),i},i.TransformBox=function(n,i){var r=n.toBoundingPoints(),u=i(r);return t.CalcRange(u)},i.CalcBoundingBox=function(i,r,u){var a,f;if(r===void 0&&(r=0),u===void 0&&(u=i.length),!i||i.length<=0)return new t;if(i instanceof n.Vector3Array)return this.BKu(i,r,u);var e=void 0,o=void 0,s=void 0,h=void 0,c=void 0,l=void 0;for(e=o=s=340282347e30,h=c=l=-340282347e30,a=r;a<r+u;a++)f=i[a],e=Math.min(e,f.x),o=Math.min(o,f.y),s=Math.min(s,f.z),h=Math.max(h,f.x),c=Math.max(c,f.y),l=Math.max(l,f.z);return new t(new n.Vector3(e,o,s),new n.Vector3(h,c,l))},i.BKu=function(i,r,u){var f,a;if(r===void 0&&(r=0),u===void 0&&(u=i.length),!i||i.length<=0)return new t;var e=void 0,o=void 0,s=void 0,h=void 0,c=void 0,l=void 0;for(e=o=s=340282347e30,h=c=l=-340282347e30,f=n.Vector3.Zero(),a=r;a<r+u;a++)i.getToRef(a,f),e=Math.min(e,f.x),o=Math.min(o,f.y),s=Math.min(s,f.z),h=Math.max(h,f.x),c=Math.max(c,f.y),l=Math.max(l,f.z);return new t(new n.Vector3(e,o,s),new n.Vector3(h,c,l))},i.CalcBoundingBoxIndexed=function(i,r,u,f){var v,e;if(!i||i.length<=0)return new t;if(i instanceof n.Vector3Array)return this.BJu(i,r,u,f);var o=void 0,s=void 0,h=void 0,c=void 0,l=void 0,a=void 0;for(o=s=h=340282347e30,c=l=a=-340282347e30,v=u;v<u+f;v++)e=i[r[v]],o=Math.min(o,e.x),s=Math.min(s,e.y),h=Math.min(h,e.z),c=Math.max(c,e.x),l=Math.max(l,e.y),a=Math.max(a,e.z);return new t(new n.Vector3(o,s,h),new n.Vector3(c,l,a))},i.BJu=function(i,r,u,f){var e,v;if(!i||i.length<=0)return new t;var o=void 0,s=void 0,h=void 0,c=void 0,l=void 0,a=void 0;for(o=s=h=340282347e30,c=l=a=-340282347e30,e=n.Vector3.Zero(),v=u;v<u+f;v++)i.getToRef(r[v],e),o=Math.min(o,e.x),s=Math.min(s,e.y),h=Math.min(h,e.z),c=Math.max(c,e.x),l=Math.max(l,e.y),a=Math.max(a,e.z);return new t(new n.Vector3(o,s,h),new n.Vector3(c,l,a))},i.CalcNormals=function(t,r){var e,o,s,h,c,u,f;if(!t||!r)return null;for(e=t.length,o=new Float32Array(e*3),u=0;u<e;u++)f=u*3,s=t[u],o[f]=s.x,o[f+1]=s.y,o[f+2]=s.z;for(h=i.CalcNormalsFloatArray(o,r),c=new Array(e),u=0;u<e;u++)f=u*3,c[u]=new n.Vector3(h[f],h[f+1],h[f+2]);return c},i.CalcNormalsFloatArray=function(n,t){for(var o,i=new Float32Array(n.length),a=0,v=0,y=0,nt=Math.floor(t.length/3),h=0;h<nt;h++){o=h*3;a=t[o];v=t[o+1];y=t[o+2];var c=a*3,s=v*3,l=y*3,p=n[c]-n[s],w=n[c+1]-n[s+1],b=n[c+2]-n[s+2],k=n[l]-n[s],d=n[l+1]-n[s+1],g=n[l+2]-n[s+2],r=w*g-b*d,u=b*k-p*g,f=p*d-w*k,e=Math.sqrt(r*r+u*u+f*f);e=e===0?1:e;r=r/e;u=u/e;f=f/e;i[c]+=r;i[c+1]+=u;i[c+2]+=f;i[s]+=r;i[s+1]+=u;i[s+2]+=f;i[l]+=r;i[l+1]+=u;i[l+2]+=f}for(h=0;h<i.length/3;h++){var o=h*3,r=i[o],u=i[o+1],f=i[o+2],e=Math.sqrt(r*r+u*u+f*f);e=e===0?1:e;r=r/e;u=u/e;f=f/e;i[o]=r;i[o+1]=u;i[o+2]=f}return i},i.RayPosition=function(n,t){return n.origin.add(n.direction.scale(t))},i.IsBetween=function(t,i,r){var u=this.BLy,f=this.BKk,e,o;return u.copyFrom(t),f.copyFrom(t),u.subtractInPlace(r),f.subtractInPlace(i),e=n.Vector3.Dot(u,f),u.copyFrom(i),f.copyFrom(i),u.subtractInPlace(r),f.subtractInPlace(t),o=n.Vector3.Dot(u,f),e>0&&o>0},i.CalcQuternionOfZDirection=function(t,i){var f=t,r=i.clone(),u;return f.normalize(),r.normalize(),u=n.Vector3.Cross(f,r),n.Math3.NearZero(u,1e-13)&&(r=new n.Vector3(0,0,1),u=n.Vector3.Cross(f,r)),u.normalize(),r=n.Vector3.Cross(f,u).negate(),r.normalize(),n.Quaternion.RotationQuaternionFromAxis(u.negate(),r,f)},i.IntersectRayBox=function(n,t){return i.IntersectRayMinMax(n,t.min,t.max)},i.IntersectRayBoundingBox=function(n,t){return i.IntersectRayMinMax(n,t.minimum,t.maximum)},i.IntersectRayMinMax=function(t,i,r){var e=0,o=Number.MAX_VALUE,s,f,u,h;if(Math.abs(t.direction.x)<1e-7){if(t.origin.x<i.x||t.origin.x>r.x)return null}else if(s=1/t.direction.x,f=(i.x-t.origin.x)*s,u=(r.x-t.origin.x)*s,u===-Infinity&&(u=Infinity),f>u&&(h=f,f=u,u=h),e=Math.max(f,e),o=Math.min(u,o),e>o)return null;if(Math.abs(t.direction.y)<1e-7){if(t.origin.y<i.y||t.origin.y>r.y)return null}else if(s=1/t.direction.y,f=(i.y-t.origin.y)*s,u=(r.y-t.origin.y)*s,u===-Infinity&&(u=Infinity),f>u&&(h=f,f=u,u=h),e=Math.max(f,e),o=Math.min(u,o),e>o)return null;if(Math.abs(t.direction.z)<1e-7){if(t.origin.z<i.z||t.origin.z>r.z)return null}else if(s=1/t.direction.z,f=(i.z-t.origin.z)*s,u=(r.z-t.origin.z)*s,u===-Infinity&&(u=Infinity),f>u&&(h=f,f=u,u=h),e=Math.max(f,e),o=Math.min(u,o),e>o)return null;return new n.NullableValue(e)},i.IntersectPlaneMinMax=function(t,i,r){var u=n.Vector3.Zero(),f=n.Vector3.Zero(),e;return t.normal.x>=0?(u.x=r.x,f.x=i.x):(u.x=i.x,f.x=r.x),t.normal.y>=0?(u.y=r.y,f.y=i.y):(u.y=i.y,f.y=r.y),t.normal.z>=0?(u.z=r.z,f.z=i.z):(u.z=i.z,f.z=r.z),e=t.normal.x*f.x+t.normal.y*f.y+t.normal.z*f.z+t.d,e>0?!1:(e=t.normal.x*u.x+t.normal.y*u.y+t.normal.z*u.z+t.d,e<0?!1:!0)},i.IntersectPlaneBox=function(n,t){return i.IntersectPlaneMinMax(n,t.min,t.max)},i.IntersectSegmentPlane=function(t,i,r,u,f){f===void 0&&(f=null);var o=t.subtract(i),s=n.Vector3.Dot(r.normal,o),e;return s===0?(e=0,u.copyFrom(i),!1):(e=(n.Vector3.Dot(r.normal,t)+r.d)/s,e<-1e-13||e>1.0000000000001)?(u.setAll(0),!1):(u.copyFrom(t.add(o.negate().scale(e))),f&&(f.value=e),!0)},i.IntersectRayTriangle=function(t,i,r,u){var c=r.subtract(i),l=u.subtract(i),a=n.Vector3.Cross(t.direction,l),v=n.Vector3.Dot(c,a),s,e,h,p;if(v===0)return null;var o=1/v,y=t.origin.subtract(i),f=n.Vector3.Dot(y,a)*o;return f<0||f>1?null:(s=n.Vector3.Cross(y,c),e=n.Vector3.Dot(t.direction,s)*o,e<0||f+e>1)?null:(h=n.Vector3.Dot(l,s)*o,h<0)?null:(p=t.direction.clone(),p.normalize(),new n.IntersectionInfo(f,e,h))},i.ToColor3=function(n){return n?new BABYLON.Color3(n.r,n.g,n.b):null},i.ToColor4=function(n){return n?new BABYLON.Color4(n.r,n.g,n.b,n.a):null},i.BLy=n.Vector3.Zero(),i.BKk=n.Vector3.Zero(),i}();n.VectorHelper=u}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function n(n,t){this._strideSize=0;this.BKl=0;this._strideSize=t;this.BKl=Math.floor(n.length/this._strideSize);this._data=n}return Object.defineProperty(n.prototype,"length",{get:function(){return this.BKl},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),n.prototype.getAt=function(n){return this.getElemAt(n*this._strideSize)},n.prototype.getToRef=function(n,t){return this.elemToRef(n*this._strideSize,t)},n.prototype.setAt=function(n,t){this.setElemAt(n*this._strideSize,t)},n.prototype.getElemAt=function(){return null},n.prototype.elemToRef=function(){},n.prototype.setElemAt=function(){},n.prototype.toElementArray=function(){var t=[],i,n;if(this._data)for(i=this.length,n=0;n<i;n++)t.push(this.getAt(n));return t},n}(),i,r,e,u,f,o;n.FloatTypeArrayBase=t;i=function(t){function i(n){return t.call(this,n,3)||this}return __extends(i,t),i.Create=function(n){return new i(new Float32Array(n*3))},i.prototype.clone=function(){return new i(new Float32Array(this._data.buffer.slice(0)))},i.prototype.getElemAt=function(t){return new n.Vector3(this._data[t],this._data[t+1],this._data[t+2])},i.prototype.setElemAt=function(n,t){this._data[n]=t.x;this._data[n+1]=t.y;this._data[n+2]=t.z},i.prototype.elemToRef=function(n,t){t.x=this._data[n];t.y=this._data[n+1];t.z=this._data[n+2]},i}(t);n.Vector3Array=i;r=function(t){function i(n){return t.call(this,n,2)||this}return __extends(i,t),i.Create=function(n){return new i(new Float32Array(n*2))},i.prototype.clone=function(){return new i(new Float32Array(this._data.buffer.slice(0)))},i.prototype.getElemAt=function(t){return new n.Vector2(this._data[t],this._data[t+1])},i.prototype.setElemAt=function(n,t){this._data[n]=t.x;this._data[n+1]=t.y},i.prototype.elemToRef=function(n,t){t.x=this._data[n];t.y=this._data[n+1]},i}(t);n.Vector2Array=r;e=function(t){function i(n){return t.call(this,n,8)||this}return __extends(i,t),i.Create=function(n){return new i(new Float32Array(n*8))},i.prototype.clone=function(){return new i(new Float32Array(this._data.buffer.slice(0)))},i.prototype.getElemAt=function(t){return new n.Vertex3(this._data[t],this._data[t+1],this._data[t+2],this._data[t+3],this._data[t+4],this._data[t+5],this._data[t+6],this._data[t+7])},i.prototype.setElemAt=function(n,t){this._data[n]=t.x;this._data[n+1]=t.y;this._data[n+2]=t.z;this._data[n+3]=t.nx;this._data[n+4]=t.ny;this._data[n+5]=t.nz;this._data[n+6]=t.u;this._data[n+7]=t.v},i.prototype.elemToRef=function(n,t){t.x=this._data[n];t.y=this._data[n+1];t.z=this._data[n+2];t.nx=this._data[n+3];t.ny=this._data[n+4];t.nz=this._data[n+5];t.u=this._data[n+6];t.v=this._data[n+7]},i.prototype.getPosition=function(t){var i=t*this._strideSize;return new n.Vector3(this._data[i],this._data[i+1],this._data[i+2])},i.prototype.getPositionToRef=function(n,t){var i=n*this._strideSize;t.x=this._data[i];t.y=this._data[i+1];t.z=this._data[i+2]},i.prototype.setPosition=function(n,t){var i=n*this._strideSize;this._data[i]=t.x;this._data[i+1]=t.y;this._data[i+2]=t.z},i.prototype.setHeight=function(n,t){this._data[n*this._strideSize+1]=t},i.prototype.getTextureCoord=function(t){var i=t*this._strideSize;return new n.Vector2(this._data[i+6],this._data[i+7])},i.prototype.getTextureCoordToRef=function(n,t){var i=n*this._strideSize;t.x=this._data[i+6];t.y=this._data[i+7]},i.prototype.setTextureCoord=function(n,t){var i=n*this._strideSize;this._data[i+6]=t.x;this._data[i+7]=t.y},i}(t);n.Vertex3Array=e;u=function(){function n(n,t){this._strideSize=0;this.BKl=0;this._strideSize=t;this.BKl=Math.floor(n.length/this._strideSize);this._data=n}return Object.defineProperty(n.prototype,"length",{get:function(){return this.BKl},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),n.prototype.getAt=function(n){return this.getElemAt(n*this._strideSize)},n.prototype.setAt=function(n,t){this.setElemAt(n*this._strideSize,t)},n.prototype.getToRef=function(n,t){return this.elemToRef(n*this._strideSize,t)},n.prototype.getElemAt=function(){return null},n.prototype.elemToRef=function(){},n.prototype.setElemAt=function(){},n.prototype.toElementArray=function(){var t=[],i,n;if(this._data)for(i=this.length,n=0;n<i;n++)t.push(this.getAt(n));return t},n}();n.IntTypeArrayBase=u;f=function(t){function i(n){return t.call(this,n,3)||this}return __extends(i,t),i.Create=function(n){return new i(new Int32Array(n*3))},i.prototype.clone=function(){return new i(new Int32Array(this._data.buffer.slice(0)))},i.prototype.getElemAt=function(t){return new n.Triangle3(this._data[t],this._data[t+1],this._data[t+2])},i.prototype.setElemAt=function(n,t){this._data[n]=t.v0;this._data[n+1]=t.v1;this._data[n+2]=t.v2},i.prototype.elemToRef=function(n,t){t.v0=this._data[n];t.v1=this._data[n+1];t.v2=this._data[n+2]},i.prototype.reverseTriangleOrder=function(){for(var i,t=this._data,r=t.length,n=0;n<r;n+=3)i=t[n+2],t[n+2]=t[n+1],t[n+1]=i},i}(u);n.Triangle3Array=f;o=function(){function n(){}return n.Vector3ToFloat=function(n){for(var r,u,f=n.length,t=new Float32Array(f*3),i=0;i<f;i++)r=i*3,u=n[i],t[r]=u.x,t[r+1]=u.y,t[r+2]=u.z;return t},n.Vector2ToFloat=function(n){for(var r,u,f=n.length,i=new Float32Array(f*2),t=0;t<f;t++)r=t*2,u=n[t],i[r]=u.x,i[r+1]=u.y;return i},n.Vertex3ToFloat=function(n){for(var i,r,f=n.length,t=new Float32Array(f*8),u=0;u<f;u++)i=u*8,r=n[u],t[i]=r.x,t[i+1]=r.y,t[i+2]=r.z,t[i+3]=r.nx,t[i+4]=r.ny,t[i+5]=r.nz,t[i+6]=r.u,t[i+7]=r.v;return t},n.ToVector3Array=function(n){for(var r=n.length,u=i.Create(r),t=0;t<r;t++)u.setAt(t,n[t]);return u},n.ToVector2Array=function(n){for(var i=n.length,u=r.Create(i),t=0;t<i;t++)u.setAt(t,n[t]);return u},n.JoinFloat32Arrays=function(n){var i,r,u,t,f;if(n.length===1)return n[0];for(i=0,t=0;t<n.length;t++)i+=n[t].length;for(r=new Float32Array(i),u=0,t=0;t<n.length;t++)f=n[t],r.set(f,u),u+=f.length;return r},n.JoinInt32Arrays=function(n){var i,r,u,t,f;if(n.length===1)return n[0];for(i=0,t=0;t<n.length;t++)i+=n[t].length;for(r=new Int32Array(i),u=0,t=0;t<n.length;t++)f=n[t],r.set(f,u),u+=f.length;return r},n.JoinNumberArrays=function(n){var r,f,t,u,i;if(n.length===1)return n[0];for(r=[],f=0,t=0;t<n.length;t++)for(u=n[t],i=0;i<u.length;i++)r.push(u[i]);return r},n.AddIntValue=function(n,t){for(var i=0;i<n.length;i++)n[i]+=t},n.CreateJoinTriangleIndiceArrays=function(n){for(var u,i,r,f=0,t=0;t<n.length;t++)f+=n[t].length;for(u=new Int32Array(f),i=0,t=0;t<n.length;t++)r=n[t].slice(0),this.AddIntValue(r,i/3),u.set(r,i),i+=r.length;return u},n.GetTrianglePoints=function(t,r){var u=i.Create(r.length*3);return n.GetTrianglePointsDirect(t.data,r.data,u.data),u},n.GetTrianglePointsDirect=function(n,t,i,r){var c;r===void 0&&(r=0);var l=Math.floor(t.length/3),h=0,e,o,s,f=r;for(c=0;c<l;c++){var a=t[h],v=t[h+1],y=t[h+2],u=a*3;e=n[u];o=n[u+1];s=n[u+2];i[f++]=e;i[f++]=o;i[f++]=s;u=v*3;e=n[u];o=n[u+1];s=n[u+2];i[f++]=e;i[f++]=o;i[f++]=s;u=y*3;e=n[u];o=n[u+1];s=n[u+2];i[f++]=e;i[f++]=o;i[f++]=s;h=h+3}},n.ToTriangleArray=function(n,t){var e=Math.floor(n.length/3),o=f.Create(e),r=o.data,i,u;if(t)for(i=0,u=0;u<e;u++)r[i]=n[i],r[i+1]=n[i+2],r[i+2]=n[i+1],i+=3;else r.set(n);return o},n}();n.TypeArrayHelper=o}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var a=function(){function n(n){this.matrix=n;this.BHo=n.clone();this.BHo.invertInPlace()}return n.prototype.project=function(n){return this.matrix.transform(n)},n.prototype.unproject=function(n){return this.BHo.transform(n)},n}(),e,o,t,h,c,s;n.Matrix2Projection=a;e=function(){function i(){}return i.NearEqual=function(n,i,r){return r===void 0&&(r=1e-13),t.NearEqual(n.x,i.x,r)&&t.NearEqual(n.y,i.y,r)},i.NearEqualNumber=function(n,i,r){return r===void 0&&(r=1e-13),t.NearEqual(n,i,r)},i.NearEqualRect=function(n,i,r){return r===void 0&&(r=1e-13),t.NearEqual(n.left,i.left,r)&&t.NearEqual(n.right,i.right,r)&&t.NearEqual(n.top,i.top,r)&&t.NearEqual(n.bottom,i.bottom,r)},i.Angle=function(n,t,i,r){var u=Math.atan2(r-t,i-n);return u>0?u:6.2831853071795862+u},i.AngleBetween=function(t,i){return n.Vector3.GetAngleBetweenVectors(new n.Vector3(t.x,0,t.y),new n.Vector3(i.x,0,i.y),new n.Vector3(0,-1,0))},i.Length=function(t){return n._Line2.CalcLength(t)},i.Area=function(t){return n._Ring2.Area(t)},i.AreaFromEdge=function(n,t,i){var r=(n+t+i)*.5,u=r*(r-n)*(r-t)*(r-i);return u<0?0:Math.sqrt(u)},i.Distance=function(n,t,i,r){return Math.sqrt((i-n)*(i-n)+(r-t)*(r-t))},i.DistancePoint=function(n,t){return i.Distance(n.x,n.y,t.x,t.y)},i.SquareDistance=function(n,t,i,r){return(i-n)*(i-n)+(r-t)*(r-t)},i.SquareDistancePoint=function(n,t){return i.SquareDistance(n.x,n.y,t.x,t.y)},i.DistancePointLine=function(t,i){return n._Line2.Distance(i,t)},i.DistanceLineLine=function(t,i){return n._Line2.DistanceLine(t,i)},i.CalcInnerPoint=function(t,i){var u,f,r;if(i.copyFrom(new n.Vector2),u=t.length,u<=2)return!1;if(f=n.Rect.CalcRange(t),i.copyFrom(new n.Vector2((f.left+f.right)/2,(f.top+f.bottom)/2)),n._Ring2.Contains(t,i))return!0;if(u>3){var e=u,o=n.SystemHelper.ToInt(e/4),s=n.SystemHelper.ToInt(e*3/4);if(i.x=(t[o].x+t[s].x)/2,i.y=(t[o].y+t[s].y)/2,n._Ring2.Contains(t,i))return!0}for(r=1;r<u-2;r++)if(i.x=t[r].x/2+t[r+1].x/4+t[r+2].x/4,i.y=t[r].y/2+t[r+1].y/4+t[r+2].y/4,n._Ring2.Contains(t,i))return!0;return!1},i.RectWithin=function(n,t,r){var u=r*r;return i.SquareDistance(n.left,n.top,t.x,t.y)<u&&i.SquareDistance(n.left,n.bottom,t.x,t.y)<u&&i.SquareDistance(n.right,n.top,t.x,t.y)<u&&i.SquareDistance(n.right,n.bottom,t.x,t.y)<u},i.RectContains=function(n,t){return t.left>=n.left&&t.top>=n.top&&t.right<=n.right&&t.bottom<=n.bottom},i.RectIntersects=function(n,t){return!n.isEmpty&&!t.isEmpty&&n.x<=t.right&&n.right>=t.x&&n.y<=t.bottom&&n.bottom>=t.y},i.RectIntersectsLine=function(t,i){return n._Line2.IntersectWithRect(i,t)},i.Intersects=function(t,i){return n._Line2.IntersectWith(t,i)},i.Overlaps=function(t,i){return n._Ring2.IntersectsWithPoly(t,i)},i.Contains=function(t,i){return n._Ring2.Contains(t,i)},i.ContainsLine=function(t,i){return n._Ring2.ContainsLine(t,i)},i.ContainsRect=function(t,i){return n._Ring2.ContainsRect(t,i)},i.IntersectOnePoint=function(t,i,r){return n._Line2.IntersectOnePoint(t,i,r)},i.IntersectLine=function(t,i){return n._Line2.CalcIntersectLines(t,i,1e-13,!1)},i.IntersectSegment=function(i,r,u,f,e,o,s,h,c){var l,a;if(c.copyFrom(new n.Vector2),Math.min(r,f)>Math.max(o,h)||Math.max(r,f)<Math.min(o,h)||Math.min(i,u)>Math.max(e,s)||Math.max(i,u)<Math.min(e,s))return!1;var y=u-i,p=f-r,w=s-e,k=h-o,nt=i-e,d=r-o,g=y*k-w*p;if(t.NearEqual(Math.abs(g),0,1e-13)){if(r!==f){if(t.NearEqual(0,y*w*d+y*k*e-w*p*i,1e-13))return!1}else if(t.NearEqual(i,e,1e-13))return!1;return!1}var tt=w*d-nt*k,it=y*d-nt*p,v=tt/g,b=it/g;return v>=0&&v<=1&&b>=0&&b<=1?(l=0,a=0,t.NearEqual(v,0,1e-13)?(l=i,a=r):t.NearEqual(v,1,1e-13)?(l=u,a=f):t.NearEqual(b,0,1e-13)?(l=e,a=o):t.NearEqual(b,1,1e-13)?(l=s,a=h):(l=i+v*y,a=r+v*p),c.copyFrom(new n.Vector2(l,a)),!0):!1},i.IntersectSegmentPoint=function(n,t,r,u,f){return i.IntersectSegment(n.x,n.y,t.x,t.y,r.x,r.y,u.x,u.y,f)},i.ClosestPoint=function(t,i){return n._Line2.ClosestPoint(t,i)},i.ClosestPointAdvance=function(t,i){return n._Line2.ClosestPointAdvance(t,i)},i.ClipLine=function(t,i){return n._Ring2.ClipLine(t,i)},i._ClipLineByRect=function(i,r){for(var f,e,h,s=[],c=r.length,u=[],o=0;o<c-1;o++)f=new n.Vector2,e=new n.Vector2,this.BFa(r[o],r[o+1],i,f,e)&&(u.length===0?(u.push(f),u.push(e)):(h=u[u.length-1],t.NearEqual(h.x-f.x,0,1e-13)&&t.NearEqual(h.y-f.y,0,1e-13)?u.push(e):(s.push(u),u=[],u.push(f),u.push(e))));return u.length>0&&s.push(u),s},i.BGm=function(t,r,u,f,e,o,s){var w;o.copyFrom(new n.Vector2(t,r));s.copyFrom(new n.Vector2(u,f));var c=new Array(4),h=0,a=e.x,v=e.y,y=e.x+e.width,p=e.y+e.height,l=new n.Vector2;if(i.IntersectSegment(t,r,u,f,a,v,a,p,l)&&(c[h]=l.clone(),h=h+1),i.IntersectSegment(t,r,u,f,a,p,y,p,l)&&(c[h]=l.clone(),h=h+1),i.IntersectSegment(t,r,u,f,y,p,y,v,l)&&(c[h]=l.clone(),h=h+1),i.IntersectSegment(t,r,u,f,y,v,a,v,l)&&(c[h]=l.clone(),h=h+1),h<=0)return!1;if(1===h)if(e.contains(new n.Vector2(t,r)))c[1]=new n.Vector2(t,r);else{if(!e.contains(new n.Vector2(u,f)))return!1;c[1]=new n.Vector2(u,f)}return o.copyFrom(c[0].clone()),s.copyFrom(c[1].clone()),((t-u)*(o.x-s.x)<0||(r-f)*(o.y-s.y)<0)&&(w=o.clone(),o.copyFrom(s.clone()),s.copyFrom(w.clone())),!0},i.BFa=function(t,i,r,u,f){var e=r.x,o=r.y,s=r.right,h=r.bottom,c=t.x>=e&&t.x<=s&&t.y>=o&&t.y<=h,l=i.x>=e&&i.x<=s&&i.y>=o&&i.y<=h,a=!1;if(c&&l&&(a=!0,u.copyFrom(t.clone()),f.copyFrom(i.clone())),!c&&!l){var v=Math.min(t.x,i.x),y=Math.min(t.y,i.y),p=Math.max(t.x,i.x),w=Math.max(t.y,i.y);if(e>p||s<v||o>w||h<y)return u.copyFrom(new n.Vector2),f.copyFrom(new n.Vector2),!1}return this.BGm(t.x,t.y,i.x,i.y,r,u,f)},i.MakePolyClose=function(t){return n._Ring2.MakePolyClose(t)},i.Buffer=function(n,t,i,u,f){return i===void 0&&(i=!0),u===void 0&&(u=!0),f===void 0&&(f=!1),r.Buffer(n,t,i,u,f)},i.BufferPoint=function(n,t){return r.BufferPoint(n,t)},i.BFR=57.295779513082323,i.BHG=1/i.BFR,i}();n.Math2=e;o=function(){function i(){}return i.NearEqual=function(n,t,i){return i===void 0&&(i=1e-9),Math.abs(n.x-t.x)<=i&&Math.abs(n.y-t.y)<=i&&Math.abs(n.z-t.z)<=i},i.NearZero=function(n,i){return i===void 0&&(i=t.EPSILON),Math.abs(n.x)<i&&Math.abs(n.y)<i&&Math.abs(n.z)<i},i.DistancePointLineAdvance=function(t,i,r){var u;if(!i)return 0;var f=17976931348623157e292,e=new n.Vector3,h=t;for(u=0;u<i.length-1;u++){var c=new n.Segment3(i[u],i[u+1]),o=new n.Vector3,s=n.Segment3.DistancePL2(h,c,o);s<f&&(f=s,e=o.clone())}return r.copyFrom(e),f},i.DistancePointLine=function(t,r){var u=new n.Vector3;return i.DistancePointLineAdvance(t,r,u)},i.DistanceLineLineAdvance=function(t,i,r){var e,o,u,s,f;if(r.value=[],!t||!i)return 0;for(e=17976931348623157e292,u=0;u<t.length-1;u++)for(s=new n.Segment3(t[u],t[u+1]),f=0;f<i.length-1;f++){var l=new n.Segment3(i[f],i[f+1]),h=new n.Segment3(n.Vector3.Zero(),n.Vector3.Zero()),c=n.Segment3.DistanceLL2(s,l,h);c<e&&(e=c,o=h)}return r.value.push(o.start),r.value.push(o.end),e},i.DistanceLineLine=function(t,r){var u=new n.RefValue(null);return i.DistanceLineLineAdvance(t,r,u)},i.DistancePoint=function(t,i){return n.Vector3.Distance(t,i)},i.Distance=function(n,t,i,r,u,f){return Math.sqrt((n-r)*(n-r)+(t-u)*(t-u)+(i-f)*(i-f))},i.Length=function(t){var r,u,i,f,e;if(!t)return 0;for(r=0,u=t.length,i=0;i<u-1;i++)f=t[i].clone(),e=t[i+1].clone(),r=r+n.Vector3.Distance(f,e);return r},i.Angle=function(t,i,r){return r||(r=n.Vector3.UpReadOnly),n.Vector3.GetAngleBetweenVectors(t,i,r)},i.Area=function(t){var f,r,u;if(!t)return 0;f=t.length;f=f*1;var h=0,e=new n.Vector3,o=new n.Vector3,s=new n.Vector3;for(r=0;r<f;r=r+3){var c=t[r].clone(),l=t[r+1].clone(),a=t[r+2].clone();e.x=c.x;e.y=c.y;e.z=c.z;o.x=l.x;o.y=l.y;o.z=l.z;s.x=a.x;s.y=a.y;s.z=a.z;h=h+i.BHr(e,o,s)*.5}return u=1,u=u*u,h*u},i.BHr=function(t,i,r){var u=i.subtract(t),f=r.subtract(t);return n.Vector3.Cross(u,f).length()},i.PolygonToTriangles=function(n,t){return t===void 0&&(t=null),w.PolygonToTriangles(n,t)},i.Spline=function(n,t,i){if(i===void 0&&(i=!1),!n)return null;t>50&&(t=50);var r=BABYLON.Curve3.CreateCatmullRomSpline(n,t,i);return r.getPoints()},i._MakeTriangleNormalUp=function(t){for(var i=[],r=0;r<t.length;r=r+3){var u=t[r].clone(),f=t[r+1].clone(),e=t[r+2].clone(),o=n.Vector3.Dot(n.Vector3.Cross(e.subtract(u),f.subtract(u)),u);o<0?(i.push(u),i.push(f),i.push(e)):(i.push(e),i.push(f),i.push(u))}return i},i._IntersectSphere=function(n,t,i,r,u,f,e,o){var s=0,h=0,g,nt;n===r?h=s=0:(s=(u-t)/(r-n),h=(f-i)/(r-n));var tt=t*t,it=i*i,ft=u*u,et=f*f,a=s*s+h*h,y=2*s*t+2*h*i,rt=tt+it-e*e,c=1+a,v=y-2*a*n,ut=a*n*n-y*n+rt,p=(v*v-4*c*ut)/(4*c*c);if(p<0)return!1;var w=Math.sqrt(p),b=v/(2*c),k=w-b,d=-w-b,l=0;return l=Math.abs(n-k)<Math.abs(n-d)?k:d,g=s*(l-n)+t,nt=h*(l-n)+i,o.x=l,o.y=g,o.z=nt,!0},i.IntersectRay=function(t,r,u,f){var y=n.SystemHelper.ToInt(t.length/3),a,e,h,c,l,s,v;if(y<=0)return!1;var b=new n.Segment3(new n.Vector3(r.x,r.y,r.z),new n.Vector3(u.x,u.y,u.z)),p=17976931348623157e292,w=!1,o=0;for(a=0;a<y;a++)e=t[o].clone(),h=new n.Vector3,h.x=e.x,h.y=e.y,h.z=e.z,o=o+1,e=t[o].clone(),c=new n.Vector3,c.x=e.x,c.y=e.y,c.z=e.z,o=o+1,e=t[o].clone(),l=new n.Vector3,l.x=e.x,l.y=e.y,l.z=e.z,o=o+1,s=new n.Vector3,b.intersectsTriangle(h,c,l,s)&&(v=i.Distance(r.x,r.y,r.z,s.x,s.y,s.z),v<p&&(f.x=s.x,f.y=s.y,f.z=s.z,p=v,w=!0));return w},i.IntersectRayIndexed=function(t,r,u,f,e){var p=n.SystemHelper.ToInt(r.length/3),v,o,c,l,a,s,y;if(p<=0)return!1;var k=new n.Segment3(new n.Vector3(u.x,u.y,u.z),new n.Vector3(f.x,f.y,f.z)),w=17976931348623157e292,b=!1,h=0;for(v=0;v<p;v++)o=t[r[h]],c=new n.Vector3,c.x=o.x,c.y=o.y,c.z=o.z,o=t[r[h+1]],l=new n.Vector3,l.x=o.x,l.y=o.y,l.z=o.z,o=t[r[h+2]],a=new n.Vector3,a.x=o.x,a.y=o.y,a.z=o.z,h=h+3,s=new n.Vector3,k.intersectsTriangle(c,l,a,s)&&(y=i.Distance(u.x,u.y,u.z,s.x,s.y,s.z),y<w&&(e.x=s.x,e.y=s.y,e.z=s.z,w=y,b=!0));return b},i._RotateVector=function(t,i){var r=new n.Quaternion(i.x,i.y,i.z,0),u=new n.Quaternion(-t.x,-t.y,-t.z,t.w);return r=t.multiply(r),r=r.multiply(u),new n.Vector3(r.x,r.y,r.z)},i.Buffer=function(t,u,f,e,o){var a,s,c,h,l,v;if(f===void 0&&(f=!0),e===void 0&&(e=!0),o===void 0&&(o=!1),a=n.VectorHelper.ToVector2Array(t),s=r.Buffer(a,u,f,e,o),!s)return[];if(c=n.VectorHelper.ToVector3Array(s),s&&s.length>0)for(h=0;h<s.length;h++)l=c[h],v=i.BHY(t,l),l.y=t[v].y;return c},i.BHY=function(n,t){for(var r,u,f=Number.MAX_VALUE,o=0,i=0;i<n.length;i++)r=n[i],u=e.SquareDistance(r.x,r.z,t.x,t.z),u<f&&(o=i,f=u);return o},i._X=0,i._Y=1,i._Z=2,i}();n.Math3=o;t=function(){function t(){}return t.Barycentric=function(n,t,i,r,u){return n+(t-n)*r+(i-n)*u},t.CatmullRom=function(n,t,i,r,u){var f=u*u,e=f*u;return.5*(2*t+(i-n)*u+(2*n-5*t+4*i-r)*f+(3*t-n-3*i+r)*e)},t.Clamp=function(n,t,i){return n=n>i?i:n,n<t?t:n},t.Distance=function(n,t){return Math.abs(n-t)},t.Hermite=function(n,t,i,r,u){var f=u*u*u,e=u*u;return u===0?n:u===1?i:(2*n-2*i+r+t)*f+(3*i-3*n-2*t-r)*e+t*u+n},t.Lerp=function(n,t,i){return n+(t-n)*i},t.ToDegrees=function(n){return n*57.295779513082323},t.ToRadians=function(n){return n*.017453292519943295},t.WrapAngle=function(n){return n=n%6.2831854820251465,n<=-3.14159274?n=n+6.28318548:n>3.14159274&&(n=n-6.28318548),n},t.IntPowOfTwo=function(n){return 1<<n},t.DegreeFromDegree=function(t){return n.SystemHelper.ToInt(t)},t.MinuteFromDegree=function(t){var i=t-n.SystemHelper.ToInt(t);return n.SystemHelper.ToInt(i*60)},t.SecondFromDegree=function(i){return n.SystemHelper.ToInt(t.FloatSecondFromDegree(i))},t.FloatSecondFromDegree=function(t){var i=n.SystemHelper.ToInt(t),r=n.SystemHelper.ToInt((t-i)*60),u=(t-i)*60-r;return u*60},t.DegreeFromDMS=function(n,t,i){return n+t/60+i/3600},t._Log10=function(n){return Math.log(n)/Math.LN10},t.Sign=function(n){return n<0?-1:n>0?1:0},t.NearEqual=function(n,t,i){return i===void 0&&(i=1e-13),Math.abs(n-t)<=i},t.NearZero=function(n,t){return t===void 0&&(t=1e-13),Math.abs(n)<=t},t.EPSILON=1e-9,t}();n.MathHelper=t;h=function(){function t(){this.AE=[];this.BHw=n.Matrix.FromValues(2,-2,1,1,-3,3,-2,-1,0,0,1,0,1,0,0,0)}return t.prototype.clear=function(){this.AE=[];this.BIF=null},t.prototype.addControlPoint=function(t){this.AE.push(new n.Vector3(t.x,t.y,t.z))},t.prototype.setControlPoints=function(t,i){var r,u;for(n.ArrayHelper.Clear(this.AE),r=0;r<t.length;r++)u=t[r].clone(),this.AE.push(new n.Vector3(u.x,u.y,u.z));i&&this.AE.push(this.AE[0]);this.recalcTangents()},t.prototype.interpolate=function(n,t,i){return(i===void 0&&(i=0),arguments.length===1&&(!n||n.constructor===Number))?this.BIR(n):this.BEh(n,t,i)},t.prototype.BIR=function(t){var i=t*(this.AE.length-1),r=n.SystemHelper.ToInt(i);return t=i-r,this.interpolate(r,t,0)},t.prototype.BGc=function(t){return new n.Vector3(t.x,t.y,t.z)},t.prototype.BEh=function(t,i,r){if(t+1>=this.AE.length)return this.BGc(this.AE[this.AE.length-1]);if(i===0)return this.BGc(this.AE[t]);if(i===1)return this.BGc(this.AE[t+1]);var u=this.AE[t],f=this.AE[t+1],e=this.BIF[t].clone(),o=this.BIF[t+1].clone();if(r>0&&Math.abs(u.x-f.x)<r&&Math.abs(u.y-f.y)<r&&Math.abs(u.z-f.z)<r)return this.BGc(u.add(f.subtract(u).scale(i)));var h=i*i,c=h*i,l=new n.Vector4(c,h,i,1),a=this.BHw.multiply(n.Matrix.FromValues(u.x,u.y,u.z,1,f.x,f.y,f.z,1,e.x,e.y,e.z,1,o.x,o.y,o.z,1)),s=n.Vector4.TransformNormal(l,a);return new n.Vector3(s.x,s.y,s.z)},t.prototype.recalcTangents=function(){var t=this.AE.length,i,n;if(t>=2)for(i=this.AE[0].equals(this.AE[t-1]),this.BIF=new Array(t),n=0;n<t;n++)this.BIF[n]=n===0?i?this.AE[1].subtract(this.AE[t-2]).scale(.5):this.AE[1].subtract(this.AE[0]).scale(.5):n===t-1?i?this.BIF[0].clone():this.AE[n].subtract(this.AE[n-1]).scale(.5):this.AE[n+1].subtract(this.AE[n-1]).scale(.5)},t.prototype.getAllInterpolatePoints=function(n,t){var u,i,r,f;for(t===void 0&&(t=50),n.value=[],t<=4&&(t=4),u=1/t,i=0;i<=this.AE.length-1;i++)for(r=0;r<t;r++)f=this.interpolate(i,r*u,0),n.value.push(f);return!0},t}();n._Spline3=h;c=function(){function t(i,r,u){var s,o;r===void 0&&(r=1e6);u===void 0&&(u=null);this.BIN=1e3;this.BHd=new n.Vector2;this.BHX=0;this.BGy=0;this.BIN=r;var f=new n.RefValue(0),e=new n.RefValue(0),h=new n.RefValue(0),c=new n.RefValue(0);t.BHJ(i,0,i.length,f,e,h,c);u&&(f.value=u.x,e.value=u.y);this.BHd=new n.Vector2(f.value,e.value);var l=h.value-f.value,a=c.value-e.value,v=Math.max(l,a);for(this.BHX=this.BIN/v,this.BGy=1/this.BHX,s=[],o=0;o<i.length;o++)s.push(this.BGo(i[o]));this.AE=s}return Object.defineProperty(t.prototype,"basePoint",{get:function(){return this.BHd.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"relativePoints",{get:function(){return this.AE},enumerable:!1,configurable:!0}),t.prototype.relativeToAbsolutArray=function(n){for(var i=[],t=0;t<n.length;t++)i.push(this.BFo(n[t]));return i},t.prototype.absolutToRelativeArray=function(n){for(var i=[],t=0;t<n.length;t++)i.push(this.BGo(n[t]));return i},t.prototype.BGo=function(t){var i=t.x,r=t.y;return i=(i-this.BHd.x)*this.BHX,r=(r-this.BHd.y)*this.BHX,new n.Vector2(i,r)},t.prototype.BFo=function(t){var i=t.x,r=t.y;return i=i*this.BGy+this.BHd.x,r=r*this.BGy+this.BHd.y,new n.Vector2(i,r)},t.BHJ=function(n,t,i,r,u,f,e){r.value=u.value=17976931348623157e292;f.value=e.value=-17976931348623157e292;i=Math.min(n.length,t+i);for(var o=t;o<i;o++)r.value=Math.min(r.value,n[o].x),u.value=Math.min(u.value,n[o].y),f.value=Math.max(f.value,n[o].x),e.value=Math.max(e.value,n[o].y)},t}();s=function(){function t(){}return t.PolygonToTriangle=function(n,t){var i,u,r,f;t===void 0&&(t=null);try{if(i=new poly2tri.SweepContext(n,{cloneArrays:!0}),t)for(u=t.length,r=0;r<u;r++)i.addHole(t[r]);return i.triangulate(),f=i.getTriangles(),this.BGl(f)}catch(e){return null}},t.BGl=function(t){for(var i,r=[],u=0;u<t.length;u++)i=t[u].getPoints(),r.push(new n.Vector2(i[0].x,i[0].y)),r.push(new n.Vector2(i[1].x,i[1].y)),r.push(new n.Vector2(i[2].x,i[2].y));return r},t}();n._TriangulationUtil=s;var v=function(){function n(n,t){this.X=n;this.Y=t}return n}(),u=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(Array),l=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(Array),i=function(){function t(i,r){var f,e;if(r===void 0&&(r=null),this.basePt=new n.Vector2,this.points=new u,i.length>0)for(this.basePt=r?r:i[0].clone(),f=0;f<i.length;f++)e=i[f].clone(),this.points.push(t.BDN(e,this.basePt.x,this.basePt.y))}return t.ToPoints=function(n,i){for(var f,u=[],r=0;r<n.length;r++)f=n[r],u.push(t.BHW(f,i.x,i.y));return u},t.prototype.toIntLength=function(n){return n*1e9},t.BDN=function(t,i,r){i===void 0&&(i=0);r===void 0&&(r=0);var u=n.SystemHelper.ToInt((t.x-i)*1e9),f=n.SystemHelper.ToInt((t.y-r)*1e9);return new v(u,f)},t.BHW=function(t,i,r){i===void 0&&(i=0);r===void 0&&(r=0);var u=t.X,f=t.Y;return u=u*1e-9,f=f*1e-9,u=u+i,f=f+r,new n.Vector2(u,f)},t.BHM=1e9,t.BFF=1e-9,t}(),f=function(){function n(){}return n.ClipPolygon=function(t,r,f){var e,v;if(f.value=[],t.length>=3&&r.length>=3){var h=new u,c=new u,o=new l,s=new i(t,null),a=new i(r,s.basePt);n.BGv(h,s.points);n.BGv(c,a.points);e=new ClipperLib.Clipper;e.AddPath(h,ClipperLib.PolyType.ptSubject,!0);e.AddPath(c,ClipperLib.PolyType.ptClip,!0);e.Execute(ClipperLib.ClipType.ctIntersection,o,ClipperLib.PolyFillType.pftEvenOdd,ClipperLib.PolyFillType.pftEvenOdd);v=o.length;f.value=n.BHh(o,s.basePt)}},n.BGv=function(n,t){for(var i=0;i<t.length;i++)n.push(t[i])},n.BHh=function(n,t){var u=[],e,r,f,o;if(n.length>0)if(n[0].length)for(e=n.length,r=0;r<e;r++)f=n[r],o=f.length,o>0&&u.push(i.ToPoints(f,t));else u.push(i.ToPoints(n,t));return u},n.Buffer=function(t,r,f,e,o){var c=[],a,s,p,w,v,y,h;return r<=0||!t?c:o&&t.length<3?c:t.length<2?c:(a=new u,s=new i(t,null),n.BGv(a,s.points),p=o?ClipperLib.EndType.etClosedPolygon:e?ClipperLib.EndType.etOpenRound:ClipperLib.EndType.etOpenButt,w=f?ClipperLib.JoinType.jtRound:ClipperLib.JoinType.jtSquare,v=s.toIntLength(r),y=new ClipperLib.ClipperOffset(2,v/500),y.AddPath(a,w,p),h=new l,function(){var n=[h],t=y.Execute(n,v);return h=n[0],t}(),n.BHh(h,s.basePt))},n.BBM=500,n}();n._ClipperLibUtil=f;var y=function(){function t(t,i){var f,r,u;if(i===void 0&&(i=null),this.BHy=[],this.BGq=[],n.ArrayHelper.AddRange(this.BHy,t),this.BGq.push(t.length),i)for(f=i.length,r=0;r<f;r++)u=i[r],u&&(n.ArrayHelper.AddRange(this.BHy,u),this.BGq.push(u.length))}return Object.defineProperty(t.prototype,"allPoints",{get:function(){return this.BHy},enumerable:!1,configurable:!0}),t.prototype.extractPoly2=function(n,t){var i,u,f,r,e;if(t.value=null,n.length!==this.BHy.length||this.BGq.length<=0)return null;if(i=0,u=this.BGu(n,i,this.BGq[0]),i=i+u.length,this.BGq.length>1){for(f=[],r=1;r<this.BGq.length;r++)e=this.BGu(n,i,this.BGq[r]),i=i+e.length,f.push(e);t.value=f}return u},t.prototype.BGu=function(n,t,i){for(var u=[],r=0;r<i;r++)u.push(n[t+r]);return u},t}(),p=function(){function t(t,i){var r,u,f;for(this.BHn=new n.Dictionary,this.YV=i,this.BGE=t,r=0;r<i.length;r++)u=i[r].clone(),f=this.BIM(u.x,u.y),this.BHn.add(f,t[r].y)}return t.prototype.BIM=function(t,i){var r=n.SystemHelper.ToInt(t/2).toString(),u=n.SystemHelper.ToInt(i/2).toString();return r+"_"+u},t.prototype.BIX=function(n,t,i,r,u){var s,e;for(r.value=0,u.value=0,s=n.length,e=0;e<s-1;e++){var f=n[e].clone(),o=n[e+1].clone(),h=Math.min(f.x,o.x)-1,c=Math.min(f.y,o.y)-1,l=Math.max(f.x,o.x)+1,a=Math.max(f.y,o.y)+1;if(t>=h&&t<=l&&i>=c&&i<=a)return r.value=e,u.value=l-h>a-c?(t-f.x)/(o.x-f.x):(i-f.y)/(o.y-f.y),!0}return!1},t.prototype.matchHeight=function(t){var u=this.BIM(t.x,t.y),i,r;return this.BHn.containsKey(u)?this.BHn.getValue(u):(i=new n.RefValue(0),r=new n.RefValue(0),this.BIX(this.YV,t.x,t.y,i,r)?this.BGE[i.value].y+r.value*(this.BGE[i.value+1].y-this.BGE[i.value].y):void 0)},t}(),w=function(){function t(){}return t.PolygonToTriangles=function(i,u){var o,k,f;if(u===void 0&&(u=null),o=[],!i||i.length<=0)return null;var g=n.Box.CalcRange(i),h=g.radius*.0001,s=t.BGW(i,h);if(u=t.BIW(u,h),!s||s.length<3)return null;var l=new y(s,u),a=l.allPoints,nt=t.BIJ(a),v=new c(nt,1e7,null),w=v.relativePoints,tt=new p(a,w),b=new n.RefValue(null),it=l.extractPoly2(w,b),e=r.PolygonToTriangle(it,b.value);if(!e)return null;for(k=v.relativeToAbsolutArray(e),f=0;f<e.length;f++){var rt=e[f].clone(),ut=tt.matchHeight(rt),d=k[f].clone();o.push(new n.Vector3(d.x,ut,d.y))}return o},t.BIJ=function(t){return n.VectorHelper.ToVector2Array(t)},t.BEt=function(t){var i,r,u;if(!t||t.length<=0)return null;for(i=[],i.push(t[0]),r=t[0].clone(),u=1;u<t.length-1;u++){var f=t[u].clone(),e=t[u+1].clone(),s=n.Plane.FromPoints(new n.Vector3(r.x,r.y,r.z),new n.Vector3(f.x,f.y,f.z),new n.Vector3(e.x,e.y,e.z));o.NearZero(s.normal,1e-13)||(i.push(f),r=f.clone())}return i.push(t[t.length-1]),i},t.BGW=function(i,r){return i=n.VectorHelper.FilterDuplicatedVector3(i,r,!0),t.BEt(i)},t.BIW=function(n,i){var e,f,r,u;if(!n)return null;for(e=n.length,f=[],r=0;r<e;r++)u=t.BGW(n[r],i),u&&u.length>=3&&f.push(u);return f},t.BHj=1e7,t}(),r=function(){function t(){}return t.IsClockwise=function(n){for(var r,t=0,i=0;i<n.length;i++)r=(i+1)%n.length,t=t+n[i].x*n[r].y,t=t-n[i].y*n[r].x;return t=t/2,t<0},t.IsClockwise3=function(n){for(var r,t=0,i=0;i<n.length;i++)r=(i+1)%n.length,t=t+n[i].x*n[r].z,t=t-n[i].z*n[r].x;return t=t/2,t<0},t.ToClockwise=function(n){return t.IsClockwise(n)?n:n.reverse()},t.ToCounterClockwise=function(n){return t.IsClockwise(n)?n.reverse():n},t.ToClockwise3=function(n){return t.IsClockwise3(n)?n:n.reverse()},t.ToCounterClockwise3=function(n){return t.IsClockwise3(n)?n.reverse():n},t.ClipPolygon=function(i,r){var u=new n.RefValue([]);try{f.ClipPolygon(t.ToClockwise(i),t.ToClockwise(r),u)}catch(e){if(!(e instanceof n.Exception))throw e;}return u.value},t.PolygonToTriangle=function(n,i){i===void 0&&(i=null);try{return s.PolygonToTriangle(t.ToClockwise(n),i)}catch(r){if(r.constructor!==Object)throw r;}return null},t.BufferPoint=function(t,i){var r,e,u;try{if(r=[],r.push(t),e=i*.0001,r.push(new n.Vector2(t.x+e,t.y)),u=f.Buffer(r,i,!0,!0,!1),u.length>0)return u[0]}catch(o){if(o.constructor!==Object)throw o;}return null},t.Buffer=function(n,i,r,u,e){try{n=t.BHi(n,i*.1);var o=f.Buffer(n,i,r,u,e);if(o.length>0)return o[0]}catch(s){if(s.constructor!==Object)throw s;}return null},t.BHi=function(t,i){var f,e,u,r,o;if(i===void 0&&(i=1e-9),f=[],e=t.length,e>0){for(u=t[0].clone(),f.push(u),r=new n.Vector2,o=1;o<e;o++)r=t[o].clone(),(Math.abs(r.x-u.x)>i||Math.abs(r.y-u.y)>i)&&(f.push(r),u=r.clone());r=t[e-1].clone();u=t[0].clone();Math.abs(r.x-u.x)<=i&&Math.abs(r.y-u.y)<=i&&f.splice(f.length-1,1)}return f},t}();n.PolygonMath=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var h=function(){function t(){}return t.prototype.compare=function(t,i){return n.g_compareTo(t.no,i.no)},t}(),t,i,r,u,f,e,o,s;n.INoObjectComparer=h;t=function(t){function i(){var n=t.call(this)||this;return n.BIS=0,n}return __extends(i,t),Object.defineProperty(i.prototype,"no",{get:function(){return this.BIS},set:function(n){(this.BIS===0||n===0)&&(this.BIS=n)},enumerable:!1,configurable:!0}),i.prototype.compareTo=function(t){return n.g_compareTo(this.BIS,t.BIS)},i.EmptyNo=0,i}(n.TObject);n.ImmutableNoObject=t;i=function(n){function t(){var t=n.call(this)||this;return t.isPickable=!0,t.BHZ=!1,t}return __extends(t,n),Object.defineProperty(t.prototype,"layerName",{get:function(){return""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPicked",{get:function(){return this.BHZ},set:function(n){var t=this.BHZ!==n;if(this.BHZ=n,t)this.onIsPickedChanged(this.BHZ)},enumerable:!1,configurable:!0}),t.prototype.onIsPickedChanged=function(){},t}(t);n.PickableObject=i;r=function(){function n(n){n===void 0&&(n="");this.name=n}return n.ToNames=function(n){var i=[],t,r;if(n)for(t=0;t<n.length;t++)r=n[t],i.push(r.name);return i},n}();n.NameObject=r;u=function(){function t(){this.onAdd=new n.Observable;this.onRemove=new n.Observable;this.NG=[]}return Object.defineProperty(t.prototype,"length",{get:function(){return this.NG.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"names",{get:function(){for(var i,t=[],n=0;n<this.NG.length;n++)i=this.NG[n],t.push(i.name);return t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"objects",{get:function(){return n.ArrayHelper.CreateEnumerator(this.NG)},enumerable:!1,configurable:!0}),t.prototype.getAt=function(t){return t>=0&&t<this.NG.length?this.NG[t]:n.SystemHelper.NullObject()},t.prototype.initFromList=function(n){this.NG=n},t.prototype.getEnumerator=function(){return n.ArrayHelper.CreateEnumerator(this.NG).getEnumerator()},t.prototype.getByName=function(t){var i=this.indexFromName(t);return i>=0?this.getAt(i):n.SystemHelper.NullObject()},t.prototype.indexFromName=function(n){for(var i,t=0;t<this.NG.length;t++)if(i=this.NG[t],i&&i.name===n)return t;return-1},t.prototype.add=function(t){if(t){t.name||(t.name="Temp"+n.NumberHelper.ToString(this.NG.length));var i=this.indexFromName(t.name);return i<0?(this.NG.push(t),this.onAdd.notifyObservers(t),!0):!1}},t.prototype.insertAt=function(t,i){var u,r;return t<0||t>this.NG.length?!1:(u=!1,i&&(r=i.name,r=n.TString.Trim(r),r!==""&&(this.NG.splice(t,0,i),this.onAdd.notifyObservers(i),u=!0)),u)},t.prototype.removeAt=function(n){if(n>=0&&n<this.NG.length){var t=this.NG[n];this.NG.splice(n,1);this.onRemove.notifyObservers(t)}},t.prototype.clear=function(){n.ArrayHelper.Clear(this.NG)},t.prototype.remove=function(n){if(n){var t=this.indexFromName(n.name);t>=0&&this.removeAt(t)}},t}();n.NameObjectList=u;f=function(){function t(t){var i,r;if(this.BKP=new n.Dictionary,t)for(i=0;i<t.length;i++)r=t[i],this.add(r)}return Object.defineProperty(t.prototype,"count",{get:function(){return this.BKP.count},enumerable:!1,configurable:!0}),t.prototype.getItem=function(t){return t?this.BKP.getValue(t):n.SystemHelper.NullObject()},Object.defineProperty(t.prototype,"names",{get:function(){return n.ArrayHelper.CreateEnumerator(this.BKP.keys)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"objects",{get:function(){return n.ArrayHelper.CreateEnumerator(this.BKP.values)},enumerable:!1,configurable:!0}),t.prototype.add=function(n){return n?this.contains(n.name)?!1:(this.BKP.add(n.name,n),!0):!1},t.prototype.remove=function(n){return arguments.length===1&&(!n||n.constructor===String)?this.BIl(n):this.BJj(n)},t.prototype.BIl=function(n){return!!n&&this.BKP.remove(n)},t.prototype.BJj=function(n){return n&&this.BKP.remove(n.name)},t.prototype.modify=function(n,t){return t?t.name!==n?!1:(this.BKP.add(n,t),!0):!1},t.prototype.clear=function(){this.BKP.clear()},t.prototype.contains=function(n){return!!n&&this.BKP.containsKey(n)},t}();n.NameObjectSet=f;e=function(){function t(){this.BJC=new n.Dictionary;this.BIi=new n.Dictionary}return t.prototype.BIV=function(n){var t=this.BIi.getValue(n);return t?t:(t=new o,this.BIi.add(n,t),t)},t.prototype.addSubObject=function(n,t,i){var r=this.BJC.getValue(i),u;r||(r=new s,this.BJC.add(i,r));r.add(n,t);u=this.BIV(n);u.addSubObject(t.no,i)},t.prototype.removeSubObjects=function(t){for(var o,h,s,r,u,e,c,a,f=new n.Dictionary,i=0;i<t.length;i++)if(e=t[i],o=this.BJC.getValue(e),o)for(h=o.keys,s=0;s<h.length;s++)r=h[s],u=f.getValue(r),u||(u=new n.HashSet,f.add(r,u)),u.add(n.SystemHelper.CastObject(o.getValue(r)));for(i=0;i<t.length;i++)e=t[i],this.BJC.remove(e);for(c=f.keys,i=0;i<c.length;i++){var r=c[i],v=this.BIV(r),u=f.getValue(r),l=u.getEnumerator();try{while(l.moveNext())a=l.current,v.adjustAfterSubDeleted(a.no,this.BJC)}finally{l.dispose()}}},t.prototype.removeGroupObject=function(n,t,i){var r,u,f,e,o;if(i===void 0&&(i=!1),r=this.groupToSub(n,t),i)this.removeSubObjects(r);else{for(u=0;u<r.length;u++)f=r[u],e=this.BJC.getValue(f),e.remove(n);o=this.BIV(n);o.remove(t.no)}},t.prototype.clear=function(){this.BJC.clear();this.BIi.clear()},t.prototype.groupToSub=function(n,t){var i=this.BIV(n);return i.getSubObjects(t.no)},t.prototype.subToGroup=function(t,i){var r=this.BJC.getValue(i);return r?n.SystemHelper.CastObject(r.getValue(t)):n.SystemHelper.NullObject()},t.prototype.containsGroup=function(n,t){var i=this.BIV(n);return i.containsKey(t.no)},t.prototype.containsSub=function(n,t){return this.BJC.containsKey(t)},t.prototype.enumGroupObjectNos=function(n){for(var u,f=this.BIV(n),i=[],r=f.keys,t=0;t<r.length;t++)u=r[t],i.push(u);return i},t}();n.ObjectGroupMapping=e;o=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.addSubObject=function(t,i){var r=n.prototype.getValue.call(this,t);r||(r=[],n.prototype.add.call(this,t,r));r.push(i)},t.prototype.getSubObjects=function(t){return n.prototype.getValue.call(this,t)},t.prototype.adjustAfterSubDeleted=function(t,i){var r,u,f,e;if(n.prototype.containsKey.call(this,t))if(r=n.prototype.getValue.call(this,t),r){for(u=[],f=0;f<r.length;f++)e=r[f],i.containsKey(e)&&u.push(e);u.length<=0?n.prototype.remove.call(this,t):u.length<r.length&&n.prototype.add.call(this,t,u)}else n.prototype.remove.call(this,t)},t}(n.Dictionary);s=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(n.Dictionary)}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(){}return t.LatitudePerMeter=function(){return t.BHO},t.LongitudePerMeter=function(i){var r=Math.cos(n.MathHelper.ToRadians(i));return r===0&&(r=1),t.BHO/r},t.DistancePoint=function(n,i){return t.Distance(n.x,n.y,i.x,i.y)},t.DistancePointLine=function(n,i){for(var f,e,r=17976931348623157e292,u=0;u<i.length;u++)f=i[u].clone(),e=t.Distance(n.x,n.y,f.x,f.y),e<r&&(r=e);return r},t.Distance=function(i,r,u,f){var e=n.MathHelper.ToRadians(r),o=n.MathHelper.ToRadians(f),s=n.MathHelper.ToRadians(Math.abs(i-u)),h=0,c,l;return h=r*f<0?Math.cos(e)*Math.cos(o)*Math.cos(s)-Math.sin(e)*Math.sin(o):Math.cos(e)*Math.cos(o)*Math.cos(s)+Math.sin(e)*Math.sin(o),c=Math.acos(h),l=t.EARTH_RADIUS*c,l},t.Length=function(n){for(var r=0,i=0;i<n.length-1;i++)r=r+t.Distance(n[i].x,n[i].y,n[i+1].x,n[i+1].y);return r},t.Area=function(i){var f;if(!i||i.length<3)return 0;var c=i.length,o=i[0].x,e=i[0].y,s=0;for(f=1;f<=c-2;f++){var r=i[f].clone(),u=i[f+1].clone(),l=(o*(r.y-u.y)+r.x*(u.y-e)+u.x*(e-r.y))*.5,a=t.Distance(o,e,r.x,r.y),v=t.Distance(o,e,u.x,u.y),y=t.Distance(r.x,r.y,u.x,u.y),h=n.Math2.AreaFromEdge(a,v,y);l<0&&(h=-h);s=s+h}return Math.abs(s)},t.Angle=function(t,i,r,u){var e=Math.cos(n.MathHelper.ToRadians(i)),f=Math.atan2(u-i,e*(r-t));return f>0?f:6.2831853071795862+f},t.Buffer=function(i,r,u,f,e){u===void 0&&(u=!0);f===void 0&&(f=!0);e===void 0&&(e=!1);var o=t._ProjectPointsIsoDistance(i[0],i),s=n.PolygonMath.Buffer(o,r,u,f,e);return t._UnProjectPointsIsoDistance(i[0],s)},t.BufferPoly=function(i,r){var u=t._ProjectPointsIsoDistance(i[0],i),f=n.PolygonMath.Buffer(u,r,!0,!0,!0);return t._UnProjectPointsIsoDistance(i[0],f)},t.BufferPoint=function(i,r){var u=[],f,e;return u.push(i),f=t._ProjectPointsIsoDistance(i,u)[0].clone(),e=n.PolygonMath.BufferPoint(f,r),t._UnProjectPointsIsoDistance(i,e)},t._ProjectPointsIsoDistance=function(i,r){var u;if(!r||r.length<=0)return null;var o=1/t.LongitudePerMeter(i.y),s=1/t.LatitudePerMeter(),f=[];for(u=0;u<r.length;u++){var e=r[u].clone(),h=e.x-i.x,c=e.y-i.y;f.push(new n.Vector2(h*o,c*s))}return f},t._UnProjectPointsIsoDistance=function(i,r){var u;if(!r||r.length<=0)return null;var o=t.LongitudePerMeter(i.y),s=t.LatitudePerMeter(),f=[];for(u=0;u<r.length;u++){var e=r[u].clone(),h=e.x,c=e.y;f.push(new n.Vector2(i.x+h*o,i.y+c*s))}return f},t.EARTH_RADIUS=6378137,t.BDs=t.EARTH_RADIUS*2*3.1415926535897931,t.BHO=360/t.BDs,t}(),r,i,u;n.EarthMath2=t;r=function(){function i(){}return i.DistancePointLineAdvance=function(t,r,u){t=i.EarthToWorld(t);r=i.EarthToWorldArray(r);var f=n.Math3.DistancePointLineAdvance(t,r,u);return u.copyFrom(i.WorldToEarth(u)),f},i.DistancePointLine=function(t,r){var u=new n.Vector3;return i.DistancePointLineAdvance(t,r,u)},i.DistanceLineLineAdvance=function(t,r,u){t=i.EarthToWorldArray(t);r=i.EarthToWorldArray(r);var f=n.Math3.DistanceLineLineAdvance(t,r,u);return u.value=n.ArrayHelper.CloneArray(i.WorldToEarthArray(u.value)),f},i.DistanceLineLine=function(t,r){if(!t||!r)return 0;var u=new n.RefValue(null);return i.DistanceLineLineAdvance(t,r,u)},i.Distance=function(t,r,u,f,e,o){var s=i.EarthToWorldDouble(t,r,u),h=i.EarthToWorldDouble(f,e,o);return n.Vector3.Distance(s,h)},i.DistancePoint=function(n,t){return i.Distance(n.x,n.y,n.z,t.x,t.y,t.z)},i.Length=function(t){return t?(t=i.EarthToWorldArray(t),n.Math3.Length(t)):0},i.Area=function(t){return t?(t=i.EarthToWorldArray(t),n.Math3.Area(t)):0},i._ProjectPointsIsoDistance=function(n,t){return i.BED(n,t,!0)},i._UnProjectPointsIsoDistance=function(n,t){return i.BED(n,t,!1)},i.BED=function(i,r,u){var o,s,e,h,f,c;if(!r||r.length<=0)return null;for(o=n.VectorHelper.ToVector2Array(r),s=new n.Vector2(i.x,i.z),e=u?t._ProjectPointsIsoDistance(s,o):t._UnProjectPointsIsoDistance(s,o),h=[],f=0;f<e.length;f++)c=new n.Vector3(e[f].x,r[f].y,e[f].y),h.push(c);return h},i._RotateMatrixLH=function(t){var i=n.Matrix.RotationAxis(new n.Vector3(0,1,0),n.MathHelper.ToRadians(-t.x)),r=n.Matrix.RotationAxis(new n.Vector3(1,0,0),n.MathHelper.ToRadians(t.z-90));return r.multiply(i)},i._RotateQuaternionLH=function(t){return n.Quaternion.FromRotationMatrix(i._RotateMatrixLH(t))},i.EarthToWorld=function(n){return i.EarthToWorldDouble(n.x,n.y,n.z)},i.EarthToWorldToRef=function(n,t){i.EarthToWorldDoubleRef(n.x,n.y,n.z,t)},i.WorldToEarth=function(n){return i.WorldToEarthDouble(n.x,n.y,n.z)},i.WorldToEarthToRef=function(n,t){i.WorldToEarthDoubleRef(n.x,n.y,n.z,t)},i.EarthToWorldArray=function(n){var r,t;if(!n)return[];for(r=[],t=0;t<n.length;t++)r.push(i.EarthToWorld(n[t]));return r},i.WorldToEarthArray=function(n){var r,t;if(!n)return[];for(r=[],t=0;t<n.length;t++)r.push(i.WorldToEarth(n[t]));return r},i.EarthToWorldDouble=function(t,r,u){var f=n.Vector3.Zero();return i.EarthToWorldDoubleRef(t,r,u,f),f},i.EarthToWorldDoubleRef=function(n,t,i,r){var u=n*.017453292519943295,f=i*.017453292519943295,e=6378137+t,s=Math.sin(f)*e,o=Math.abs(Math.cos(f)*e),h=Math.sin(u)*o,c=-(Math.cos(u)*o);r.x=h;r.y=s;r.z=c},i.WorldToEarthDouble=function(t,r,u){var f=n.Vector3.Zero();return i.WorldToEarthDoubleRef(t,r,u,f),f},i.WorldToEarthDoubleRef=function(t,i,r,u){r=-r;var f=Math.sqrt(t*t+r*r),e=Math.atan2(t,r),o=Math.atan2(i,f),s=n.Math3.Distance(t,i,r,0,0,0),h=e*57.295779513082323,c=o*57.295779513082323,l=s-6378137;u.x=h;u.y=l;u.z=c},i.GetWorldRadius=function(){return 6378137},i.GetUpVector=function(n){var t=i.EarthToWorld(n);return t.normalize(),t.clone()},i.EarthToLocal=function(t,i){var r=n.Vector3.Zero();return this.EarthToLocalToRef(t,i,r),r},i.EarthToLocalToRef=function(n,i,r){var u=t.LatitudePerMeter(),f=t.LongitudePerMeter(n.z);r.set((i.x-n.x)/f,i.y-n.y,(i.z-n.z)/u)},i.BIO=6378137,i}();n.EarthMath3=r;i=function(){function t(n,t,i,r){n===void 0&&(n=0);t===void 0&&(t=0);i===void 0&&(i=0);r===void 0&&(r=0);this.west=n;this.south=t;this.east=i;this.north=r}return Object.defineProperty(t.prototype,"width",{get:function(){var n=this.east,i=this.west;return n<i&&(n+=t.BGR*2),n-i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.north-this.south},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t(this.west,this.south,this.east,this.north)},t.prototype.intersects=function(n){var t=this.width,r=this.height,i=n.width,u=n.height;return t>=0&&i>=0&&n.west<=this.west+t&&n.west+i>=this.west&&n.south<=this.south+r&&n.south+u>=this.south},Object.defineProperty(t.prototype,"center",{get:function(){return new n.Vector2((this.west+this.east)*.5,(this.south+this.north)*.5)},enumerable:!1,configurable:!0}),t.BGR=180,t.MAX_VALUE=Object.freeze(new t(-t.BGR,-t.BGR*.5,t.BGR,t.BGR*.5)),t}();n.GeoExtent=i;u=function(){function t(){}return t.XyToExtent=function(n,t,r){var u=this.XyToRect(n,t,r);return new i(u.x,u.y,u.right,u.bottom)},t.XyToRect=function(t,i,r){var u=new n.Rect;return this.XyToRectToRef(t,i,r,u),u},t.XyToRectToRef=function(n,t,i,r){var u=180/(1<<n);r.x=-180+t*u;r.y=90-(i+1)*u;r.width=u;r.height=u},t}();n._EarthTilingTransform=u}(Drawsee||(Drawsee={})),function(n){var o=function(){function i(){}return i.CalcArrowPoints=function(r,u,f){var e=n.ArrayHelper.CloneArray(r,!0),o=[],a,w,ft,b,et,k,st;if(e.length<2)return o;var v=e[e.length-1],ot=e[e.length-2],ht=f*2/n.Vector2.Distance(v,ot);v=n.Vector2.Lerp(v,ot,ht);e[e.length-1]=v;var d=[],g=[],l=[];i.BFH(e,u,f,d,g);var nt=new n.Vector2,tt=new n.Vector2,it=new n.Vector2,rt=new n.Vector2,y=e[0].x,p=e[0].y,h=e[1].x,c=e[1].y,ut=u/2,s=n.Math2.Angle(y,p,h,c);for(nt.x=y+ut*Math.cos(s),nt.y=p+ut*Math.sin(s),a=e.length,y=e[a-2].x,p=e[a-2].y,h=e[a-1].x,c=e[a-1].y,w=n.Math2.Angle(y,p,h,c),ut=f/2,s=w+1.5707963267948966,tt.x=h+f*Math.cos(s),tt.y=c+f*Math.sin(s),it.x=h+f*Math.cos(s+3.1415926535897931),it.y=c+f*Math.sin(s+3.1415926535897931),rt.x=h+f*Math.cos(w)*2,rt.y=c+f*Math.sin(w)*2,ft=t.Bezeir(d,d.length*5),b=t.Bezeir(g,g.length*5),n.ArrayHelper.AddRange(o,ft),o.push(tt),o.push(rt),o.push(it),et=b.length,k=0;k<et;k++)o.push(b[et-k-1]);return l.push(b[0]),l.push(nt),l.push(ft[0]),st=t.Bezeir(l,l.length*5),n.ArrayHelper.AddRange(o,st),o},i.BHP=function(n){return n<0?n+6.2831853071795862:n>6.2831853071795862?n-6.2831853071795862:n},i.BFH=function(t,r,u,f,e){var o,b,w;n.ArrayHelper.Clear(f);n.ArrayHelper.Clear(e);var h=0,k=n.Math2.Length(t),c=t[0].x,l=t[0].y,a=t[1].x,v=t[1].y,y=n.Math2.Angle(c,l,a,v),p=r/2,s=y+1.5707963267948966;for(i.BJr(c,l,s,p,f,e),h=h+n.Math2.Distance(c,l,a,v),o=1;o<t.length-1;o++)y=n.Math2.Angle(t[o].x,t[o].y,t[o-1].x,t[o-1].y),b=n.Math2.Angle(t[o].x,t[o].y,t[o+1].x,t[o+1].y),s=b+i.BHP(y-b)/2,i.BHP(s),p=u/2+(r-u)/2*((k-h)/k),i.BJr(t[o].x,t[o].y,s,p,f,e),h=h+n.Math2.Distance(t[o].x,t[o].y,t[o+1].x,t[o+1].y);w=t.length;c=t[w-2].x;l=t[w-2].y;a=t[w-1].x;v=t[w-1].y;y=n.Math2.Angle(c,l,a,v);p=u/2;s=y+1.5707963267948966;i.BJr(a,v,s,p,f,e)},i.BJr=function(t,i,r,u,f,e){var o=new n.Vector2;return o.x=t+u*Math.cos(r),o.y=i+u*Math.sin(r),f.push(o),f.push(o),f.push(o),f.push(o),f.push(o),o=new n.Vector2,r=r+3.1415926535897931,o.x=t+u*Math.cos(r),o.y=i+u*Math.sin(r),e.push(o),e.push(o),e.push(o),e.push(o),e.push(o),o.clone()},i}(),i,u,r,s,f,h,c,t,e;n._Arrow=o;i=function(){function t(){this.index=0;this.ratio=0;this.point=new n.Vector2}return t.Create=function(n,i,r){var u=new t;return u.index=n,u.ratio=i,u.point=r.clone(),u},t}();n.PointOnLine=i;u=function(){function t(){}return t.prototype.compare=function(t,i){return t.index>i.index?1:t.index<i.index?-1:n.g_compareTo(t.ratio,i.ratio)},t}();n.PointOnLine_Comparer=u;r=function(){function r(n){if(n){this.points=new Array(n.length);for(var t=0;t<n.length;t++)this.points[t]=n[t]}}return r.ClosestPoint=function(n,t){return r.ClosestPointAdvance(n,t).point.clone()},r.ClosestPointAdvance=function(t,u){var f=new i,e=new n.RefValue;f.point=r.BIm(t,u,e);f.index=e.value;var o=t[f.index].clone(),h=t[f.index+1].clone(),s=n.Math2.DistancePoint(o,h);return f.ratio=s===0?0:n.Math2.DistancePoint(o,f.point)/s,f},r.BIm=function(t,i,u){var s=17976931348623157e292,h,f,e,o;for(u.value=0,f=0;f<t.length-1;f++)e=r.ClosestPointSegment(i.x,i.y,t[f].x,t[f].y,t[f+1].x,t[f+1].y),o=n.Vector2.DistanceSquared(e,i),o<s&&(s=o,u.value=f,h=e);return h},r.SelfClosestPoint=function(t,i,u,f,e){var s,l,o,h,c;if(u.value=-1,f.value=17976931348623157e292,t.length<2)return null;for(s=t[i].clone(),o=0;o<t.length-1;o++)o!==i&&o!==i-1&&(h=r.ClosestPointSegment(s.x,s.y,t[o].x,t[o].y,t[o+1].x,t[o+1].y),c=n.Math2.DistancePoint(h,s),c<f.value&&(f.value=c,l=h,u.value=o));return u.value<0?null:t.length>3&&(i===0&&u.value===t.length-2||i===t.length-1&&u.value===0)&&n.Math2.NearEqual(t[0],t[t.length-1],e*.01)?null:l},r.ClosestPointSegment=function(t,i,r,u,f,e){var s=(t-r)*(t-r)+(i-u)*(i-u),h=(t-f)*(t-f)+(i-e)*(i-e),o=(r-f)*(r-f)+(u-e)*(u-e);if(n.MathHelper.NearEqual(s,0,1e-13)||n.MathHelper.NearEqual(o,0,1e-13))return new n.Vector2(r,u);if(n.MathHelper.NearEqual(h,0,1e-13))return new n.Vector2(f,e);if(n.MathHelper.NearEqual(r,f,1e-13)&&n.MathHelper.NearEqual(u,e,1e-13))return new n.Vector2(r,u);if(s>h+o)return new n.Vector2(f,e);if(h>s+o)return new n.Vector2(r,u);var c=u-e,l=f-r,y=r*e-f*u,a=Math.abs(c*t+l*i+y)/Math.sqrt(c*c+l*l),v=Math.sqrt(s-a*a),p=r+(f-r)*v/Math.sqrt(o),w=u+(e-u)*v/Math.sqrt(o);return new n.Vector2(p,w)},r.DistanceSegment=function(t,i,r,u,f,e){var o=(t-r)*(t-r)+(i-u)*(i-u),s=(t-f)*(t-f)+(i-e)*(i-e),l=(r-f)*(r-f)+(u-e)*(u-e);if(n.MathHelper.NearEqual(r,f,1e-13)&&n.MathHelper.NearEqual(u,e,1e-13))return Math.sqrt(o);if(o>s+l)return Math.sqrt(s);if(s>o+l)return Math.sqrt(o);var h=u-e,c=f-r,a=r*e-f*u;return Math.abs(h*t+c*i+a)/Math.sqrt(h*h+c*c)},r.Distance=function(n,t){for(var f,u=17976931348623157e292,i=0;i<n.length-1;i++)f=r.DistanceSegment(t.x,t.y,n[i].x,n[i].y,n[i+1].x,n[i+1].y),f<u&&(u=f);return u},r.DistanceLine=function(n,t){var f=17976931348623157e292,i,u;if(r.IntersectWith(n,t))return 0;for(i=0;i<t.length;i++)u=r.Distance(n,t[i]),u<f&&(f=u);for(i=0;i<n.length;i++)u=r.Distance(t,n[i]),u<f&&(f=u);return f},r.CalcLength=function(t){for(var r=0,i=0;i<t.length-1;i++)r=r+n.Math2.Distance(t[i].x,t[i].y,t[i+1].x,t[i+1].y);return r},r.IntersectWith=function(t,i){var u=new n.Vector2;return r.IntersectOnePoint(t,i,u)},r.IntersectOnePoint=function(t,i,r){var u,f,e;for(r.copyFrom(new n.Vector2),u=0;u<t.length-1;u++)for(f=0;f<i.length-1;f++)if(e=new n.Vector2,n.Math2.IntersectSegment(t[u].x,t[u].y,t[u+1].x,t[u+1].y,i[f].x,i[f].y,i[f+1].x,i[f+1].y,e))return!0;return!1},r.IntersectWithRect=function(i,u){var f,e;return!i||i.length<=0?!1:(f=n.Rect.CalcRange(i),!n.Math2.RectIntersects(f,u))?!1:n.Math2.RectContains(u,f)?!0:(e=t.Rectangle(u),r.IntersectWith(i,e))},r.IntersectSegmentAdvance=function(t,i,r,u,f,e,o,s,h,c,l,a){var tt,it,v,y;if(h.value=c.value=0,l.copyFrom(new n.Vector2),a.value=!1,Math.min(i,u)>Math.max(e,s)||Math.max(i,u)<Math.min(e,s)||Math.min(t,r)>Math.max(f,o)||Math.max(t,r)<Math.min(f,o))return!1;var p=r-t,w=u-i,b=o-f,k=s-e,nt=t-f,d=i-e,g=p*k-b*w;if(0===Math.abs(g)){if(a.value=!0,i!==u){if(0==p*b*d+p*k*f-b*w*t)return!1}else if(t===f)return!1;return!1}return(tt=b*d-nt*k,it=p*d-nt*w,h.value=tt/g,c.value=it/g,h.value>=0&&h.value<=1&&c.value>=0&&c.value<=1)?(v=0,y=0,h.value===0?(v=t,y=i):h.value===1?(v=r,y=u):c.value===0?(v=f,y=e):c.value===1?(v=o,y=s):(v=t+h.value*p,y=i+h.value*w),l.copyFrom(new n.Vector2(v,y)),!0):!1},r.CalcIntersectPointsIgnoreStartEnd=function(t,u,f,e){var o,s,d,g,nt,h;e===void 0&&(e=!1);var tt=t.length,it=u.length,rt=new n.RefValue(!1);for(f.value=[],o=0;o<tt-1;o++)for(s=0;s<it-1;s++)if(!e||Math.abs(s-o)>1){var c=new i,ut=new i,l=t[o].x,a=t[o].y,v=t[o+1].x,y=t[o+1].y,p=u[s].x,w=u[s].y,b=u[s+1].x,k=u[s+1].y;if(Math.min(p,b)<=Math.max(l,v)&&Math.max(p,b)>=Math.min(l,v)&&Math.min(w,k)<=Math.max(a,y)&&Math.max(w,k)>=Math.min(a,y)&&(d=new n.RefValue,g=new n.RefValue,r.IntersectSegmentAdvance(l,a,v,y,p,w,b,k,d,g,c.point,rt))){for(c.ratio=d.value,ut.ratio=g.value,c.index=o,nt=!1,h=0;h<f.value.length;h=h+1)if(o<f.value[h].index||o===f.value[h].index&&c.ratio<f.value[h].ratio){f.value.splice(h,0,c);nt=!0;break}nt||f.value.push(c)}}return f.value=r.BEw(t,f.value),!0},r.BEw=function(t,i){for(var r,f=[],e=t[0].clone(),o=t[t.length-1].clone(),u=0;u<i.length;u++)r=i[u],n.Math2.NearEqual(r.point,e,1e-13)||n.Math2.NearEqual(r.point,o,1e-13)||f.push(r);return f},r.CalcSplitLineParts=function(t,i,r,u,f,e){var s,o;if(f.value=null,e.value=null,!t)return!1;if(s=t.length,n.Math2.NearEqual(t[i],r,u)){for(f.value=new Array(s-i),o=0;o<f.value.length;o++)f.value[o]=t[i+o].clone();for(e.value=new Array(i+1),o=0;o<e.value.length;o++)e.value[o]=t[o].clone()}else if(n.Math2.NearEqual(t[i+1],r,u)){for(f.value=new Array(s-i-1),o=0;o<f.value.length;o++)f.value[o]=t[i+o+1].clone();for(e.value=new Array(i+2),o=0;o<e.value.length;o++)e.value[o]=t[o].clone()}else{for(f.value=new Array(s-i),o=1;o<f.value.length;o++)f.value[o]=t[i+o].clone();for(f.value[0]=r.clone(),e.value=new Array(i+2),o=0;o<e.value.length-1;o++)e.value[o]=t[o].clone();e.value[e.value.length-1]=r.clone()}return!0},r.GetSubLine=function(n,t,i,r){var e=t.point.clone(),u,f;for(r.value=[],r.value.push(e),u=0,f=t.index+1;f<=i.index;f++)(n[f].x!==r.value[u].x||n[f].y!==r.value[u].y)&&(r.value.push(n[f]),u=u+1);return e=i.point.clone(),(e.x!==r.value[u].x||e.y!==r.value[u].y)&&r.value.push(e),r.value.length>=2},r.CalcIntersectLines=function(t,f,e,o){var c,s,l,h,a;if(e===void 0&&(e=1e-13),o===void 0&&(o=!1),c=[],s=new n.RefValue(null),r.CalcIntersectPointsIgnoreStartEnd(t,f,s,o),s.value.length>0)for(n.Math2.NearEqual(s.value[0].point,t[0],e)||s.value.splice(0,0,i.Create(0,0,t[0])),l=t.length,n.Math2.NearEqual(s.value[s.value.length-1].point,t[l-1],e)||s.value.push(i.Create(l-1,0,t[l-1])),n.ArrayHelper.Sort(s.value,new u),h=0;h<s.value.length-1;h++)a=new n.RefValue(null),r.GetSubLine(t,s.value[h],s.value[h+1],a)&&c.push(a.value);else c.push(t);return c},r}();n._Line2=r;s=function(){function i(n){if(n){this.points=new Array(n.length);for(var t=0;t<n.length;t++)this.points[t]=n[t].clone()}}return i.Distance=function(n,t){return i.Contains(n,t)?0:r.Distance(n,t)},i.DistanceLine=function(n,t){return r.IntersectWith(n,t)?0:i.ContainsLine(n,t)?0:i.ContainsLine(t,n)?0:r.DistanceLine(t,n)},i.Area=function(n){var t;if(n.length<3)return 0;var u=n[0].x,r=n[0].y,i=0;for(t=1;t<=n.length-2;t++)i=i+(u*(n[t].y-n[t+1].y)+n[t].x*(n[t+1].y-r)+n[t+1].x*(r-n[t].y))/2;return Math.abs(i)},i.BJH=function(n,t,i,r,u,f,e){var o,s,h;if(e.value=0,r===f)n>=i&&n<=u&&t===r&&(e.value=1);else{if(o=0,s=0,r<f?(o=i,s=r):(o=u,s=f),s===t){if(o===n){e.value=1;return}if(o>n){e.value=2;return}}(r>t&&f<t||r<t&&f>t)&&(h=(u-i)*(t-r)/(f-r)+i,h===n?e.value=1:h>n&&(e.value=2))}},i.Contains=function(t,r){var h=0,e=new n.RefValue(0),c=!1,o=r.x,s=r.y,u=n.Rect.CalcRange(t),f;if(c&&(o<u.left||o>u.right||s<u.top||s>u.bottom)||o<=u.left||o>=u.right||s<=u.top||s>=u.bottom)return!1;for(f=0;f<t.length-1;f++)if(i.BJH(o,s,t[f].x,t[f].y,t[f+1].x,t[f+1].y,e),2===e.value&&(h=h+1),c&&1===e.value)return!0;if(t[0].x!==t[t.length-1].x||t[0].y!==t[t.length-1].y)if(i.BJH(o,s,t[t.length-1].x,t[t.length-1].y,t[0].x,t[0].y,e),2===e.value)h=h+1;else if(c&&1===e.value)return!0;return h%2!=0},i.ContainsLine=function(n,t){for(var r=0;r<t.length;r++)if(!i.Contains(n,t[r]))return!1;return!0},i.ContainsRect=function(n,r){return i.ContainsLine(n,t.Rectangle(r))},i.IntersectsWithPoly=function(n,t){return n&&n.length>=3&&t&&t.length>=3&&(i.ContainsLine(n,t)||i.ContainsLine(t,n)||r.IntersectWith(n,t))},i.IntersectsWithRect=function(n,i){return this.IntersectsWithPoly(n,t._TempRectanglePoints(i))},i.MakePolyClose=function(t){if(!t||t.length<3)return t;if(!t[0].equals(t[t.length-1])){var i=n.ArrayHelper.CloneArray(t);i.push(t[0]);t=i}return t},i.ClipLine=function(t,u){var e=[],o,h,s,f,c;if(i.ContainsLine(t,u))return e.push(u),e;for(o=n.ArrayHelper.CloneArray(t),o.push(o[0]),h=r.CalcIntersectLines(u,o,1e-13,!1),s=0;s<h.length;s++)f=h[s],f.length>=2&&(c=new n.Vector2((f[0].x+f[1].x)*.5,(f[0].y+f[1].y)*.5),i.Contains(t,c)&&e.push(f));return e},i}();n._Ring2=s;f=function(){function t(){}return t.CalcBezeirPoints=function(n,i){var r=[],u;return i<=1?r:(u=n.length,u<2)?r:(t.BGj(n,i,r),r.push(n[n.length-1]),r)},t.BGj=function(n,i,r){for(var f,e,o=n.length,u=0;u<i;u++)f=u/i,e=t.BJU(n,o-1,f),r.push(e)},t.BJU=function(t,i,r){for(var e=new n.Vector2(0,0),c=1,l=Math.pow(1-r,i),f=0;f<=i;f++){var o=i,s=f,h=i-f,u=c*l;for(c=c*r,l=l/(1-r);o>=1;)u=u*o,o=o-1,s>1&&(u=u/s,s=s-1),h>1&&(u=u/h,h=h-1);e.x=e.x+t[f].x*u;e.y=e.y+t[f].y*u}return e.clone()},t}();n._Bezier=f;h=function(){function t(i,r,u){if(u===void 0&&(u=null),this.level=0,this.bounds=new n.Rect,this.subSegs=[],this.level=i,this.points=r,this.bounds=u?u.value:n.Rect.CalcRange(r),i<2){var f=t.GetSplitDivCount(r.length);f>0&&this.BIs(f)}}return t.GetSplitDivCount=function(n){return n>4096?8:n>1024?4:n>256?2:0},t.prototype.BIs=function(t){var r,e;if(t>0){n.ArrayHelper.Clear(this.subSegs);var h=Math.max(this.bounds.width,this.bounds.height)/t,i=0,u=i=17976931348623157e292,f=0,o=f=-17976931348623157e292,s=[],c=this.points.length;for(r=0;r<c;r++)e=this.points[r].clone(),s.push(e),i=Math.min(i,e.x),u=Math.min(u,e.y),f=Math.max(f,e.x),o=Math.max(o,e.y),r<c-2&&(f-i>h||o-u>h)&&(this.BKR(s,new n.NullableValue(new n.Rect(i,u,f-i,o-u))),u=i=17976931348623157e292,o=f=-17976931348623157e292,n.ArrayHelper.Clear(s),r=r-1);this.BKR(s,null)}},t.prototype.BKR=function(n,i){if(i===void 0&&(i=null),n.length>=2){var r=new t(this.level+1,n,i);this.subSegs.push(r)}},t.prototype.clipLine=function(t,i){var r,u;if(n.Math2.RectIntersects(t,this.bounds))if(this.subSegs.length>0)for(r=0;r<this.subSegs.length;r++)u=this.subSegs[r],u.clipLine(t,i);else i.push(this.points)},t.prototype.BIz=function(t,i){var r=i.x,u=i.y;return r=Math.min(r,t.right),r=Math.max(r,t.left),u=Math.min(u,t.bottom),u=Math.max(u,t.top),new n.Vector2(r,u)},t.prototype.clipPolygon=function(t,i,r){var e,f,u,o;if(n.Math2.RectIntersects(t,this.bounds))if(this.subSegs.length>0)for(u=0;u<this.subSegs.length;u++)e=this.subSegs[u],e.clipPolygon(t,i,r);else for(f=this.points,u=0;u<f.length;u++)o=f[u].clone(),r.push(this.BIz(i,o));else r.push(this.BIz(i,this.points[0])),r.push(this.BIz(i,this.points[this.points.length-1]))},t}();c=function(){function t(n){this.BHx=new h(0,n,null);this.BJn()}return t.prototype.BJn=function(){var f=Math.max(this.BHx.bounds.width,this.BHx.bounds.height)/512,r=[],u=this.BHx.points,t=u[0].clone(),i,n;for(r.push(t),i=1;i<u.length;i++)n=u[i].clone(),(Math.abs(n.x-t.x)>=f||Math.abs(n.y-t.y)>=f)&&(r.push(n),t=n.clone());this.BBp=r},t.prototype.clipLine=function(n){var t=[],i=.2;return n.width<this.BHx.bounds.width*i&&n.height<this.BHx.bounds.height*i?(this.BHx.clipLine(n,t),t):(t.push(this.BBp),t)},t.prototype.clipPoly=function(t){var i=[],r=.2;if(t.width<this.BHx.bounds.width*r&&t.height<this.BHx.bounds.height*r){var o=t.x+t.width*.5,s=t.y+t.height*.5,u=2,f=t.width*u,e=t.height*u,h=new n.Rect(o-f,s-e,f*2,e*2);return this.BHx.clipPolygon(t,h,i),i}return n.ArrayHelper.AddRange(i,this.BBp),i},t}();n._IndexedLine2=c;t=function(){function t(){}return t.Arrow=function(n,t,i){return o.CalcArrowPoints(n,t,i)},t.Bezeir=function(n,t){return f.CalcBezeirPoints(n,t)},t.Spline=function(t,i,r){i===void 0&&(i=50);r===void 0&&(r=!1);var u=n.VectorHelper.ToVector3Array(t),f=n.Math3.Spline(u,i,r);return n.VectorHelper.ToVector2Array(f)},t.Circle=function(t,i){var f,r,u,o;i===void 0&&(i=32);f=i%2==0;i>=16&&f&&(i+=1,f=!1);var e=[],s=6.2831853071795862/i;for(r=0;r<i;r++)u=void 0,u=f?s*(r+.5):s*r,u+=6.2831853071795862/2,o=new n.Vector2,o.y=t*Math.cos(u),o.x=-t*Math.sin(u),e.push(o);return e.push(e[0].clone()),e},t.Rectangle=function(t){return[new n.Vector2(t.left,t.top),new n.Vector2(t.right,t.top),new n.Vector2(t.right,t.bottom),new n.Vector2(t.left,t.bottom),new n.Vector2(t.left,t.top)]},t._InitRectPoints=function(t){for(var i=0;i<5;i++)t[i]=new n.Vector2},t._TempRectanglePoints=function(n){var t=e;return t[0].set(n.left,n.top),t[1].set(n.right,n.top),t[2].set(n.right,n.bottom),t[3].set(n.left,n.bottom),t[4].set(n.left,n.top),t},t}();n.Shape2=t;e=[];t._InitRectPoints(e)}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var r=function(){function t(n,t,r,u){r===void 0&&(r=64);u===void 0&&(u=6);n&&t&&(this._rootBlock=new i(this,n,t,r,0,u))}return Object.defineProperty(t.prototype,"count",{get:function(){return this._rootBlock.count},enumerable:!1,configurable:!0}),t.prototype.add=function(n){this._rootBlock.add(n)},t.prototype.addArray=function(n){this._rootBlock.addArray(n)},t.prototype.select=function(t){var i=new n.HashSet;return this._rootBlock.select(t,i),n.ArrayHelper.CloneArray(i)},t}(),u,i,f,e,t;n.QuadtreeIndex=r;u=function(t){function r(i){i===void 0&&(i=64);var r=t.call(this)||this;return r.Pr=!1,r.Bt=n.Rect.Empty,r.BJP=0,r.BKO=[],r.BJP=i,r}return __extends(r,t),r.prototype.add=function(n){n&&(this.BJx(n),this._rootBlock&&this._rootBlock.add(n),this.BKO.push(n))},r.prototype.addArray=function(n){for(var i,t=0;t<n.length;t++)i=n[t],this.add(i)},r.prototype.BJx=function(t){var i=t.bounds;this.Pr?this.Bt.contains(new n.Vector2(i.x,i.y))&&this.Bt.contains(new n.Vector2(i.right,i.bottom))||(this.Bt.unionInPlace(i),this.BKO.length>this.BJP&&this.BJN()):(this.Bt=i.clone(),this.Pr=!0)},r.prototype.BJN=function(){var t=new n.Rect(this.Bt.x-this.Bt.width,this.Bt.y-this.Bt.height,this.Bt.width*3,this.Bt.height*3);this.Bt=t.clone();this._rootBlock=new i(this,new n.Vector2(this.Bt.x,this.Bt.y),new n.Vector2(this.Bt.right,this.Bt.bottom),this.BJP,0,24);this._rootBlock.addArray(this.BKO)},r.prototype.select=function(n){return this._rootBlock?t.prototype.select.call(this,n):this.BKB(n)},r.prototype.BKB=function(t){for(var r,u=new n.HashSet,i=0;i<this.BKO.length;i++)r=this.BKO[i],n.Math2.RectIntersects(t,r.bounds)&&u.add(r);return n.ArrayHelper.CloneArray(u)},r.BIk=24,r}(r);n.DynamicQuadTreeIndex=u;i=function(){function t(t,i,r,u,f,e){this.BJI=[];this.BHK=0;this.BJd=0;this.BJi=0;this.BKM=0;this.Bt=new n.Rect;this.BAk=t;this.BKM=u;this.BJd=f;this.BJi=e;this.Bt=n.Rect.CreateFromPoint(i,r)}return Object.defineProperty(t.prototype,"capacity",{get:function(){return this.BKM},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rect",{get:function(){return this.Bt.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this.BHK},enumerable:!1,configurable:!0}),t.prototype.addArray=function(n){for(var i,t=0;t<n.length;t++)i=n[t],this.add(i)},t.prototype.add=function(t){var i,r;if(n.Math2.RectIntersects(t.bounds,this.Bt))if(this.BHK=this.BHK+1,this.BJz)for(i=0;i<this.BJz.length;i++)r=this.BJz[i],r.add(t);else this.BJI.push(t),this.BJI.length>this.BKM&&this.BJd<this.BJi&&this.BHb()},t.prototype.BHb=function(){var u,f,i,r;for(this.BJz=[],u=this.Bt.width*.5,f=this.Bt.height*.5,i=0;i<2;i++)for(r=0;r<2;r++){var o=new n.Vector2(this.Bt.left+u*i,this.Bt.top+f*r),s=new n.Vector2(this.Bt.left+u*(i+1),this.Bt.top+f*(r+1)),e=new t(this.BAk,o,s,this.BKM,this.BJd+1,this.BJi);e.addArray(this.BJI);this.BJz.push(e)}n.ArrayHelper.Clear(this.BJI)},t.prototype.select=function(t,i){var e,u,r,f;if(n.Math2.RectIntersects(t,this.Bt))if(this.BJz)for(r=0;r<this.BJz.length;r++)e=this.BJz[r],e.select(t,i);else{for(u=[],r=0;r<this.BJI.length;r++)f=this.BJI[r],n.Math2.RectIntersects(t,f.bounds)&&u.push(f);i.unionWith(n.ArrayHelper.CreateEnumerator(u))}},t}();f=function(){function i(n){this.Mz=[];this.BJK=0;this.BKJ=0;this.BJt=0;this.BHI=[];this.BHK=0;this.init(n)}return Object.defineProperty(i.prototype,"count",{get:function(){return this.BHK},enumerable:!1,configurable:!0}),i.prototype.init=function(n){this.clear();this.BKJ=n;this.BJK=this.BKJ*this.BKJ;this.BJt=n*2},i.prototype.clear=function(){this.BHK=0;this.Mz=[];this.BHI=[]},i.prototype.addToIndex=function(n,i,r){var p=this.Mz.length,h,o,b,s;if(p>2048)return!1;if(r>this.BKJ)return this.BHI.push(new t(n,r,i)),this.BHK=this.BHK+1,!0;for(h=!1,o=0;o<p;o++){var u=this.Mz[o],c=Math.abs(u.ptCenter.x-i.x),w=Math.abs(u.ptCenter.y-i.y),l=Math.abs(u.ptCenter.z-i.z);if((c<this.BJt||l<this.BJt)&&(b=c*c+w*w+l*l,b<this.BJK)){var f=u.ptCenter.clone(),a=u.objs.length,v=a/(a+1),y=1/(a+1),k=f.x*v+i.x*y,d=f.y*v+i.y*y,g=f.z*v+i.z*y;f.x=k;f.y=d;f.z=g;u.ptCenter=f.clone();u.objs.push(new t(n,r,i));h=!0;break}}return h||(s=new e,s.ptCenter=i.clone(),s.objs.push(new t(n,r,i)),this.Mz.push(s)),this.BHK=this.BHK+1,!0},i.prototype.search=function(t,i,r){var e,o,h,u,f;r.value=[];var s=Math.max(this.BKJ*2,i),c=s*s,l=this.Mz.length;for(e=0;e<l;e++)if(o=this.Mz[e],h=n.Vector3.DistanceSquared(o.ptCenter,t),h<c)for(u=0;u<o.objs.length;u++)f=o.objs[u],n.Vector3.Distance(t,f.center)<i+f.radius&&r.value.push(f.obj);for(u=0;u<this.BHI.length;u++)f=this.BHI[u],n.Vector3.Distance(t,f.center)<i+f.radius&&r.value.push(f.obj);return r.value.length>0},i}();n.SphereIndex=f;e=function(){function t(){this.ptCenter=new n.Vector3;this.objs=[]}return t}();t=function(){function t(t,i,r){this.radius=0;this.center=new n.Vector3;this.obj=t;this.radius=i;this.center=r.clone()}return t}()}(Drawsee||(Drawsee={})),function(n){function f(n,t,i){i.x=n.x+t.x;i.y=n.y+t.y;i.z=n.z+t.z}function h(n){var i=n.length,t=new Float32Array(i);return t.set(n,0),t}function r(n){var i=n.length,t=new Int32Array(i);return t.set(n,0),t}var u=function(){function t(){this._b=new n.Box}return t.Create=function(n,i,r){var u=new t;return u.Bt=n,u.BAx=i,u.BHm=r,u.BHK=Math.floor(i.length/3),u},t.CreateFromPoints=function(n){var i=new t;return i.BIZ(n),i},Object.defineProperty(t.prototype,"count",{get:function(){return this.BHK},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bounds",{get:function(){return this.Bt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minArray",{get:function(){return this.BAx},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxArray",{get:function(){return this.BHm},enumerable:!1,configurable:!0}),t.prototype.BIZ=function(t){var a,f,e;this.Bt=n.Box.CalcRangeFromArray(t);a=t.data;f=Math.floor(t.length/3);this.BHK=f;var c=n.Vector3Array.Create(f),l=n.Vector3Array.Create(f),i=n.Vector3.Zero(),r=n.Vector3.Zero(),u=n.Vector3.Zero(),o=n.Vector3.Zero(),s=n.Vector3.Zero(),h=0;for(e=0;e<f;e++)t.getToRef(h,i),t.getToRef(h+1,r),t.getToRef(h+2,u),o.x=Math.min(Math.min(i.x,r.x),u.x),o.y=Math.min(Math.min(i.y,r.y),u.y),o.z=Math.min(Math.min(i.z,r.z),u.z),s.x=Math.max(Math.max(i.x,r.x),u.x),s.y=Math.max(Math.max(i.y,r.y),u.y),s.z=Math.max(Math.max(i.z,r.z),u.z),c.setAt(e,o),l.setAt(e,s),h+=3;this.BAx=c.data;this.BHm=l.data},t.prototype.triBounds=function(n){var u=this._b,t=n*3,f=u.min,e=this.BAx,i,r;return f.x=e[t],f.y=e[t+1],f.z=e[t+2],i=u.max,r=this.BHm,i.x=r[t],i.y=r[t+1],i.z=r[t+2],u},t}(),t,i,e,o,s;n.BoundsBinder=u;t=function(){function n(n,t,i,r){this.binder=n;this.total=t;this.capacity=i;this.maxDepth=r}return n}();n.OctreeBlockSplitInfo=t;i=function(){function t(n,t,i,r,u,f){r===void 0&&(r=[]);u===void 0&&(u=null);f===void 0&&(f=0);this.min=n;this.max=t;this.depth=i;this.entries=r;this.subs=u;this.count=f;this.no=0}return t.prototype.addEntries=function(n,t){for(var i=0;i<t.length;i++)this.addEntry(n,t[i])},t.prototype.addEntry=function(t,i){var e=t.binder.triBounds(i),r,o,u,f;if(n.Box.IntersectsMinMax(this.min,this.max,e.min,e.max))if(this.count++,r=this.subs,r)for(o=r.length,u=0;u<o;u++)r[u].addEntry(t,i);else f=this.entries,f.push(i),f.length>t.capacity&&this.depth<t.maxDepth&&this.BHb(t)},t.prototype.BHb=function(i){var e,o,r,s,h,l;this.subs=[];var u=this.min,c=this.max,a=new n.Vector3((c.x-u.x)*.5,(c.y-u.y)*.5,(c.z-u.z)*.5),v=this.subs,y=this.entries;for(e=0;e<2;e++)for(o=0;o<2;o++)for(r=0;r<2;r=r+1)s=a.multiplyByFloats(e,o,r),f(u,s,s),h=a.multiplyByFloats(e+1,o+1,r+1),f(u,h,h),l=new t(s,h,this.depth+1),l.addEntries(i,y),v.push(l),i.total++;this.entries.length=0},t.prototype.enumSubBlocks=function(n){var t,i;if(n.push(this),t=this.subs,t)for(i=0;i<t.length;i++)t[i].enumSubBlocks(n)},t.prototype.select=function(n,t,i){this.BFr(n,t,i)},t.prototype.BFr=function(n,t,i){var u,e,r,f,o;if(t.intersects(this.min,this.max))if(u=this.subs,u&&u.length>0)for(r=0;r<u.length;r++)u[r].BFr(n,t,i);else for(e=this.entries,r=0;r<e.length;r++)f=e[r],t.intersectsEntry(n,f)&&(o=n.triBounds(f),i.push(f))},t}();n.OctreeBlock=i;e=function(){function n(){}return Object.defineProperty(n.prototype,"root",{get:function(){return this.Zj},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"count",{get:function(){return this.Zj.count},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"boundingBox",{get:function(){return this.BIP.bounds},enumerable:!1,configurable:!0}),n.Create=function(r,f,e){var s;f===void 0&&(f=64);e===void 0&&(e=2);var h=new n,o=u.CreateFromPoints(r),c=new i(o.bounds.min,o.bounds.max,0),a=new t(o,0,f,e),l=[];for(s=0;s<o.count;s++)l.push(s);return c.addEntries(a,l),h.BIP=o,h.Zj=c,h},n.prototype.select=function(n){var t=[];return this.Zj.select(this.BIP,n,t),t},n}();n.OctreeIndex=e;o=function(){function n(n,t,i,r,u,f,e,o){this.bounds=n;this.addrs=t;this.subs=i;this.entries=r;this.binderMin=u;this.binderMax=f;this.binderBoundsArray=e;this.triPointFloats=o}return n}();n.QueryOctreeIndexData=o;s=function(){function f(t,i,r,u,f){this.binder=t;this.bounds=i;this.addrs=r;this.subs=u;this.entries=f;this.BAx=n.Vector3.Zero();this.BHm=n.Vector3.Zero()}return Object.defineProperty(f.prototype,"boundingBox",{get:function(){return this.binder.bounds},enumerable:!1,configurable:!0}),f.prototype.BHS=function(n){var t=this.bounds,i=n*6,r=this.BAx,u=this.BHm;r.x=t[i];r.y=t[i+1];r.z=t[i+2];u.x=t[i+3];u.y=t[i+4];u.z=t[i+5]},f.prototype.select=function(n){var t=[];return this.BHf(this.binder,0,n,t),t},f.prototype.BHf=function(n,t,i,r){var f,e,h,o,c,u,s;if(this.BHS(t),i.intersects(this.BAx,this.BHm))if(f=this.addrs[t],f>0)for(e=f-1,h=this.subs[e],u=0;u<h;u++)this.BHf(n,this.subs[e+u+1],i,r);else for(o=-(f+1),c=this.entries[o],u=0;u<c;u++)s=this.entries[o+u+1],i.intersectsEntry(n,s)&&r.push(s)},f.Create=function(n,r,e){var s;r===void 0&&(r=64);e===void 0&&(e=2);var o=u.CreateFromPoints(n),h=new i(o.bounds.min,o.bounds.max,0),l=new t(o,0,r,e),c=[];for(s=0;s<o.count;s++)c.push(s);return h.addEntries(l,c),f.CreateFromBlock(o,h)},f.CreateFromBlock=function(n,t){var c=[],v,u,i,s,p,w,e;for(t.enumSubBlocks(c),v=c.length,u=0;u<v;u++)i=c[u],i.no=u;var o=[],y=[],l=[],a=[];for(u=0;u<v;u++)if(i=c[u],o.push(i.min.x),o.push(i.min.y),o.push(i.min.z),o.push(i.max.x),o.push(i.max.y),o.push(i.max.z),s=i.subs,s&&s.length>0)for(y.push(l.length+1),l.push(s.length),e=0;e<s.length;e++)l.push(s[e].no);else for(y.push(-(a.length+1)),p=i.entries.length,w=i.entries,a.push(p),e=0;e<p;e++)a.push(w[e]);return new f(n,h(o),r(y),r(l),r(a))},f}();n.QueryOctreeIndex=s}(Drawsee||(Drawsee={})),function(n){var r=function(){function t(n){this.BID=n}return t.prototype.intersects=function(t,i){return!!n.VectorHelper.IntersectRayMinMax(this.BID,t,i)},t.prototype.intersectsEntry=function(t,i){var r=t.triBounds(i);return!!n.VectorHelper.IntersectRayMinMax(this.BID,r.min,r.max)},t}(),t,i;n.OctreeRaySelector=r;t=function(){function t(n){this.BIb=n.clone()}return t.prototype.intersects=function(t,i){return n.VectorHelper.IntersectPlaneMinMax(this.BIb,t,i)},t.prototype.intersectsEntry=function(t,i){var r=t.triBounds(i);return n.VectorHelper.IntersectPlaneMinMax(this.BIb,r.min,r.max)},t}();n.OctreePlaneSelector=t;i=function(){function t(n){this.BGp=n}return t.prototype.intersects=function(t,i){return n.Box.IntersectsMinMax(this.BGp.min,this.BGp.max,t,i)},t.prototype.intersectsEntry=function(t,i){var r=t.triBounds(i);return n.Box.IntersectsMinMax(this.BGp.min,this.BGp.max,r.min,r.max)},t}();n.OctreeBoxSelector=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var r=function(){function t(t,i){t===void 0&&(t=n.Vector3.Zero());i===void 0&&(i=0);this.position=t;this.value=i}return t}(),u=function(){function t(){}return t.prototype.compare=function(t,i){return n.g_compareTo(t.value,i.value)},t}(),t=function(){function t(){}return t.prototype.BHq=function(t){for(var u=this.selectByPlane(t),f=[],c=n.SystemHelper.ToInt(u.length/3),r=0,e=0;e<c;e++){var o=u[r],s=u[r+1],h=u[r+2],i=new n.Vector3;n.VectorHelper.IntersectSegmentPlane(o,s,t,i)&&f.push(i);n.VectorHelper.IntersectSegmentPlane(o,h,t,i)&&f.push(i);n.VectorHelper.IntersectSegmentPlane(s,h,t,i)&&f.push(i);r=r+3}return f},t.prototype.selectByRay=function(){return[]},t.prototype.selectByPlane=function(){return[]},t.prototype.selectByBox=function(){return[]},t.prototype.intersectsRay=function(n){var t=this.selectByRay(n);return this.intersectsRayTriangles(n,t)},t.prototype.intersectsRayTriangles=function(t,i){var f;if(i.length<=0)return null;var s=n.SystemHelper.ToInt(i.length/3),r=0,u=340282347e30,o=null;for(f=0;f<s;f++){var h=i[r],c=i[r+1],l=i[r+2],e=n.VectorHelper.IntersectRayTriangle(t,h,c,l);e&&e.distance<u&&(u=e.distance,o=t.origin.add(t.direction.scale(u)));r=r+3}return o},t.prototype.clampLine=function(t,i,f,e){var s=[],a=t.add(f.scale(n.Vector3.Distance(t,i))),v=n.Plane.FromPoints(t,i,a),h,l,c,o;for(s=this.BHq(v),s=this.BDa(s,t,i),h=[],o=0;o<s.length;o++)l=s[o],h.push(new r(l,n.Vector3.DistanceSquared(t,l)));for(n.ArrayHelper.Sort(h,new u),c=[],c.push(t),o=0;o<h.length;o++)c.push(h[o].position);return c.push(i),n.VectorHelper.FilterDuplicatedVector3(c,e)},t.prototype.BDa=function(t,i,r){for(var o,f,s=r.subtract(i),h=n.Vector3.DistanceSquared(i,r),e=[],u=0;u<t.length;u++)o=t[u].subtract(i),f=n.Vector3.Dot(s,o),f>0&&f<h&&e.push(t[u]);return e},t}(),i;n.TriangleIndexBase=t;i=function(t){function i(i){var r=t.call(this)||this;return r.BGZ=!1,r.BIG=i,i&&i.length<1e3?r.BAk=n.OctreeIndex.Create(i,64,3):r.BHT(),r}return __extends(i,t),i.prototype.BGn=function(){return this.BAk&&this.BIG?!0:(this.BHT(),!!this.BAk)},Object.defineProperty(i.prototype,"triPoints",{get:function(){return this.BIG},enumerable:!1,configurable:!0}),i.prototype.BHT=function(){var t=this;this.BGZ||this.BAk||(this.BGZ=!0,n.AsyncProcess.CreateTriangleIndex(this.BIG).then(function(i){i&&(t.BAk=i.index,t.BIG=new n.Vector3Array(i.triPointFloats));t.BGZ=!1}))},i.prototype.BGD=function(n){var t=[],u,i,f,r;if(n.length<=0)return t;for(u=Math.min(n.length,1024),i=0;i<u;i++)f=n[i],r=f*3,t.push(this.BIG.getAt(r)),t.push(this.BIG.getAt(r+1)),t.push(this.BIG.getAt(r+2));return t},i.prototype.isBoundingBoxIntersects=function(t){return this.BGn()?!!n.VectorHelper.IntersectRayBox(t,this.BAk.boundingBox):!1},i.prototype.selectTriNosByRay=function(t){return this.BGn()?this.BAk.select(new n.OctreeRaySelector(t)):[]},i.prototype.selectTriNosByPlane=function(t){return this.BGn()?this.BAk.select(new n.OctreePlaneSelector(t)):[]},i.prototype.selectTriNosByBox=function(t){return this.BGn()?this.BAk.select(new n.OctreeBoxSelector(t)):[]},i.prototype.BGt=function(t,i){var f;if(t.length<=0)return t;var u=[],h=n.SystemHelper.ToInt(t.length/3),r=0;for(f=0;f<h;f++){var e=t[r],o=t[r+1],s=t[r+2];r=r+3;var c=n.VectorHelper.MinVector(n.VectorHelper.MinVector(e,o),s),l=n.VectorHelper.MaxVector(n.VectorHelper.MaxVector(e,o),s),a=new n.Box(c,l);n.Box.Intersects(a,i)&&(u.push(e),u.push(o),u.push(s))}return u},i.prototype.selectByRay=function(n,t){t===void 0&&(t=!1);var i=this.selectTriNosByRay(n);return this.BGD(i)},i.prototype.selectByPlane=function(n){var t=this.selectTriNosByPlane(n);return this.BGD(t)},i.prototype.selectByBox=function(n){var t=this.selectTriNosByBox(n);return this.BGD(t)},i.prototype.intersectsWithTriangle=function(t,i,r,u,f,e){var l,c,v,o;for(e.value=[],l=u.length,f.value=0,c=0;c<l;c++){var a=!1,s=new n.Vector3,h=new n.Vector3;c===l-1?(s=u[l-1].clone(),h=u[0].clone()):(s=u[c].clone(),h=u[c+1].clone());v=n.Plane.FromPoints(new n.Vector3(s.x,s.y,s.z),new n.Vector3(h.x,h.y,h.z),new n.Vector3(0,0,0));o=new n.Vector3;n.VectorHelper.IntersectSegmentPlane(t,i,v,o)&&n.VectorHelper.IsBetween(s,h,o)&&(a=!0,e.value.push(new n.Vector3(o.x,o.y,o.z)));n.VectorHelper.IntersectSegmentPlane(t,r,v,o)&&n.VectorHelper.IsBetween(s,h,o)&&(a=!0,e.value.push(new n.Vector3(o.x,o.y,o.z)));n.VectorHelper.IntersectSegmentPlane(i,r,v,o)&&n.VectorHelper.IsBetween(s,h,o)&&(a=!0,e.value.push(new n.Vector3(o.x,o.y,o.z)));a&&(f.value=f.value+1)}return e.value.length>0},i.prototype.clipOneTriangle=function(t,i,r,u,f){var o,a,v,c,s,e,y,p,h;f.value=[];try{for(o=[],o.push(new n.Vector2(t.x,t.z)),o.push(new n.Vector2(i.x,i.z)),o.push(new n.Vector2(r.x,r.z)),a=n.PolygonMath.ClipPolygon(o,u),v=a.length,c=0;c<v;c++)if(s=a[c],e=[],s){for(y=n.Plane.FromPoints(t,i,r),p=s.length,h=0;h<p;h++){var w=s[h].x,b=s[h].y,d=new n.Vector3(w,-1e4,b),g=new n.Vector3(w,1e4,b),l=new n.Vector3;n.VectorHelper.IntersectSegmentPlane(d,g,y,l)&&e.push(new n.Vector3(l.x,l.y,l.z))}e.length>0&&e.push(e[0]);f.value.push(e)}return f.value.length>0}catch(k){if(k.constructor===Object)return!1;throw k;}},i.prototype.clampPolygon=function(t){var k=n.Box.CalcRange(t),s=this.selectByBox(k),o,v,y,r,i,c,a,p,w;if(s.length<=0)return null;for(o=[],v=[],r=0;r<t.length;r++)y=t[r].clone(),v.push(new n.Vector2(y.x,y.z));var l=v,d=n.SystemHelper.ToInt(s.length/3),h=0;for(r=0;r<d;r++){var u=s[h],f=s[h+1],e=s[h+2];h=h+3;i=0;n.Math2.Contains(l,new n.Vector2(u.x,u.z))&&(i=i+1);n.Math2.Contains(l,new n.Vector2(f.x,f.z))&&(i=i+1);n.Math2.Contains(l,new n.Vector2(e.x,e.z))&&(i=i+1);var g=new n.RefValue(0),nt=new n.RefValue(null),b=this.intersectsWithTriangle(u,f,e,t,g,nt);if(i!==0||b)if(3!==i||b){for(c=new n.RefValue(null),this.clipOneTriangle(u,f,e,l,c),a=0;a<c.value.length;a++)p=c.value[a],p&&(w=n.Math3.PolygonToTriangles(p,null),w&&n.ArrayHelper.AddRange(o,w));c.value=null}else o.push(new n.Vector3(u.x,u.y,u.z)),o.push(new n.Vector3(f.x,f.y,f.z)),o.push(new n.Vector3(e.x,e.y,e.z))}return o},i}(t);n.MeshTriangleIndex=i}(Drawsee||(Drawsee={})),function(n){var r=function(){function n(n,t,i,r,u){u===void 0&&(u=0);this.bounds=n;this.depth=t;this.entries=i;this.subs=r;this.count=u}return n}(),i,t,u;n.DynOctreeBlock=r;i=function(){function n(n,t,i){this.totalSubCount=n;this.capacity=t;this.maxDepth=i}return n}();n.DynOctreeBlockSplitInfo=i;t=function(){function t(){}return t.CreateFromBounds=function(t,i,u){return new r(new n.Box(t,i),u,[],null)},t.AddEntries=function(n,i,r){for(var u=0;u<r.length;u++)t.AddEntry(n,i,r[u])},t.AddEntry=function(i,r,u){var f,s,e,o;if(n.Box.Intersects(u.bounds,r.bounds))if(r.count++,f=r.subs,f)for(s=f.length,e=0;e<s;e++)t.AddEntry(i,f[e],u);else o=r.entries,o.push(u),o.length>i.capacity&&r.depth<i.maxDepth&&t.BIc(i,r)},t.BFE=function(t,i){return new n.Vector3(t.x+i.x,t.y+i.y,t.z+i.z)},t.BIc=function(i,r){var e,o,u;r.subs=[];var f=r.bounds.min,s=r.bounds.max,h=new n.Vector3((s.x-f.x)/2,(s.y-f.y)/2,(s.z-f.z)/2),l=r.subs,a=r.entries;for(e=0;e<2;e++)for(o=0;o<2;o++)for(u=0;u<2;u=u+1){var v=t.BFE(f,h.multiplyByFloats(e,o,u)),y=t.BFE(f,h.multiplyByFloats(e+1,o+1,u+1)),c=t.CreateFromBounds(v,y,r.depth+1);t.AddEntries(i,c,a);l.push(c);i.totalSubCount++}r.entries.length=0},t.Select=function(n,i,r){var f,e,u,o;if(i.intersects(n.bounds))if(f=n.subs,f&&f.length>0)for(u=0;u<f.length;u++)t.Select(f[u],i,r);else for(e=n.entries,u=0;u<e.length;u++)o=e[u],i.intersects(o.bounds)&&r.push(o)},t}();u=function(){function n(){}return Object.defineProperty(n.prototype,"root",{get:function(){return this.Zj},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"count",{get:function(){return this.Zj.count},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"splitInfo",{get:function(){return this.BHA},enumerable:!1,configurable:!0}),n.CreateForBuild=function(r,u,f,e){f===void 0&&(f=64);e===void 0&&(e=2);var o=new n;return o.Zj=t.CreateFromBounds(r,u,0),o.BHA=new i(0,f,e),o},n.CreateForQuery=function(t){var i=new n;return i.Zj=t,i},n.prototype.add=function(n){this.BHA&&t.AddEntries(this.splitInfo,this.Zj,n)},n.prototype.select=function(n){var i=[];return t.Select(this.Zj,n,i),i},n}();n.DynOctreeIndex=u}(Drawsee||(Drawsee={})),function(n){var r=function(){function t(n){this.BID=n}return t.prototype.intersects=function(t){return!!n.VectorHelper.IntersectRayBox(this.BID,t)},t}(),t,i;n.DynOctreeRaySelector=r;t=function(){function t(n){this.BIb=n.clone()}return t.prototype.intersects=function(t){return n.VectorHelper.IntersectPlaneBox(this.BIb,t)},t}();n.DynOctreePlaneSelector=t;i=function(){function t(n){this.BGp=n}return t.prototype.intersects=function(t){return n.Box.Intersects(this.BGp,t)},t}();n.DynOctreeBoxSelector=i}(Drawsee||(Drawsee={})),function(n){var t=function(){function n(n){this.bounds=n}return n.prototype.inRegion=function(n){return this.bounds.intersects(n)},n}(),i,r;n.RectClipRegion=t;i=function(){function t(t){this.points=t;this.bounds=n.Rect.CalcRange(t)}return t.prototype.intersects=function(t){return this.bounds.intersects(t)?n._Ring2.IntersectsWithRect(this.points,t):!1},t}();r=function(){function n(){}return n.prototype.BIe=function(){},n.prototype.BHF=function(){},n.prototype.intersects=function(n){var t,i;if(!this.Bt.intersects(n))return!1;this.BHF(n);var r=this.BIY,u=this.BGN+this.BId,f=this.BFc+this.BIT;for(t=this.BGN;t<u;t++)for(i=this.BFc;i<f;i++)if(r[t][i])return!0;return!1},n}()}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var i,t,u,r,f;(function(n){n[n.Any=0]="Any";n[n.Number=1]="Number";n[n.String=2]="String"})(i=n.ObjectCacheKeyType||(n.ObjectCacheKeyType={}));t=function(){function t(n){this.accessMs=0;this.Cw=n}return t.prototype.dispose=function(){var i=this.Cw,n,t;i&&this.object&&(n=this.object,t=this.Cw._objectLoader,t?t.releaseObject(this.key,n):n&&n.dispose&&n.dispose(),i.removeObject(this.key));this.Cw=null;this.object=null},t.DisposeUnits=function(n){for(var i,t=0;t<n.length;t++)i=n[t],i&&i.dispose()},t.SortByAccessEarlyToLate=function(t){return t.sort(function(t,i){return n.g_compareTo(t.accessMs,i.accessMs)})},t}();u=function(){function r(t,r){r===void 0&&(r=i.Any);this.capacity=0;this.BKY=0;this.BHl=n.SystemTime._FrameNow();this._objectLoader=t;this.capacity=32;switch(r){case i.Any:this.BHc=new n.Dictionary;break;case i.Number:this.BHc=new n.IntKeyDictionary;break;case i.String:this.BHc=new n.StringKeyDictionary}}return r.prototype.enableTimeOutClear=function(n){n===void 0&&(n=5e3);n||(n=5e3);var t=Math.max(5e3,n);this.BKY=t},r.prototype.disEnableTimeOutClear=function(){this.BKY=0},Object.defineProperty(r.prototype,"count",{get:function(){return this.BHc.count},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"values",{get:function(){for(var t=this._enumUnits(),i=[],n=0;n<t.length;n++)i.push(t[n].object);return i},enumerable:!1,configurable:!0}),r.prototype._enumUnits=function(){for(var n,i=[],r=this.BHc.values,t=0;t<r.length;t++)n=r[t],n&&n.object&&i.push(n);return i},r.prototype.contains=function(n){return this.BHc.containsKey(n)},r.prototype.accessObject=function(t,i){var r,f,u;return(i===void 0&&(i=!1),r=this.BHc.getValue(t),r)?(f=n.SystemTime._FrameNow(),r.accessMs=f,this.BHl=f,r.object):i&&this._objectLoader?(u=this._objectLoader.loadObject(t),u&&this.addObject(t,u),u):null},r.prototype.addObject=function(i,r){var u,f;return r?this.contains(i)?!1:(u=new t(this),this.BHc.add(i,u),u.key=i,u.object=r,f=n.SystemTime._FrameNow(),u.accessMs=f,this.BHl=f,this.BHc.count>this.capacity&&(this.BKZ=!0,this.collectGabage()),!0):!1},r.prototype.collectGabage=function(){(this.BKZ||n.SystemTime._IsTimer1000)&&this.commitCollectGabage();this.BKZ=!1},r.prototype.commitCollectGabage=function(){this.BKY>0?this.BII():this.BHc.count>this.capacity&&this.BIo(0)},r.prototype.removeObject=function(n){return this.BHc.remove(n)},r.prototype.clear=function(){this.BIo(this.BHc.count)},r.prototype.BIo=function(n){var i,r;this.BHc.count>0&&(i=this._enumUnits(),n===0&&(n=i.length-Math.floor(this.capacity*.8)),n=Math.min(n,i.length),r=this.BGd(i,n),t.DisposeUnits(r))},r.prototype.BGd=function(n,i){var u,r,e,f;if(i===n.length)return n;for(n=t.SortByAccessEarlyToLate(n),u=[],r=0;r<i;r++)e=r,f=n[e],f&&u.push(f);return u},r.prototype.BII=function(){var r,u,f,n,i;if(!(this.BKY<=0)){for(r=this._enumUnits(),u=0,u=this.BHl,f=[],n=0;n<r.length;n++)i=r[n],i&&u-i.accessMs>this.BKY&&f.push(i);t.DisposeUnits(f)}},r}();n.ObjectCache=u;r=function(){function i(){}return i.NextId=function(){return i.BIU++},i.Register=function(n){n&&i.BGw.add(n.no,n);i.BIu()},i.UnRegister=function(n){n&&i.BGw.remove(n.no)},i.BIu=function(){var r,t,u;i.BIn||(r=n.SystemHelper.GetMemoryLimitMBytes(),t=n.Drawing3DSetting._GetCombinedLodRatio(),t*=t,u=Math.min(4096,Math.max(256,r*t*2)),i.BIn=u*1048576)},i.CollectGabage=function(){n.SystemTime._IsTimer1000&&this.BJB()},i.BJq=function(){var t=n.Drawing3DSetting.CacheRatio?n.Drawing3DSetting.CacheRatio:1;return this.BIn*t},i.BJB=function(){var e=this.BGw.values,r,c,l,v,y,s,f,h,i;if(!(e.length<=0)){for(r=[],i=0;i<e.length;i++)c=e[i],l=c._enumUnits(),r=r.concat(l);var a=n.SystemTime._FrameNow(),o=a,u=0;for(u=0,i=r.length-1;i>=0;i--)f=r[i],f.object.cacheBytes&&(u+=f.object.cacheBytes),o=Math.min(o,f.accessMs);if(!(u<this.BJq())&&(!(a-o<2e3)||(this.BIn=Math.min(8589934592,this.BIn*2),!(u<this.BJq())))){for(v=this.BJq(),r=t.SortByAccessEarlyToLate(r),y=v*.75,u=0,i=r.length-1;i>=0;i--)if(f=r[i],f.object.cacheBytes&&(u+=f.object.cacheBytes),u>y){s=i;break}if(h=[],s)for(i=s;i>=0;i--)h.push(r[i]);t.DisposeUnits(h)}}},i.BGw=new n.IntKeyDictionary,i.BIU=1,i}();n._SizeBasedObjectCacheManager=r;f=function(n){function t(t){var u=n.call(this,t,i.Number)||this;return u.no=r.NextId(),r.Register(u),u}return __extends(t,n),t.prototype.commitCollectGabage=function(){},t}(u);n.SizeBasedObjectCache=f}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var i=function(t){function i(){var i=t!==null&&t.apply(this,arguments)||this;return i.alpha=1,i.isPickable=!1,i.isObjectAlwaysVisible=!1,i.isAnimation=!1,i.OC=!0,i.ZV=new n.RenderObservableBase,i}return __extends(i,t),Object.defineProperty(i.prototype,"isVisible",{get:function(){return this.OC},set:function(n){this.OC=n;this.onSetVisible()},enumerable:!1,configurable:!0}),i.prototype.onSetVisible=function(){},Object.defineProperty(i.prototype,"onBeforeRender",{get:function(){return this.ZV.onBeforeRender},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onAfterRender",{get:function(){return this.ZV.onAfterRender},enumerable:!1,configurable:!0}),i.prototype.notifyOnBeforeRender=function(){this.ZV.notifyOnBeforeRender(this)},i.prototype.notifyOnAfterRender=function(){this.ZV.notifyOnAfterRender(this)},i}(n.NameObject),t;n.Layer=i;t=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.isVisible=!0,t}return __extends(t,n),t.prototype.hasAnimation=function(){for(var i,t=0;t<this.length;t++)if(i=n.prototype.getAt.call(this,t),i&&i.isVisible&&i.isAnimation)return!0;return!1},t}(n.NameObjectList);n.LayerCollection=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var i=function(){function t(){this.BJL=[];this.BKh=new n.HashSet;this.BMP=!1;this.BFZ()}return Object.defineProperty(t.prototype,"count",{get:function(){return this.BJL.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasButtonDown",{get:function(){return this.BMP},enumerable:!1,configurable:!0}),t.prototype.BFZ=function(){this.BKh.add(87);this.BKh.add(24);this.BKh.add(26);this.BKh.add(23);this.BKh.add(25);this.BKh.add(19);this.BKh.add(20);this.BKh.add(57);this.BKh.add(56)},t.prototype.pushMouseMessage=function(t,i,r){var u,f;if(t===n.OperMouseMsgType.LeftButtonDown||t===n.OperMouseMsgType.RightButtonDown?this.BMP=!0:(t===n.OperMouseMsgType.LeftButtonUp||t===n.OperMouseMsgType.RightButtonUp)&&(this.BMP=!1),t===n.OperMouseMsgType.MouseMove){if(u=this.BMM(),u&&u.mouseMsg===t){u.point=r.clone();return}}else this.BJL.length>1&&n.ArrayHelper.Clear(this.BJL);f=n.OperMessageCommon.CreateMouse(t,i,r);f.hasButtonDown=this.BMP;this.BJL.push(f)},t.prototype.pushKeyMessage=function(t,i,r){var u=this.BMM();u&&u.keyCode===i&&u.isKeyDown===t||(t||n.ArrayHelper.Clear(this.BJL),this.BJL.push(n.OperMessageCommon.CreateKey(t,i,r)))},t.prototype.getNextMessage=function(){if(this.BJL.length>0){var n=this.BJL[0];return this.BJL.length===1&&n.isKeyDown&&this.BKh.contains(n.keyCode)?n:(this.BJL.splice(0,1),n)}return null},t.prototype.BMM=function(){return this.BJL.length>0?this.BJL[this.BJL.length-1]:null},t.prototype.isOnlyMouseMove=function(){var t,i;if(this.BMP)return!1;for(t=0;t<this.BJL.length;t++)if(i=this.BJL[t],i.mouseMsg!==n.OperMouseMsgType.MouseMove)return!1;return!0},t}(),r,t;n._MessageQueueBase=i;r=function(i){function r(){var n=i.call(this)||this;return n.BMC=!1,n}return __extends(r,i),r.prototype.attachUI=function(n,i){this.BKc=n;this.BLG=i;this.BHU(i);this.BJo=new t(i)},r.prototype.BHU=function(n){var t=this;this.BLB=n;window.addEventListener("keyup",function(n){t.BMV(n)},!1);window.addEventListener("keydown",function(n){t.BMO(n)},!1);n.addEventListener("mousedown",function(n){t.BGM(n)},!1);n.addEventListener("mouseup",function(n){t.BML(n)},!1);n.addEventListener("mousewheel",function(n){t.BLD(n)},!1);n.addEventListener("DOMMouseScroll",function(n){t.BGx(n)},!1);n.addEventListener("mousemove",function(n){t.BLU(n)},!1);n.addEventListener("touchstart",function(n){t.UO(n)},!1);n.addEventListener("touchmove",function(n){t.BLf(n)},!1);n.addEventListener("touchend",function(n){t.BLm(n)},!1);n.addEventListener("mouseenter",function(){t.BMC=!0},!1);n.addEventListener("mouseleave",function(){t.BMC=!1},!1);n.oncontextmenu=function(){return!1}},r.prototype.BGM=function(t){t.preventDefault();n.Keyboard.UpdateModifierKey(t);t.button===0?this.BLc(t):t.button===2&&this.BLM(t)},r.prototype.BML=function(t){t.preventDefault();n.Keyboard.UpdateModifierKey(t);t.button===0?this.BLS(t):t.button===2&&this.BMT(t)},r.prototype.BLU=function(t){t.preventDefault();n.Keyboard.UpdateModifierKey(t);this.pushMouseMessage(n.OperMouseMsgType.MouseMove,0,this.BMI(t));this.BKc&&this.BKc.onMouseMove.notifyObservers(this.BLb(t))},r.prototype.BLD=function(t){t.preventDefault();n.Keyboard.UpdateModifierKey(t);this.pushMouseMessage(n.OperMouseMsgType.MouseWheel,t.wheelDelta,new n.Vector2);this.BKc&&this.BKc.onMouseWheel.notifyObservers(this.BJW(t))},r.prototype.BMO=function(t){n.Keyboard.UpdateModifierKey(t);this.BMC&&this.pushKeyMessage(!0,n.WindowsHelper.KeyFromJs(t.keyCode),0)},r.prototype.BMV=function(t){n.Keyboard.UpdateModifierKey(t);this.BMC&&this.pushKeyMessage(!1,n.WindowsHelper.KeyFromJs(t.keyCode),0)},r.prototype.UO=function(t){var i,r;t.preventDefault();this.BJo.onTouchStart(t);(i=this.BJo.currentPoint,i)&&(this.BJo.isZooming||(r=n.WindowsHelper.IsDoubleClick(new n.MouseButtonEventArgs(i),20),this.BJo.isRightButton?r?this.pushMouseMessage(n.OperMouseMsgType.RightButtonDoubleClick,0,i):this.pushMouseMessage(n.OperMouseMsgType.RightButtonDown,0,i):r?this.pushMouseMessage(n.OperMouseMsgType.LeftButtonDoubleClick,0,i):(this.pushMouseMessage(n.OperMouseMsgType.LeftButtonDown,0,i),this.pushMouseMessage(n.OperMouseMsgType.MouseMove,0,i))))},r.prototype.BLf=function(t){var i,r;this.BJo.onTouchMove(t);(i=this.BJo.currentPoint,i)&&(this.BJo.isZooming?(r=this.BJo.getWheelDeltaAndClear(),r!==0&&this.pushMouseMessage(n.OperMouseMsgType.MouseWheel,r,new n.Vector2)):this.pushMouseMessage(n.OperMouseMsgType.MouseMove,0,i),t.preventDefault())},r.prototype.BLm=function(t){var i=this.BJo.currentPoint;if(i){if(t.preventDefault(),this.BJo.isZooming){this.pushMouseMessage(n.OperMouseMsgType.LeftButtonUp,0,i);return}this.BJo.isRightButton?this.pushMouseMessage(n.OperMouseMsgType.RightButtonUp,0,i):this.pushMouseMessage(n.OperMouseMsgType.LeftButtonUp,0,i)}},r.prototype.BGx=function(t){t.preventDefault();this.pushMouseMessage(n.OperMouseMsgType.MouseWheel,-t.detail,new n.Vector2)},r.prototype.BMG=function(){},r.prototype.BKe=function(){},r.prototype.BLi=function(t){return new n.MouseButtonEventArgs(this.BMI(t))},r.prototype.BLb=function(t){return new n.MouseEventArgs(this.BMI(t))},r.prototype.BJW=function(t){var i=new n.MouseWheelEventArgs(this.BMI(t));return i.delta=-t.detail,i},r.prototype.BLc=function(t){this.BMG();this.BLG.focus();var i=this.BMI(t),r=n.WindowsHelper.IsDoubleClick(new n.MouseButtonEventArgs(i));r?this.pushMouseMessage(n.OperMouseMsgType.LeftButtonDoubleClick,0,i):this.pushMouseMessage(n.OperMouseMsgType.LeftButtonDown,0,i);this.BKc&&this.BKc.onMouseLeftButtonDown.notifyObservers(this.BLi(t))},r.prototype.BLS=function(t){this.pushMouseMessage(n.OperMouseMsgType.LeftButtonUp,0,this.BMI(t));this.BKe();this.BKc&&this.BKc.onMouseLeftButtonUp.notifyObservers(this.BLi(t))},r.prototype.BLM=function(t){this.BMG();var i=this.BMI(t),r=n.WindowsHelper.IsDoubleClick(new n.MouseButtonEventArgs(i));r?this.pushMouseMessage(n.OperMouseMsgType.RightButtonDoubleClick,0,i):this.pushMouseMessage(n.OperMouseMsgType.RightButtonDown,0,i);this.BKc&&this.BKc.onMouseRightButtonDown.notifyObservers(this.BLi(t))},r.prototype.BMT=function(t){this.pushMouseMessage(n.OperMouseMsgType.RightButtonUp,0,this.BMI(t));this.BKe();this.BKc&&this.BKc.onMouseRightButtonUp.notifyObservers(this.BLi(t))},r.prototype.BMI=function(t){return new n.Vector2(t.offsetX,t.offsetY)},r}(i);n._MessageQueue=r;t=function(){function t(n){this.BLk=!1;this.BKt=!1;this.BEj=!1;this.BLK=0;this.BLY=-1;this.BKw=-1;this.BLB=n}return Object.defineProperty(t.prototype,"isStart",{get:function(){return this.BLk},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRightButton",{get:function(){return this.BKt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isZooming",{get:function(){return this.BEj},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentPoint",{get:function(){return this.BJm},enumerable:!1,configurable:!0}),t.prototype.getWheelDeltaAndClear=function(){if(this.BLK===0)return 0;var n=this.BLK;return this.BLK=0,this.BLs(),n},t.prototype.onTouchStart=function(n){this.Jw();this.BIv(n,!0);this.BJm&&(this.BLt=this.BJm.clone(),this.BLk=!0)},t.prototype.onTouchMove=function(n){(this.BJm=null,this.BLk)&&this.BIv(n,!1)},t.prototype.onTouchEnd=function(){this.BLk=!1;this.Jw()},t.prototype.Jw=function(){this.BLt=null;this.BLA=null;this.BLY=-1;this.BKw=-1;this.BKt=!1;this.BEj=!1},t.prototype.BLs=function(){this.BMH&&(this.BLt=this.BMH.clone());this.BLV&&(this.BLA=this.BLV.clone());this.BMH=null;this.BLV=null},t.prototype.BIv=function(t,i){if(this.BJm=null,!(t.touches.length<=0)){var r=new n.Vector2(t.touches[0].clientX,t.touches[0].clientY);this.BJs(r)&&(i&&this.BLX(t),this.BLE(t),this.BJm=this.BLl(r),i&&!this.isZooming&&(this.BKt=this.BKi(this.BJm)))}},t.prototype.BLX=function(t){t.touches.length>1&&(this.BLt=this.BLl(new n.Vector2(t.touches[0].clientX,t.touches[0].clientY)),this.BLY=t.touches[0].identifier,this.BLA=this.BLl(new n.Vector2(t.touches[1].clientX,t.touches[1].clientY)),this.BKw=t.touches[1].identifier)},t.prototype.BLE=function(t){if(this.BLt&&this.BLA&&!(t.touches.length<2)&&(this.BMH=this.BLe(t,this.BLY),this.BLV=this.BLe(t,this.BKw),this.BMH&&this.BLV)){var r=n.Math2.DistancePoint(this.BLt,this.BLA),u=n.Math2.DistancePoint(this.BMH,this.BLV),i=u-r;Math.abs(i)<30?i=0:(this.BLK=i>0?1:-1,this.BEj=!0)}},t.prototype.BLe=function(t,i){for(var r=0;r<t.touches.length;r++)if(t.touches[r].identifier===i)return this.BLl(new n.Vector2(t.touches[r].clientX,t.touches[r].clientY));return null},t.prototype.BJs=function(t){var i=this.BLB.getBoundingClientRect(),r=new n.Rect(i.left,i.top,i.width,i.height);return r.contains(t)},t.prototype.BKi=function(n){var t=this.BLB;if(n.y<t.clientHeight*.2)return!1;var u=Math.min(t.clientWidth/12,80),f=Math.min(t.clientHeight/12,80),i=t.clientWidth-n.x,r=t.clientHeight-n.y;return i>0&&i<u||r>0&&r<f},t.prototype.BLl=function(t){var i=this.BLB.getBoundingClientRect();return new n.Vector2(t.x-i.left,t.y-i.top)},t}();n._TouchEventHandler=t}(Drawsee||(Drawsee={})),function(n){var t,f,r,u,i,e;(function(n){n[n.None=0]="None";n[n.LeftButtonDown=10]="LeftButtonDown";n[n.LeftButtonUp=11]="LeftButtonUp";n[n.LeftButtonDoubleClick=12]="LeftButtonDoubleClick";n[n.RightButtonDown=20]="RightButtonDown";n[n.RightButtonUp=21]="RightButtonUp";n[n.RightButtonDoubleClick=22]="RightButtonDoubleClick";n[n.MouseMove=30]="MouseMove";n[n.MouseWheel=40]="MouseWheel"})(t=n.OperMouseMsgType||(n.OperMouseMsgType={}));f=function(){function r(){this.mouseMsg=t.None;this.point=new n.Vector2;this.pointDevice=new n.Vector2;this.mouseParam=0;this.hasButtonDown=!1;this.keyCode=0;this.isKeyDown=!1;this.keyParam=0;this.keyModifiers=0}return r.CreateMouse=function(n,t,u){var f=new r;return f.keyModifiers=i.GetModifierKeys(),f.mouseMsg=n,f.point=u.clone(),f.pointDevice=u.clone(),f.mouseParam=t,f},r.CreateKey=function(n,t,u){var f=new r;return f.keyModifiers=i.GetModifierKeys(),f.isKeyDown=n,f.keyCode=t,f.keyParam=u,f},r}();n.OperMessageCommon=f;r=function(){function n(n,t,i,r){this.point=n;this.pointDevice=t;this.modifier=i;this.mouseParam=r;this.keyModifiers=0}return n.prototype.isModifierKeyDown=function(n){return(this.keyModifiers&n)===n},n}();n.OperMouseMessage=r;u=function(){function n(n,t,i,r){this.keyCode=n;this.isKeyDown=t;this.modifier=i;this.keyParam=r}return n.prototype.isModifierKeyDown=function(n){return(this.modifier&n)===n},n}();n.OperKeyMessage=u;i=function(){function t(){}return t.GetModifierKeys=function(){return n.SystemHelper.ToInt(n.Keyboard.Modifiers)},t}();n.OperKeybord=i;e=function(){function n(){this.BKU=!1;this.BKF=!1}return Object.defineProperty(n.prototype,"isTaskStarted",{get:function(){return this.BKU},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isTaskFinish",{get:function(){return this.BKF},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"cursor",{get:function(){return this.BMK},set:function(n){this.BMK=n},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sonOper",{get:function(){return this.BLW},set:function(n){this.BLW=n;this.BLW&&(this.BLW.fatherOper=this)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fatherOper",{get:function(){return this.BLJ},set:function(n){this.BLJ=n},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"topSonOper",{get:function(){return this.BLW?this.BLW.topSonOper:this},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"topfatherOper",{get:function(){return this.BLJ?this.BLJ.topfatherOper:this},enumerable:!1,configurable:!0}),n.prototype.handleMessage=function(n){var e,i,f;if(n.keyCode>0)return e=new u(n.keyCode,n.isKeyDown,n.keyModifiers,n.keyParam),n.isKeyDown?this.onKeyDown(e):this.onKeyUp(e);if(n.mouseMsg!==t.None)if(i=new r(n.point,n.pointDevice,n.keyModifiers,n.mouseParam),f=n.mouseMsg,f<=t.RightButtonDoubleClick)switch(f){case t.LeftButtonDown:return this.onLeftButtonDown(i);case t.LeftButtonUp:return this.onLeftButtonUp(i);case t.LeftButtonDoubleClick:return this.onLeftButtonDblClk(i);default:switch(f){case t.RightButtonDown:return this.onRightButtonDown(i);case t.RightButtonUp:return this.onRightButtonUp(i);case t.RightButtonDoubleClick:return this.onRightButtonDblClk(i)}}else if(f!==t.MouseMove){if(f===t.MouseWheel)return this.onMouseWheel(i)}else return this.onMouseMove(i)},n.prototype.onDraw=function(){this.BLW&&this.BLW.onDraw()},n.prototype.resetTask=function(){this.BKU=!1;this.BKF=!1;this.BLW&&this.BLW.resetTask()},n.prototype.startTask=function(){this.BKU=!0;this.BLJ&&this.BLJ.onSonOperStartTask()},n.prototype.completeTask=function(){this.BKF=!0;this.BKU=!1;this.BLJ&&this.BLJ.sonOper===this&&this.BLJ.onSonOperCompleteTask()},n.prototype.cancelTask=function(){this.BKU=!1;this.BLJ&&this.BLJ.sonOper===this&&this.BLJ.onSonOperCancelTask()},n.prototype.failTask=function(){this.BKU=!1;this.BLJ&&this.BLJ.sonOper===this&&this.BLJ.onSonOperFailTask()},n.prototype.onSonOperStartTask=function(){this.startTask()},n.prototype.onSonOperCompleteTask=function(){this.BLW.resetTask();this.completeTask()},n.prototype.onSonOperCancelTask=function(){this.BLW.resetTask();this.cancelTask()},n.prototype.onSonOperFailTask=function(){this.BLW.resetTask();this.failTask()},n.prototype.notifyFather=function(){this.BLJ&&this.BLJ.onSonOperNotify()},n.prototype.onSonOperNotify=function(){this.notifyFather()},n.prototype.notifyFatherDraw=function(){this.BLJ&&this.BLJ.onSonOperDraw()},n.prototype.onSonOperDraw=function(){},n.prototype.onKeyDown=function(n){return this.BLW&&this.BLW.onKeyDown(n)},n.prototype.onKeyUp=function(n){return this.BLW&&this.BLW.onKeyUp(n)},n.prototype.onLeftButtonDblClk=function(n){return this.BLW&&this.BLW.onLeftButtonDblClk(n)},n.prototype.onLeftButtonDown=function(n){return this.BLW&&this.BLW.onLeftButtonDown(n)},n.prototype.onLeftButtonUp=function(n){return this.BLW&&this.BLW.onLeftButtonUp(n)},n.prototype.onMouseMove=function(n){return this.BLW&&this.BLW.onMouseMove(n)},n.prototype.onMouseWheel=function(n){return this.BLW&&this.BLW.onMouseWheel(n)},n.prototype.onRightButtonDblClk=function(n){return this.BLW&&this.BLW.onRightButtonDblClk(n)},n.prototype.onRightButtonDown=function(n){return this.BLW&&this.BLW.onRightButtonDown(n)},n.prototype.onRightButtonUp=function(n){return this.BLW&&this.BLW.onRightButtonUp(n)},n}();n.OperationBase=e}(Drawsee||(Drawsee={})),function(n){var f=function(){function n(){this.lodParam=new t(0)}return n}(),t,i,r,u;n.AsyncRenderableParam=f;t=function(){function t(t){this.lod=0;this.localEyePos=new n.Vector3;this.globalEyePos=new n.Vector3;this.objectCenter=new n.Vector3;this.lod=t}return t.CreatePoint=function(n,i,r){var u=new t(n);return u.localEyePos=i.clone(),u.globalEyePos=r.clone(),u},t}();n.AsyncRenderableParam_LodParams=t;i=function(){function n(){}return n.Copy=function(n,t){t.alpha=n.alpha;t.isEnableDepthBuffer=n.isEnableDepthBuffer;t.isEnableDepthWrite=n.isEnableDepthWrite;t.isEnableColorWrite=n.isEnableColorWrite;t.isReceiveShadow=n.isReceiveShadow;t.isCulling=n.isCulling;t.isUseLight=n.isUseLight;t._customScene=n._customScene},n}();n._RenderStateHelper=i;r=function(){function n(){this.alpha=1;this.isEnableDepthBuffer=!0;this.isEnableDepthWrite=!0;this.isEnableColorWrite=!0;this.isReceiveShadow=!1;this.isUseLight=!0;this.isCulling=!1}return n}();n.RenderStateBase=r;u=function(){function t(){}return Object.defineProperty(t.prototype,"onBeforeRender",{get:function(){return this.BJF||(this.BJF=new n.Observable),this.BJF},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{get:function(){return this.BHp||(this.BHp=new n.Observable),this.BHp},enumerable:!1,configurable:!0}),t.prototype.notifyOnBeforeRender=function(n){this.BJF&&this.BJF.notifyObservers(n)},t.prototype.notifyOnAfterRender=function(n){this.BHp&&this.BHp.notifyObservers(n)},t}();n.RenderObservableBase=u}(Drawsee||(Drawsee={})),function(n){function t(n){var i,t,r;if(n[0]==91&&n[n.length-1]==93){for(i="",t=0;t<n.length;t++)i+=String.fromCharCode(n[t]);return r=eval(i),new Uint8Array(r)}return n}var i=function(){function n(n,t){this.BFO=!0;this.Cn=new XMLHttpRequest;this.BFO=n;this.BEv=t}return n.prototype.read=function(n){var i=this;return new Promise(function(r,u){i.BFT(n,!0,function(){var f=i.Cn,n;f.status===404?u(null):f.readyState===4&&f.status==200&&(n=void 0,f.response&&(n=i.BFO?t(new Uint8Array(i.Cn.response)):i.Cn.response),i.BEv&&(n=t(n)),r(n))},function(){u(null)})})},n.prototype.BFT=function(n,t,i,r){try{this.Cn.open("GET",n,t);this.Cn.onreadystatechange=i;this.Cn.onerror=r;this.BFO&&(this.Cn.responseType="arraybuffer");this.Cn.send(null)}catch(u){r&&r()}},n}();n.AsyncDataReader=i}(Drawsee||(Drawsee={})),function(n){var t=function(){function n(n,t,i){i===void 0&&(i=null);this.count=n;this.datas=t;this.processedData=i}return n}(),i,u,r;n.AsyncWebStreamResultPackage=t;i=function(){function t(t,i,r,u,f){u===void 0&&(u=null);f===void 0&&(f=n.AsyncDataLoadType.ArrayBuffer);this.taskName=t;this.url=i;this.callback=r;this.tag=u;this.type=f}return t}();n.AsyncWebStreamTask=i;u=function(){function n(n,t,i){this.datas=n;this.rawDataBytes=t;this.processedData=i}return n}();r=function(){function i(){}return i.ReadDirectUint8Array=function(t){var i=new n.AsyncDataReader(!0,!1);return i.read(t)},i.ReadDirect=function(t){var i=new n.AsyncDataReader(!1,!1);return i.read(t)},i.BHH=function(n,t){n.callback&&n.callback(n.url,n.url,t)},i.AddTaskBatch=function(n){var i=n.length,t;if(!(i<=0)){for(t=0;t<i;t++)this.BFn.push(n[t]);this.BHg()}},i.GetLoadingCount=function(){return this.BHL.count},i.IsLoading=function(n){return this.BHL.containsKey(n)},i.BHg=function(){var r,t,u;if(!(this.BFn.length<=0)&&!(this.BHL.count>=this.MaxLoading)){var n=[],i=this.BFn,f=this.MaxLoading-this.BHL.count,e=i.length;for(r=0;r<e;r++)if((t=i[0],u=t.url,!this.BHL.containsKey(u))&&(this.BHL.add(u,t),i.splice(0,1),n.push(t),n.length>=f))break;n.length>0&&this.BHv(n)}},i._InitLoadWorker=function(){this.BGJ||(this.BGJ=i.BHs())},i.BHs=function(){var t=n.SystemHelper.CreateWorker("loadWorker");return t.onmessage=i.BFM,t},i.BHv=function(n){n.length<=0||this.BFV(this.BGJ,n)},i.BFV=function(t,i){var r,u,o;if(!(i.length<=0)){var s=n.SystemTime._FrameNow(),f=[],e=[];for(r=0;r<i.length;r++)u=i[r],u._startMs=s,f.push(u.type),e.push(u.url);o={types:f,urls:e};t.postMessage(o)}},i._IsFastNet=function(){if(this.BHQ>=.5){var n=this.BEZ/this.BHQ;this.BIB=this.BIB<=0?n:this.BIB*.8+n*.2;this.BEZ=0;this.BHQ=0}return this.BIB>1},i.BFM=function(r){var s=r.data.url,u=i.BHL.getValue(s),f,e,o;u&&(f=null,r.data&&r.data.data&&(e=r.data.data,i.BHQ+=(n.SystemTime._FrameNow()-u._startMs)*.001,i.BEZ+=e.rawDataBytes/1048576,u.type===n.AsyncDataLoadType.TileMesh?f=new t(0,[],e.processedData):(o=e.datas,f=u.type===n.AsyncDataLoadType.ArrayBufferOrPackage?new t(o.length,o):o[0])),i.BHL.remove(s),i.BHg(),i.BHH(u,f))},i.IsAllowUseCache=!0,i.BHL=new n.StringKeyDictionary,i.BFn=[],i.MaxLoading=8,i.BHQ=0,i.BEZ=0,i.BIB=0,i}();n.AsyncWebStream=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var i,r,u;(function(n){n[n.TileMesh=1]="TileMesh";n[n.Octree=2]="Octree"})(i||(i={}));r=function(){function n(n){this.resolve=n;this.id=t._NextId()}return n}();u=function(){function n(n,t){this.index=n;this.triPointFloats=t}return n}();n.OctreeIndexCreateResult=u;var f=function(n){function t(t,i){var r=n.call(this,t)||this;return r.resolve=t,r.vs=i,r}return __extends(t,n),t}(r),e=function(){function r(){this.taskMax=64;this.BDL=0;this.BFn=[]}return r.prototype.addTask=function(n){var i=this;return new Promise(function(r){if(i.BDL>=i.taskMax){r(null);return}i.BDL++;var u=new f(r,n);t._AddTaskIdMapping(u);i.BFn.push(u)})},r.prototype.sendTasks=function(){var r,u,f,n,e;if(!(this.BFn.length<=0)){for(r=[],u=[],f=0;f<this.BFn.length;f++)n=this.BFn[0],n.vs&&(e=new Float32Array(n.vs.data.buffer),r.push({id:n.id,data:e}),u.push(e.buffer)),this.BFn.splice(0,1);t._PostMessageToWorker(i.Octree,r,u)}},r.prototype.resolveMessageFromWorker=function(n){var t=n.data;this.BBe(t)},r.prototype.BBe=function(i){for(var s,h,o=i.results,e=0;e<o.length;e++){if(s=o[e].id,h=t._GetTaskFromId(s),h){var r=o[e].data,c=null,f=r.binderBoundsArray,l=new n.Box(new n.Vector3(f[0],f[1],f[2]),new n.Vector3(f[3],f[4],f[5])),a=n.BoundsBinder.Create(l,r.binderMin,r.binderMax);c=new n.QueryOctreeIndex(a,r.bounds,r.addrs,r.subs,r.entries);h.resolve(new u(c,r.triPointFloats))}t._RemoveTaskIdMapping(s);this.BDL--}},r}(),o=function(){function u(){this.BFn=[]}return u.prototype.getTaskCount=function(){return this.BFn.length},u.prototype.addTask=function(n){var i=this;return new Promise(function(u){var f=new r(u),e;t._AddTaskIdMapping(f);e={id:f.id,data:n};i.BFn.push(e)})},u.prototype.sendTasks=function(){var r=this.BFn,f,u;if(!(r.length<=0)){for(this.BFn=[],f=[],u=0;u<r.length;u++)n.ArrayHelper.AddRange(f,r[u].data.getTransferObjects());t._PostMessageToWorker(i.TileMesh,r,f)}},u.prototype.resolveMessageFromWorker=function(n){for(var u,i,e=n.data,f=e.results,r=0;r<f.length;r++)u=f[r],i=t._GetTaskFromId(u.id),i&&(t._RemoveTaskIdMapping(i.id),i.resolve(u.data))},u}(),t=function(){function t(){}return t._NextId=function(){return this.BDe++},t._AddTaskIdMapping=function(n){this.BGO[n.id]=n},t._GetTaskFromId=function(n){return this.BGO[n]},t._RemoveTaskIdMapping=function(n){this.BGO[n]=undefined},t.CreateTriangleIndex=function(n){return this.BEf.getTaskCount()>0?new Promise(function(n){n(null)}):this.BFY.addTask(n)},t.ProcessTileMesh=function(n){return this.BEf.addTask(n)},t._InitProcessWorker=function(){var i=this,t;this.BEU||(t=n.SystemHelper.CreateWorker("processWorker"),t.onmessage=function(n){i.BFI.push(n)},this.BEU=t)},t._PostMessageToWorker=function(n,t,i){if(!(t.length<=0)){var r={type:n,tasks:t};this.BEU.postMessage(r,i)}},t.BGH=function(n){for(var r,t=this.BFI,i=0;i<t.length;i++)if(r=t[0],t.splice(0,1),this.BGT(r),n.isTimeOut())break},t.BGT=function(n){var t=n.data;t.type===i.Octree?this.BFY.resolveMessageFromWorker(n):t.type===i.TileMesh&&this.BEf.resolveMessageFromWorker(n)},t._CommitTasks=function(n,t){this.BGH(n,t);this.BFI.length<=0&&(this.BEf.getTaskCount()>0?this.BEf.sendTasks():this.BFY.sendTasks())},t.BDe=1,t.BGO=[],t.BFY=new e,t.BEf=new o,t.BFI=[],t}();n.AsyncProcess=t}(Drawsee||(Drawsee={})),function(n){var f=function(){function n(n,t){this.priority=0;this.key=n;this.priority=t}return n}(),i,t,r;n.CacheTask=f,function(n){n[n.ArrayBuffer=0]="ArrayBuffer";n[n.ArrayBufferOrPackage=1]="ArrayBufferOrPackage";n[n.TileMesh=10]="TileMesh";n[n.Image=100]="Image"}(i=n.AsyncDataLoadType||(n.AsyncDataLoadType={})),function(n){n[n.Common=0]="Common";n[n.Low=-10]="Low";n[n.System=10]="System"}(t=n.AsyncDataPriority||(n.AsyncDataPriority={}));r=function(){function n(n,t,i){this.url=n;this.data=t;this.isBadUrl=i}return n}();n.AsyncDataLoadResult=r;var e=function(){function n(n,t,i,r,u){this.type=n;this.url=t;this.priority=i;this.resolve=r;this.tag=u}return n}(),o=function(){function u(){this.BFy=32;this.BDP=16;this.BFj=[];this.BDm=[];this.BGX=[];this.BDq=new n.StringKeyDictionary;this.BDH=n.AsyncWebStream.MaxLoading;this.BCj=0}return u.prototype.isLoading=function(n){return this.BDq.containsKey(n)},u.prototype.canLoadData=function(){return this.BDm.length+n.AsyncWebStream.GetLoadingCount()<n.AsyncWebStream.MaxLoading},u.prototype.canLoadImage=function(){return this.BGX.length+this.BCj<this.BFy},u.prototype.loadAsync=function(n,r,u,f){var o=this;return u===void 0&&(u=null),f===void 0&&(f=t.Common),new Promise(function(s){var c=n===i.Image&&o.canLoadImage()||n!==i.Image&&(f===t.System||o.canLoadData()),h;if(!c){s(null);return}h=new e(n,r,f,s,u);f===t.System&&n!==i.Image?o.BFj.push(h):n===i.Image?o.BGX.push(h):o.BDm.push(h);o.BDq.add(r,h)})},u.prototype.commitTasks=function(){var n=this.BDf(),t=this.BGL(this.BDP);n.length>0&&this.BFU(n);t.length>0&&this.BGS(t)},u.prototype.BDf=function(){for(var r=n.AsyncWebStream.GetLoadingCount(),t=[],i=0;i<this.BFj.length;i++){if(t.length+r>this.BDH)break;t.push(this.BFj.splice(0,1)[0])}for(i=0;i<this.BDm.length;i++){if(t.length+r>this.BDH)break;t.push(this.BDm.splice(0,1)[0])}return t},u.prototype.BGL=function(n){for(var t=[],i=0;i<this.BGX.length;i++){if(t.length+this.BCj>n)break;t.push(this.BGX.splice(0,1)[0])}return t},u.prototype.BFU=function(t){var e=this,f,u,i,o;if(!(t.length<=0)){for(f=[],u=0;u<t.length;u++)i=t[u],o=new n.AsyncWebStreamTask(i.url,i.url,function(n,t,i){var u=e.BDq.getValue(t),f;u&&(f=!i,u.resolve(new r(t,i,f)));e.BDq.remove(t)},i.tag,i.type),f.push(o);n.AsyncWebStream.AddTaskBatch(f)}},u.prototype.BGS=function(n){for(var t=0;t<n.length;t++)this.BEq(n[t])},u.prototype.BEq=function(t){var u=this,i=n.WindowsHelper.CreateImage(),e=t.resolve,o=t.tag,f=t.url;this.BCj++;i.onload=function(){u.BCj--;u.BDq.remove(t.url);e(new r(f,i,!1))};i.onerror=function(){u.BCj--;u.BDq.remove(t.url);e(new r(f,i,!0))};i.decoding="async";i.src=f},u}(),u=function(){function n(n){n===void 0&&(n=!0);this.isFinish=n}return n}();n.DataPrepareState=u;var s=function(){function n(n,t,i){this.data=n;this.callback=t;this.resolve=i}return n}(),h=function(){function i(){this.BEr=[];this.BFn=[];this.BHB=0}return i.prototype.addPrepareDataTask=function(r,u,f){var o=this,e;return(f===void 0&&(f=t.Common),this.BEr.length+this.BFn.length>=i.Ct)?null:(e=new n.PromiseDelegate(function(){o.BFS(r,u,f).then(function(){e.onThen()})}),e.tryInvoke(),e)},i.prototype.BFS=function(n,i,r){var u=this;return r===void 0&&(r=t.Common),new Promise(function(f){var e=new s(n,i,f);r===t.System?u.BEr.push(e):u.BFn.push(e)})},i.prototype.commitTasks=function(n){this.BEr.length>0&&this.BHE(n,this.BEr);this.BFn.length>0&&this.BHE(n,this.BFn)},i.prototype.BHE=function(n,t){for(var i,f,r=0;r<t.length;r++)if(i=t[0],f=new u,i.callback(i.data,f),f.isFinish){if(i.resolve(!0),t.splice(0,1),n.isTimeOut())break}else break},i.Ct=8,i}(),c=function(){function n(){}return n.LoadData=function(i,r,u,f){return u===void 0&&(u=null),f===void 0&&(f=t.Common),n.BHe.loadAsync(i,r,u,f)},n.IsLoading=function(t){return n.BHe.isLoading(t)},n.CanLoadData=function(){return n.BHe.canLoadData()},n.CanLoadImage=function(){return n.BHe.canLoadImage()},n.CommitLoadTasks=function(t){n.BHe.commitTasks(t)},n.PrepareData=function(i,r,u){return u===void 0&&(u=t.Common),n.BIH.addPrepareDataTask(i,r,u)},n.CommitPrepareTasks=function(t){n.BIH.commitTasks(t)},n._SetActive=function(){this.BGa=!0},Object.defineProperty(n,"_IsActive",{get:function(){return this.BGa},enumerable:!1,configurable:!0}),n.BHe=new o,n.BIH=new h,n}();n.AsyncRenderContext=c}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){function dt(n){n&&(c[n.uiid]||(c[n.uiid]=n.uiid,c.push(n)))}function gt(){for(var i,r=new n.Rect(0,0,window.innerWidth,window.innerHeight),t=0;t<c.length;t++)i=c[t],i&&i._onWindowSizeChange(r)}var t,i,e,bt,r,a,o,u,b,rt,v,h,ut,ft,et,f,ot,st,k,ht,y,ct,d,lt,g,l,kt,c,p,at,vt,w,yt,nt,pt,tt,it,wt,s;(function(n){n[n.Left=0]="Left";n[n.Center=1]="Center";n[n.Right=2]="Right";n[n.Stretch=3]="Stretch"})(t=n.HorizontalAlignment||(n.HorizontalAlignment={})),function(n){n[n.Top=0]="Top";n[n.Center=1]="Center";n[n.Bottom=2]="Bottom";n[n.Stretch=3]="Stretch"}(i=n.VerticalAlignment||(n.VerticalAlignment={})),function(n){n[n.Visible=0]="Visible";n[n.Hidden=1]="Hidden";n[n.Collapsed=2]="Collapsed"}(e=n.Visibility||(n.Visibility={})),function(n){n[n.None=0]="None";n[n.Fill=1]="Fill";n[n.Uniform=2]="Uniform";n[n.UniformToFill=3]="UniformToFill"}(bt=n.Stretch||(n.Stretch={})),function(n){n[n.None=0]="None";n[n.Cancel=1]="Cancel";n[n.Back=2]="Back";n[n.Tab=3]="Tab";n[n.LineFeed=4]="LineFeed";n[n.Clear=5]="Clear";n[n.Return=6]="Return";n[n.Enter=6]="Enter";n[n.Pause=7]="Pause";n[n.CapsLock=8]="CapsLock";n[n.Capital=8]="Capital";n[n.HangulMode=9]="HangulMode";n[n.KanaMode=9]="KanaMode";n[n.HanjaMode=12]="HanjaMode";n[n.Escape=13]="Escape";n[n.Space=14]="Space";n[n.PageUp=15]="PageUp";n[n.Prior=19]="Prior";n[n.PageDown=20]="PageDown";n[n.Next=20]="Next";n[n.End=21]="End";n[n.Home=22]="Home";n[n.Left=23]="Left";n[n.Up=24]="Up";n[n.Right=25]="Right";n[n.Down=26]="Down";n[n.Select=27]="Select";n[n.Print=28]="Print";n[n.PrintScreen=30]="PrintScreen";n[n.Insert=31]="Insert";n[n.Delete=32]="Delete";n[n.Help=33]="Help";n[n.D0=34]="D0";n[n.D1=35]="D1";n[n.D2=36]="D2";n[n.D3=37]="D3";n[n.D4=38]="D4";n[n.D5=39]="D5";n[n.D6=40]="D6";n[n.D7=41]="D7";n[n.D8=42]="D8";n[n.D9=43]="D9";n[n.A=44]="A";n[n.B=45]="B";n[n.C=46]="C";n[n.D=47]="D";n[n.E=48]="E";n[n.F=49]="F";n[n.G=50]="G";n[n.H=51]="H";n[n.I=52]="I";n[n.J=53]="J";n[n.K=54]="K";n[n.L=55]="L";n[n.M=56]="M";n[n.N=57]="N";n[n.O=58]="O";n[n.P=59]="P";n[n.Q=60]="Q";n[n.R=61]="R";n[n.S=62]="S";n[n.T=63]="T";n[n.U=64]="U";n[n.V=65]="V";n[n.W=66]="W";n[n.X=67]="X";n[n.Y=68]="Y";n[n.Z=69]="Z";n[n.LWin=70]="LWin";n[n.RWin=71]="RWin";n[n.Apps=72]="Apps";n[n.Sleep=73]="Sleep";n[n.NumPad0=74]="NumPad0";n[n.NumPad1=75]="NumPad1";n[n.NumPad2=76]="NumPad2";n[n.NumPad3=77]="NumPad3";n[n.NumPad4=78]="NumPad4";n[n.NumPad5=79]="NumPad5";n[n.NumPad6=80]="NumPad6";n[n.NumPad7=81]="NumPad7";n[n.NumPad8=82]="NumPad8";n[n.NumPad9=83]="NumPad9";n[n.Multiply=84]="Multiply";n[n.Add=85]="Add";n[n.Separator=86]="Separator";n[n.Subtract=87]="Subtract";n[n.Decimal=88]="Decimal";n[n.Divide=89]="Divide";n[n.F1=90]="F1";n[n.F2=91]="F2";n[n.F3=92]="F3";n[n.F4=93]="F4";n[n.F5=94]="F5";n[n.F6=95]="F6";n[n.F7=96]="F7";n[n.F8=97]="F8";n[n.F9=98]="F9";n[n.F10=99]="F10";n[n.F11=100]="F11";n[n.F12=101]="F12";n[n.F13=102]="F13";n[n.F14=103]="F14";n[n.F15=104]="F15";n[n.F16=105]="F16";n[n.F17=106]="F17";n[n.F18=107]="F18";n[n.F19=108]="F19";n[n.F20=109]="F20";n[n.F21=110]="F21";n[n.F22=111]="F22";n[n.F23=112]="F23";n[n.F24=113]="F24";n[n.NumLock=114]="NumLock";n[n.Scroll=115]="Scroll";n[n.LeftShift=116]="LeftShift";n[n.RightShift=117]="RightShift";n[n.LeftCtrl=118]="LeftCtrl";n[n.RightCtrl=119]="RightCtrl";n[n.LeftAlt=120]="LeftAlt";n[n.RightAlt=121]="RightAlt"}(r=n._Key||(n._Key={})),function(n){n[n.None=0]="None";n[n.Alt=1]="Alt";n[n.Control=2]="Control";n[n.Shift=4]="Shift";n[n.Windows=8]="Windows"}(a=n.ModifierKeys||(n.ModifierKeys={}));o=function(){function n(n,t,i,r){n===void 0&&(n=0);t===void 0&&(t=0);i===void 0&&(i=0);r===void 0&&(r=0);this.left=n;this.top=t;this.right=i;this.bottom=r}return n.prototype.clone=function(){return new n(this.left,this.top,this.right,this.bottom)},n}();n.Thickness=o;u=function(){function n(n){n===void 0&&(n=0);this.value=n}return Object.defineProperty(n,"UNLIMIT",{get:function(){return-99999},enumerable:!1,configurable:!0}),n}();n.GridLength=u;b=function(){function n(){}return n}();n.Brush=b;rt=function(n){function t(t){var i=n.call(this)||this;return i.color=t.clone(),i}return __extends(t,n),t}(b);n.SolidColorBrush=rt,function(n){n[n.Default=0]="Default";n[n.Arrow=1]="Arrow";n[n.Cross=2]="Cross";n[n.Hand=3]="Hand";n[n.Help=4]="Help";n[n.IBeam=5]="IBeam";n[n.None=6]="None";n[n.SizeAll=7]="SizeAll";n[n.Wait=8]="Wait"}(v=n.Cursor||(n.Cursor={}));h=function(){function n(){}return n}();n.EventArgs=h;ut=function(n){function t(t){var i=n.call(this)||this;return i.result=t,i}return __extends(t,n),t}(h);n.TypedEventArgs=ut;ft=function(){function n(n,t){n===void 0&&(n=!1);t===void 0&&(t="");this.success=!1;this.errorString="";this.success=n;this.errorString=t}return n}();n.OperationReturn=ft;et=function(n){function t(t,i){i===void 0&&(i="");var r=n.call(this)||this;return r.success=!1,r.errString="",r.success=t,r.errString=i,r}return __extends(t,n),t}(h);n.OperationEventArgs=et;f=function(n){function t(){var t=n.call(this)||this;return t.handled=!1,t}return __extends(t,n),t}(h);n.RoutedEventArgs=f;ot=function(){function n(){}return Object.defineProperty(n,"Modifiers",{get:function(){return this.BKI},enumerable:!1,configurable:!0}),n.UpdateModifierKey=function(n){var t=0;n.altKey&&(t|=a.Alt);n.ctrlKey&&(t|=a.Control);n.shiftKey&&(t|=a.Shift);this.BKI=t},n.BKI=0,n}();n.Keyboard=ot;st=function(n){function t(){var t=n.call(this)||this;return t.cancel=!1,t.cancel=!1,t}return __extends(t,n),t}(h);n.CancelEventArgs=st;k=function(t){function i(){var i=t.call(this)||this;return i.newSize=n.Size.Zero(),i.previousSize=n.Size.Zero(),i}return __extends(i,t),i}(f);n.SizeChangedEventArgs=k;ht=function(n){function t(t,i){var r=n.call(this)||this;return r.addedItems=i,r.removedItems=t,r}return __extends(t,n),t}(f);n.SelectionChangedEventArgs=ht;y=function(n){function t(t){var i=n.call(this)||this;return i.point=t,i}return __extends(t,n),t}(f);n.MouseEventArgs=y;ct=function(n){function t(t){var i=n.call(this)||this;return i.key=0,i.key=t,i}return __extends(t,n),t}(f);n.KeyEventArgs=ct;d=function(n){function t(t){var i=n.call(this,t)||this;return i.clickCount=0,i}return __extends(t,n),t}(y);n.MouseButtonEventArgs=d;lt=function(n){function t(t){var i=n.call(this,t)||this;return i.delta=0,i}return __extends(t,n),t}(y);n.MouseWheelEventArgs=lt;g="100%";l=function(){function r(r,u){this.onClick=new n.Observable;this.onMouseLeftButtonDown=new n.Observable;this.onMouseLeftButtonUp=new n.Observable;this.onMouseMove=new n.Observable;this.onMouseRightButtonDown=new n.Observable;this.onMouseRightButtonUp=new n.Observable;this.onMouseWheel=new n.Observable;this.onSizeChanged=new n.Observable;this.horizontalAlignment=t.Stretch;this.verticalAlignment=i.Stretch;this.isTabStop=!1;this.tooltip="";this.BLv=!1;this.BHt=0;this.BLn=1;this.BKW=new o(0,0,0,0);this.BJE=0;this.BLR=0;this.Ei=0;this.Dy=0;this.BMS=[];this.BKg=!0;this.BON=!1;this.fontSize=0;this.BNq=!1;this.BKm="";this.BNN=!1;this.BKx=!1;this.isBoundsFixed=!1;r?(this.BLB=typeof r=="string"?document.getElementById(r):r,this.BNf(this.BLB),this.BMe(),u||(this.BNN=!0,dt(this))):(this.BLB=this.createSystemUI(),this.BMe());this.BLB&&(this.BKm=this.BLB.localName.toLowerCase());u&&u.appendChild(this)}return Object.defineProperty(r.prototype,"defineWidth",{get:function(){return this._defineWidth?this._defineWidth:0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"defineHeight",{get:function(){return this._defineHeight?this._defineHeight:0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"parentUI",{get:function(){return this.BIw},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"htmlUI",{get:function(){return this.BLB},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"children",{get:function(){return this.BMS},enumerable:!1,configurable:!0}),r.prototype.appendChild=function(n){if(n){for(var t=0;t<this.BMS.length;t++)if(this.BMS[t]===n)return;n.BIw=this;this.BMS.push(n);this.BLB&&n.htmlUI&&this.BLB.appendChild(n.htmlUI)}},Object.defineProperty(r.prototype,"uiid",{get:function(){return this.BMA||(this.BMA=r.BFs()),this.BMA},enumerable:!1,configurable:!0}),r.BFs=function(){var n="_uiid"+r.BFW.toString();return r.BFW++,n},Object.defineProperty(r.prototype,"htmlCursor",{get:function(){return this.BMK},set:function(n){this.BMK=n;s.SetCursor(this.htmlUI,n)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isEnabled",{get:function(){return this.BLB&&!this.BLB.disabled?!0:!1},set:function(n){this.BLB&&(this.BLB.disabled=n?!1:!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isHitTestVisible",{get:function(){return this.BKg},set:function(n){this.BKg=n;!n&&this.BLB&&(this.BLB.style.zIndex="0")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"foreground",{get:function(){return this.BLp},set:function(n){(this.BLp=n,n)&&this.BLB&&(this.BLB.style.color=s.WindowsColorToJs(n))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"background",{get:function(){return this.BMX},set:function(n){(this.BMX=n,n)&&this.BLB&&(this.BLB.style.background=s.WindowsColorToJs(n))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"hasBackground",{get:function(){return this.BMX!==undefined},enumerable:!1,configurable:!0}),r.prototype.setDisplay=function(n){this.htmlUI&&(this.htmlUI.style.display=n?"":"none")},Object.defineProperty(r.prototype,"opacity",{get:function(){return this.BLB?n.NumberHelper.ToDouble(this.BLB.style.opacity):this.BLn},set:function(n){this.BLn=n;this.BLB&&(this.BLB.style.opacity=n.toString())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"visibility",{get:function(){return this.BLB?this.BLB.style.visibility=="hidden"?e.Collapsed:e.Visible:this.BHt},set:function(n){this.BHt=n;this.BLB&&(n===e.Visible?(this.BLB.style.visibility="visible",this.setDisplay(!0)):(this.BLB.style.visibility="hidden",this.setDisplay(!1)))},enumerable:!1,configurable:!0}),r.prototype.getFontSizePixel=function(){return this.toPixel(this.getFontSize())},r.prototype.getFontSize=function(){return this.fontSize>0?this.fontSize:this.BIw?this.BIw.getFontSize():r.DefaultFontSize},r.prototype.registerMouseMessage=function(){var n=this;!this.BNq&&this.htmlUI&&(this.htmlUI.addEventListener("mousedown",function(t){n.BGM(t)},!1),this.htmlUI.addEventListener("mousemove",function(t){n.BLU(t)},!1))},r.prototype.BGM=function(n){n.button===0?this.onMouseLeftButtonDown.hasObservers()&&this.onMouseLeftButtonDown.notifyObservers(this.BLZ(n)):n.button===2&&this.onMouseRightButtonDown.hasObservers()&&this.onMouseRightButtonDown.notifyObservers(this.BLZ(n))},r.prototype.BLU=function(n){this.onMouseMove.hasObservers()&&this.onMouseMove.notifyObservers(this.BLZ(n))},r.prototype.BLZ=function(t){var i=new d(new n.Vector2(t.clientX,t.clientY));return i.clickCount=1,i},r.prototype.registerClickMessage=function(){var n=this;this.htmlUI&&this.htmlUI.addEventListener("click",function(){n.onClick.hasObservers()&&n.onClick.notifyObservers(new f)},!1)},r.prototype.registerClickMessageHelper=function(n){var t=this;n&&n.addEventListener("click",function(){t.onClick.hasObservers()&&t.onClick.notifyObservers(new f)},!1)},r.prototype.toPixel=function(n){return n+"px"},r.prototype.createSystemUI=function(){return null},r.prototype.createSystemUiWithIdInner=function(n,t){t===void 0&&(t="");var i=document.createElement(n);return i.id=this.uiid,!t||(i.className=t),i.style.position="absolute",i},r.prototype.BMe=function(n){if(this.BLB){var t=this.getBoundsFromUI(n);this.margin=new o(t.left,t.top,0,0);this.BJE=t.left;this.BLR=t.top;this.Ei=t.width;this.Dy=t.height;this._defineWidth=t.width;this._defineHeight=t.height;this.BKx=!0}},r.prototype.BNf=function(n){n&&(n.style.position||(n.style.position="absolute"),n.style.left||(n.style.left="0px"),n.style.top||(n.style.top="0px"),n.style.width||(n.style.width="100%"),n.style.height||(n.style.height="100%"))},r.prototype._onWindowSizeChange=function(n){this.BMe(n);this.updateLayout()},Object.defineProperty(r.prototype,"actualWidth",{get:function(){return this.width},set:function(n){this.width=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"actualHeight",{get:function(){return this.height},set:function(n){this.height=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bounds",{get:function(){return new n.Rect(this.BJE,this.BLR,this.Ei,this.Dy)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"defineBounds",{get:function(){return new n.Rect(this.BKW.left,this.BKW.top,this.defineWidth,this.defineHeight)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"margin",{get:function(){return this.BKW.clone()},set:function(n){n&&(this.BKW=n.clone(),this.BLB&&this.setLeftTop(n.left,n.top))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this.Ei},set:function(n){this._defineWidth=n;n<=0?this.setDisplay(!1):this.setDisplay(!0);this.setWidthInner(n)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this.Dy},set:function(n){this._defineHeight=n;n<=0?this.setDisplay(!1):this.setDisplay(!0);this.setHeightInner(n)},enumerable:!1,configurable:!0}),r.prototype.BMx=function(){var t=new k;t.newSize=new n.Size(this.Ei,this.Dy);this.onSizeChanged.notifyObservers(t)},r.prototype.getChildrenDefineBoundary=function(){for(var e,t,f=this.children,i=this.margin.left+this.defineWidth,r=this.margin.top+this.defineHeight,u=0;u<f.length;u++)e=f[u],t=e.getChildrenDefineBoundary(),t.width>i&&(i=t.width),t.height>r&&(r=t.height);return new n.Size(i,r)},r.prototype.getBoundsFromUI=function(t){var e,u,f;if(this.BLB instanceof HTMLCanvasElement)return e=this.BLB,new n.Rect(0,0,e.width,e.height);var o=0,h=0,i=t?t.width:0,r=t?t.height:0;return this.BLB.style.left&&(o=s.GetStyleNumber(this.BLB.style.left)),this.BLB.style.top&&(h=s.GetStyleNumber(this.BLB.style.top)),this.BLB.style.width&&this.BLB.style.height&&(u=this.BLB.style.width.toLowerCase().trim(),f=this.BLB.style.height.toLowerCase().trim(),u.indexOf("px")>0?i=n.SystemHelper.ToInt(this.BLB.clientWidth):u.indexOf("%")>0&&(u=u.replace("%",""),i=n.SystemHelper.ToInt(n.SystemHelper.ToInt(u)/100*i)),f.indexOf("px")>0?r=n.SystemHelper.ToInt(this.BLB.clientHeight):f.indexOf("%")>0&&(f=f.replace("%",""),r=n.SystemHelper.ToInt(n.SystemHelper.ToInt(f)/100*r))),i<=0&&(i=n.SystemHelper.ToInt(this.BLB.clientWidth)),r<=0&&(r=n.SystemHelper.ToInt(this.BLB.clientHeight)),new n.Rect(o,h,i,r)},r.prototype.calcBoundsFromParent=function(){return this.BIw?this.BIw.calcChildBounds(this):this.bounds},r.prototype.calcChildBounds=function(r){var u=r.BKW.clone(),f=r.BIw.bounds,s,h,e,o;s=u.left;h=u.top;e=Math.max(r.width,r.defineWidth);o=Math.max(r.height,r.defineHeight);switch(r.horizontalAlignment){case t.Center:s=(f.width-e)*.5;break;case t.Right:s=f.width-u.right-e;break;case t.Stretch:e=Math.max(0,f.width-(u.left+u.right))}switch(r.verticalAlignment){case i.Center:h=(f.height-o)*.5;break;case i.Bottom:h=f.height-u.bottom-o;break;case i.Stretch:o=Math.max(0,f.height-(u.top+u.bottom))}return new n.Rect(s,h,e,o)},r.prototype.BOB=function(n){return n===0?"":n+"px"},r.prototype.setLeftTop=function(n,t){this.BLQ(n);this.BNy(t)},r.prototype.setPosition=function(n,r,u,f,e,s){e===void 0&&(e=t.Left);s===void 0&&(s=i.Top);this.horizontalAlignment=e;this.verticalAlignment=s;this.width=u;this.height=f;this.margin=new o(n,r,0,0)},r.prototype.BLQ=function(t){if(t=n.SystemHelper.ToInt(t),this.BJE===t)return!1;if(this.BJE=t,this.BLB){var i=this.BOB(t);if(this.BLB.style.left!==i)return this.BLB.style.left=i,!0}return!1},r.prototype.BNy=function(t){if(t=n.SystemHelper.ToInt(t),this.BLR===t)return!1;if(this.BLR=t,this.BLB){var i=this.BOB(t);if(this.BLB.style.top!==i)return this.BLB.style.top=i,!0}return!1},r.prototype.setWidthInner=function(t){t=n.SystemHelper.ToInt(t);var i=this.Ei!==t;this.Ei=t;this.BLB&&this.setHtmlWidth(t);i&&this.BMx()},r.prototype.setHeightInner=function(t){t=n.SystemHelper.ToInt(t);var i=this.Dy!==t;this.Dy=t;this.BLB&&this.setHtmlHeight(t);i&&this.BMx()},r.prototype.setHtmlWidth=function(n){var i,r;this.BLB&&(this.BLB instanceof HTMLCanvasElement?(i=this.BLB,i.width!==n&&(i.width=n)):(r=this.BOB(n),this.BLB.style.width=this.BKm!=="div"||this.BJE!==0||this.horizontalAlignment!==t.Stretch||this.hasBackground?r:g))},r.prototype.setHtmlHeight=function(n){var t,r;this.BLB&&(this.BLB instanceof HTMLCanvasElement?(t=this.BLB,t.height!==n&&(t.height=n)):(r=this.BOB(n),this.BLB.style.height=this.BKm!=="div"||this.BLR!==0||this.verticalAlignment!=i.Stretch||this.hasBackground?r:g))},r.prototype.onChildResize=function(){},r.prototype.getTooltipUiid=function(){return"#"+this.uiid},r.prototype.updateLayout=function(){var n,t,i;for(this.BLB&&this.name!==this.BLB.getAttribute("name")&&this.BLB.setAttribute("name",this.name),this.BIw&&!this.isBoundsFixed&&(n=this.calcBoundsFromParent(),this.BLQ(n.left),this.BNy(n.top),this.setWidthInner(n.width),this.setHeightInner(n.height)),t=0;t<this.BMS.length;t++)this.BMS[t].updateLayout();!this.tooltip||this.BLv||(i=this.getTooltipUiid(),!i||(this.BLv=!0,$(i).tooltip({content:this.tooltip})))},r.BFW=1,r.DefaultFontSize=12,r}();n.UIElement=l;window.addEventListener("resize",function(){gt()},!1);kt=[];c=[];p=function(n){function t(t,i){return t===void 0&&(t=null),i===void 0&&(i=null),n.call(this,t,i)||this}return __extends(t,n),t.prototype.createSystemUI=function(){return this.createSystemUiWithIdInner("div")},Object.defineProperty(t.prototype,"cursor",{get:function(){return this.getTopMostUI().htmlCursor},set:function(n){this.getTopMostUI().htmlCursor=n},enumerable:!1,configurable:!0}),t.prototype.getTopMostUI=function(){return this},t}(l);n.FrameworkElement=p;at=function(n){function t(t,i){return t===void 0&&(t=null),i===void 0&&(i=null),n.call(this,t,i)||this}return __extends(t,n),t.prototype.createSystemUI=function(){return this.createSystemUiWithIdInner("div")},t}(l);n.RectangleElement=at;vt=function(n){function t(t,i){return t===void 0&&(t=null),i===void 0&&(i=null),n.call(this,t,i)||this}return __extends(t,n),Object.defineProperty(t.prototype,"text",{get:function(){return this.htmlUI.innerHTML},set:function(n){this.htmlUI.innerHTML=n},enumerable:!1,configurable:!0}),t.prototype.createSystemUI=function(){var n=this.createSystemUiWithIdInner("span");return n.style.fontSize=this.getFontSizePixel(),n},t}(l);n.TextBlock=vt;w=function(n){function t(t,i){return t===void 0&&(t=null),i===void 0&&(i=null),n.call(this,t,i)||this}return __extends(t,n),t}(p);n.Panel=w;yt=function(n){function t(t,i){t===void 0&&(t=null);i===void 0&&(i=null);var r=n.call(this,t,i)||this;return r.htmlCanvas=r.htmlUI,r}return __extends(t,n),t.prototype.invalidateArrange=function(){},t.prototype.createSystemUI=function(){return this.createSystemUiWithIdInner("canvas")},t}(w);n.Canvas=yt;nt=function(n){function t(t,i){return t===void 0&&(t=null),i===void 0&&(i=null),n.call(this,t,i)||this}return __extends(t,n),t}(p);n.Control=nt;pt=function(n){function t(t,i){t===void 0&&(t=null);i===void 0&&(i=null);var r=n.call(this,t,i)||this;return r.BLC=!0,r}return __extends(t,n),t.prototype.initializeComponent=function(){},t.prototype.focus=function(){},t.prototype.onKeyDown=function(){},t.prototype.appendChild=function(t){this.BLC=!0;n.prototype.appendChild.call(this,t)},t.prototype.updateLayout=function(){if(this.BLC&&(!this._defineWidth||!this._defineHeight)){var t=this.getChildrenDefineBoundary();this._defineWidth&&(t.width=Math.min(this._defineWidth,t.width));this._defineHeight&&(t.height=Math.min(this._defineHeight,t.height));this.width<t.width&&this.setWidthInner(t.width);this.height<t.height&&this.setHeightInner(t.height);this.BLC=!1}n.prototype.updateLayout.call(this)},t}(nt);n.UserControl=pt;tt=function(){function n(n){n===void 0&&(n=new u);this.height=n}return n}();n.RowDefinition=tt;it=function(){function n(n){n===void 0&&(n=new u);this.width=n}return n}();n.ColumnDefinition=it;wt=function(r){function f(n,t){n===void 0&&(n=null);t===void 0&&(t=null);var i=r.call(this,n,t)||this;return i.rowDefinitions=[],i.columnDefinitions=[],i.subGrids=[],i}return __extends(f,r),f.prototype.createSystemUI=function(){return this.createSystemUiWithIdInner("div")},f.prototype.updateLayout=function(){var n;if((this.rowDefinitions.length>0||this.columnDefinitions.length>0)&&(n=this.parentUI.calcChildBounds(this),this.BLg(n)),r.prototype.updateLayout.call(this),!this.isBoundsFixed){var t=this.getChildrenDefineBoundary(),i=this.getBoundsFromUI(),u=Math.max(t.width,i.right),f=Math.max(t.height,i.bottom);u>this.width&&this.setWidthInner(u);f>this.height&&this.setHeightInner(f)}},f.prototype.addColumn=function(n){this.columnDefinitions.push(new it(new u(n)))},f.prototype.addRow=function(n){this.rowDefinitions.push(new tt(new u(n)))},f.prototype.BLg=function(n){var s=this.subGrids.length,h,f,c,e,u,r;if(!(s<=0))if(this.rowDefinitions.length>0)for(h=this.BNW(n.height,this.BLu()),f=0,u=0;u<s;u++)r=this.subGrids[u],r.isBoundsFixed=!0,r.verticalAlignment=i.Top,r.margin=new o(0,f,0,0),r.setLeftTop(0,f),r.width=n.width,r.height=h[u],f+=h[u],r.updateLayout();else if(this.columnDefinitions.length>0)for(c=this.BNW(n.width,this.BLN()),e=0,u=0;u<s;u++)r=this.subGrids[u],r.isBoundsFixed=!0,r.horizontalAlignment=t.Left,r.margin=new o(e,0,0,0),r.setLeftTop(e,0),r.width=c[u],r.height=n.height,e+=c[u],r.updateLayout()},f.prototype.BLu=function(){for(var i,t=new Array(this.rowDefinitions.length),n=0;n<this.rowDefinitions.length;n++)i=this.rowDefinitions[n],t[n]=i.height.value;return t},f.prototype.BLN=function(){for(var i,t=new Array(this.columnDefinitions.length),n=0;n<this.columnDefinitions.length;n++)i=this.columnDefinitions[n],t[n]=i.width.value;return t},f.prototype.BNW=function(t,i){for(var s,o,h,f=new Array(i.length),c=i.length,l=0,a=0,e=0,r=0;r<c;r++)f[r]=i[r],f[r]>=0?l+=f[r]:(e++,f[r]!==u.UNLIMIT&&(a+=-f[r]));if(s=t-l-a,e>0)for(r=0;r<c;r++)if(o=Math.max(0,n.SystemHelper.ToInt(s/e)),h=void 0,f[r]<0&&(h=f[r]===u.UNLIMIT?o:-f[r]+o,f[r]=h,s-=o,e--),e<=0)break;return f},f}(w);n.Grid=wt;s=function(){function u(){}return u.CreateImage=function(){var n=new Image;return n.crossOrigin="Anonymous",n},u.CreateSystemUI=function(n,t){var i=document.createElement(t);return i.style.position="absolute",n?n.appendChild(i):document.body.appendChild(i),i},u.CreateContainerDiv=function(n,t){var i=document.createElement("div");return document.body.appendChild(i),i.style.position="absolute",i.style.width=n.toString()+"px",i.style.height=t.toString()+"px",i},u.SetControlPositionInViewport=function(n,t,i,r){r===void 0&&(r=10);var e=n.clientWidth,o=n.clientHeight,u,f;u=Math.min(i.width-e-r,t.x);u=Math.max(0,u);f=Math.min(i.height-o-r,t.y);f=Math.max(0,f);n.style.left=u.toString()+"px";n.style.top=f.toString()+"px"},u.GetStyleNumber=function(t){return t?n.SystemHelper.ToInt(t.replace("px","")):0},u.SetCursor=function(n,t){if(n)switch(t){case v.Hand:n.style.cursor="pointer";break;case v.Arrow:n.style.cursor="default";break;case v.None:n.style.cursor="none";break;default:n.style.cursor="default"}},u.KeyFromJs=function(n){switch(n){case 107:return r.Add;case 109:return r.Subtract;case 33:return r.PageUp;case 34:return r.PageDown;case 37:return r.Left;case 38:return r.Up;case 39:return r.Right;case 40:return r.Down;default:if(n>=65&&n<=90)return n-65+r.A;if(n>=48&&n<=57)return n-48+r.D0}return r.None},u.WindowsColorToJs=function(n){if(!n)return"";if(n.charAt(0)==="#"&&n.length==9){var t=void 0,i=void 0,r=void 0,u=void 0;return t=n.substr(1,2),i=n.substr(3,2),r=n.substr(5,2),u=n.substr(7,2),"rgba("+parseInt(i,16).toString()+","+parseInt(r,16).toString()+","+parseInt(u,16).toString()+","+(parseInt(t,16)/255).toString()+")"}try{return eval("Colors."+n)}catch(f){return""}},u.BoolToVisibility=function(n){return n?e.Visible:e.Collapsed},u.VisibilityToBool=function(n){return n==e.Visible?!0:!1},u.CalcPixelAlignOffsetToLeftBottom=function(r,u,f,e){var o=0,s=0;switch(r){case t.Center:o=n.SystemHelper.ToInt(-(f*.5));break;case t.Left:o=n.SystemHelper.ToInt(-f)}switch(u){case i.Bottom:s=n.SystemHelper.ToInt(-e);break;case i.Center:s=n.SystemHelper.ToInt(-(e*.5))}return new n.Vector2(o,s)},u.CalcPixelPaddingOffset=function(r,u,f){var e=0,o=0;switch(r){case t.Right:e=f;break;case t.Left:e=-f}switch(u){case i.Bottom:o=-f;break;case i.Top:o=f}return new n.Vector2(e,o)},u.IsDoubleClick=function(t,i){i===void 0&&(i=1);var u=n.SystemTime._FrameNow(),r=t.point,f=Math.abs(r.x-this.BNo)<=i&&Math.abs(r.y-this.BKo)<=i&&Math.abs(u-this.BNZ)<=500;return this.BNo=r.x,this.BKo=r.y,this.BNZ=u,f},u.BNo=0,u.BKo=0,u.BNZ=0,u}();n.WindowsHelper=s}(Drawsee||(Drawsee={})),function(n){function u(n){return n!==undefined&&n!==null}function i(n,t){return n!==undefined&&n!==null?n:t}function f(n,t){var e,r,u;if(n===null||typeof n!="object")return n;t=i(t,!1);e=new n.constructor;for(r in n)n.hasOwnProperty(r)&&(u=n[r],t&&(u=f(u,t)),e[r]=u);return e}function e(n,t,r){r=i(r,!1);var o={},l=u(n),c=u(t),f,s,h;if(l)for(f in n)n.hasOwnProperty(f)&&(s=n[f],c&&r&&typeof s=="object"&&t.hasOwnProperty(f)?(h=t[f],o[f]=typeof h=="object"?e(s,h,r):s):o[f]=s);if(c)for(f in t)t.hasOwnProperty(f)&&!o.hasOwnProperty(f)&&(h=t[f],o[f]=h);return o}function t(n,r,u){return r=i(r,0),u=i(u,n.byteLength-r),n=n.subarray(r,r+u),t.decode(n)}function r(n,t,i){return t<=n&&n<=i}function o(t){for(var i,u=0,s=0,f=0,e=128,o=191,c=[],l=t.length,h=0;h<l;++h){if(i=t[h],f===0){if(r(i,0,127)){c.push(i);continue}if(r(i,194,223)){f=1;u=i&31;continue}if(r(i,224,239)){i===224&&(e=160);i===237&&(o=159);f=2;u=i&15;continue}if(r(i,240,244)){i===240&&(e=144);i===244&&(o=143);f=3;u=i&7;continue}throw new n.Exception("String decoding failed.");}if(!r(i,e,o)){u=f=s=0;e=128;o=191;--h;continue}e=128;o=191;u=u<<6|i&63;++s;s===f&&(c.push(u),u=f=s=0)}return c}n.defined=u;n.defaultValue=i;n.defaultValue_EMPTY_OBJECT=Object.freeze({});n.clone=f;n.combine=e;n.WebGLConstants=Object.freeze({TRIANGLES:4,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130,REPEAT:10497,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963});n.DeveloperError=n.Exception;n.getStringFromTypedArray=t;t.decodeWithTextDecoder=function(n){var t=new TextDecoder("utf-8");return t.decode(n)};t.decodeWithFromCharCode=function(n){for(var t,i="",u=o(n),f=u.length,r=0;r<f;++r)t=u[r],t<=65535?i+=String.fromCharCode(t):(t-=65536,i+=String.fromCharCode((t>>10)+55296,(t&1023)+56320));return i};t.decode=typeof TextDecoder!="undefined"?t.decodeWithTextDecoder:t.decodeWithFromCharCode}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var r=function(){function n(n,t,i){this.maxRadius=Math.max(n,t,i)}return n.WGS84=Object.freeze(new n(6378137,6378137,6356752.3142451793)),n}(),t=function(){function t(){this._ellipsoid=r.WGS84;this._semimajorAxis=this._ellipsoid.maxRadius;this.maxRadius=this._ellipsoid.maxRadius;this._oneOverSemimajorAxis=1/this._semimajorAxis}return t.prototype.project=function(t){var i=n.Vector2.Zero();return this.projectToRef(t,i),i},t.prototype.projectToRef=function(){},t.prototype.unproject=function(t){var i=new n.Vector2;return this.unprojectToRef(t,i),i},t.prototype.unprojectToRef=function(){},t}(),u=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.Bn=function(n){return Math.PI/2-2*Math.atan(Math.exp(-n))},i.BG=function(n){n>i.CB?n=i.CB:n<-i.CB&&(n=-i.CB);var t=Math.sin(n);return.5*Math.log((1+t)/(1-t))},i.prototype.projectToRef=function(t,r){var u=this._semimajorAxis,f=n.MathHelper.ToRadians(t.x)*u,e=i.BG(n.MathHelper.ToRadians(t.y))*u;r.x=f;r.y=e},i.prototype.unprojectToRef=function(t,r){var u=this._oneOverSemimajorAxis,f=t.x*u,e=i.Bn(t.y*u);r.x=n.MathHelper.ToDegrees(f);r.y=n.MathHelper.ToDegrees(e)},i.CB=i.Bn(Math.PI),i}(t),i;n._WebMercatorProjection=u;i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.projectToRef=function(n,t){var i=this._semimajorAxis,r=n.x*i,u=n.y*i;t.x=r;t.y=u},t.prototype.unprojectToRef=function(n,t){var i=this._oneOverSemimajorAxis,r=n.x*i,u=n.y*i;t.x=r;t.y=u},t}(t);n._GeographicProjection=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var i=function(){function t(){}return t.CreateFromType=function(t){return t===n.TilingType.Geographic?new r:new u},t}();n._TilingSchemeHelper=i;var t=function(){function n(){this._numberOfLevelZeroTilesX=1;this._numberOfLevelZeroTilesY=1}return Object.defineProperty(n.prototype,"extent",{get:function(){return this._extent},enumerable:!1,configurable:!0}),n}(),r=function(t){function i(i){var r=t.call(this)||this;return r.tilingType=n.TilingType.Geographic,r.Bm(i),r}return __extends(i,t),i.prototype.Bm=function(t){t=n.defaultValue(t,n.defaultValue_EMPTY_OBJECT);this._extent=n.defaultValue(t.extent,n.GeoExtent.MAX_VALUE);this._projection=new n._GeographicProjection;this._numberOfLevelZeroTilesX=2;this._numberOfLevelZeroTilesY=1},i.prototype.xCountOfLevel=function(n){return this._numberOfLevelZeroTilesX<<n},i.prototype.yCountOfLevel=function(n){return this._numberOfLevelZeroTilesY<<n},i.prototype.xyToNativeExtent=function(n){return this.xyToExtent(n)},i.prototype.xyToExtent=function(t){var r=t.x,u=t.y,f=t.level,i=this._extent,s=this.xCountOfLevel(f),h=this.yCountOfLevel(f),e=i.width/s,c=r*e+i.west,l=(r+1)*e+i.west,o=i.height/h,a=i.north-u*o,v=i.north-(u+1)*o;return new n.GeoExtent(c,v,l,a)},i}(t),u=function(t){function i(i,r){var u=t.call(this)||this;return u.tilingType=n.TilingType.WebMercator,u.Bm(i,r),u}return __extends(i,t),i.prototype.Bm=function(t,i){var r,u,f;this._numberOfLevelZeroTilesX=1;this._numberOfLevelZeroTilesY=1;this._projection=new n._WebMercatorProjection;n.defined(t)&&n.defined(i)?(this.Bf=t,this.CC=i):(r=this._projection.maxRadius*Math.PI,this.Bf=new n.Vector2(-r,-r),this.CC=new n.Vector2(r,r));u=this._projection.unproject(this.Bf);f=this._projection.unproject(this.CC);this._extent=new n.GeoExtent(u.x,u.y,f.x,f.y)},i.prototype.xCountOfLevel=function(n){return this._numberOfLevelZeroTilesX<<n},i.prototype.yCountOfLevel=function(n){return this._numberOfLevelZeroTilesY<<n},i.prototype.xyToNativeExtent=function(t){var i=t.x,r=t.y,u=t.level,o=this.xCountOfLevel(u),s=this.yCountOfLevel(u),f=(this.CC.x-this.Bf.x)/o,h=this.Bf.x+i*f,c=this.Bf.x+(i+1)*f,e=(this.CC.y-this.Bf.y)/s,l=this.CC.y-r*e,a=this.CC.y-(r+1)*e;return new n.GeoExtent(h,a,c,l)},i.prototype.xyToExtent=function(t){var i=this.xyToNativeExtent(t),r=this._projection,u=r.unproject(new n.Vector2(i.west,i.south)),f=r.unproject(new n.Vector2(i.east,i.north));return new n.GeoExtent(u.x,u.y,f.x,f.y)},i}(t)}(Drawsee||(Drawsee={})),function(n){function h(t){var r,u,i,e,f,o;if(!n.defined(t))throw new n.Exception("obj is required.");r="";for(u in t)if(t.hasOwnProperty(u))if(i=t[u],e=encodeURIComponent(u)+"=",Array.isArray(i))for(f=0,o=i.length;f<o;++f)r+=e+encodeURIComponent(i[f])+"&";else r+=e+encodeURIComponent(i)+"&";return r.slice(0,-1)}function c(t){var i,e,f,s,u;if(!n.defined(t))throw new n.Exception("queryString is required.");if(i={},t==="")return i;for(e=t.replace(/\+/g,"%20").split(/[&;]/),f=0,s=e.length;f<s;++f){var h=e[f].split("="),o=decodeURIComponent(h[0]),r=h[1];r=n.defined(r)?decodeURIComponent(r):"";u=i[o];typeof u=="string"?i[o]=[u,r]:Array.isArray(u)?u.push(r):i[o]=r}return i}function r(n,t){var i;return typeof document!="undefined"&&(i=document),r._implementation(n,t,i)}function l(n){return o.test(n)}function a(n){return s.test(n)}function v(i){n.defined(t)||(t=document.createElement("a_crossTest"));t.href=window.location.href;var r=t.host,u=t.protocol;return t.href=i,t.href=t.href,u!==t.protocol||r!==t.host}function u(n,t,r,u){var f=n.query(),e,o;if(f.length===0)return{};f.indexOf("=")===-1?(o={},o[f]=undefined,e=o):e=c(f);t._queryParameters=r?i(e,t._queryParameters,u):e;n.search("")}function y(t,i){var r=i._queryParameters,u=Object.keys(r);u.length!==1||n.defined(r[u[0]])?t.search(h(r)):t.search(u[0])}function f(t,i){return n.defined(t)?n.defined(t.clone)?t.clone():n.clone(t):i}function i(t,i,r){var f,u,e,o;if(!r)return n.combine(t,i);f=n.clone(t,!0);for(u in i)i.hasOwnProperty(u)&&(e=f[u],o=i[u],n.defined(e)?(Array.isArray(e)||(e=f[u]=[e]),f[u]=e.concat(o)):f[u]=Array.isArray(o)?o.slice():o);return f}var e={UNISSUED:0,ISSUED:1,ACTIVE:2,RECEIVED:3,CANCELLED:4,FAILED:5},o,s,t;r._implementation=function(t,i,r){if(!n.defined(t))throw new n.Exception("relative uri is required.");if(!n.defined(i)){if(typeof r=="undefined")return t;i=n.defaultValue(r.baseURI,r.location.href)}var u=URI(t);return u.scheme()!==""?u.toString():u.absoluteTo(i).toString()};o=/^data:/i;s=/^blob:/i;var p={TERRAIN:0,IMAGERY:1,TILES3D:2,OTHER:3},w=function(){function t(t){t=n.defaultValue(t,n.defaultValue_EMPTY_OBJECT);var i=n.defaultValue(t.throttleByServer,!1),r=n.defaultValue(t.throttle,!1);this.url=t.url;this.requestFunction=t.requestFunction;this.cancelFunction=t.cancelFunction;this.priorityFunction=t.priorityFunction;this.priority=n.defaultValue(t.priority,0);this.throttle=r;this.throttleByServer=i;this.type=n.defaultValue(t.type,p.OTHER);this.serverKey=undefined;this.state=e.UNISSUED;this.deferred=undefined;this.cancelled=!1}return t.prototype.cancle=function(){this.cancelled=!0},t.prototype.clone=function(i){return n.defined(i)?(i.url=this.url,i.requestFunction=this.requestFunction,i.cancelFunction=this.cancelFunction,i.priorityFunction=this.priorityFunction,i.priority=this.priority,i.throttle=this.throttle,i.throttleByServer=this.throttleByServer,i.type=this.type,i.serverKey=this.serverKey,i.state=e.UNISSUED,i.deferred=undefined,i.cancelled=!1,i):new t(this)},t}(),b=function(){function t(t){t=n.defaultValue(t,n.defaultValue_EMPTY_OBJECT);typeof t=="string"&&(t={url:t});this.BH=undefined;this.CP=f(t.templateValues,{});this._queryParameters=f(t.queryParameters,{});this.BK=f(t.headers,{});this.Cn=new w;this.proxy=t.proxy;var i=URI(t.url);u(i,this,!0,!0);i.fragment("");this.BH=i.toString()}return t.prototype.BD=function(i){return n.defined(i)||(i=new t({url:this.BH})),i.BH=this.BH,i._queryParameters=n.clone(this._queryParameters),i.CP=n.clone(this.CP),i.BK=n.clone(this.BK),i.proxy=this.proxy,i.Cn=this.Cn.clone(),i},t.createIfNeeded=function(n,i){return i?i.CL({},i.Cn):new t({url:n})},Object.defineProperty(t.prototype,"queryParameters",{get:function(){return this._queryParameters},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templateValues",{get:function(){return this.CP},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this.getUrlComponent(!0,!0)},set:function(n){var t=URI(n);u(t,this,!1);t.fragment("");this.BH=t.toString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDataUri",{get:function(){return l(this.BH)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBlobUri",{get:function(){return a(this.BH)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCrossOriginUrl",{get:function(){return v(this.BH)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasHeaders",{get:function(){return Object.keys(this.BK).length>0},enumerable:!1,configurable:!0}),t.prototype.getUrlComponent=function(t,i){var u,r,f;return this.isDataUri?this.BH:(u=URI(this.BH),t&&y(u,this),r=u.toString().replace(/%7B/g,"{").replace(/%7D/g,"}"),f=this.CP,r=r.replace(/{(.*?)}/g,function(t,i){var r=f[i];return n.defined(r)?encodeURIComponent(r):t}),i&&n.defined(this.proxy)&&(r=this.proxy.getURL(r)),r)},t.prototype.setQueryParameters=function(n,t){this._queryParameters=t?i(this._queryParameters,n,!1):i(n,this._queryParameters,!1)},t.prototype.appendQueryParameters=function(n){this._queryParameters=i(n,this._queryParameters,!0)},t.prototype.setTemplateValues=function(t,i){this.CP=i?n.combine(this.CP,t):n.combine(t,this.CP)},t.prototype.appendForwardSlash=function(){var n=this.BH;(n.length===0||n[n.length-1]!=="/")&&(n=n+"/",this.BH=n)},t.prototype.CL=function(t,i){var f=this.BD(),e;return n.defined(t.url)&&(e=URI(t.url),u(e,f,!0,!1),e.fragment(""),f.BH=e.scheme()!==""?e.toString():e.absoluteTo(URI(r(this.BH))).toString()),n.defined(t.queryParameters)&&(f._queryParameters=n.combine(t.queryParameters,f._queryParameters)),n.defined(t.templateValues)&&(f.CP=n.combine(t.templateValues,f.templateValues)),n.defined(t.headers)&&(f.BK=n.combine(t.headers,f.BK)),n.defined(t.proxy)&&(f.proxy=t.proxy),n.defined(i)&&(f.Cn=i),f},t.prototype.getDerivedResource=function(n){return this.CL(n)},t}();n._UrlResource=b}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t,i,r;(function(n){n[n.None=0]="None";n[n.Point=1]="Point";n[n.LineString=2]="LineString";n[n.Polygon=3]="Polygon";n[n.MultiPoint=4]="MultiPoint";n[n.MultiLineString=5]="MultiLineString";n[n.MultiPolygon=6]="MultiPolygon";n[n.GeometryCollection=7]="GeometryCollection";n[n.CircularString=8]="CircularString";n[n.CompoundCurve=9]="CompoundCurve";n[n.CurvePolygon=10]="CurvePolygon";n[n.MultiCurve=11]="MultiCurve";n[n.MultiSurface=12]="MultiSurface";n[n.Curve=13]="Curve";n[n.Surface=14]="Surface";n[n.PolyhedralSurface=15]="PolyhedralSurface";n[n.Tin=16]="Tin";n[n.Triangle=17]="Triangle";n[n.Rect=10001]="Rect";n[n.Ellipse=10002]="Ellipse";n[n.Text=10011]="Text";n[n.Arrow=10101]="Arrow";n[n.SplinePoly=10201]="SplinePoly";n[n.Box=20001]="Box";n[n.Ball=20002]="Ball";n[n.Plane=20101]="Plane"})(t=n.GeoType||(n.GeoType={})),function(n){n[n.None=0]="None";n[n.One=1]="One";n[n.Two=2]="Two";n[n.Three=3]="Three"}(i=n.GeoDimension||(n.GeoDimension={}));r=function(r){function u(){var u=r.call(this)||this;return u.text="",u.BFA=0,u.BFm=0,u.BCq=new n.Box,u.BFJ=new n.Rect,u.BFA=t.None,u.BFm=i.None,u}return __extends(u,r),Object.defineProperty(u.prototype,"drawStyle",{get:function(){return this.BGB},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"drawStyleForUpdate",{get:function(){return this.BGB||(this.BGB=new n.DrawStyle),this.BGB},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"geoType",{get:function(){return this.BFA},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"dimension",{get:function(){return this.BFm},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"bounds",{get:function(){return this.BCq},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"bounds2",{get:function(){return this.BFJ},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"position",{get:function(){return this.AE.length>0?this.AE[0]:new n.Vector3},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"points",{get:function(){return this.AE},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"position2",{get:function(){return this.AE.length>0?new n.Vector2(this.AE[0].x,this.AE[0].z):new n.Vector2},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"points2",{get:function(){return!this.BDy&&this.AE&&(this.BDy=n.VectorHelper.ToVector2Array(this.AE)),this.BDy},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"subGeometries",{get:function(){return this.BDt},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"topoNos",{get:function(){return this.BGA||(this.BGA=[]),this.BGA},set:function(t){this.BGA=n.ArrayHelper.CloneArray(t)},enumerable:!1,configurable:!0}),u.CreateFromClone=function(n){var t=new u;return t.copyFrom(n),t},u.CreateFromPoint2=function(n){var r=new u;return r.BFA=t.Point,r.BFm=i.Two,r.updateFromPoint2(n),r},u.CreateFromRect=function(n,t){var r=new u;return r.BFA=n,r.BFm=i.Two,r.updateFromRect(t),r},u.CreateFromPoint2Array=function(n,t){var r=new u;return r.BFA=n,r.BFm=i.Two,r.updateFromPoint2Array(t),r},u.CreateFromPoint=function(n){var r=new u;return r.BFA=t.Point,r.BFm=i.Three,r.updateFromPoint(n),r},u.CreateFromPointArray=function(n,t){var r=new u;return r.BFA=n,r.BFm=i.Three,r.updateFromPointArray(t),r},u.CreateFromGeometryArray=function(n){var i=new u;return i.BFA=t.GeometryCollection,i.updateFromGeometryArray(n),i},u._CreateFromText=function(i,r,f,e,o){var v=f*r.length,s=new n.Vector2(v,f),y=n.MathHelper.ToRadians(e),p=n.Matrix2.CreateRotation(y),a,h,c,l;return s=p.transform(s),s.x=s.x+i.x,s.y=s.y+i.y,a=t.Text,h=[],h.push(i),h.push(s),c=u.CreateFromPoint2Array(a,h),l=c.drawStyleForUpdate,l.textHeight=f,l.textAngle=e,l.textColor=o.clone(),c.text=r,c},u.prototype.BFl=function(n){this._onUpdateCallback&&this._onUpdateCallback(n)},u.prototype.updateFromPoint2=function(i){if(i){var r=[];r.push(new n.Vector3(i.x,0,i.y));this.BFb(new n.Rect(i.x,i.y,0,0));this.BFG(r);this.BFl(t.Point)}},u.prototype.updateFromRect=function(n){n&&(this.BFb(n),this.BFG(this.BFd(n)),this.BFl(t.Rect))},u.prototype.updateFromPoint2Array=function(i){if(i&&!(i.length<=1)){var r=[];n.ArrayHelper.AddRange(r,n.VectorHelper.ToVector3Array(i));this.BFb(n.Rect.CalcRange(i));this.BFG(r);this.BFl(t.LineString)}},u.prototype.updateFromPoint=function(i){if(i){var r=[];r.push(i);this.BGQ(new n.Box(i,i));this.BFG(r);this.BFl(t.Point)}},u.prototype.updateFromPointArray=function(i){if(i&&!(i.length<=0)){var r=n.Box.CalcRange(i);this.BGQ(r);this.BFG(i);this.BFl(t.LineString)}},u.prototype.updateFromGeometryArray=function(i){!i||i.length<=0||this.BFA===t.GeometryCollection&&(this.BDt=n.ArrayHelper.CloneDataArray(i),this.BGQ(this.BFB()),this.BFl(t.GeometryCollection))},u.prototype.copyFrom=function(t){var r,i,f;if(t&&(this.no=t.no,this.text=t.text,this.tag=t.tag,this.BFA=t.BFA,this.BFm=t.BFm,this.BFJ=t.BFJ.clone(),this.AE=n.ArrayHelper.CloneDataArray(t.AE),this.BDy=null,t.BDt)){for(r=[],this.BDt=n.ArrayHelper.CloneDataArray(t.BDt),i=0;i<t.BDt.length;i++)f=new u,f.copyFrom(t.BDt[i]),r.push(f);this.BDt=r}},u.prototype.BFG=function(n){this.AE=n;this.BDy=null},u.prototype.BGQ=function(t){this.BCq=t;this.BFJ=new n.Rect(t.min.x,t.min.z,t.max.x-t.min.x,t.max.z-t.min.z)},u.prototype.BFb=function(t){this.BFJ=t.clone();this.BCq=n.Box.CreateFromDouble(t.left,0,t.top,t.right,0,t.bottom)},u.prototype.BFB=function(){var i=new n.Box,t,r;if(!this.BDt)return i;for(t=0;t<this.BDt.length;t++)r=this.BDt[t],r&&(t===0?i=r.bounds:n.Box.Union(i,r.bounds));return i},u.prototype.BFd=function(t){var i=[];return i.push(new n.Vector3(t.left,0,t.top)),i.push(new n.Vector3(t.right,0,t.top)),i.push(new n.Vector3(t.right,0,t.bottom)),i.push(new n.Vector3(t.left,0,t.bottom)),i},u.CalcBounds=function(t){for(var i,r=new n.Rect,f=!0,u=0;u<t.length;u++)i=t[u],i&&(f?(r=i.bounds2,f=!1):r.unionInPlace(i.bounds2));return r.clone()},u.prototype.transform=function(n){var t,i,r;if(this.BDt&&this.BDt.length>0){for(t=0;t<this.BDt.length;t++)i=this.BDt[t],i.transform(n);this.updateFromGeometryArray(this.BDt)}else r=n.transformPoints(this.points2),this.updateFromPoint2Array(r)},u}(n.ImmutableNoObject);n.Geometry=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(){this.onPoint=function(){};this.onMultiPoint=function(){};this.onLineString=function(){};this.onMultiLineString=function(){};this.onPolygon=function(){}}return t.prototype.loadAsync=function(t){var i=this;n.AsyncWebStream.ReadDirect(t).then(function(n){if(n){var t=JSON.parse(n);i.onJsonData(t)}})},t.prototype.onJsonData=function(){},t}(),i;n.GeoJsonParserBase=t;i=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.onJsonData=function(n){for(var c,f,e,h=n,o=0;o<h.features.length;o++){var s=h.features[o],t=s.geometry.type,r=s.geometry.coordinates,u=s.properties;if(this.onPoint&&t==="Point"){c=i.Cs(r);this.onPoint(c,u)}else if(this.onPoint&&t==="MultiPoint"){f=i.Bl(r);this.onMultiPoint(f,u)}else if(this.onLineString&&t==="LineString"){f=i.Bl(r);this.onLineString(f,u)}else if(this.onMultiLineString&&t==="MultiLineString"){e=i.Co(r);this.onMultiLineString(e,u)}else if(t==="Polygon"&&this.onPolygon){var e=i.Co(r),f=e[0],l=null;e.length>1&&(l=e.slice(1));this.onPolygon(f,l,u)}}},i.Cs=function(t){return new n.Vector3(t[0],0,t[1])},i.Bl=function(t){for(var r,u=[],i=0;i<t.length;i++)r=t[i],u.push(new n.Vector3(r[0],0,r[1]));return u},i.Co=function(n){for(var r,i=[],t=0;t<n.length;t++)r=n[t],i.push(this.Bl(r));return i},i}(t);n.GeoJsonParser=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.onJsonData=function(n){var t=n,i,r;t&&t.features&&(i=t.features,r=t.geometryType,r==="esriGeometryPoint"?this.BX(i):r==="esriGeometryPolyline"?this.Bu(i):r==="esriGeometryPolygon"&&this.CW(i))},i.prototype.BX=function(t){for(var i=0;i<t.length;i++){var r=t[i],u=r.geometry,f=new n.Vector3(u.x,0,u.y);this.onPoint(f,r.attributes)}},i.prototype.Bu=function(n){for(var t=0;t<n.length;t++){var i=n[t],r=i.geometry,u=this.Bb(r.paths[0]);this.onLineString(u.reverse(),i.attributes)}},i.prototype.Bb=function(t){var r,f,i,u;if(!t)return null;for(r=[],f=t.length,i=0;i<f;i++)u=t[i],r.push(new n.Vector3(u[0],0,u[1]));return r},i.prototype.CW=function(n){for(var t=0;t<n.length;t++){var r=n[t],f=r.geometry,i=this.Ci(f.rings),e=i[0],u=null;i.length>1&&(u=i.slice(1));this.onPolygon(e.reverse(),u,r.attributes)}},i.prototype.Ci=function(t){var f,o,r,u,e,i;if(!t)return null;for(f=[],o=t.length,r=0;r<o;r++){for(u=t[r],e=[],i=0;i<u.length;i++)e.push(new n.Vector3(u[i][0],0,u[i][1]));f.push(e)}return f},i}(n.GeoJsonParserBase);n.EsriGeoJsonParser=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){function i(n,t,i){for(var f=0,u=n.length-1,r,e;f<=u;){if(r=~~((f+u)/2),e=i(n[r],t),e<0){f=r+1;continue}if(e>0){u=r-1;continue}return r}return~(u+1)}function r(n,t,i,r){for(var u,e=r.length,f=0;f<e;++f)if(u=r[f],u.x===t&&u.y===i&&u.level===n)return!0;return!1}var u=function(n){function t(t,i,r,u,f){var e=n.call(this,i,r,u,f)||this;return e.level=t,e.west=i,e.south=r,e.east=u,e.north=f,e}return __extends(t,n),t}(n.GeoExtent),t=function(n){function t(t,i,r,u,f){var e=n.call(this,r,u,f)||this;return e.tilingScheme=t,e.parent=i,e.level=r,e.x=u,e.y=f,e.extent=t.xyToExtent(e),e.rectangles=[],e}return __extends(t,n),Object.defineProperty(t.prototype,"nw",{get:function(){return this.BU||(this.BU=new t(this.tilingScheme,this,this.level+1,this.x*2,this.y*2)),this.BU},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ne",{get:function(){return this.Cd||(this.Cd=new t(this.tilingScheme,this,this.level+1,this.x*2+1,this.y*2)),this.Cd},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sw",{get:function(){return this.Bz||(this.Bz=new t(this.tilingScheme,this,this.level+1,this.x*2,this.y*2+1)),this.Bz},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"se",{get:function(){return this.BQ||(this.BQ=new t(this.tilingScheme,this,this.level+1,this.x*2+1,this.y*2+1)),this.BQ},enumerable:!1,configurable:!0}),t.rectanglesOverlap=function(n,t){var i=Math.max(n.west,t.west),r=Math.max(n.south,t.south),u=Math.min(n.east,t.east),f=Math.min(n.north,t.north);return r<f&&i<u},t.putGeoExtentInQuadtree=function(n,t,r){while(t.level<n)if(this.CR(t.nw.extent,r))t=t.nw;else if(this.CR(t.ne.extent,r))t=t.ne;else if(this.CR(t.sw.extent,r))t=t.sw;else if(this.CR(t.se.extent,r))t=t.se;else break;if(t.rectangles.length===0||t.rectangles[t.rectangles.length-1].level<=r.level)t.rectangles.push(r);else{var u=i(t.rectangles,r.level,this.Bg);u<0&&(u=~u);t.rectangles.splice(u,0,r)}},t.Bg=function(n,t){return n.level-t},t.CR=function(n,t){return t.west>=n.west&&t.east<=n.east&&t.south>=n.south&&t.north<=n.north},t.rectangleContainsPosition=function(n,t){return t.x>=n.west&&t.x<=n.east&&t.y>=n.south&&t.y<=n.north},t.findMaxLevelFromNode=function(n,t,i){for(var r=0,a=!1,e,f,l;!a;){var o=t.BU&&this.rectangleContainsPosition(t.BU.extent,i),s=t.Cd&&this.rectangleContainsPosition(t.Cd.extent,i),h=t.Bz&&this.rectangleContainsPosition(t.Bz.extent,i),c=t.BQ&&this.rectangleContainsPosition(t.BQ.extent,i),u=0;if(o&&u++,s&&u++,h&&u++,c&&u++,u>1){o&&(r=Math.max(r,this.findMaxLevelFromNode(t,t.BU,i)));s&&(r=Math.max(r,this.findMaxLevelFromNode(t,t.Cd,i)));h&&(r=Math.max(r,this.findMaxLevelFromNode(t,t.Bz,i)));c&&(r=Math.max(r,this.findMaxLevelFromNode(t,t.BQ,i)));break}else o?t=t.BU:s?t=t.Cd:h?t=t.Bz:c?t=t.BQ:a=!0}while(t!==n){for(e=t.rectangles,f=e.length-1;f>=0&&e[f].level>r;--f)l=e[f],this.rectangleContainsPosition(l,i)&&(r=l.level);t=t.parent}return r},t}(n.QuadtreeHandle),f=function(){function i(n,t){this.tilingScheme=n;this.maximumLevel=t;this.CV=[];this.CV=[]}return i.prototype.addAvailableTileRange=function(i,f,e,o,s){var y=this.tilingScheme,a=this.CV,h,c,v,p;if(i===0)for(h=e;h<=s;++h)for(c=f;c<=o;++c)r(i,c,h,a)||a.push(new t(y,undefined,0,c,h));var l=y.xyToExtent(new n.QuadtreeHandle(i,f,e)),b=l.west,k=l.north;l=y.xyToExtent(new n.QuadtreeHandle(i,o,s));var d=l.east,g=l.south,w=new u(i,b,g,d,k);for(v=0;v<a.length;++v)p=a[v],t.rectanglesOverlap(p.extent,w)&&t.putGeoExtentInQuadtree(this.maximumLevel,p,w)},i.prototype.CZ=function(i){for(var f,r,u=0;u<this.CV.length;++u)if(f=this.CV[u],t.rectangleContainsPosition(f.extent,i)){r=f;break}return n.defined(r)?t.findMaxLevelFromNode(undefined,r,i):-1},i.prototype.isTileAvailable=function(n){return this.CM(n.level,n.x,n.y)},i.prototype.isTileAvailableByExtent=function(n,t){var i=t.center,r=this.CZ(i);return r>=n},i.prototype.CM=function(t,i,r){var u=this.tilingScheme.xyToExtent(new n.QuadtreeHandle(t,i,r));return this.isTileAvailableByExtent(t,u)},i}();n._TileAvailability=f}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(n,t,i,r,u,f,e,o,s,h,c,l){l===void 0&&(l={});this.resource=n;this.version=t;this.isHeightmap=i;this.tileUrlTemplates=r;this.availability=u;this.hasVertexNormals=f;this.hasWaterMask=e;this.hasMetadata=o;this.availabilityLevels=s;this.availabilityTilesLoaded=h;this.littleEndianExtensionSize=c;this.availabilityPromiseCache=l}return t.prototype.getAvailabilityTile=function(t){var i=t.level,e=t.x,o=t.y;if(i!==0){var r=this.availabilityLevels,u=i%r==0?i-r:(i/r|0)*r,f=1<<i-u,s=e/f|0,h=o/f|0;return new n.QuadtreeHandle(u,s,h)}},t}(),i=function(){function i(n,t,i,r){this.BL=[];this.Ck=!1;this.Ba(n,t,i,r)}return Object.defineProperty(i.prototype,"ready",{get:function(){return this.Ck},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maximumLevel",{get:function(){return this.CH.maximumLevel},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scheme",{get:function(){return this.BV},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tilingScheme",{get:function(){return this.CF},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"availability",{get:function(){return this.CH},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"extent",{get:function(){return this.CA},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"heightmapStructure",{get:function(){return this.Bv},enumerable:!1,configurable:!0}),i.prototype.Ba=function(t,i,r,u){var f=this,e,s,o;t&&t&&(o=n._UrlResource.createIfNeeded(t),o.appendForwardSlash(),e=o,s=e.getDerivedResource({url:"layer.json"}),n.AsyncWebStream.ReadDirect(s.url).then(function(n){var t=JSON.parse(n);f.Bs(e,t,i);r&&r(f);f.Ck=!0},function(){u&&u(f)}))},i.prototype.BE=function(t){return!t||t.length<4?null:new n.GeoExtent(n.NumberHelper.ToDouble(t[0]),n.NumberHelper.ToDouble(t[1]),n.NumberHelper.ToDouble(t[2]),n.NumberHelper.ToDouble(t[3]))},i.prototype.Bs=function(i,r,u){var s=[],p=0,o,k,h,a,ft,et,c,l,d,g,v,nt,ht,f,tt,y,e;if(!r.format){o="The tile format is not specified in the layer.json file.";throw new n.Exception(o);}if(!r.tiles||r.tiles.length===0){o="The layer.json file does not specify any tile URL templates.";throw new n.Exception(o);}var w=!1,b=!1,it=!1,rt=!0,ut=!1;if(r.format==="heightmap-1.0")ut=!0,n.defined(this.Bv)||(this.Bv={heightScale:1/5,heightOffset:-1e3,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1,lowestEncodedHeight:0,highestEncodedHeight:65535}),b=!0;else if(r.format.indexOf("quantized-mesh-1.")!==0){o='The tile format "'+r.format+'" is invalid or not supported.';throw new n.Exception(o);}if(k=r.valid_bounds?r.valid_bounds:r.bounds,k&&(this.CA=this.BE(k)),h=r.tiles,this.defaultTileUrlTemplates=h&&h.length>0?h[0]:undefined,a=r.maxzoom,p=Math.max(p,a),u)this.CF=n._TilingSchemeHelper.CreateFromType(u);else if(r.projection&&r.projection!=="EPSG:4326")if(r.projection==="EPSG:3857")this.CF=n._TilingSchemeHelper.CreateFromType(n.TilingType.WebMercator);else{o='The projection "'+r.projection+'" is invalid or not supported.';throw new n.Exception(o);}else this.CF=n._TilingSchemeHelper.CreateFromType(n.TilingType.Geographic);if(r.scheme&&r.scheme!=="tms"&&r.scheme!=="slippyMap"){o='The scheme "'+r.scheme+'" is invalid or not supported.';throw new n.Exception(o);}else this.BV=r.scheme;if(n.defined(r.extensions)&&r.extensions.indexOf("octvertexnormals")!==-1?w=!0:n.defined(r.extensions)&&r.extensions.indexOf("vertexnormals")!==-1&&(w=!0,rt=!1),n.defined(r.extensions)&&r.extensions.indexOf("watermask")!==-1&&(b=!0),n.defined(r.extensions)&&r.extensions.indexOf("metadata")!==-1&&(it=!0),c=r.available,n.defined(c))for(l=new n._TileAvailability(this.CF,c.length),f=0;f<c.length;++f)for(d=c[f],g=this.CF.yCountOfLevel(f),n.defined(s[f])||(s[f]=[]),v=0;v<d.length;++v){var e=d[v],ot=g-e.endY-1,st=g-e.startY-1;s[f].push([e.startX,ot,e.endX,st,]);l.addAvailableTileRange(f,e.startX,ot,e.endX,st)}else n.defined(et)&&(ft=new n._TileAvailability(this.CF,a),l=new n._TileAvailability(this.CF,a),s[0]=[[0,0,1,0]],l.addAvailableTileRange(0,0,0,1,0));if(this.BL.push(new t(i,r.version,ut,h,l,w,b,it,et,ft,rt)),nt=s.length,nt>0)for(ht=this.CH=new n._TileAvailability(this.CF,p),f=0;f<nt;++f)for(tt=s[f],y=0;y<tt.length;++y)e=tt[y],ht.addAvailableTileRange(f,e[0],e[1],e[2],e[3])},i.prototype.prepareLayersToUse=function(t){var u=this.BL,f,e=u.length,i,r;if(e===1)f=u[0];else for(i=0;i<e;++i)if(r=u[i],!n.defined(r.availability)||r.availability.isTileAvailable(t)){f=r;break}return f},i.prototype.getTileDataAvailable=function(t){return n.defined(this.CH)?t.level>this.CH.maximumLevel?!1:this.CH.isTileAvailable(t)?!0:!1:undefined},i}();n._TileSourceInfo=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t,i,r;(function(n){n[n.Geographic=1]="Geographic";n[n.WebMercator=2]="WebMercator"})(t=n.TilingType||(n.TilingType={}));i=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n._tileWidth=256,n._tileHeight=256,n}return __extends(i,t),Object.defineProperty(i.prototype,"isReady",{get:function(){return this._isReady},enumerable:!1,configurable:!0}),i.prototype.initRootFromOptions=function(t){return t=n.defaultValue(t,n.defaultValue_EMPTY_OBJECT),this._accessToken=t.accessToken,this._rootLevel=t.rootLevel,this.Cl=n.defaultValue(t.minLevel,0),this.BF=t.maxLevel,this.setTilingType(t.tilingType),this._extent=n.defaultValue(t.extent,this.CF.extent),this.CS(t),t},i.prototype.CS=function(t){var i;n.defined(t.subdomains)?(i=t.subdomains,Array.isArray(i)?i=i.slice():i.length>0&&(i=i.split(""))):i=["a","b","c"];this._subdomains=i},Object.defineProperty(i.prototype,"name",{get:function(){return this.hashKey()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tilingType",{get:function(){return this.CF.tilingType},enumerable:!1,configurable:!0}),i.prototype.setTilingType=function(t){this.CF=n._TilingSchemeHelper.CreateFromType(t)},i.prototype.projection=function(){return this.CF._projection},Object.defineProperty(i.prototype,"minLevel",{get:function(){return this.Cl},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxLevel",{get:function(){return this.BF},enumerable:!1,configurable:!0}),i.prototype.setMaxLevel=function(t){n.defined(this.BF)||(this.BF=t)},i.prototype.xCountOfLevel=function(n){return this.CF.xCountOfLevel(n)},i.prototype.yCountOfLevel=function(n){return this.CF.yCountOfLevel(n)},i.prototype.xyToNativeExtent=function(n){return this.CF.xyToNativeExtent(n)},i.prototype.xyToExtent=function(n){return this.CF.xyToExtent(n)},i.prototype._buildTileResource=function(){throw new n.DeveloperError("must override buildImageResource");},i.prototype.isTileAvailableByExtent=function(n,t){return this._extent?this._extent.intersects(t):!0},i.prototype.getTileUrl=function(t){if(!this._isReady||n.defined(this.BF)&&t.level>this.BF||n.defined(this.Cl)&&t.level<this.Cl)return null;n.defined(this._rootLevel)&&(t=new n.QuadtreeHandle(t.level+this._rootLevel,t.x,t.y));var i=this._buildTileResource(t);return i?i.url:""},i}(n.TObject);n.ImageProviderBase=i;r=function(n){function i(){return n!==null&&n.apply(this,arguments)||this}return __extends(i,n),Object.defineProperty(i.prototype,"name",{get:function(){return this.hashKey()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isReady",{get:function(){return this._provider?this._provider.isReady:!1},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tilingType",{get:function(){return this._provider?this._provider.tilingType:t.WebMercator},enumerable:!1,configurable:!0}),i.prototype.isTileAvailableByExtent=function(n,t){return this._provider?this._provider.isTileAvailableByExtent(n,t):!1},i.prototype.getTileUrl=function(n){return this._provider?this._provider.getTileUrl(n):null},i}(n.TObject);n.WrapperImageProviderBase=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=/{[^}]+}/g,i=function(i){function r(t){var r=i.call(this)||this;return r.Bq={x:r.BR,y:r.Ca,z:r.Eh,s:r.DB,reverseX:r.Be,reverseY:r.CG,reverseZ:r.Ce,westDegrees:r.Ea,southDegrees:r.EY,eastDegrees:r.BY,northDegrees:r.Dn,westProjected:r.Dh,southProjected:r.EO,eastProjected:r.EP,northProjected:r.Dz,width:r.Do,height:r.ET},r.EA=!1,r.Eg=new n.GeoExtent,r.EK=!1,r.Ch=new n.GeoExtent,t&&r._reinitialize(t,null),r}return __extends(r,i),r._CreateInner=function(n,t){var i=new r;return i._reinitialize(n,t),i},r.prototype._reinitialize=function(t,i){var r;if(t=this.initRootFromOptions(t),r=this,!n.defined(t))throw new n.DeveloperError("options is required.");if(!n.defined(t.url)&&!i)throw new n.DeveloperError("options.url is required.");var u=t.customTags,f=n.combine(this.Bq,u),e=n._UrlResource.createIfNeeded(t.url,i);r.BW=n.defaultValue(t.urlSchemeZeroPadding,r.BW);r._resource=e;r.Bh=f;this._isReady=!0},r.prototype._buildTileResource=function(i){if(!this.isReady)throw new n.DeveloperError("buildImageResource must not be called before the imagery provider is ready.");this.EA=!1;this.EK=!1;var r=this._resource,o=r.getUrlComponent(!0),u=this.Bh,f={},s=this,e=o.match(t);return n.defined(e)&&e.forEach(function(t){var r=t.substring(1,t.length-1);n.defined(u[r])&&(f[r]=u[r](s,i))}),r.getDerivedResource({templateValues:f})},r.prototype.Cj=function(n,t,i){var u,r;return n.BW&&n.BW.hasOwnProperty(t)&&(u=n.BW[t],typeof u=="string"&&(r=u.length,r>1&&(i=i.length>=r?i:new Array(r-i.toString().length+1).join("0")+i))),i},r.prototype.BR=function(n,t){return n.Cj(n,"{x}",t.x)},r.prototype.Be=function(n,t){var i=n.xCountOfLevel(t.level)-t.x-1;return n.Cj(n,"{reverseX}",i)},r.prototype.Ca=function(n,t){return n.Cj(n,"{y}",t.y)},r.prototype.CG=function(n,t){var i=n.yCountOfLevel(t.level)-t.y-1;return n.Cj(n,"{reverseY}",i)},r.prototype.Ce=function(t,i){var r=t.maxLevel,u=i.level,f=n.defined(r)&&u<r?r-u-1:u;return t.Cj(t,"{reverseZ}",f)},r.prototype.Eh=function(n,t){return n.Cj(n,"{z}",t.level)},r.prototype.DB=function(n,t){var i=(t.x+t.y+t.level)%n._subdomains.length;return n._subdomains[i]},r.prototype.Dx=function(n,t){n.EA||(n.Eg=n.xyToExtent(t),n.EA=!0)},r.prototype.Ea=function(n,t){return n.Dx(n,t),n.Eg.west},r.prototype.EY=function(n,t){return n.Dx(n,t),n.Eg.south},r.prototype.BY=function(n,t){return n.Dx(n,t),n.Eg.east},r.prototype.Dn=function(n,t){return n.Dx(n,t),n.Eg.north},r.prototype.BA=function(n,t){n.EK||(n.Ch=n.xyToNativeExtent(t),n.EK=!0)},r.prototype.Dh=function(n,t){return n.BA(n,t),n.Ch.west},r.prototype.EO=function(n,t){return n.BA(n,t),n.Ch.south},r.prototype.EP=function(n,t){return n.BA(n,t),n.Ch.east},r.prototype.Dz=function(n,t){return n.BA(n,t),n.Ch.north},r.prototype.Do=function(n){return n._tileWidth},r.prototype.ET=function(n){return n._tileHeight},r}(n.ImageProviderBase);n.TemplateImageProvider=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){function t(n){var i={};for(var t in n)n.hasOwnProperty(t)&&(i[t.toLowerCase()]=n[t]);return i}var i=function(i){function r(n){var t=i.call(this)||this;return t.Bm(n),t}return __extends(r,i),r.prototype.Bm=function(i){var f,u;if(i=n.defaultValue(i,n.defaultValue_EMPTY_OBJECT),!n.defined(i.url))throw new n.DeveloperError("options.url is required.");if(!n.defined(i.layers))throw new n.DeveloperError("options.layers is required.");f=n._UrlResource.createIfNeeded(i.url);f.setQueryParameters(r.Dv,!0);n.defined(i.parameters)&&f.setQueryParameters(t(i.parameters));u={};u.layers=i.layers;u.bbox="{westProjected},{southProjected},{eastProjected},{northProjected}";u.width="{width}";u.height="{height}";parseFloat(f.queryParameters.version)>=1.3?u.crs=n.defaultValue(i.crs,i.tilingType&&i.tilingType===n.TilingType.WebMercator?"EPSG:3857":"CRS:84"):u.srs=n.defaultValue(i.srs,i.tilingType&&i.tilingType===n.TilingType.WebMercator?"EPSG:3857":"EPSG:4326");f.setQueryParameters(u,!0);this._provider=n.TemplateImageProvider._CreateInner(n.combine(i,{tilingType:n.TilingType.Geographic}),f)},r.Dv=Object.freeze({service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"}),r}(n.WrapperImageProviderBase);n.WmsImageProvider=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(n){var i=t.call(this)||this;return i.Bm(n),i}return __extends(i,t),i.prototype.Bm=function(t){var s;if(t=this.initRootFromOptions(t),!n.defined(t.url))throw new n.DeveloperError("options.url is required.");var r=n._UrlResource.createIfNeeded(t.url),u=n.defaultValue(t.style,"default"),f=t.tileMatrixSet,e=r.url,o=e.match(/{/g);if(!n.defined(o)||o.length===1&&/{s}/.test(e)){if(!n.defined(t.layer))throw new n.DeveloperError("options.layer is required.");if(!n.defined(t.tileMatrixSet))throw new n.DeveloperError("options.tileMatrixSet is required.");r.setQueryParameters(i.Dv);this.DH=!0}else s={style:u,Style:u,TileMatrixSet:f},r.setTemplateValues(s),this.DH=!1;this._resource=r;this.EJ=t.layer;this.DS=u;this.DN=f;this.EX=t.tileMatrixLabels;this.DP=n.defaultValue(t.format,"image/jpeg");this.DT=t.dimensions;this._isReady=!0},i.prototype._buildTileResource=function(t){var u=t.x,f=t.y,e=t.level,c=this.EX,l=n.defined(c)?c[e]:e.toString(),o=this._subdomains,s=this.DT,r,h,i;return this.DH?(i={},i.tilematrix=l,i.layer=this.EJ,i.style=this.DS,i.tilerow=f,i.tilecol=u,i.tilematrixset=this.DN,i.format=this.DP,n.defined(s)&&(i=n.combine(i,s)),h={s:o[(u+f+e)%o.length]},r=this._resource.getDerivedResource({queryParameters:i}),r.setTemplateValues(h)):(h={TileMatrix:l,TileRow:f.toString(),TileCol:u.toString(),s:o[(u+f+e)%o.length]},r=this._resource.getDerivedResource({}),r.setTemplateValues(h),n.defined(s)&&r.setTemplateValues(s)),r},i.Dv=Object.freeze({service:"WMTS",version:"1.0.0",request:"GetTile"}),i}(n.ImageProviderBase);n.WmtsImageProvider=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t,i,r;(function(n){n.Image="World_Imagery";n.Terrain="World_Topo_Map";n.Road="World_Street_Map"})(t=n.ArcGisImageStyle||(n.ArcGisImageStyle={}));i=function(){function n(){}return n.FromStyle=function(n){switch(n){case t.Image:case t.Terrain:case t.Road:return this.Cb+n+"/MapServer/tile/";default:return this.Cb+t.Image+"/MapServer/tile/"}},n.Cb="https://services.arcgisonline.com/ArcGIS/rest/services/",n}();r=function(t){function r(n){var i=t.call(this)||this;return i.DC=!0,n&&typeof n=="object"?i.DM(n):i.EE(n),i}return __extends(r,t),r.prototype.EE=function(t){var u=i.FromStyle(t),r;this.initRootFromOptions({url:u});r=n._UrlResource.createIfNeeded(u);r.appendForwardSlash();this._resource=r;this.DC=!0;this._isReady=!0},r.prototype.DM=function(t){if(t=this.initRootFromOptions(t),!n.defined(t.url))throw new n.DeveloperError("options.url is required.");var i=n._UrlResource.createIfNeeded(t.url);i.appendForwardSlash();n.defined(this._accessToken)&&i.setQueryParameters({token:this._accessToken});this._resource=i;this.BL=t.layers;this._isReady=!1;this.DD()},r.prototype.DD=function(){var t=this,i=this._resource.getDerivedResource({queryParameters:{f:"json"}});n.AsyncWebStream.ReadDirect(i.url).then(function(n){var i=JSON.parse(n);t.BC(i)},function(){t.Bc()})},r.prototype.BC=function(t){var u=t.tileInfo;if(n.defined(u)){if(u.spatialReference.wkid===102100||u.spatialReference.wkid===102113?this.setTilingType(n.TilingType.WebMercator):t.tileInfo.spatialReference.wkid===4326?this.setTilingType(n.TilingType.Geographic):this.Bc(),this.setMaxLevel(t.tileInfo.lods.length-1),n.defined(t.fullExtent)&&n.defined(t.fullExtent.spatialReference)&&n.defined(t.fullExtent.spatialReference.wkid))if(t.fullExtent.spatialReference.wkid===102100||t.fullExtent.spatialReference.wkid===102113){var i=new n._WebMercatorProjection,r=t.fullExtent,f=i.unproject(new n.Vector2(Math.max(r.xmin,-i.maxRadius*Math.PI),Math.max(r.ymin,-i.maxRadius*Math.PI))),e=i.unproject(new n.Vector2(Math.min(r.xmax,i.maxRadius*Math.PI),Math.min(r.ymax,i.maxRadius*Math.PI)));this._extent=new n.GeoExtent(f.x,f.y,e.x,e.y)}else t.fullExtent.spatialReference.wkid===4326?this._extent=new n.GeoExtent(t.fullExtent.xmin,t.fullExtent.ymin,t.fullExtent.xmax,t.fullExtent.ymax):this.Bc();this.DC=!0}else this.DC=!1;this._isReady=!0},r.prototype.Bc=function(){throw new n.DeveloperError("ArcGisImageProvider 错误的 url");},r.prototype._buildTileResource=function(t){var u;if(!this._isReady)throw new n.DeveloperError("buildImageResource must not be called before the imagery provider is ready.");if(this.DC)u=this._resource.getDerivedResource({url:"tile/"+t.level+"/"+t.y+"/"+t.x});else{var r=this.xyToNativeExtent(t),f=r.west+","+r.south+","+r.east+","+r.north,i={bbox:f,size:this._tileWidth+","+this._tileHeight,format:"png32",transparent:!0,f:"image"};this.tilingType===n.TilingType.Geographic?(i.bboxSR=4326,i.imageSR=4326):(i.bboxSR=3857,i.imageSR=3857);this.BL&&(i.layers="show:"+this.BL);u=this._resource.getDerivedResource({url:"export",queryParameters:i})}return u},r}(n.ImageProviderBase);n.ArcGisImageProvider=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t,i,r;(function(n){n.Arial="Aerial";n.ArialWithLablels="AerialWithLabels";n.Road="Road";n.CanvasDark="CanvasDark";n.CanvasLight="CanvasLight";n.CanvasGray="CanvasGray"})(t=n.BingImageStyle||(n.BingImageStyle={}));i=function(){function n(){}return n.FromStyle=function(n){switch(n){case t.Arial:return"http://ecn.{subdomain}.tiles.virtualearth.net/tiles/a{quadkey}.jpeg?g=11888";case t.ArialWithLablels:return"http://ecn.{subdomain}.tiles.virtualearth.net/tiles/h{quadkey}.jpeg?g=11888&mkt={culture}";case t.Road:return"http://ecn.{subdomain}.tiles.virtualearth.net/tiles/r{quadkey}.jpeg?g=11888&mkt={culture}&shading=hill";case t.CanvasDark:return"http://ak.dynamic.{subdomain}.tiles.virtualearth.net/comp/ch/{quadkey}?mkt=en-US&it=G,L&cstl=WD&og=1757&n=z";case t.CanvasLight:return"http://ak.dynamic.{subdomain}.tiles.virtualearth.net/comp/ch/{quadkey}?mkt=en-US&it=G,L&cstl=WL&og=1757&n=z";case t.CanvasGray:return"http://ak.dynamic.{subdomain}.tiles.virtualearth.net/comp/ch/{quadkey}?mkt=en-US&it=G,L&cstl=CG&og=1757&n=z";default:return this.FromStyle(t.Arial)}},n}();r=function(r){function u(n){var t=r.call(this)||this;return n&&typeof n=="object"?t.DM(n):t.EE(n),t}return __extends(u,r),u.prototype.EE=function(t){this.initRootFromOptions({});this._resource=n._UrlResource.createIfNeeded("https://dev.virtualearth.net/");this._resource.appendForwardSlash();this.Dj=this.Cx("");this.Bx="";this.setMaxLevel(20);this.By=["t0","t1","t2","t3"];this.EU=i.FromStyle(t);this._isReady=!0},u.prototype.DM=function(i){if(i=this.initRootFromOptions(i),!n.defined(i.url))throw new n.DeveloperError("options.url is required.");if(!n.defined(i.accessToken))throw new n.DeveloperError("options.accessToken is required.");this.setTilingType(n.TilingType.WebMercator);this._resource=n._UrlResource.createIfNeeded(i.url);this._resource.appendForwardSlash();this.Dj=this.Cx(i.tileProtocol);this.Dr=n.defaultValue(i.mapStyle,t.Arial);this.Bx=n.defaultValue(i.culture,"");this.Ec=i.proxy;this._isReady=!1;this.Dk()},u.prototype.Dk=function(){function r(n){if(n.resourceSets.length===1){var i=n.resourceSets[0].resources[0];this.setMaxLevel(i.zoomMax-1);t.By=i.imageUrlSubdomains;t.EU=i.imageUrl;t._isReady=!0}}var i=this._resource.getDerivedResource({url:"REST/v1/Imagery/Metadata/"+this.Dr,queryParameters:{incl:"ImageryProviders",key:this._accessToken,uriScheme:this.Dj}}),t=this;n.AsyncWebStream.ReadDirect(i.url).then(function(n){var t=JSON.parse(n);r(t)})},u.prototype.Cx=function(t){if(n.defined(t))t.length>0&&t[t.length-1]===":"&&(t=t.substr(0,t.length-1));else{var i=document.location.protocol;t=i==="http:"?"http":"https"}return t},u.prototype.Eo=function(n,t,i){for(var f,r,e="",u=n;u>=0;--u)f=1<<u,r=0,(t&f)!=0&&(r|=1),(i&f)!=0&&(r|=2),e+=r;return e},u.prototype._buildTileResource=function(n){if(!this._isReady)return null;var t=n.x,i=n.y,r=n.level-1;var f=this.EU,u=this.By,e=(t+i+r)%u.length;return this._resource.getDerivedResource({url:f,templateValues:{quadkey:this.Eo(r,t,i),subdomain:u[e],culture:this.Bx},queryParameters:{n:"z"}})},u}(n.ImageProviderBase);n.BingImageProvider=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=/\/$/,r=function(i){function r(n){var t=i.call(this)||this;return t.Bm(n),t}return __extends(r,i),r.prototype.Bm=function(i){var e,r,u,f;if(i=n.defaultValue(i,n.defaultValue_EMPTY_OBJECT),e=i.mapId,!n.defined(e))throw new n.DeveloperError("options.mapId is required.");if(!n.defined(i.accessToken))throw new n.DeveloperError("options.accessToken is required.");r=n._UrlResource.createIfNeeded(n.defaultValue(i.url,"https://{s}.tiles.mapbox.com/v4/"));u=n.defaultValue(i.format,"png");/\./.test(u)||(u="."+u);f=r.getUrlComponent();t.test(f)||(f+="/");f+=e+"/{z}/{x}/{y}"+u;r.url=f;r.setQueryParameters({access_token:i.accessToken});this._provider=n.TemplateImageProvider._CreateInner(i,r)},r}(n.WrapperImageProviderBase),i;n.MapboxImageProvider=r;i=function(i){function r(n){var t=i.call(this)||this;return t.Bm(n),t}return __extends(r,i),r.prototype.Bm=function(i){var f;if(i=n.defaultValue(i,n.defaultValue_EMPTY_OBJECT),f=i.styleId,!n.defined(f))throw new n.DeveloperError("options.styleId is required.");if(!n.defined(i.accessToken))throw new n.DeveloperError("options.accessToken is required.");var r=n._UrlResource.createIfNeeded(n.defaultValue(i.url,"https://api.mapbox.com/styles/v1/")),e=n.defaultValue(i.tilesize,512),o=n.defaultValue(i.username,"mapbox"),s=n.defined(i.scaleFactor)?"@2x":"",u=r.getUrlComponent();t.test(u)||(u+="/");u+=o+"/"+f+"/tiles/"+e+"/{z}/{x}/{y}"+s;r.url=u;r.setQueryParameters({access_token:i.accessToken});this._provider=n.TemplateImageProvider._CreateInner(i,r)},r}(n.WrapperImageProviderBase);n.MapboxStyleImageProvider=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(n){var i=t.call(this)||this;return i.Bm(n),i}return __extends(i,t),i.prototype.Bm=function(t){t=n.defaultValue(t,n.defaultValue_EMPTY_OBJECT);var i=n._UrlResource.createIfNeeded(n.defaultValue(t.url,"https://a.tile.openstreetmap.org/"));i.appendForwardSlash();i.url+="{z}/{x}/{y}."+n.defaultValue(t.fileExtension,"png");this._provider=n.TemplateImageProvider._CreateInner(n.combine(t,{tilingType:n.TilingType.WebMercator}),i)},i}(n.WrapperImageProviderBase);n.OpenStreetMapImageProvider=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var i,r,t,u,f,e;(function(n){n.Image="img";n.ChineseImageAnno="cia";n.EnglishImageAnno="eia";n.Map="vec";n.ChineseMapAnno="cva";n.EnglishMapAnno="eva";n.Terrain="ter";n.ChineseTerrainAnno="cta"})(i=n.TianDiTuImageStyle||(n.TianDiTuImageStyle={}));r=function(t){function r(i,r){var u=t.call(this)||this,f;return f=i&&typeof i=="object"?i:u.Bd(i,r),u._provider=new n.WmtsImageProvider(f),u}return __extends(r,t),r.EI=function(n){return n||(n=i.Image),"http://{s}.tianditu.com/"+n+"_c/"},r.prototype.Bd=function(t,u){if(!u)if(n.SystemHelper.GetLocalHostIp().indexOf("drawsee.com")>=0)u="eb8356e753b3f970c41ad67c534d7b1b";else throw new n.DeveloperError("天地图必须提供 accessToken");t=t?t:i.Image;var f=r.EI(t)+"wmts?tk="+u;return{url:f,tileMatrixSet:"c",layer:t,tilingType:n.TilingType.Geographic,subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],format:"tiles",rootLevel:1}},r}(n.WrapperImageProviderBase);n.TianDiTuImageProvider=r,function(n){n.Image="6";n.ImageAnno="8";n.Map="7"}(t=n.GaoDeImageStyle||(n.GaoDeImageStyle={}));u=function(i){function r(n){var u=i.call(this)||this,t,f;return n&&typeof n=="object"?t=n:(f=r.ED(n),t={url:f}),u.Bm(t),u}return __extends(r,i),r.ED=function(n){switch(n){case t.Image:return this.Cb+"style="+n+"&";case t.ImageAnno:case t.Map:return this.Cb+"lang=zh_cn&size=1&scale=1&style="+n+"& ";default:return this.Cb+"style=6&"}},r.prototype.Bm=function(i){var f=i.url,u,e,o;f||(f=r.ED(t.Image));u=n._UrlResource.createIfNeeded(f);u.appendForwardSlash();u.url+="&x={x}&y={y}&z={z}";e=n.defaultValue(i.minLevel,0);o=i.maxLevel;this._provider=n.TemplateImageProvider._CreateInner(n.combine(i,{tilingType:n.TilingType.WebMercator}),u)},r.Cb="https://webst01.is.autonavi.com/appmaptile?",r}(n.WrapperImageProviderBase);n.GaoDeImageProvider=u;f=function(t){function i(){var n=t.call(this)||this;return n.Bm(),n}return __extends(i,t),i.prototype.Bm=function(){this.setTilingType(n.TilingType.WebMercator);this.setMaxLevel(18);this._resource=n._UrlResource.createIfNeeded(i.Cb);this._resource.appendForwardSlash()},i.prototype.getTileUrl=function(t){if(n.defined(this.maxLevel)&&t.level>this.maxLevel||n.defined(this.minLevel)&&t.level<this.minLevel)return null;var u=t.x,f=t.y,r=t.level,e=(u+f+r)%10,h=i.Cb,o=this.xCountOfLevel(r),s=this.yCountOfLevel(r);return i.Cb.replace("{x}",(u-o/2).toString()).replace("{y}",(s/2-f-1).toString()).replace("{z}",(r+1).toString()).replace("{s}",e.toString())},i.Cb="http://online{s}.map.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles=pl&scaler=1&p=1",i}(n.ImageProviderBase);n.BaiDuImageProvider=f;e=function(t){function i(n){var u=t.call(this)||this,i,r;return n&&typeof n=="object"?(i=n,r=i.url):r=n,u.Dk(r,i),u}return __extends(i,t),i.prototype.Dk=function(t,i){var f=this,r,u;if(!t)throw new n.DeveloperError("LocalTmsImageProvider must have url");i=n.defaultValue(i,n.defaultValue_EMPTY_OBJECT);u=n.defaultValue(i.tilingType,n.TilingType.WebMercator);this.Dm=new n._TileSourceInfo(t,u,function(e){var o;r={url:t,maximumLevel:e.maximumLevel,tilingType:u};e.defaultTileUrlTemplates&&(o=e.defaultTileUrlTemplates.toLowerCase(),o=o.replace(".terrain",".png"));f.Bm(n.combine(i,r),o)},function(){r={url:t};f.Bm(n.combine(i,r))})},i.prototype.Bm=function(t,i){var e=t.url,r,u,f;if(!e)throw new n.DeveloperError("LocalTmsImageProvider must have url");i||(i="{z}/{x}/{y}.png");r=t.fileExtension;r&&(r.indexOf(".")<0&&(r="."+r),i=i.replace(".png",r));u=n._UrlResource.createIfNeeded(e);u.appendForwardSlash();f=u.getDerivedResource({url:i});this._provider=n.TemplateImageProvider._CreateInner(n.combine(t,{url:f.url}),f)},i.prototype.isTileAvailableByExtent=function(n,t){return this.Dm&&this.Dm.availability?this.Dm.availability.isTileAvailableByExtent(n,t):this._provider?this._provider.isTileAvailableByExtent(n,t):!1},i}(n.WrapperImageProviderBase);n.LocalTmsImageProvider=e}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(t){this.provider=t;this.Du=new n.StringHashSet}return t.prototype.addEmptyUrl=function(n){this.Du.add(n)},t.prototype.isEmptyUrl=function(n){return this.Du.contains(n)},t.prototype.onBadLoadingTask=function(n){n&&this.Du.add(n.url)},t.prototype.toTaskName=function(t){return n.TString.Concat(["imageblock,",t.level,",",t.x,",",t.y])},t.prototype.loadTileImage=function(t){var i=this.provider.getTileUrl(t);return i?n.WriteableBitmap.CreateFromUrl(i):null},t.prototype.loadTileTexture=function(t,i,r,u){var f=this.provider.getTileUrl(i);return f?new n.UrlTexture(t,f,r,u?u:this.toTaskName(i)):null},t.ImageDataBlock="imageblock",t.ImageSep=",",t}(),i;n._ImageTileReader=t;i=function(){function i(i,r,u){u===void 0&&(u=1024);this.graphics=i;this.provider=r;this.DZ=r.tilingType===n.TilingType.WebMercator?new n._MercatorImageTileReader(r):new t(r);this.Cw=new n.ObjectCache(null,0);this.Cw.capacity=u}return i.prototype.dispose=function(){this.Cw.clear();this.DZ=n.SystemHelper.FreeDispose(this.DZ)},i.prototype.collectGabage=function(){this.Cw.collectGabage()},i.prototype.accessTexture=function(n){return this.Cw.accessObject(n,!1)},i.prototype.loadTexture=function(n,t){var i=this.Cw.accessObject(n);return i||(i=this.DZ.loadTileTexture(this.graphics,n,!0,t),i&&this.Cw.addObject(n,i)),i},i}();n.CachedImageTileReader=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var r=function(){function t(t,i,r,u,f,e){this.reader=t;this.tileSource=i;this.level=r;this.xIndex=u;this.zIndex=f;this.BN=!1;e?(this.DR="imageblock,",this.level,this.xIndex,this.zIndex):this.DR=e;this.handle=new n.QuadtreeHandle(r,u,f)}return Object.defineProperty(t.prototype,"image",{get:function(){return this.Br},enumerable:!1,configurable:!0}),t.prototype.loadImage=function(){var t=this,u,i,r;this.Br||this.BN||(n.AsyncRenderContext._IsActive?this.DG||(u=new n.QuadtreeHandle(this.handle.level+1,this.handle.x,this.handle.y),i=this.reader.provider.getTileUrl(u),i&&(this.DG=new n.PromiseDelegate(function(){n.AsyncRenderContext.LoadData(n.AsyncDataLoadType.Image,i,t.DR).then(function(i){if(t.DG.onThen(),i)if(i.isBadUrl){t.BN=!0;t.tileSource.onBadTile(t)}else if(i.data){t.Br=n.WriteableBitmap.CreateFromHtmlImage(i.data);t.tileSource.onLoadTileInfoSuccess(t)}})})),this.DG&&this.DG.tryInvoke()):(r=this.reader.provider.getTileUrl(this.handle),r&&(this.Br=n.WriteableBitmap.CreateFromUrl(r))))},t}(),i=function(){function t(){}return t.ToLngLat=function(t,i,r){var f=1<<t,e=i/f*360-180,u=Math.atan(Math.sinh(3.1415926535897931*(1-2*r/f)));return u=u*180/3.1415926535897931,new n.Vector2(e,u)},t.ToTile=function(t,i){var r=1<<t,u=(i.x+180)/360*r,f=this.ToTileY(t,i.y);return new n.Vector2(u,f)},t.ToTileY=function(n,t){t>85&&(t=85);t<-85&&(t=-85);var i=1<<n;return t=t*.017453292519943295,(1-Math.log(Math.tan(t)+1/Math.cos(t))/3.1415926535897931)/2*i},t.ToTileYArray=function(n,t,i){for(var r,f=(1<<n)*.5,e=t.length,u=0;u<e;u++)r=t[u],r>85&&(r=85),r<-85&&(r=-85),r=r*.017453292519943295,i[u]=(1-Math.log(Math.tan(r)+1/Math.cos(r))/3.1415926535897931)*f},t.TileDataMax=256,t.TileRangeMax=1024,t.TilePixelMax=128,t.BlockSize=256,t}(),t=function(){function t(){}return t.CalcTileYRange=function(t,r,u){var f=n._EarthTilingTransform.XyToRect(t,r,u),o=f.y,s=f.y+f.height,e=t+1;return new n.Vector2(Math.floor(i.ToTileY(e,s)),Math.floor(i.ToTileY(e,o)))},t.PrepareSrcTileYs=function(t,r,u,f,e){for(var c,s=n._EarthTilingTransform.XyToRect(t,r,u),h=f.length,l=h-1,a=s.height/l,v=s.y+s.height,o=0;o<h;o++)f[o]=v-a*o;c=t+1;i.ToTileYArray(c,f,e)},t}(),u=function(){function i(t){this.reader=t;this.Ed=new n.HashSet;this.ES=new n.WriteableBitmap(256,256);this.Cy=new n.WriteableBitmap(256,512);this.CK=new n.WriteableBitmap(256,768);this.De=new n.WriteableBitmap(256,1024);this.Bk=new n.ObjectCache(null);this.Bk.capacity=128}return i.prototype.BB=function(t,i,r){var e=new n.QuadtreeHandle(t,i,r),f=this.Bk.accessObject(e),u;return f&&(u=f.image,u&&u.pixelWidth>0&&u.pixelHeight>0)?u:null},i.prototype.DA=function(i,u,f,e){for(var h,s,a,c=t.CalcTileYRange(i,u,f),v=c.x,y=c.y,l=[],o=v;o<=y;o++)(h=new n.QuadtreeHandle(i,u,o),this.Ed.contains(h))||(s=this.Bk.accessObject(h),s||(a=e?e+"_"+o:null,s=new r(this.reader,this,i,u,o,a),l.push(s)));return l},i.prototype.loadSrcTiles=function(t,i,r){for(var e,f=this.DA(t,i,r),u=0;u<f.length;u++)if(e=f[u],e.loadImage(),!n.AsyncRenderContext.CanLoadImage())break},i.prototype.onLoadTileInfoSuccess=function(n){n&&this.Bk.addObject(n.handle,n)},i.prototype.onBadTile=function(n){n&&(this.Ed.add(n.handle.clone()),this.Bk.removeObject(n.handle))},i.prototype.isSrcTilesReady=function(n,i,r){for(var f=t.CalcTileYRange(n,i,r),e=f.x,o=f.y,u=e;u<=o;u++)if(!this.BB(n,i,u))return!1;return!0},i.prototype.Bp=function(i,r,u){for(var e,o,l,h=t.CalcTileYRange(i,r,u),s=h.x,c=h.y,f=s;f<=c;f++)if(!this.BB(i,r,f))return null;for(o=Math.min(4,c-s+1),e=o<3?this.Cy:o<4?this.CK:this.De,e.clear(),f=0;f<o;f++)l=this.BB(i,r,f+s),l.copyToRect(0,0,e,new n.Rect(0,f*256,256,256));return this.Bk.collectGabage(),e},i.prototype.Dp=function(i,r,u){var c=this.Bp(i,r,u),s,a,e,v,l,f,h,o,y;if(!c)return null;for(s=i<=4?16:i<=8?8:1,a=new Float64Array(s+1),e=new Float64Array(s+1),t.PrepareSrcTileYs(i,r,u,a,e),v=Math.floor(e[0]),l=this.ES.pixelHeight/s,this.ES.clear(),f=0;f<s;f++)h=(e[f]-v)*256,o=(e[f+1]-e[f])*256,h+o>c.pixelHeight&&(o=c.pixelHeight-h),o<=0&&(o=1,h-=1),y=new n.Rect(0,h,256,o),c.copyToRectStretch(y,this.ES,new n.Rect(0,f*l,256,l));return this.ES},i.prototype.accessResultTileImage=function(n,t,i){var r=this.Dp(n,t,i);return r?r:(this.loadSrcTiles(n,t,i),null)},i}(),f=function(t){function i(n){var i=t.call(this,n)||this;return i.provider=n,i.CD=new u(i),i}return __extends(i,t),i.prototype.Cu=function(n,t,i){return this.CD.isSrcTilesReady(n,t,i)?this.CD.accessResultTileImage(n,t,i):(this.CD.loadSrcTiles(n,t,i),null)},i.prototype.getTextureImage=function(n){var t=this.CD.accessResultTileImage(n.level,n.x,n.y);return t?t.canvas:null},i.prototype.loadTileImage=function(n){var t=this.Cu(n.level,n.x,n.y);return t?t.clone():null},i.prototype.loadTileTexture=function(t,i,r,u){var f=i.level,e=i.x,o=i.y;return this.CD.isSrcTilesReady(f,e,o)?new n._TileImageTexture(this,new n.QuadtreeHandle(f,e,o),t,r,u):(this.CD.loadSrcTiles(f,e,o),null)},i}(n._ImageTileReader);n._MercatorImageTileReader=f}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t,f,o,i,s,r,u,h;(function(n){n[n.Canvas=0]="Canvas";n[n.CanvasBackground=10]="CanvasBackground";n[n.BlockBuffer=20]="BlockBuffer"})(t=n.RenderingType||(n.RenderingType={})),function(n){n[n.Null=0]="Null";n[n.Mercator=100]="Mercator"}(f||(f={}));var c=function(){function n(){}return n.prototype.KD=function(t){var i=n.KI*t,r=Math.asin(n._E*Math.sin(i))*n.JV,u=n.KI*(45+t*.5),f=n.KI*(45+r*.5);return Math.tan(u)/Math.pow(Math.tan(f),n._E)},n.prototype.Ew=function(t){var i=2*Math.atan(Math.exp(t))-n.CE*.5,r=i+n.A1*Math.sin(2*i)+n.B1*Math.sin(4*i)+n.C1*Math.sin(6*i)+n.D1*Math.sin(8*i);return n.JV*r},n.prototype.project=function(t){var i=this.KD(t);return Math.log(i)*n.JV},n.prototype.unProject=function(t){return this.Ew(t*n.KI)},n.CE=3.1415926535897931,n._A=6378137,n._B=6356752.3,n.GU=1-n._B*n._B/(n._A*n._A),n._E=Math.sqrt(n.GU),n.KI=n.CE/180,n.JV=180/n.CE,n.A1=.0033560695588,n.B1=65700353e-13,n.C1=176221e-12,n.D1=608e-13,n}(),l=function(){function t(){this.Il=new c;this.Gd()}return Object.defineProperty(t.prototype,"isUse",{get:function(){return t.Jh},set:function(n){t.Jh=n},enumerable:!1,configurable:!0}),t.prototype.Gd=function(){var n,i;if(!t.Jp){for(t.Jp=new Float64Array(1e5),t.In=new Int32Array(1e5),t.JK=.00085084058840009975,t.It=1/t.JK,n=0;n<1e5;n++)i=n*t.JK,t.Jp[n]=this.Il.project(i);t.Jp[0]=0;this.Ke()}},t.prototype.Ke=function(){var n,i,r;for(t.JT=t.Jp[99999],t.KW=t.JT/1e5,t.Ig=1/t.KW,n=0,i=0;i<1e5;i++){for(r=i*t.KW;t.Jp[n+1]<r&&n<99999;)n=n+1;t.In[i]=n}},t.prototype.project=function(i,r){var s,h,o,f,u,e,c;return t.Jh?(o=r<0,o&&(r=-r),f=0,r>85.084058840009973?f=t.JT:(u=n.SystemHelper.ToInt(r/t.JK),f=u>=99999?t.JT:t.Jp[u]+(r-u*t.JK)*t.It*(t.Jp[u+1]-t.Jp[u])),e=0,e=o?-f:f,c=i*111111.11111111111,e=e*111111.11111111111,new n.Vector2(c,e)):(s=i*111111.11111111111,h=r*111111.11111111111,new n.Vector2(s,h))},t.prototype.Gt=function(i){var u=n.SystemHelper.ToInt(i/t.KW),r,f;if(u>=99999)return 85.084058840009973;for(r=t.In[u];i>t.Jp[r+1]&&r<99999;)r=r+1;return f=(i-t.Jp[r])/(t.Jp[r+1]-t.Jp[r]),t.JK*(r+f)},t.prototype.unProject=function(i,r){var o,s,f,u,h,e;return t.Jh?(i=i*9e-6,r=r*9e-6,f=r<0,f&&(r=-r),u=0,u=r>t.JT?85.084058840009973:this.Gt(r),h=i,e=0,e=f?-u:u,new n.Vector2(h,e)):(o=i*9e-6,s=r*9e-6,new n.Vector2(o,s))},t.ProjCount=1e5,t.EarthCoordLimit=85.084058840009973,t.JR=111111.11111111111,t.BZ=9e-6,t.JK=0,t.It=0,t.KW=0,t.Ig=0,t.JT=0,t.Jh=!0,t}(),e=function(){function t(t){this.GZ=0;this.JQ=0;this.Jb=0;this.Jt=0;this.Ih=0;this.HY=0;this.KA=0;this.KF=0;this.Jq=0;this.Ir=new n.Rect;this.initViewport(t);this.resetData()}return t.prototype.resetData=function(){this.Gz=n.ArrayHelper.CreateDataArray2(32,32);this.Jq=0},t.prototype.initViewport=function(n){this.Ir=n.clone();this.GZ=n.x;this.JQ=n.y;this.Jb=n.width;this.Jt=n.height;this.Ih=31/this.Jb;this.HY=31/this.Jt;this.KA=1/this.Ih;this.KF=1/this.HY;this.resetData()},t.prototype.toCellRectIndex=function(t,i,r,u,f){i.value=n.SystemHelper.ToInt((t.x-this.GZ)*this.Ih);r.value=n.SystemHelper.ToInt((t.y-this.JQ)*this.HY);u.value=n.SystemHelper.ToInt(t.right*this.Ih)+1;f.value=n.SystemHelper.ToInt(t.bottom*this.HY)+1;i.value=n.NumberHelper.VerifyRange(i.value,0,31);r.value=n.NumberHelper.VerifyRange(r.value,0,31);u.value=n.NumberHelper.VerifyRange(u.value,0,31);f.value=n.NumberHelper.VerifyRange(f.value,0,31)},t.prototype.calcCellRange=function(t,i){return new n.Rect(t*this.KA,i*this.KF,this.KA,this.KF)},t.prototype.combineRect=function(t){var i,r,f,u;if(n.Math2.RectIntersects(this.Ir,t)){this.Jq=this.Jq+1;t.inflateInPlace(4,4);var e=new n.RefValue(0),s=new n.RefValue(0),h=new n.RefValue(0),c=new n.RefValue(0);for(this.toCellRectIndex(t,e,s,h,c),i=s.value;i<=c.value;i++)for(r=e.value;r<=h.value;r++)f=this.calcCellRange(r,i),n.Math2.RectIntersects(f,t)&&(u=this.Gz[r][i],u||(u=new o(r,i,f),this.Gz[r][i]=u),u.push(t))}},t.prototype.rectInRegion=function(t){var e=new n.RefValue(0),o=new n.RefValue(0),s=new n.RefValue(0),h=new n.RefValue(0),i,r,u,c,f,l;for(this.toCellRectIndex(t,e,o,s,h),i=o.value;i<=h.value;i++)for(r=e.value;r<=s.value;r++)if(u=this.Gz[r][i],u&&(c=this.calcCellRange(r,i),n.Math2.RectIntersects(c,t)))for(f=0;f<u.length;f++)if(l=u[f],n.Math2.RectIntersects(l,t))return!0;return!1},t.RegionSizePower=5,t.RegionSize=32,t}();n.RectOverlapRegion=e;o=function(t){function i(i,r,u){var f=t.call(this)||this;return f.x=0,f.y=0,f.range=new n.Rect,f.x=i,f.y=r,f.range=u.clone(),f}return __extends(i,t),i}(Array);i=function(){function t(){this.worldRect=new n.Rect;this.windowRect=new n.Rect;this.viewportRect=new n.Rect;this.zoomRatio=2;this._maxScale=1e9;this._minScale=0;this.Iy=new n.Matrix2;this.JI=new n.Matrix2;this.Jg=new l;this.KB=new n.Vector2;this.HE=0;this.Ja=0;this.Dw=!0;this.Ka=!0;this.Ik=0;this.IL=0;this.JZ=1;this.Hu=n.Matrix2.Identity;this.KL=n.Matrix2.Identity;this.isUseProjection=!0}return Object.defineProperty(t,"PixelPerMm",{get:function(){return 5},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEarthCoord",{get:function(){return this.Dw},set:function(n){this.Dw=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUseProjection",{get:function(){return this.Jg.isUse},set:function(n){this.Jg.isUse=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUseLevelZoom",{get:function(){return this.Ka},set:function(n){this.Ka=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return new n.Vector2(this.KB.x,this.KB.y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.Ja},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this.HE},enumerable:!1,configurable:!0}),t.prototype.Hi=function(n){return n<t.HU&&(n=t.HU),n>t.Hq&&(n=t.Hq),n},t.ScaleToLevel=function(t){var r=t*this.JC,i=0;return i=r>=1?n.SystemHelper.ToInt(n.MathHelper._Log10(r)/n.MathHelper._Log10(2)+.5):n.SystemHelper.ToInt(n.MathHelper._Log10(r)/n.MathHelper._Log10(2)),i=n.SystemHelper.ToInt(i),20-i},t.prototype.Jk=function(i){var r=t.ScaleToLevel(i);return r=this.Hi(r),n.SystemHelper.ToInt(r)},t._LevelToScale=function(n){n=20-n;var t=0;return t=n>=0?1<<n:1/(1<<Math.abs(n)),t*this.FS},t.prototype.JL=function(n){return n=this.Hi(n),t._LevelToScale(n)},t.prototype.applyTransform=function(){var t=this.Jk(this.JZ),n;this.KB.x=this.Ik;this.KB.y=this.IL;this.HE=t;this.Ja=this.isUseLevelZoom?this.JL(this.HE):this.JZ;n=5e3/this.Ja;this.Iy=this.KO(n);this.JI=this.KO(n);this.JI.invertInPlace();this.JO()},t.prototype.JX=function(n,t,i){this.Ik=n;this.IL=t;this.JZ=i;this.HZ()},t.prototype.HZ=function(){this.JZ=n.NumberHelper.VerifyRange(this.JZ,this._minScale,this._maxScale);this.worldRectLimit&&(this.Ik=n.NumberHelper.VerifyRange(this.Ik,this.worldRectLimit.value.left,this.worldRectLimit.value.right),this.IL=n.NumberHelper.VerifyRange(this.IL,this.worldRectLimit.value.top,this.worldRectLimit.value.bottom))},t.prototype.KO=function(t){var i=n.Matrix2.Identity,r;return i.translateInPlace(this.viewportRect.x+this.viewportRect.width*.5,this.viewportRect.y+this.viewportRect.height*.5),i.scaleInPlace(t,-t),r=this.KX(this.KB.x,this.KB.y),i.translateInPlace(-r.x,-r.y),i},t.prototype.JO=function(){this.windowRect=this.screenToMapRect(this.viewportRect);this.Dw&&(this.windowRect.x<-180&&(this.windowRect.x=-180),this.windowRect.x>180&&(this.windowRect.x=180),this.windowRect.y<-90&&(this.windowRect.y=-90),this.windowRect.y>90&&(this.windowRect.y=90),this.windowRect.width=Math.min(this.windowRect.width,180-this.windowRect.x),this.windowRect.height=Math.min(this.windowRect.height,90-this.windowRect.y))},t.prototype.KS=function(n,i,r){var u=this.KX(n.left,n.top),f=this.KX(n.right,n.bottom),e=Math.abs(f.x-u.x),o=Math.abs(f.y-u.y),s=i.width/t.Gp,h=i.height/t.Gp,c=Math.max(e/s,o/h);return c*r},t.prototype.whole=function(){var n=this.worldRect.x+this.worldRect.width*.5,t=this.worldRect.y+this.worldRect.height*.5,i=this.KS(this.worldRect,this.viewportRect,1.5);return this.JX(n,t,i),this.windowRect=this.worldRect.clone(),!0},t.prototype.zoomToFitViewport=function(n,t){this.worldRect=n.clone();this.viewportRect=t.clone();var i=this.worldRect.x+this.worldRect.width*.5,r=this.worldRect.y+this.worldRect.height*.5,u=this.KS(this.worldRect,this.viewportRect,1);return this.JX(i,r,u),!0},t.prototype.zoomToLevel=function(n,t){return this.JX(n.x,n.y,this.JL(t)),!0},t.prototype.zoomToScale=function(n,t){return this.JX(n.x,n.y,t),!0},t.prototype.zoomToRect=function(t){if(t.width===0||t.height===0)return!1;var r=t.x+t.width*.5,u=t.y+t.height*.5,i=this.scale,f=Math.max(t.width/this.windowRect.width,t.height/this.windowRect.height);return i=i*f,this.zoomToScale(new n.Vector2(r,u),i),!0},t.prototype.zoomIn=function(n){return this.FZ(n,!0)},t.prototype.zoomOut=function(n){return this.FZ(n,!1)},t.prototype.FZ=function(n,t){var i,r;return this.isUseLevelZoom?(i=this.level,i=t?i+1:i-1,this.JX(this.KB.x,this.KB.y,this.JL(i))):(r=this.scale,r=t?r/this.zoomRatio:r*this.zoomRatio,this.JX(this.KB.x,this.KB.y,r)),!0},t.prototype.move=function(n,t){return this.JX(this.KB.x+n,this.KB.y+t,this.scale),!0},t.prototype.KX=function(t,i){return this.Dw?this.Jg.project(t,i):new n.Vector2(t,i)},t.prototype.Jm=function(t,i){return this.Dw?this.Jg.unProject(t,i):new n.Vector2(t,i)},Object.defineProperty(t.prototype,"mapToEarthMatrix",{get:function(){return this.Hu.clone()},set:function(n){this.Hu.copyFrom(n);this.KL.copyFrom(n);this.KL.invertInPlace()},enumerable:!1,configurable:!0}),t.prototype.mapToEarthToRef=function(n,t){this.Dw?t.set(n.x,n.y):this.Hu.transformToRef(n,t)},t.prototype.earthToMapToRef=function(n,t){this.Dw?t.set(n.x,n.y):this.KL.transformToRef(n,t)},t.prototype.mapToEarth=function(t){var i=n.Vector2.Zero();return this.mapToEarthToRef(t,i),i},t.prototype.earthToMap=function(t){var i=n.Vector2.Zero();return this.earthToMapToRef(t,i),i},t.prototype.mapToEarthRect=function(t){var i=this.mapToEarth(new n.Vector2(t.left,t.top)),r=this.mapToEarth(new n.Vector2(t.right,t.bottom));return n.Rect.CreateFromPoint(i,r)},t.prototype.earthToMapRect=function(t){var i=this.earthToMap(new n.Vector2(t.left,t.top)),r=this.earthToMap(new n.Vector2(t.right,t.bottom));return n.Rect.CreateFromPoint(i,r)},t.prototype.mapToScreen=function(n){return n=this.KX(n.x,n.y),this.Iy.transform(n)},t.prototype.screenToMap=function(n){var t=this.JI.transform(n);return this.Jm(t.x,t.y)},t.prototype.mapToScreenPoints=function(t){var i,r;if(!t||t.length<=0)return null;for(i=n.ArrayHelper.CloneDataArray(t),r=0;r<i.length;r++)i[r]=this.KX(i[r].x,i[r].y);return this.Iy.transformPoints(i)},t.prototype.screenToMapPoints=function(n){var t,i;if(!n||n.length<=0)return null;for(t=this.JI.transformPoints(n),i=0;i<t.length;i++)t[i]=this.Jm(t[i].x,t[i].y);return t},t.prototype.mapToScreenLength=function(t){var i=new n.Vector2(t,0),r=new n.Vector2(0,0);return i=this.mapToScreen(i),r=this.mapToScreen(r),i.x-r.x},t.prototype.screenToMapLength=function(t){var i=new n.Vector2(t,0),r=new n.Vector2(0,0);return i=this.screenToMap(i),r=this.screenToMap(r),i.x-r.x},t.prototype.mapToMeter=function(t){return this.Dw?t/n.EarthMath2.LongitudePerMeter(this.KB.y):t},t.prototype.meterToMap=function(t){return this.Dw?n.EarthMath2.LongitudePerMeter(this.KB.y)*t:t},t.prototype.mapToScreenRect=function(t){var i=this.mapToScreen(new n.Vector2(t.x,t.y)),r=this.mapToScreen(new n.Vector2(t.right,t.bottom));return n.Rect.CreateFromPoint(i,r)},t.prototype.screenToMapRect=function(t){var i=this.screenToMap(new n.Vector2(t.x,t.y)),r=this.screenToMap(new n.Vector2(t.right,t.bottom));return n.Rect.CreateFromPoint(i,r)},t.prototype.transformAndFilterPoints=function(t,i){return i===void 0&&(i=2),this.mapToScreenPoints(n.VectorHelper.FilterDuplicatedVector2(t,this.screenToMapLength(i),!1))},t.prototype.calcBlockRange=function(i,r,u){i=i+8;var l=r<<i,a=u<<i,c=1<<i,f=l,e=a,o=f+c,s=e+c,h=t.Iq;return f=f*h,e=e*h,o=o*h,s=s*h,n.Rect.CalcRange([this.Jm(f,e),this.Jm(f,s),this.Jm(o,s),this.Jm(o,e)])},t.prototype.calcBlockPixelCenter=function(n,i,r){n=n+8;var s=i<<n,h=r<<n,e=1<<n,u=s+e/2,f=h+e/2,o=t.Iq;return u=u*o,f=f*o,this.Jm(u,f)},t.Hr=4,t.Gp=t.Hr*1e3,t.HU=0,t.Hq=32,t.Iq=12756274*Math.PI/268435456,t.FS=t.Iq*t.Gp,t.JC=1/t.FS,t}();n.CoordSystem2=i;s=function(){function r(r){this.renderType=t.Canvas;this.isDrawDynAnno=!1;this.isCheckDrawingPass=!1;this.Ie=new i;this.JG=new n.Pen2(n.Color.Black,1);this.KM=new n.SolidColorBrush(n.Color.Black);this.Jy=new n.SolidColorBrush(n.Color.Black);this.HS=new n.SolidColorBrush(n.Color.LightGray);this.KC=new n.SolidColorBrush(n.Color.FromIntRgba(0,0,0,128));this.KV=!1;this.Ha=r;this.isCheckDrawingPass=!1;this.isDrawDynAnno=!0;this.DU=new n.SolidPointLegend(n.Color.FromIntRgba(0,0,0,255),.40000000596046448,!0);this.Jn=new n.SolidLineLegend(n.Color.FromIntRgba(0,0,128,255),.2);this.Hg=new n.SolidPolyLegend(n.Color.FromIntRgba(160,160,160,255))}return Object.defineProperty(r.prototype,"graphics",{get:function(){return this.Ha},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"coordSystem",{get:function(){return this.Ie},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentLegend",{get:function(){return this.CX},set:function(n){this.CX!==n&&(this.CX&&(this.CX=null),this.CX=n)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"defaultPolyBrush",{get:function(){return this.HS},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isDrawingCanvasBackground",{get:function(){return t.CanvasBackground===this.renderType},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isDrawingBlockBuffer",{get:function(){return t.BlockBuffer===this.renderType},enumerable:!1,configurable:!0}),r.prototype.II=function(){this.Ji=new e(this.Ie.viewportRect)},r.prototype.getOverlapRegion=function(){return this.Ji},r.prototype.combineRect=function(n){this.Ji&&this.Ji.combineRect(n)},r.prototype.rectInRegion=function(n){return this.Ji&&this.Ji.rectInRegion(n)},r.prototype.isFullRedraw=function(){return!0},r.prototype.getDrawingRange=function(){return this.Ie.windowRect.clone()},r.prototype.begineCanvasDraw=function(i,r){this.Ji?this.Ji.initViewport(this.Ie.viewportRect):this.II();this.clearDrawSomething();this.Ie.applyTransform();i&&this.graphics.clear();r&&this.graphics.drawRectangle(this.coordSystem.viewportRect,null,new n.SolidColorBrush(r));this.renderType=t.Canvas},r.prototype.clearDrawSomething=function(){this.KV=!1},r.prototype.setDrawSomething=function(){this.KV=!0},r.prototype.hasDrawSomething=function(){return this.KV},r.prototype.drawNode=function(n,t){if(t===void 0&&(t=0),!this.isCheckDrawingPass){var i=this.Ie.mapToScreen(n);this.CX?this.CX.drawPoint(this.graphics,i,t):this.DU.drawPoint(this.graphics,i,t)}this.KV=!0},r.prototype.drawPolyline=function(n){if(!this.isCheckDrawingPass){var t=this.Ie.transformAndFilterPoints(n,2);this.CX?this.CX.drawPolyline(this.graphics,t):this.Jn.drawPolyline(this.graphics,t)}this.KV=!0},r.prototype.drawPolylineClip=function(t){var r=.1,i=this.coordSystem.viewportRect.clone(),o=new n.Rect(i.x-i.width*r,i.y-i.height*r,i.width*(1+2*r),i.height*(1+2*r)),s=this.Ie.transformAndFilterPoints(t,2),f=n.Math2._ClipLineByRect(o,s),u,e;if(f.length>0)for(u=0;u<f.length;u++)e=f[u],e&&this.drawPolylineNoTrans(e)},r.prototype.drawPolylineNoTrans=function(n){this.isCheckDrawingPass||(this.CX?this.CX.drawPolyline(this.graphics,n):this.Jn.drawPolyline(this.graphics,n));this.KV=!0},r.prototype.drawPolygon=function(n,t,i){var r=this.Ie.transformAndFilterPoints(n,2);this.Ha.drawPolygon(r,t,i);this.KV=!0},r.prototype.fillPolygon=function(n){if(!this.isCheckDrawingPass){var t=this.Ie.transformAndFilterPoints(n,2);this.CX?this.CX.fillPolygon(this.graphics,t):this.Hg.fillPolygon(this.graphics,t)}this.KV=!0},r.prototype.drawText=function(n,t,i,r){r===void 0&&(r=!1);t=this.Ie.mapToScreen(t);this.Ha.drawText(n,t,this.KC.color,r);this.KV=!0},r.SystemFontSize=12,r}();n.RenderContext2=s;r=function(){function n(){this.nextNodeLen=0;this.curIndex=0;this.x=0;this.y=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.nextNodeLen=0;this.curIndex=0;this.x=0;this.y=0;this.x1=this.y1=this.x2=this.y2=0}return n}();n.DrawAnnoPara=r;u=function(){function t(){}return t.CalcPositionOnLine=function(t,i,r){for(var f=t.length,u;r.nextNodeLen<i&&r.curIndex<f-1;)r.nextNodeLen=r.nextNodeLen+n.Math2.Distance(t[r.curIndex].x,t[r.curIndex].y,t[r.curIndex+1].x,t[r.curIndex+1].y),r.curIndex=r.curIndex+1;r.curIndex<=0&&(r.curIndex=f-1);r.curIndex>f-1&&(r.curIndex=f-1);r.x1=t[r.curIndex-1].x;r.y1=t[r.curIndex-1].y;r.x2=t[r.curIndex].x;r.y2=t[r.curIndex].y;u=(r.nextNodeLen-i)/n.Math2.Distance(r.x1,r.y1,r.x2,r.y2);u=1-u;r.x=r.x1+(r.x2-r.x1)*u;r.y=r.y1+(r.y2-r.y1)*u},t.CalcAnnoDrawSize=function(n,i){return n*i+(n-1)*i*t.GetTextSpaceRatio(n)},t.CanDraw=function(n,i,r){return t.CalcAnnoDrawSize(n,i)<r*.60000002384185791},t.IsHighWayAnno=function(n){return n.length===4&&(n.charCodeAt(0)===71||n.charCodeAt(0)===103)},t.GetTextSpaceRatio=function(n){switch(n){case 2:return 3;case 3:return 2;default:return.5}},t.CalcAnnoPoints=function(i,u,f,e,o){var h=[],c,a;if(!i||(u<=0&&(u=n.Math2.Length(i)),c=t.CalcAnnoDrawSize(f,e),c>u))return h;var l=(u-c)/2,v=t.GetTextSpaceRatio(f),s=new r;for(a=0;a<f;a++){if(t.CalcPositionOnLine(i,l,s),s.curIndex>=i.length)break;o?h.push(new n.Vector2(s.x,s.y)):h.push(new n.Vector2(s.x-e*.5,s.y+e*.5));l=l+e*(1+v)}return h},t.FindMaxSegForAnno=function(t,i,r){var o,f,u,e;if(!t)return-1;for(o=-34028234663852886e22,f=-1,u=0;u<i-1;u++)e=n.Math2.Distance(t[u].x,t[u].y,t[u+1].x,t[u+1].y),e>=r&&e>o&&(f=u,o=e);return f<0||f>=i-1?-1:f},t.SetAnnoClipRegion=function(i,r,u,f,e,o,s){var c,l,a,y,h,v;if(n.Math2.RectContains(i,r))c=t.CalcAnnoPoints(f,e,o,s,!1);else for(c=[],l=n.Math2._ClipLineByRect(i,f),h=0;h<l.length;h++)a=l[h],a&&(y=t.CalcAnnoPoints(a,0,o,s,!1),n.ArrayHelper.AddRange(c,y));var p=u.coordSystem.mapToScreenLength(s),w=n.SystemHelper.ToInt(p*1.2),b=n.SystemHelper.ToInt(p*1.5);for(h=0;h<c.length;h++)v=u.coordSystem.mapToScreen(c[h]),u.combineRect(new n.Rect(v.x,v.y,w,b))},t}();n._LineAnnoHelper=u;h=function(){function t(){}return t.DrawAnnoClip=function(i,r,u,f,e,o,s,h,c,l){var v,a,y;if(n.Math2.RectContains(i,r))t.DrawAnno(u,f,e,o,s,h,c,l);else for(v=n.Math2._ClipLineByRect(i,f),a=0;a<v.length;a++)y=v[a],y&&t.DrawAnno(u,y,0,o,s,h,c,l)},t.DrawAnno=function(t,i,r,f,e,o,s,h){var w,c,a,p,v,y,l,b;if(f&&i.length>=2&&(w=t.graphics,w&&(c=u.CalcAnnoPoints(i,r,f.length,e,h),c.length>0)))for(a=c.length,p=!1,p=Math.abs(c[0].x-c[a-1].x)>.5*Math.abs(c[0].y-c[a-1].y)?c[0].x>c[a-1].x:c[0].y<c[a-1].y,v=f.length,y=new Array(1),l=0;l<v;l++){if(l>=c.length)break;b=t.coordSystem.mapToScreen(c[l]);y[0]=f.charCodeAt(v-l-1);y[0]=p?f.charCodeAt(v-l-1):f.charCodeAt(l);t.graphics.drawText(n.TString.FromChars(y),b,s.color,!0)}},t.DrawStyledText=function(t,i,r,u){var f,e,o;!!i&&u&&(f=u.textAngle,e=n.SystemHelper.ToInt(t.coordSystem.mapToScreenLength(Math.abs(u.textHeight*1.1))),e>=8&&(f>=360&&(f=f-360),o=t.coordSystem.mapToScreen(r),t.graphics.drawTextAdvance(i,o,f,u.textColor,e,u.fontName,!0)))},t.KN=1.1,t}();n._TextRenderHelper=h}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(){}return t.GeoObjectTypeFromName=function(t){switch(t){case"点":return n.GeoType.Point;case"折线":return n.GeoType.LineString;case"多边形":return n.GeoType.Polygon;case"箭头":return n.GeoType.Arrow;case"曲线多边形":return n.GeoType.SplinePoly;case"矩形":return n.GeoType.Rect;case"圆":return n.GeoType.Ellipse;case"椭圆":return n.GeoType.Ellipse}return n.GeoType.None},t.MapToolTypeFromName=function(t){switch(t){case"点":return n.MapToolType.None;case"折线":return n.MapToolType.TrackLine;case"多边形":return n.MapToolType.TrackPoly;case"箭头":return n.MapToolType.TrackLine;case"曲线多边形":return n.MapToolType.TrackPoly;case"矩形":return n.MapToolType.TrackRect;case"圆":return n.MapToolType.TrackCircle;case"椭圆":return n.MapToolType.TrackEllipse}return n.MapToolType.None},t.EnumNames=function(){return t.BO},t.GeoObjectTypeNames_cctor=function(){var n=[];n.push("");n.push("点");n.push("折线");n.push("多边形");n.push("箭头");n.push("曲线多边形");n.push("矩形");n.push("圆");n.push("椭圆");t.BO=n},t.None="",t.Point="点",t.Line="折线",t.Poly="多边形",t.Arrow="箭头",t.SplinePoly="曲线多边形",t.Rect="矩形",t.Circle="圆",t.Ellipse="椭圆",t}(),i,r;n.GeoObjectTypeNames=t;i=function(n){function t(t,i){i===void 0&&(i=null);var r=n.call(this)||this;return r.callerInfo=i,r.result=t,r}return __extends(t,n),t}(n.EventArgs);n.GeoObjectPickEventArgs=i;r=function(t){function i(){var i=t.call(this)||this;return i.isObjectVisible=!0,i.maxVisibleScale=17976931348623157e292,i.minVisibleScale=0,i.angle=0,i.Dq=!1,i.DJ=!1,i.GD=!1,i.GA=!1,i.Ff=n.Color.Black,i}return __extends(i,t),Object.defineProperty(i.prototype,"geometry",{get:function(){return this.GH},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"geoType",{get:function(){return this.GH.geoType},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"anno",{get:function(){return this.GH.text},set:function(n){this.GH.text=n},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"annoColor",{get:function(){var t=new n.Color;return t=this.GH.drawStyle?this.GH.drawStyle.textColor.clone():this.Ff.clone(),t.clone()},set:function(n){this.GH.drawStyle?this.GH.drawStyle.textColor=n.clone():this.Ff=n.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this.GH.position2},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bounds",{get:function(){return this.GH.bounds2},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"points",{get:function(){return this.GH.points2},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"legend",{get:function(){return this.CX},set:function(n){this.CX=n;this.Dq=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"boundLegend",{get:function(){return this.Cp},set:function(n){this.Cp=n;this.DJ=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fillLegend",{get:function(){return this.Da},set:function(n){this.Da=n;this.GD=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"layerName",{get:function(){return this._layerName},enumerable:!1,configurable:!0}),i.CreateFromGeometry=function(n){var t=new i;return t.GH=n,t},i.CreateFromPoint=function(t){var r=new i;return r.GH=n.Geometry.CreateFromPoint2(t),r},i.CreateFromRect=function(t,r){var u=new i;return u.GH=n.Geometry.CreateFromRect(t,r),u},i.CreateFromPoints=function(t,r){var u=new i;return u.GH=n.Geometry.CreateFromPoint2Array(t,r),u},i.prototype.Fc=function(n){var t=n.coordSystem.scale;return this.maxVisibleScale>0&&(t>this.maxVisibleScale||t<this.minVisibleScale)?!1:!0},i.prototype.drawAnno=function(t,i,r){var f,u;if(!!this.anno&&this.Fc(t)){f=1;u=0;n:for(;;)switch(u){default:var l=this.GH.points2.length,s=void 0,e=new n.Vector2,h=void 0,c=!0,o=this.geoType;switch(o){case n.GeoType.Point:if(l<=0)return;h=this.legend?this.legend:i.pointLegend;e=this.GH.points2[0].clone();c=!1;u=f;continue n;case n.GeoType.LineString:this.CQ(t,s,this.annoColor,this.anno,this.GH.points2,r);return;case n.GeoType.Polygon:break;default:switch(o){case n.GeoType.Rect:case n.GeoType.Ellipse:break;default:if(o!==n.GeoType.Text){u=f;continue n}n._TextRenderHelper.DrawStyledText(t,this.anno,this.GH.points2[0],this.GH.drawStyle);return}}e=this.GH.position2;u=f;continue n;case 1:this.Gj(t,h,s,this.annoColor,this.anno,e,r,c);break n}}},i.prototype.markAnnoOverlap=function(t,i,r){var f,u;if(this.Fc(t)&&this.anno&&this.anno.length>0){f=1;u=0;n:for(;;)switch(u){default:var c=this.GH.points2.length,e=new n.Vector2,o=void 0,s=!0,h=this.geoType;switch(h){case n.GeoType.Point:if(c<=0)return;o=this.legend?this.legend:i.pointLegend;e=this.GH.points2[0].clone();s=!1;u=f;continue n;case n.GeoType.LineString:return;case n.GeoType.Polygon:break;default:switch(h){case n.GeoType.Rect:case n.GeoType.Ellipse:break;default:u=f;continue n}}e=this.GH.position2;u=f;continue n;case 1:this.FM(t,o,void 0,this.annoColor,this.anno,e,r,s);break n}}},i.prototype.FN=function(t,i,r,u,f,e,o,s,h,c){var a,v,y,d;if(h.copyFrom(new n.Vector2),c.copyFrom(n.Rect.Empty),a=f.length,a<=0)return!1;var l=12,g=t.coordSystem.screenToMapLength(l),p=l>>1,w=(l>>2)+1,b=n.SystemHelper.ToInt(l*1.1),k=n.SystemHelper.ToInt(l*1.5);return h.copyFrom(e.clone()),v=0,i&&(y=i.bounds,v=y.right*n.CoordSystem2.PixelPerMm,d=y.bottom*n.CoordSystem2.PixelPerMm),h.copyFrom(t.coordSystem.mapToScreen(h)),h.x=h.x+(p+v),h.y=h.y+w,c.copyFrom(new n.Rect(h.x,h.y,a*b,k)),n.Math2.RectIntersects(t.coordSystem.viewportRect,c)},i.prototype.FM=function(t,i,r,u,f,e,o,s){var c=new n.Vector2,h=new n.Rect;this.FN(t,i,r,u,f,e,o,s,c,h)&&(t.rectInRegion(h)?this.GA=!0:(this.GA=!1,t.combineRect(h)))},i.prototype.Gj=function(t,i,r,u,f,e,o,s){if(!this.GA){var h=new n.Vector2,c=new n.Rect;this.FN(t,i,r,u,f,e,o,s,h,c)&&t.graphics.drawText(f,h,u,!0)}},i.prototype.CQ=function(t,i,r,u,f,e){var h=u.length,o;if(h>0&&(o=this.GH.points2.length,o>0)){var s=12,c=t.coordSystem.screenToMapLength(s),l=new n.SolidColorBrush(r),a=n.Rect.CalcRange(f);n._TextRenderHelper.DrawAnnoClip(e,a,t,f,0,u,c,s,l,!1)}},i.prototype.DO=function(t){this.Dq||(this.CX=null);this.DJ||(this.Cp=null);this.GD||(this.Da=null);this.geoType===n.GeoType.Point?this.CX||(this.CX=t.pointLegend):this.GH.drawStyle&&this.GH.geoType!==n.GeoType.Text?(this.Cp||(this.Cp=new n.SolidLineLegend(this.GH.drawStyle.penColor,.1)),this.Da||(this.Da=new n.SolidPolyLegend(this.GH.drawStyle.brushColor))):this.Cp||this.Da||(this.Cp=this.CX?this.CX:t.lineLegend,this.Da=this.CX?this.CX:t.polyLegend)},i.prototype.draw=function(t,i,r){var f,u,h,v,y,e;if(this.isObjectVisible&&this.Fc(t)){if(this.geoType!==n.GeoType.Point&&!n.Math2.RectIntersects(r,this.GH.bounds2))return;this.DO(i);f=void 0;u=void 0;i.isLineVisible&&this.boundLegend&&(f=this.boundLegend.pen);i.isPolyVisible&&(this.fillLegend&&(u=this.fillLegend.brush),u||(u=t.defaultPolyBrush));h=this.geoType;switch(h){case n.GeoType.Point:if(this.legend||(this.legend=i.pointLegend),this.legend){var o=this.legend.bounds,c=t.coordSystem.mapToScreen(this.GH.points2[0]),s=n.CoordSystem2.PixelPerMm,l=o.left*s,p=o.right*s,a=o.top*s,w=o.bottom*s,b=new n.Rect(c.x+l,c.y+a,p-l,w-a);if(!n.Math2.RectIntersects(t.coordSystem.viewportRect,b))break}else if(!r.contains(this.GH.points2[0]))break;t.currentLegend=this.legend;t.drawNode(this.GH.points2[0],this.angle);break;case n.GeoType.LineString:t.currentLegend=this.boundLegend;v=Math.max(this.bounds.width,this.bounds.height)*.5>Math.max(r.width,r.height);v?t.drawPolylineClip(this.GH.points2):t.drawPolyline(this.GH.points2);break;case n.GeoType.Polygon:y=t.coordSystem.transformAndFilterPoints(this.GH.points2,2);t.graphics.drawPolygon(y,f,u);break;default:switch(h){case n.GeoType.Rect:e=t.coordSystem.mapToScreenRect(this.bounds);this.geoType===n.GeoType.Rect?t.graphics.drawRectangle(e,f,u):t.graphics.drawRectangle(e,f,u);break;case n.GeoType.Ellipse:e=t.coordSystem.mapToScreenRect(this.bounds);this.geoType===n.GeoType.Rect?t.graphics.drawEllipse(e,f,u):t.graphics.drawEllipse(e,f,u)}}}},i}(n.PickableObject);n.GeoObject=r;t.GeoObjectTypeNames_cctor()}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t,i,u,f,e,r,o,s;(function(n){n[n.None=0]="None";n[n.GeoLayer=1]="GeoLayer";n[n.ShapeLayer=2]="ShapeLayer";n[n.ImageLayer=10]="ImageLayer";n[n.SimpleImageLayer=11]="SimpleImageLayer"})(t=n.Layer2Type||(n.Layer2Type={}));i=function(i){function r(){var r=i!==null&&i.apply(this,arguments)||this;return r.bounds=new n.Rect,r.maxVisibleScale=1e9,r.minVisibleScale=0,r.textPosition=0,r.isPointVisible=!0,r.isLineVisible=!0,r.isPolyVisible=!0,r.fontColor=n.Color.White,r.isAnnoVisible=!0,r.isCacheDrawingMode=!1,r.isAnnoCacheDrawingMode=!1,r.isBackground=!1,r._layerType=t.None,r.Gl=0,r}return __extends(r,i),Object.defineProperty(r.prototype,"count",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"coordType",{get:function(){return this.Gl},set:function(n){this.Gl=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isEmpty",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layerType",{get:function(){return this._layerType},enumerable:!1,configurable:!0}),r.prototype.getAt=function(){return null},r.prototype.draw=function(){},r.prototype.drawAnno=function(){},r.prototype.prepareData=function(){return!1},r.prototype.markAnnoOverlap=function(){},r.prototype.claimAnnoPos=function(){},r.prototype.drawDynamicAnno=function(){},r.prototype.isDrawable=function(n){if(!this.isVisible)return!1;var t=n.coordSystem.scale;return t<=this.maxVisibleScale&&t>=this.minVisibleScale},r.prototype.hasSomethingToDrawInRect=function(){return!1},r.prototype.selectOneObject=function(){return null},r}(n.Layer);n.Layer2=i;u=function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.FQ=function(t){var i=new n.RefValue(t),r=new n.RefValue(0);return n._ParamEvaluater.Parse4(i,r,52,37),n.SystemHelper.ToInt(i.value)},r.prototype.calcBounds=function(){for(var r,u=n.Rect.Empty,e=!0,f=this.FQ(this.length-1);f>=0;f=f-1)r=i.prototype.getAt.call(this,f),r&&r.isVisible&&(r.layerType===t.SimpleImageLayer||r.count>0)&&(e?(u=r.bounds.clone(),e=!1):r.bounds.width>0&&r.bounds.height>0&&u.unionInPlace(r.bounds));return this.length>0&&u.isEmpty?this.CI():u.clone()},r.prototype.CI=function(){for(var t,u=n.Rect.Empty,f=!0,r=this.FQ(this.length-1);r>=0;r=r-1)t=i.prototype.getAt.call(this,r),t&&t.isVisible&&(t.bounds.isEmpty||(f?(u=t.bounds.clone(),f=!1):t.bounds.width>0&&t.bounds.height>0&&u.unionInPlace(t.bounds)));return u.clone()},r.prototype.calcCoordType=function(){for(var t,n=this.FQ(this.length-1);n>=0;n=n-1)if(t=i.prototype.getAt.call(this,n),t&&t.isVisible&&t.coordType===1)return 1;return 0},r.prototype.FH=function(n){for(var r,u=[],t=0;t<this.length;t++)r=i.prototype.getAt.call(this,t),r.isBackground===n&&u.push(r);return u},r.prototype.Fg=function(){for(var r,t=[],n=0;n<this.length;n++)r=i.prototype.getAt.call(this,n),t.push(r);return t},r.prototype.draw=function(n,t){this.GX=n;this.isVisible&&(this.Ft(n,this.FH(!0),t),this.Ft(n,this.FH(!1),t))},r.prototype.Ft=function(n,t,i){var u,r;for(this.GX=n,u=this.FQ(t.length-1);u>=0;u=u-1)r=t[u],this.Ee(r)||r&&r.isVisible&&r.isCacheDrawingMode===i&&r.count>0&&r.draw(n);i&&this.EC(n,t,!0)},r.prototype.drawAnno=function(n){this.EC(n,this.FH(!1),!1)},r.prototype.markAnnoOverlap=function(n){var t,r;if(this.isVisible)for(t=0;t<this.length;t++)r=i.prototype.getAt.call(this,t),r&&r.isVisible&&r.markAnnoOverlap(n)},r.prototype.EC=function(n,t,i){var u,r;if(this.isVisible)for(u=0;u<t.length;u++)r=t[u],r&&r.isVisible&&r.isAnnoCacheDrawingMode===i&&r.drawAnno(n)},r.prototype.drawDynamicAnno=function(n){var t,r;if(this.isVisible)for(t=0;t<this.length;t++)r=i.prototype.getAt.call(this,t),r&&r.drawDynamicAnno(n)},r.prototype.drawImage=function(n){var t,r;if(this.GX=n,this.isVisible)for(t=this.FQ(this.length-1);t>=0;t=t-1)r=i.prototype.getAt.call(this,t),r&&r.isVisible&&this.Ee(r)&&r.draw(n)},r.prototype.Ee=function(n){return n.layerType===t.SimpleImageLayer||n.layerType===t.ImageLayer},r.prototype.selectOneObject=function(n,t){var r,u,f;if(!this.GX)return null;for(r=0;r<this.length;r++)if(u=i.prototype.getAt.call(this,r),u&&this.Eq(this.GX,u)&&(f=u.selectOneObject(n,t),f))return f;return null},r.prototype.Eq=function(t,i){if(!t||!i.isVisible||!i.isPickable)return!1;var r=t.coordSystem.scale;return r<=i.maxVisibleScale&&r>=i.minVisibleScale&&n.Math2.RectIntersects(i.bounds,t.coordSystem.windowRect)},r.prototype.prepareData=function(n){var u,t,r;if(!this.isVisible)return!1;for(u=!1,t=0;t<this.length;t++)r=i.prototype.getAt.call(this,t),r&&r.isVisible&&r.prepareData(n)&&(u=!0);return u},r.prototype.setIsCacheDrawingMode=function(n){var u,t,r;if(!this.isVisible)return!1;for(u=!1,t=0;t<this.length;t++)r=i.prototype.getAt.call(this,t),r&&(r.isCacheDrawingMode!==n&&(u=!0),r.isCacheDrawingMode=n);return u},r}(n.LayerCollection);n.Layer2Collection=u;f=function(i){function r(r,u){u===void 0&&(u="");var f=i.call(this)||this;return f.FI=[],f.EW=new n.Dictionary,f.DQ=[],f.isBackground=!1,f.isAnnoCacheDrawingMode=!1,f._layerType=t.ShapeLayer,f.name=u,r.layers.add(f),f.isPickable=!0,f}return __extends(r,i),Object.defineProperty(r.prototype,"count",{get:function(){return this.FI.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isEmpty",{get:function(){return this.count<=0},enumerable:!1,configurable:!0}),r.prototype.getAt=function(n){return n>=0&&n<this.FI.length?this.FI[n]:null},r.prototype.getGeoObjectByOid=function(n){return this.EW.getValue(n)},r.prototype.addGeoObject=function(n){if(n.no===0&&(n.no=this.FI.length+1),!this.EW.containsKey(n.no)){this.FI.push(n);this.EW.add(n.no,n);this.DQ.push(n.no);var t=n.bounds;this.FI.length<=1?this.bounds=t.clone():this.bounds.unionInPlace(t);n._layerName=this.name}return n},r.prototype.clear=function(){n.ArrayHelper.Clear(this.FI);this.EW.clear();n.ArrayHelper.Clear(this.DQ)},r.prototype.addPoint=function(t){var i=n.GeoObject.CreateFromPoint(t);return this.addGeoObject(i)},r.prototype.addLine=function(t){if(!t||t.length<2)return null;var i=n.GeoObject.CreateFromPoints(n.GeoType.LineString,t);return this.addGeoObject(i)},r.prototype.addPoly=function(t){if(!t||t.length<3)return null;var i=n.GeoObject.CreateFromPoints(n.GeoType.Polygon,t);return this.addGeoObject(i)},r.prototype.addAnno=function(t,i,r,u,f){var e=n.Geometry._CreateFromText(t,i,r,u,f),o=n.GeoObject.CreateFromGeometry(e);return this.addGeoObject(o)},r.prototype.addRect=function(t){var i=n.GeoObject.CreateFromRect(n.GeoType.Rect,t);return this.addGeoObject(i)},r.prototype.addEllipse=function(t){var i=n.GeoObject.CreateFromRect(n.GeoType.Ellipse,t);return this.addGeoObject(i)},r.prototype.addArrow=function(t,i,r,u){return!i||i.length<2?null:this.addPoly(n.Shape2.Arrow(i,r,u))},r.prototype.addSpline=function(t,i,r){if(i===void 0&&(i=50),r===void 0&&(r=!0),!t||t.length<3)return null;var u=n.Shape2.Spline(t,i,r);return r?this.addPoly(u):this.addLine(u)},r.prototype.GO=function(n,t){return n>0&&t>0&&n<t},r.prototype.hasSomethingToDrawInRect=function(t){for(var i,f=[],e=Math.max(t.width,t.height)*r.Gc,u=0;u<this.FI.length;u++)i=this.FI[u],i&&n.Math2.RectIntersects(t,i.bounds)&&(this.GO(Math.max(i.bounds.width,i.bounds.height),e)||f.push(u));return f.length>0},r.prototype.draw=function(t){var u,o,s,f,h,e,r;if(this.GX=t,i.prototype.isDrawable.call(this,t))for(u=t.getDrawingRange(),o=t.coordSystem.screenToMapLength(8),u.inflateInPlace(o,o),s=t.coordSystem.screenToMapLength(4),f=0;f<this.FI.length;f++){h=1;e=0;n:for(;;)switch(e){default:if(r=this.FI[f],r&&this.FY(r)){if(r.geoType!==n.GeoType.Point&&(!n.Math2.RectIntersects(u,r.bounds)||r.bounds.width<=s&&r.bounds.height<=s)){e=h;continue n}r.draw(t,this,u)}e=h;continue n;case 1:break n}}},r.prototype.FY=function(t){var i=t.geoType;switch(i){case n.GeoType.Point:return this.isPointVisible;case n.GeoType.LineString:return this.isLineVisible;case n.GeoType.Polygon:break;default:switch(i){case n.GeoType.Rect:case n.GeoType.Ellipse:break;default:return!1}}return this.isPolyVisible||this.isLineVisible},r.prototype.drawAnno=function(n){var u,t,r;if(i.prototype.isDrawable.call(this,n))for(u=n.getDrawingRange(),t=0;t<this.FI.length;t++)r=this.FI[t],r&&r.drawAnno(n,this,u)},r.prototype.markAnnoOverlap=function(n){var u,t,r;if(i.prototype.isDrawable.call(this,n))for(u=n.getDrawingRange(),t=0;t<this.FI.length;t++)r=this.FI[t],r&&r.markAnnoOverlap(n,this,u)},r.prototype.GT=function(t,i,r,u){if(i.points.length>0){var f=t.coordSystem.mapToScreenPoints(i.points),o=new n.Pen2(n.Color.Black,1),s=new n.SolidColorBrush(u);switch(i.geoType){case n.GeoType.Point:var h=f[0].x,c=f[0].y,e=10;t.graphics.drawEllipse(new n.Rect(h-e,c-e,e*2,e*2),o,s);break;case n.GeoType.LineString:this.isLineVisible&&t.graphics.drawPolyline(f,o);break;case n.GeoType.Polygon:this.isPolyVisible&&t.graphics.drawPolygon(f,null,s)}}},r.prototype.Fh=function(t,i){if(!t||!t.isObjectVisible||!t.isPickable||t.maxVisibleScale<i)return!1;var r=t.geoType;switch(r){case n.GeoType.Point:return this.isPointVisible;case n.GeoType.LineString:return this.isLineVisible;case n.GeoType.Polygon:break;default:switch(r){case n.GeoType.Rect:case n.GeoType.Ellipse:break;default:return!1}}return this.isPolyVisible},r.prototype.selectOneObject=function(t,i){var y,l,p,w,u,r,a,e,g,v;if(!this.GX)return null;var h=t.x,c=t.y,f=new n.Vector2;for(f.x=h,f.y=c,y=this.FI.length,l=new Array(5),u=0;u<l.length;++u)l[u]=new n.Vector2;for(p=i*i,w=this.GX.coordSystem.scale,u=y-1;u>=0;u=u-1)if(r=this.FI[u],r&&this.Fh(r,w))if(r.geoType===n.GeoType.Point){if(n.Math2.SquareDistancePoint(r.points[0],f)<=p)return r}else if(r.bounds.inflate(i,i).contains(f)){a=r.geoType;switch(a){case n.GeoType.LineString:if(n.Math2.DistancePointLine(f,r.points)<i)return r;break;case n.GeoType.Polygon:if(n.Math2.Contains(r.points,f))return r;break;default:switch(a){case n.GeoType.Rect:if(r.bounds.contains(f))return r;break;case n.GeoType.Ellipse:if(e=r.bounds,e.width>0&&e.height>0){var o=e.width*.5,b=e.height*.5,k=e.x+o,d=e.y+b,s=o/b;if(s=s*s,g=o*o,v=Math.sqrt((h-k)*(h-k)+(c-d)*(c-d)*s),r.fillLegend){if(v<o)return r}else if(Math.abs(v-o)<=i)return r}}}}return null},r.prototype.selectByRect=function(t){var u=[],f,i,r;if(!this.GX)return u;for(f=this.GX.coordSystem.scale,i=this.FI.length-1;i>=0;i=i-1)r=this.FI[i],r&&this.Fh(r,f)&&n.Math2.RectIntersects(t,r.bounds)&&u.push(r);return u},r.prototype.selectByPoly=function(t){var u=[],f,i,r;if(!this.GX)return u;for(f=this.GX.coordSystem.scale,i=this.FI.length-1;i>=0;i=i-1)r=this.FI[i],r&&this.Fh(r,f)&&n.Math2.Overlaps(t,n.Shape2.Rectangle(r.bounds))&&u.push(r);return u},r.prototype.selectByCircle=function(t,i){var f=[],e,r,u;if(!this.GX)return f;for(e=this.GX.coordSystem.scale,r=this.FI.length-1;r>=0;r=r-1)u=this.FI[r],u&&this.Fh(u,e)&&n.Math2.RectWithin(u.bounds,t,i)&&f.push(u);return f},r.prototype.transform=function(n){for(var i,t=0;t<this.count;t++)i=this.getAt(t),i&&i.geometry.transform(n);this.bounds=n.transformRect(this.bounds)},r.Gc=.02,r}(i);n.ShapeLayer2=f,function(n){n[n.Point=0]="Point";n[n.Anno=1]="Anno";n[n.Other=2]="Other"}(e||(e={}));r=function(t){function i(i){var r=t.call(this)||this;return r.anchorDis=10,r.lineDis=4,r.borderColor=n.Color.FromIntRgba(255,128,0,255),r.borderWidth=.5,r.backgroundColor=n.Color.FromIntRgba(255,255,255,220),r.padding=4,r.isBold=!0,r.Ei=0,r.Dy=0,r.Fv=!1,r.DW=[],r.Gg=[],r.Eu=i,r}return __extends(i,t),Object.defineProperty(i.prototype,"geoObject",{get:function(){return this.Eu},enumerable:!1,configurable:!0}),i.prototype.calcOverlapBounds=function(t,i,r){var u=t.coordSystem.mapToScreen(this.Eu.position),f=this.EL(t,i,r);return f.unionInPlace(new n.Rect(u.x,u.y,1e-13,1e-13)),f.clone()},i.prototype.EL=function(t,i,r){var u=t.coordSystem.mapToScreen(this.Eu.position);switch(i){case n.HorizontalAlignment.Left:u.x=u.x-(this.Ei+this.anchorDis);break;case n.HorizontalAlignment.Center:u.x=u.x-this.Ei*.5;break;case n.HorizontalAlignment.Right:u.x=u.x+this.anchorDis}switch(r){case n.VerticalAlignment.Top:u.y=u.y-(this.Dy+this.anchorDis);break;case n.VerticalAlignment.Center:u.y=u.y-this.Dy*.5;break;case n.VerticalAlignment.Bottom:u.y=u.y+this.anchorDis}return new n.Rect(u.x,u.y,this.Ei,this.Dy)},i.prototype.Fu=function(t,i,r){var u=t.coordSystem.mapToScreen(this.Eu.position),f=this.Fj();switch(i){case n.HorizontalAlignment.Left:u.x=u.x-this.anchorDis;break;case n.HorizontalAlignment.Center:u.x=u.x-f;break;case n.HorizontalAlignment.Right:u.x=u.x+this.anchorDis}switch(r){case n.VerticalAlignment.Top:u.y=u.y-this.anchorDis;break;case n.VerticalAlignment.Center:u.y=u.y-f;break;case n.VerticalAlignment.Bottom:u.y=u.y+this.anchorDis}return u.clone()},i.prototype.Fj=function(){return Math.min(.5*this.anchorDis,this.Dy/6)},i.prototype.GQ=function(t,i,r){var u=t.coordSystem.mapToScreen(this.Eu.position),f=i===n.HorizontalAlignment.Center,e=this.anchorDis+Math.min(2*this.anchorDis,this.Dy*.5),o=this.Fj();switch(i){case n.HorizontalAlignment.Left:u.x=u.x-this.anchorDis;break;case n.HorizontalAlignment.Center:u.x=u.x+o;break;case n.HorizontalAlignment.Right:u.x=u.x+this.anchorDis}switch(r){case n.VerticalAlignment.Top:u.y=f?u.y-this.anchorDis:u.y-e;break;case n.VerticalAlignment.Center:u.y=u.y+o;break;case n.VerticalAlignment.Bottom:u.y=f?u.y+this.anchorDis:u.y+e}return u.clone()},i.prototype.setSize=function(n,t){this.Fv=!0;this.Ei=n;this.Dy=t},i.prototype.clearText=function(){n.ArrayHelper.Clear(this.DW);n.ArrayHelper.Clear(this.Gg)},i.prototype.appendText=function(n,t){return this.DW.push(n),this.Gg.push(t),this.Gg.length-1},i.prototype.updateText=function(n,t,i){n>=0&&n<this.DW.length&&(this.DW[n]=t,this.Gg[n]=i)},i.prototype.getText=function(n){return n<0||n>=this.DW.length?"":this.DW[n]},i.prototype.getColor=function(t){return t<0||t>=this.Gg.length?n.Color.Black:this.Gg[t]},i.prototype.Cq=function(n){var t,i;if(!this.Fv&&this.DW.length>0){for(this.Dy=this.FF()*this.DW.length,this.Ei=0,t=0;t<this.DW.length;t++)i=n.graphics.measureText(this.DW[t],12,""),i.width>this.Ei&&(this.Ei=i.width);this.Dy=this.Dy+this.padding*2;this.Ei=this.Ei+this.padding*2}},i.prototype.FF=function(){return 12+this.lineDis},i.prototype.draw=function(t,i,r,u){this.Cq(t);var e=t.coordSystem.mapToScreen(this.Eu.position),h=this.Fu(t,r,u),c=this.GQ(t,r,u),o=this.EL(t,r,u),f=t.graphics,s=new n.Pen2(this.borderColor,this.borderWidth);f.drawRectangle(o,new n.Pen2(this.borderColor,this.borderWidth),new n.SolidColorBrush(this.backgroundColor));f.drawLine(e,h,s);f.drawLine(e,c,s);this.FB(t,o)},i.prototype.FB=function(t,i){var r;if(this.DW.length>0){var e=t.graphics,o=this.FF(),f=12,s=this.padding,u=f+this.padding;for(r=0;r<this.DW.length;r++)e.drawTextAdvance(this.DW[r],new n.Vector2(i.x+s,i.y+u),0,this.Gg[r],f,"",this.isBold),u=u+o}},i}(n.ImmutableNoObject);n.LabelObject=r;o=function(t){function i(){var n=t.call(this)||this;return n.Fd=[],n.Et=[],n.isCacheDrawingMode=!1,n}return __extends(i,t),Object.defineProperty(i.prototype,"count",{get:function(){return this.Fd.length},enumerable:!1,configurable:!0}),i.prototype.addLabel=function(n){var t=new r(n);return t.no=this.Fd.length+1,this.Fd.push(t),t},i.prototype.clear=function(){n.ArrayHelper.Clear(this.Fd);n.ArrayHelper.Clear(this.Et)},i.prototype.draw=function(i){var o,s,u,r,f,e;if(this.GX=i,t.prototype.isDrawable.call(this,i))for(n.ArrayHelper.Clear(this.Et),o=i.getDrawingRange(),s=i.coordSystem.viewportRect.clone(),u=0;u<this.Fd.length;u++)r=this.Fd[u],r&&o.contains(r.geoObject.position)&&(f=new n.RefValue(0),e=new n.RefValue(0),this.GC(r,s,f,e)&&(r.draw(i,this,f.value,e.value),this.Et.push(r.calcOverlapBounds(i,f.value,e.value))))},i.prototype.GC=function(t,i,r,u){return(r.value=n.HorizontalAlignment.Right,u.value=n.VerticalAlignment.Center,this.GB(t,i,r.value,u.value))?!0:(r.value=n.HorizontalAlignment.Right,u.value=n.VerticalAlignment.Top,this.GB(t,i,r.value,u.value))?!0:(r.value=n.HorizontalAlignment.Right,u.value=n.VerticalAlignment.Bottom,this.GB(t,i,r.value,u.value))?!0:(r.value=n.HorizontalAlignment.Left,u.value=n.VerticalAlignment.Center,this.GB(t,i,r.value,u.value))?!0:(r.value=n.HorizontalAlignment.Left,u.value=n.VerticalAlignment.Top,this.GB(t,i,r.value,u.value))?!0:(r.value=n.HorizontalAlignment.Left,u.value=n.VerticalAlignment.Bottom,this.GB(t,i,r.value,u.value))?!0:(r.value=n.HorizontalAlignment.Center,u.value=n.VerticalAlignment.Top,this.GB(t,i,r.value,u.value))?!0:(r.value=n.HorizontalAlignment.Center,u.value=n.VerticalAlignment.Bottom,this.GB(t,i,r.value,u.value))},i.prototype.GB=function(t,i,r,u){var e=t.calcOverlapBounds(this.GX,r,u),f;if(!n.Math2.RectContains(i,e))return!1;for(f=0;f<this.Et.length;f++)if(n.Math2.RectIntersects(e,this.Et[f]))return!1;return!0},i}(i);n.LabelLayer=o;s=function(i){function r(n){var r=i.call(this)||this;return r.Cl=0,r.BF=0,r.name=n,r.Cl=0,r.BF=20,r._layerType=t.SimpleImageLayer,r}return __extends(r,i),Object.defineProperty(r.prototype,"isEmpty",{get:function(){return!this.Gb},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxLevel",{get:function(){return this.BF},set:function(n){this.BF=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minLevel",{get:function(){return this.Cl},set:function(n){this.Cl=n},enumerable:!1,configurable:!0}),r.prototype.updateImage=function(n,t){this.bounds=t.clone();this.Gb=n},r.prototype.hasSomethingToDrawInRect=function(t){return this.Gb&&this.bounds.width>0&&this.bounds.height>0&&n.Math2.RectIntersects(this.bounds,t)},r.prototype.draw=function(t){var i,r;this.Gb&&t.coordSystem.level>=this.minLevel&&t.coordSystem.level<=this.maxLevel&&this.bounds.width>0&&this.bounds.height>0&&(i=t.getDrawingRange(),n.Math2.RectIntersects(this.bounds,i)&&(r=t.coordSystem.mapToScreenRect(this.bounds),t.graphics.drawImageStretch(this.Gb,r)))},r}(i);n.SimpleImageLayer=s}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(){}return t.EarthToGrid=function(t,i){return new n.Vector2((t+180)*this.FP,(i+90)*this.FP)},t.GridToEarth=function(t,i){return new n.Vector2(t*this.Fs-180,i*this.Fs-90)},t.EarthToGridRect=function(t){var i=this.EarthToGrid(t.x,-t.y),r=this.EarthToGrid(t.right,-t.bottom);return n.Rect.CreateFromPoint(i,r)},t.GridToEarthRect=function(t){var i=this.GridToEarth(t.x,t.y),r=this.GridToEarth(t.right,t.bottom);return i.y=-i.y,r.y=-r.y,n.Rect.CreateFromPoint(i,r)},t.ToImageRect=function(t,i,r){var f=Math.pow(2,20-t),u=256*f;return new n.Rect(i*u,r*u,u,u)},t.ToEarthRect=function(n,t,i){var r=this.ToImageRect(n,t,i);return this.GridToEarthRect(r)},t.ToBlockScale=function(n){return Math.pow(2,20-n)},t.ToGridCoord=function(n,t){return Math.pow(2,20-n)*256*t},t.BASE_COUNT=268435456,t.BlockSize=256,t.Fs=360/t.BASE_COUNT,t.FP=1/t.Fs,t}(),i=function(){function i(t,i,r,u){this.level=0;this.xIndex=0;this.zIndex=0;this.bounds=new n.Rect;this.FA=!1;this.Ge();this.Ev(t,i,r,u)}return Object.defineProperty(i.prototype,"isSubDataReady",{get:function(){return this.FA},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isEmpty",{get:function(){var i=!1,t;if(this.Fw)i=this.Fw.value;else{for(this.Fw=new n.NullableValue(!0),t=0;t<4;t++)if(this.FW[t]){this.Fw=new n.NullableValue(!1);break}i=this.Fw.value}return i},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"subNodes",{get:function(){return this.FW},enumerable:!1,configurable:!0}),i.prototype.getSubNode=function(n){return this.FW[n]},i.prototype.Ge=function(){this.Fw=null;this.FW=new Array(4);for(var n=0;n<4;n++)this.FW[n]=null},i.prototype.Ev=function(i,r,u,f){this.Fz=i;this.level=n.SystemHelper.ToInt(r);this.xIndex=u;this.zIndex=f;this.handle=new n.QuadtreeHandle(r,u,f);this.bounds=t.ToImageRect(r,u,f)},i.prototype.setSubNode=function(n,t){this.Fw=null;this.FW[n]=t},i.prototype.bindingDrawingData=function(){var i,n,t;if(this.imageSource||(this.imageSource=this.Fz.accessImage(this.handle)),this.isEmpty)this.FA=!1;else for(this.FA=!0,i=this.FW,n=0;n<i.length;n++)t=i[n],t&&(t.bindingDrawingData(),t.imageSource||(this.FA=!1))},i.SubNodeCount=4,i}(),r=function(){function t(){this.CV=[];this.FW=[];this.DL();this.Ey()}return Object.defineProperty(t.prototype,"rootNodes",{get:function(){return this.CV},enumerable:!1,configurable:!0}),t.prototype.getNodesTotal=function(){return this.getRootNodeCount()+this.getSubNodeCount()},t.prototype.getRootNodeCount=function(){return this.CV.length},t.prototype.getSubNodeCount=function(){return this.FW.length},t.prototype.getRootNode=function(n){return n<0||n>=this.CV.length?null:this.CV[n]},t.prototype.getSubNode=function(n){return n<0||n>=this.FW.length?null:this.FW[n]},t.prototype.enumAllNodes=function(){var t=[];return n.ArrayHelper.AddRange(t,this.CV),n.ArrayHelper.AddRange(t,this.FW),t},t.prototype.getNodesByLevel=function(t){var u=[],f,i,r;if(t===0)n.ArrayHelper.AddRange(u,this.CV);else for(f=this.getSubNodeCount(),i=0;i<f;i++)r=this.getSubNode(i),r&&r.level===t&&u.push(r);return u},t.prototype.createRootNode=function(t){this.CV=n.ArrayHelper.CloneArray(t)},t.prototype.DL=function(){this.CV=[]},t.prototype.Ey=function(){this.FW=[]},t.prototype.allocSubNode=function(n,t,r,u){if(this.FW.length>=1024)return null;var f=new i(n,t,r,u);return this.FW.push(f),f},t.prototype.resetNodes=function(){this.DL();this.Ey()},t.SubNodesBufferMax=1024,t.RootNodesMax=128,t}(),u=function(t){function r(i){var r=t.call(this)||this;return r.isAllowFatherLevel=!0,r.maxLevel=28,r.BJ=-1,r.Df=0,r.GK=0,r.EF=new n.Dictionary,r.Bi=0,r.Dl=i,r.GW=new n.ObjectCache(r,0),r.GW.capacity=128,r}return __extends(r,t),r.prototype.loadObject=function(n){return this.Dl.loadTileImage(n)},r.prototype.releaseObject=function(){},r.prototype.accessImage=function(n){if(n.level>this.maxLevel)return null;var t=this.GW.accessObject(n,!1);return t?t:(this.GW.collectGabage(),this.GW.accessObject(n,!0))},r.prototype.GG=function(u,f,e){var v=n.SystemHelper.ToInt((f.left+f.right)*.5),y=n.SystemHelper.ToInt((f.top+f.bottom)*.5),s,a,h,b,o,k;if(e===this.BJ&&v===this.Df&&y===this.GK||(this.Bi=e,s=0,s=this.isAllowFatherLevel?e-r.EM:e,s=Math.max(2,s),!u.coordSystem.isEarthCoord&&s<10))return!1;var p=new n.RefValue(0),w=new n.RefValue(0),c=new n.RefValue(0),l=new n.RefValue(0);if(this.Fn(f,s,p,w,c,l)){if(c.value>r.Gf||l.value>r.Gf)return!1;for(a=[],o=0;o<l.value;o++)for(h=0;h<c.value;h++)b=new i(this,s,p.value+h,w.value+o),a.push(b);for(t.prototype.resetNodes.call(this),t.prototype.createRootNode.call(this,a),o=0;o<this.rootNodes.length;o++)k=this.rootNodes[o],this.FR(f,k);return this.BJ=e,this.Df=v,this.GK=y,!0}return!1},r.prototype.FR=function(n,i){if(!this.CT(n,i))return!0;if(i.level>0){var r=t.prototype.allocSubNode.call(this,this,i.level+1,i.xIndex*2,i.zIndex*2);r&&this.FR(n,r)&&i.setSubNode(0,r);r=t.prototype.allocSubNode.call(this,this,i.level+1,i.xIndex*2+1,i.zIndex*2);r&&this.FR(n,r)&&i.setSubNode(1,r);r=t.prototype.allocSubNode.call(this,this,i.level+1,i.xIndex*2,i.zIndex*2+1);r&&this.FR(n,r)&&i.setSubNode(2,r);r=t.prototype.allocSubNode.call(this,this,i.level+1,i.xIndex*2+1,i.zIndex*2+1);r&&this.FR(n,r)&&i.setSubNode(3,r)}return!0},r.prototype.CT=function(t,i){return i.level<this.Bi&&n.Math2.RectIntersects(t,i.bounds)},r.prototype.Fn=function(t,i,r,u,f,e){var o,h,s,c,l;return r.value=u.value=f.value=e.value=0,o=new n.Rect(t.x,t.y,t.width,t.height),i=20-i,h=Math.pow(2,i),s=256*h,r.value=n.SystemHelper.ToInt(o.x/s),u.value=n.SystemHelper.ToInt(o.y/s),c=n.SystemHelper.ToInt(o.right/s),l=n.SystemHelper.ToInt(o.bottom/s),f.value=c-r.value+1,e.value=l-u.value+1,!0},r.prototype.enumDrawingNodes=function(n,t,i){var u,e,r,f;for(this.EF.clear(),this.prepareDrawingData(n,t,i),u=[],r=0;r<this.rootNodes.length;r++)e=this.rootNodes[r],this.Fi(e,u);for(r=0;r<u.length;r++)f=u[r],f.imageSource||this.EF.add(f.handle,1);return u},r.prototype.prepareDrawingData=function(n,t,i){var r,u;for(this.GG(n,t,i),r=0;r<this.rootNodes.length;r++)u=this.rootNodes[r],u.bindingDrawingData();return!0},r.prototype.Fi=function(n,t){var r,i,u;if(n)for(n.isSubDataReady||t.push(n),r=n.subNodes,i=0;i<r.length;i++)u=r[i],this.Fi(u,t)},r.EM=4,r.Gf=64,r}(r),f=function(i){function r(t,r,f){f===void 0&&(f=!0);var e=i.call(this)||this;return e.name=t,e.Dl=r,e.Fz=new u(e.Dl),e.Fz.isAllowFatherLevel=f,e._layerType=n.Layer2Type.ImageLayer,e.bounds=new n.Rect(-180,-90,360,180),e}return __extends(r,i),Object.defineProperty(r.prototype,"maxLevel",{get:function(){return this.Fz.maxLevel},set:function(n){this.Fz.maxLevel=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isEmpty",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.Cf=function(n){return n.level},r.prototype.BI=function(n){return n.mapToEarthRect(n.windowRect)},r.prototype.DF=function(n){return n.mapToScreenRect(n.windowRect)},r.prototype.Fb=function(n){var i=n.mapToEarthRect(n.windowRect);return t.EarthToGridRect(i)},r.prototype.Fr=function(n,i){var r=t.GridToEarthRect(i),u=n.earthToMapRect(r);return n.mapToScreenRect(u)},r.prototype.FK=function(n){var t=n.windowRect;return!t||t.width<=0||t.height<=0},r.prototype.prepareData=function(n){var t,i;return n.isDrawingBlockBuffer?!1:this.isVisible?(t=n.coordSystem,this.FK(t))?!1:(i=this.Fb(t),this.Fz.prepareDrawingData(n,i,this.Cf(t))):!1},r.prototype.isAllImageInWindowReady=function(n){var i=n.coordSystem,u,r,t,f;if(this.FK(i))return!1;for(u=this.Fb(i),r=this.Fz.enumDrawingNodes(n,u,this.Cf(i)),t=0;t<r.length;t++)if(f=r[t],!f.imageSource)return!1;return!0},r.prototype.hasSomethingToDrawInRect=function(){return!0},r.prototype.draw=function(n){var r=n.coordSystem,i,u,f;this.FK(r)||n.isDrawingBlockBuffer||this.isVisible&&(i=this.BI(r),i.width>0&&i.height>0&&(u=this.DF(r),f=t.EarthToGridRect(i),this.FL(n,f,u)))},r.prototype.FL=function(t,i){var e=t.coordSystem,f,u,r,o;if(this.FK(e))return!1;var s=t.graphics,h=this.Cf(e),c=this.Fz.enumDrawingNodes(t,i,h);for(f=0;f<c.length;f++)u=c[f],u.imageSource&&(r=this.Fr(e,u.bounds),r.width=r.width+.75,r.height=r.height+.75,o=!1,u.level===h&&Math.abs(r.width-256)<1&&Math.abs(r.height-256)<1&&(o=!0),o?s.drawImage(u.imageSource,new n.Vector2(r.x,r.y),0):s.drawImageStretch(u.imageSource,r));return!0},r.BlockSize=256,r}(n.Layer2);n.ImageTileLayer=f}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var i,r,u,t,f,e,o,s,h,c,l;(function(n){n[n.None=0]="None";n[n.NodeLegend=100]="NodeLegend";n[n.NodeSimpleLegend=101]="NodeSimpleLegend";n[n.NodeSystemLegend=102]="NodeSystemLegend";n[n.NodeGisLegend=103]="NodeGisLegend";n[n.NodeImageLegend=104]="NodeImageLegend";n[n.LineLegend=200]="LineLegend";n[n.LineSimpleLegend=201]="LineSimpleLegend";n[n.LineSystemLegend=202]="LineSystemLegend";n[n.LineGisLegend=203]="LineGisLegend";n[n.LineAdvanceLegend=204]="LineAdvanceLegend";n[n.PolyLegend=300]="PolyLegend";n[n.PolySimpleLegend=301]="PolySimpleLegend";n[n.PolySystemLegend=302]="PolySystemLegend";n[n.PolyGisLegend=303]="PolyGisLegend"})(i=n.LegendType||(n.LegendType={})),function(n){n[n.Repeat=0]="Repeat";n[n.Middle=20]="Middle"}(r=n.PointFillLineStyle||(n.PointFillLineStyle={}));u=function(){function t(){this.EH=[];this.Bw=new n.Dictionary;this.GI=new n.Dictionary;this.GP=0;this.GP=1}return t.prototype.getItem=function(n){return arguments.length===1&&(!n||n.constructor===String)?this.FV(n):this.Fl(n)},t.prototype.FV=function(n){if(!n)return null;var t=this.Bw.getValue(n);return t&&(t.legendSet=this),t},t.prototype.Fl=function(n){var t=this.GI.getValue(n);return t&&(t.legendSet=this),t},t.prototype.Cr=function(){var t,n;for(this.Bw.clear(),this.GI.clear(),t=0;t<this.EH.length;t++)n=this.EH[t],n&&(this.Bw.add(n.name,n),this.GI.add(n.no,n),n.legendSet=this)},t.prototype.selectByType=function(n){for(var t,r=[],i=0;i<this.EH.length;i++)t=this.EH[i],t&&t.type===n&&r.push(t);return r},t.prototype.BS=function(t){for(var i="",r=0;r<t;r++)i=i+n.NumberHelper.ToString(Math.random()*90+10);return i},t.prototype.getUniqueName=function(n){var t=this.BS(4),i;do i=n+t,t=t+this.BS(4);while(this.Bw.containsKey(i));return i},t.prototype.enumNos=function(){for(var t,i=new Int32Array(this.EH.length),n=0;n<this.EH.length;n++)t=this.EH[n],i[n]=t?t.no:0;return i},t.prototype.Fx=function(){return n.SystemHelper.ToInt(this.GP++)},t.prototype.add=function(n){n&&(n.no<=0?n.no=this.Fx():this.GP=Math.max(n.no,this.GP),this.GI.add(n.no,n),this.Bw.add(n.name,n),this.EH.push(n),n.legendSet=this)},t.prototype.remove=function(n){var t=this.Bw.getValue(n),i;t&&(i=this.EH.indexOf(t),i>=0&&this.EH.splice(i,1),this.Bw.remove(n),this.GI.remove(t.no))},t.prototype.clear=function(){n.ArrayHelper.Clear(this.EH);this.Bw.clear();this.GI.clear()},t.prototype.rename=function(t,i){if(i=n.TString.Trim(i),!i)return!1;var r=this.Bw.getValue(t);return r?this.Bw.containsKey(i)?!1:(this.Bw.remove(t),this.Bw.add(i,r),r.name=i,!0):!1},t}();n.LegendSet=u;t=function(t){function i(){var i=t.call(this)||this;return i.type=0,i.Cc=new n.Color,i.FE(),i}return __extends(i,t),Object.defineProperty(i.prototype,"color",{get:function(){return this.Cc.clone()},set:function(n){this.Cc=n.clone();this.clearResource()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bounds",{get:function(){return new n.Rect(0,0,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"brush",{get:function(){return this.checkResource(),this._brush},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pen",{get:function(){return this.checkResource(),this._pen},enumerable:!1,configurable:!0}),i.prototype.FE=function(){this.color=n.Color.Black},i.prototype.checkResource=function(){},i.prototype.clearResource=function(){this._brush=null;this._pen=null},i.prototype.drawPoint=function(n,t,i){i===void 0&&(i=0)},i.prototype.drawPolyline=function(){},i.prototype.fillPolygon=function(){},i.prototype.drawSample=function(){},i.prototype.prepareSampleLine=function(t){var i=new Array(2),r=(t.left+t.right)*.5-1,u=(t.top+t.bottom)*.5-1,f=t.width;return i[0]=new n.Vector2(r-.40000000596046448*f,u),i[1]=new n.Vector2(r+.40000000596046448*f,u),i},i.prototype.prepareSampleRegion=function(t){var i=t.width*.4,r=t.height*.4,u=(t.left+t.right)*.5-1,f=(t.top+t.bottom)*.5-1;return new n.Rect(u-i,f-i,2*i,2*r)},i}(n.ImmutableNoObject);n.Legend=t;f=function(t){function r(){var n=t.call(this)||this;return n.Fk=1,n.type=i.NodeImageLegend,n}return __extends(r,t),Object.defineProperty(r.prototype,"bounds",{get:function(){var t=this.FX;return t?new n.Rect(-t.pixelWidth*.5*this.Fk,-t.pixelHeight*.5*this.Fk,t.pixelWidth*this.Fk,t.pixelHeight*this.Fk):new n.Rect},enumerable:!1,configurable:!0}),r.CreateFromBitmap=function(n){var t=new r;return t.FX=n,t},r.CreateFromUrl=function(n){var t=new r;return t.EQ(n),t},r.prototype.EQ=function(t){this.FX=n.WriteableBitmap.CreateFromUrl(t,null)},r.prototype.drawPoint=function(t,i,r){r===void 0&&(r=0);this.FX&&(this.Fk=1/n.CoordSystem2.PixelPerMm,this.FC(t,i,r))},r.prototype.FC=function(t,i,r){var u=this.FX;u&&t.drawImage(u,new n.Vector2(i.x-u.pixelWidth*.5,i.y-u.pixelHeight*.5),r)},r.prototype.drawSample=function(t,i){var r=new n.Vector2(i.x+i.width*.5,i.y+i.height*.5);this.FC(t,r,0)},r}(t);n.ImagePointLegend=f;e=function(t){function r(n,r){n===void 0&&(n=null);r===void 0&&(r=.5);var u=t.call(this)||this;return u.Ei=.5,u.type=i.LineSimpleLegend,n&&(u.color=n.clone(),u.width=r),u}return __extends(r,t),Object.defineProperty(r.prototype,"width",{get:function(){return this.Ei},set:function(n){this.Ei=n;this.clearResource()},enumerable:!1,configurable:!0}),r.prototype.checkResource=function(){if(!this._pen){var t=this.width*n.CoordSystem2.PixelPerMm;this._pen=new n.Pen2(this.color,t)}},r.prototype.drawPolyline=function(n,t){this.checkResource();this._pen&&t&&n.drawPolyline(t,this._pen)},r.prototype.drawSample=function(n,i){this.checkResource();var r=t.prototype.prepareSampleLine.call(this,i);n.drawPolyline(r,this._pen)},r}(t);n.SolidLineLegend=e;o=function(t){function r(n,r,u){n===void 0&&(n=null);r===void 0&&(r=null);u===void 0&&(u=.5);var f=t.call(this)||this;return f.Ei=.5,f.type=i.LineSystemLegend,f.patterns=n,r&&(f.color=r.clone()),f.width=u,f}return __extends(r,t),Object.defineProperty(r.prototype,"width",{get:function(){return this.Ei},set:function(n){this.Ei=n;this.clearResource()},enumerable:!1,configurable:!0}),r.prototype.checkResource=function(){if(!this._pen){var t=this.width*n.CoordSystem2.PixelPerMm;this._pen=new n.Pen2(this.color,t);this._pen.setDashPattern(this.patterns)}},r.prototype.drawPolyline=function(n,t){this.checkResource();this._pen&&t&&n.drawPolyline(t,this._pen)},r.ConvertPattern=function(n){var i=0,r,u,t;if(!n||n.length<=0)return null;if(n.length%2==0){for(r=new Float32Array(n.length),t=0;t<n.length;t++)r[t]=0;for(t=0;t<n.length;t=t+2)r[2*i]+=n[t],r[2*i+1]+=n[t+1],r[2*i]>0&&r[2*i+1]>0&&(i=i+1);for(t=0;t<i*2;t++)r[t]=r[t]*.01;for(u=new Float32Array(i*2),t=0;t<i*2;t++)u[t]=r[t];return u}return null},r.prototype.drawSample=function(n,i){this.checkResource();var r=t.prototype.prepareSampleLine.call(this,i);n.drawPolyline(r,this._pen)},r}(t);n.PatternLineLegend=o;s=function(t){function r(n,r,u){n===void 0&&(n=null);r===void 0&&(r=.5);u===void 0&&(u=!1);var f=t.call(this)||this;return f.Dg=0,f.Db=1,f.Gk=!1,f.type=i.NodeSimpleLegend,n&&(f.color=n.clone()),f.radius=r,f.isFill=u,f.EB(),f}return __extends(r,t),Object.defineProperty(r.prototype,"bounds",{get:function(){return new n.Rect(-this.radius,-this.radius,this.radius*2,this.radius*2)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"radius",{get:function(){return this.Db},set:function(n){this.Db=n;this.clearResource();this.EB()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isFill",{get:function(){return this.Gk},set:function(n){this.Gk=n;this.clearResource()},enumerable:!1,configurable:!0}),r.CreatePolygon=function(n,t,i,u){var f=new r;return f.color=n.clone(),f.radius=t,f.isFill=i,f.Dg=u,f.EB(),f},r.prototype.checkResource=function(){this._brush||this.isFill&&(this._brush=new n.SolidColorBrush(this.color));this._pen||(this._pen=new n.Pen2(this.color,1))},r.prototype.clearResource=function(){t.prototype.clearResource.call(this)},r.prototype.EB=function(){var i,r;if(this.Dg>=3){var t=[],u=6.2831853071795862/this.Dg,f=this.Db*2,e=0;for(e=this.Dg%2==1?-1.5707963267948966:-1.5707963267948966+u*.5,i=0;i<this.Dg;i++)r=e+u*i,t.push(new n.Vector2(f*Math.cos(r),f*Math.sin(r)));t.push(t[0]);this.FJ=t}},r.prototype.drawPoint=function(n,t,i){i===void 0&&(i=0);this.GN(n,t)},r.prototype.GN=function(t,i){this.checkResource();var r=n.CoordSystem2.PixelPerMm*this.radius;this.DV(t,i,r)},r.prototype.DV=function(t,i,r){var f,u;if(this.FJ){for(f=new Array(this.FJ.length),u=0;u<this.FJ.length;u++)f[u]=new n.Vector2(this.FJ[u].x+i.x,this.FJ[u].y+i.y);t.drawPolygon(f,this._pen,this._brush)}else t.drawEllipse(new n.Rect(i.x-r,i.y-r,r*2,r*2),this._pen,this._brush)},r.prototype.drawSample=function(t,i){var r=new n.Vector2(i.x+i.width*.5,i.y+i.height*.5);this.drawPoint(t,r,0)},r}(t);n.SolidPointLegend=s;h=function(n){function t(){var t=n.call(this)||this;return t.lineLegends=[],t.type=i.LineAdvanceLegend,t}return __extends(t,n),t.prototype.drawPolyline=function(n,t){for(var r,i=0;i<this.lineLegends.length;i++)r=this.lineLegends[i],r&&r.drawPolyline(n,t)},t.prototype.exchangeSubLegend=function(n,t){if(t>=0&&t<this.lineLegends.length&&n>=0&&n<this.lineLegends.length){var i=this.lineLegends[n],r=this.lineLegends[t];this.lineLegends[n]=r;this.lineLegends[t]=i}},t.prototype.drawSample=function(n,t){for(var r,i=0;i<this.lineLegends.length;i++)r=this.lineLegends[i],r&&r.drawSample(n,t)},t}(t);n.CompoundLineLegend=h;c=function(t){function r(n){var r=t.call(this)||this;return r.type=i.PolySimpleLegend,r.color=n.clone(),r}return __extends(r,t),r.prototype.checkResource=function(){this._brush||(this._brush=new n.SolidColorBrush(this.color))},r.prototype.fillPolygon=function(n,t){this.checkResource();this._brush&&t&&n.drawPolygon(t,null,this._brush)},r.prototype.drawSample=function(n,i){this.checkResource();n.drawRectangle(t.prototype.prepareSampleRegion.call(this,i),null,this._brush)},r}(t);n.SolidPolyLegend=c;l=function(n){function t(t,i,u){t===void 0&&(t=null);i===void 0&&(i=r.Repeat);u===void 0&&(u=0);var f=n.call(this)||this;return f.style=r.Repeat,f.distance=0,f.fillLegend=t,f.style=i,f.distance=u,f}return __extends(t,n),t}(t);n.PointFillLineLegend=l}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){function p(n){window.requestAnimationFrame?window.requestAnimationFrame(n):window.setTimeout(n,16)}var h=function(t){function i(i,r,u){var f=t.call(this)||this;return f.dirtyRange=new n.Rect,f.maxScale=0,f.minScale=0,f.dirtyRange=i.clone(),f.maxScale=r,f.minScale=u,f}return __extends(i,t),i}(n.EventArgs),u,i,e;n.MapDataDirtyEventArgs=h,function(n){n[n.None=0]="None";n[n.Pan=1]="Pan";n[n.TrackPoint=10]="TrackPoint";n[n.TrackLine=20]="TrackLine";n[n.TrackPoly=30]="TrackPoly";n[n.TrackRect=40]="TrackRect";n[n.TrackEllipse=50]="TrackEllipse";n[n.TrackCircle=51]="TrackCircle";n[n.MeasureLength=120]="MeasureLength";n[n.MeasureArea=130]="MeasureArea";n[n.PointPick=210]="PointPick"}(u=n.MapToolType||(n.MapToolType={}));i=function(t){function i(){var i=t!==null&&t.apply(this,arguments)||this;return i.objectAlphaRatio=1,i.minScale=0,i.maxScale=1e9,i.isGeoLayerLoadedReady=!1,i.layers=new n.Layer2Collection,i.Bt=new n.Rect(0,0,0,0),i.onMapDataDirty=new n.Observable,i}return __extends(i,t),i.prototype.getBounds=function(){return this.calcBounds()},i.prototype.calcBounds=function(){var t=this.layers.calcBounds();return this.Bt=n.Rect.Empty,t.isEmpty||(this.Bt=t.clone()),this.Bt.clone()},i.prototype.isLayerEmpty=function(){for(var t,n=0;n<this.layers.length;n++)if(t=this.layers.getAt(n),t&&t.isVisible&&!t.isEmpty)return!1;return!0},i.prototype.close=function(){return this.layers.clear(),!0},i.prototype.isReady=function(){return this.isGeoLayerLoadedReady||this.layers.length>0},i}(n.NameObject);n.Map=i;var f=function(){function t(t,i){var r=this;this.Hf=!1;this.HI=!1;this.Fq=new n.CycleTimer(500);this.IO=new n.CycleTimer(3e3);this.Hv=0;this.Ib=n.Rect.Empty;this.Fy=0;this.Hy=0;this.Gw=new n.CycleTimer(2e3);this.isCoordVisible=!0;this.isDegreeFormat=!1;this.Fe=t;this.GS=t.map;this.GX=i;this.FG=new c(this.GS,i.coordSystem);this.GS&&this.GS.onMapDataDirty.add(function(n){r.onDataDirtyEvent(n)})}return t.prototype.getRenderContext=function(){return this.GX},t.prototype.redraw=function(){this.Hv=this.GX.coordSystem.scale;this.Hf=!0},t.prototype.oneDrawingStep=function(){var t=this.IB(),n;return(this.IM(),n=t||this.Hf||this.HI&&this.Fq.isWorkTime()||this.IO.isWorkTime(),n)?(this.Hx(),!0):!1},t.prototype.IM=function(){this.FG.collectGabage();this.HI=this.FG.renderBkBlocks(this.GX)||this.HI;var n=this.GS.layers.prepareData(this.GX);n&&this.redraw()},t.prototype.Hx=function(){this.GX.begineCanvasDraw(!0,n.Color.White);this.GS.layers.markAnnoOverlap(this.GX);var t=this.GX.coordSystem.isUseLevelZoom;t?(this.FG.prepareBlocksForDrawing(this.GX),this.GS.layers.drawImage(this.GX),this.FG.drawContents(this.GX),this.GS.layers.draw(this.GX,!1)):(this.GS.layers.drawImage(this.GX),this.GS.layers.draw(this.GX,!0),this.GS.layers.draw(this.GX,!1));this.GS.layers.drawAnno(this.GX);this.GS.layers.drawDynamicAnno(this.GX);this.Hf=!1;this.HI=!1},t.prototype.markBkSurfaceDirtyByLevel=function(n,t,i){this.FG.markDirtyByLevel(n,t,i)},t.prototype.clearBkSurface=function(){this.FG.clear()},t.prototype.IB=function(){return this.Ib.isEmpty?!1:this.Gw.isWorkTime()?(this.markBkSurfaceDirtyByLevel(this.Ib,this.Fy,this.Hy),this.Ib=n.Rect.Empty,!0):!1},t.prototype.onDataDirtyEvent=function(t){if(t.maxScale>=this.Hv)if(this.GX.coordSystem.isUseLevelZoom){var i=n.CoordSystem2.ScaleToLevel(t.maxScale),r=n.CoordSystem2.ScaleToLevel(t.minScale);this.Ib.isEmpty?(this.Ib=t.dirtyRange.clone(),this.Fy=i,this.Hy=r):(this.Ib.unionInPlace(t.dirtyRange),i>this.Fy&&(this.Fy=i),r<this.Hy&&(this.Hy=r))}else this.redraw()},t.prototype.getMouseCoordString=function(t){var r,i;if(!this.isCoordVisible)return"";if(r=n.SystemHelper.ToInt(this.GX.coordSystem.scale),this.Fe.isSimpleCoord)i=t.x.toFixed(8)+","+t.y.toFixed(8);else{if(this.GX.coordSystem.isEarthCoord)if(this.isDegreeFormat){var u=n.MathHelper.DegreeFromDegree(t.x),f=Math.abs(n.MathHelper.MinuteFromDegree(t.x)),e=Math.abs(n.MathHelper.FloatSecondFromDegree(t.x)),o=n.MathHelper.DegreeFromDegree(t.y),s=Math.abs(n.MathHelper.MinuteFromDegree(t.y)),h=Math.abs(n.MathHelper.FloatSecondFromDegree(t.y));i="X "+u+"."+n.TString.FormatNumber(f,2)+"'"+n.TString.FormatNumber(e,2,3)+'"   Y '+o+"."+n.TString.FormatNumber(s,2)+"'"+n.TString.FormatNumber(h,2,3)+'"'}else i="X "+t.x.toFixed(8)+"   Y "+t.y.toFixed(8);else i="X "+t.x.toFixed(3)+"   Y "+t.y.toFixed(3);i="  "+i+"   比例尺 "+r}return i},t}(),t=function(){function t(t,i,r,u){this.bkBlockHandle=0;this.isImageDirty=!0;this.isDrawSomething=!1;this.level=0;this.x=0;this.y=0;this.bounds=new n.Rect;this.subNodes=new Array(4);for(var f=0;f<this.subNodes.length;++f)this.subNodes[f]=null;this.level=i;this.x=r;this.y=u;this.CU=t;this.bounds=t.calcBlockRange(i,r,u)}return t.prototype.bindingImageData=function(n){this.imageBlock=n.getImageBlock(this.bkBlockHandle)},t.prototype.prepareSubNodes=function(){if(!this.subNodes[0]){var n=this.level-1,i=this.x*2,r=this.y*2;this.subNodes[0]=new t(this.CU,n,i,r);this.subNodes[1]=new t(this.CU,n,i+1,r);this.subNodes[2]=new t(this.CU,n,i,r+1);this.subNodes[3]=new t(this.CU,n,i+1,r+1)}},t.prototype.markImageDirty=function(n){this.bounds=this.CU.calcBlockRange(this.level,this.x,this.y);this.isImageDirty=!0;n&&(this.imageBlock=null)},t}(),c=function(){function i(r,u){this.CV=[];this.IN=[];this.Er=[];this.Ii=new n.Rect;this.HL=0;this.GM=new v;this.Fm=new a;this.GS=r;var f=i.Hq;this.CV.push(new t(u,f,-1,-1));this.CV.push(new t(u,f,-1,0));this.CV.push(new t(u,f,0,0));this.CV.push(new t(u,f,0,-1))}return i.prototype.renderBkBlocks=function(n){var t,i;if(this.IN.length<=0)return!1;for(t=!1;this.IN.length>0;)if(i=this.IN[0],this.Hj(n,i),i.isDrawSomething&&(t=!0),this.IN.splice(0,1),t)break;return t},i.prototype.Hj=function(t,i){var r,u;return i?(r=this.Fm.getImageBlock(i.bkBlockHandle),r||(r=this.Fm.allocImageBlock(),r&&(i.bkBlockHandle=r.handle)),r&&(u=new n.RefValue,this.GM.renderOneBlock(t,this.GS,i,r,u),i.isDrawSomething=u.value,i.isImageDirty=!1),!!r):!1},i.prototype.FU=function(){n.ArrayHelper.Clear(this.IN);n.ArrayHelper.Clear(this.Er)},i.prototype.prepareBlocksForDrawing=function(t){var r,u;if(this.FU(),n.ArrayHelper.Clear(this.Er),this.Ii=t.coordSystem.windowRect.clone(),this.HL=t.coordSystem.level,this.HL>=i.HU)for(r=0;r<this.CV.length;r++)u=this.CV[r],this.IZ(u)},i.prototype.IZ=function(t){var r,u;if(t.level===this.HL&&(t.bindingImageData(this.Fm),t.imageBlock&&this.Er.push(t),(!t.imageBlock||t.isImageDirty)&&this.IN.length<i.Ct&&this.IN.push(t)),t.level>this.HL)for(t.prepareSubNodes(),r=0;r<t.subNodes.length;r++)u=t.subNodes[r],u&&n.Math2.RectIntersects(u.bounds,this.Ii)&&this.IZ(u)},i.prototype.clear=function(){for(var t,n=0;n<this.CV.length;n++)t=this.CV[n],this.Gi(t,null,20,0,!0)},i.prototype.markDirtyByLevel=function(t,i,r){var u,f;if(i>=19)this.clear();else for(u=0;u<this.CV.length;u++)f=this.CV[u],this.Gi(f,new n.NullableValue(t),i,r,!0)},i.prototype.Gi=function(t,i,r,u,f){var e,o;if(t.level<=r&&t.markImageDirty(f),t.level>u)for(e=0;e<t.subNodes.length;e++)o=t.subNodes[e],o&&(!i||n.Math2.RectIntersects(o.bounds,i.value))&&this.Gi(o,i,r,u,f)},i.prototype.collectGabage=function(){this.Fm.collectGabage()},i.prototype.isAllBlockReady=function(){return this.IN.length<=0},i.prototype.drawContents=function(t){var s=t.coordSystem.windowRect.clone(),r,i,u,o,f;if(s.width<=0)return!1;var h=t.coordSystem,c=t.graphics,e=new n.Dictionary;for(r=0;r<this.Er.length;r++)i=this.Er[r],i.isDrawSomething&&(e.containsKey(i.bkBlockHandle)||(e.add(i.bkBlockHandle,1),u=i.imageBlock,u&&u.bitmap&&(o=t.coordSystem.calcBlockPixelCenter(i.level,i.x,i.y),f=h.mapToScreen(o),c.drawImage(u.bitmap,new n.Vector2(f.x-128,f.y-128),0))));return!0},i.Ct=32,i.Hq=20,i.HU=-8,i}(),l=function(){function t(n){this.handle=0;this.handle=n}return Object.defineProperty(t.prototype,"bitmap",{get:function(){return this.Gb},set:function(t){this.Gb||(this.Gb=new n.WriteableBitmap(256,256));t&&t.copyTo(this.Gb)},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.Gb=null},t.BLOCK_SIZE=256,t}(),a=function(){function t(){this.Gy=1;this.IW=new n.ObjectCache(this,0);this.IW.capacity=t.Gx}return t.prototype.getImageBlock=function(n){return this.IW.accessObject(n,!1)},t.prototype.allocImageBlock=function(){return this.Gy=this.Gy+1,this.IW.accessObject(this.Gy,!0)},t.prototype.collectGabage=function(){this.IW.collectGabage()},t.prototype.clear=function(){this.IW.clear()},t.prototype.loadObject=function(){return new l(this.Gy)},t.prototype.releaseObject=function(n,t){t&&t.dispose()},t.Gx=256,t}(),v=function(){function t(){this.GY()}return t.prototype.GY=function(){this.Hh||(this.Hh=new n.WriteableBitmap(256,256),this.GX=new n.RenderContext2(new n.CanvasGraphics(this.Hh.canvas)))},t.prototype.HH=function(){this.Hh.clear()},t.prototype.renderOneBlock=function(t,i,r,u,f){var o,e,s,h;return(f.value=!1,!this.GX)?!1:u?(this.HH(),o=this.GX.renderType,this.GX.renderType=n.RenderingType.BlockBuffer,e=this.GX.coordSystem,e.isEarthCoord=t.coordSystem.isEarthCoord,s=t.coordSystem,h=s.calcBlockPixelCenter(r.level,r.x,r.y),e.viewportRect=new n.Rect(0,0,256,256),e.zoomToLevel(h,r.level),this.GX.begineCanvasDraw(!1),i.layers.draw(this.GX,!0),f.value=this.GX.hasDrawSomething(),this.GX.renderType=o,f.value&&(u.bitmap=this.Hh),!0):!1},t}(),y=function(){function t(n){this.isPolyVisible=!0;this.GS=n}return Object.defineProperty(t.prototype,"map",{get:function(){return this.GS},enumerable:!1,configurable:!0}),t.prototype.drawToBitmap=function(n,t,i,r,u){return this.Gs(n,t,i,!1,r,u)},t.prototype.hasSomethingDrawToBitmap=function(n,t){var i=this.GS.calcBounds();return i.intersectInPlace(t),!i.isEmpty&&this.IY(t)},t.prototype.IY=function(n){for(var i,t=0;t<this.GS.layers.length;t++)if(i=this.GS.layers.getAt(t),i.hasSomethingToDrawInRect(n))return!0;return!1},t.prototype.Gs=function(t,i,r,u,f,e){if(!t)return!1;var s=new n.CanvasGraphics(t.canvas),o=new n.RenderContext2(s),h=new n.Rect(0,0,t.pixelWidth,t.pixelHeight);return o.coordSystem.isUseProjection=!1,o.coordSystem.isUseLevelZoom=!1,o.renderType=n.RenderingType.BlockBuffer,o.isCheckDrawingPass=u,o.isDrawDynAnno=r,o.clearDrawSomething(),o.coordSystem.zoomToFitViewport(i,h),this.IV(o,u,f,e),o.hasDrawSomething()},t.prototype.IV=function(n,t,i){n.begineCanvasDraw(!0);i&&(this.FO(),this.GS.layers.drawImage(n),this.GS.layers.draw(n,!0),this.GS.layers.draw(n,!1));i&&(t||this.GS.layers.drawDynamicAnno(n))},t.prototype.FO=function(){},t}();n.GeoMapRender=y;e=function(t){function r(i,r){i===void 0&&(i=null);r===void 0&&(r=null);var u=t.call(this,i,r)||this;return u.onOpenFinish=new n.Observable,u.onTrackFinish=new n.Observable,u.onRedrawScreenFinish=new n.Observable,u.onPickObject=new n.Observable,u.isDrawDebugInfo=!1,u.isSimpleCoord=!1,u.HX=new n.Vector2,u.HM=new n.Vector2,u.Hl=0,u.GE=0,u.Hm=50,u.HB=50,u.Dw=!0,u.CN=!1,u.IR=!1,u.focusNodeLegend=new n.SolidPointLegend(n.Color.FromIntRgba(255,0,0,64),3,!0),u.focusLineLegend=new n.SolidLineLegend(n.Color.FromIntRgba(255,0,0,64),2),u.focusPolyLegend=new n.SolidPolyLegend(n.Color.FromIntRgba(255,0,0,64)),u.Gv=new n.HashSet,u.ID=new n._MessageQueue,u.initializeComponent(),u.HP(u.HV),u.ID.attachUI(u,u.htmlUI),u.HQ=new s(u),u}return __extends(r,t),Object.defineProperty(r.prototype,"mapCanvas",{get:function(){return this.HV},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"trackerGraphics",{get:function(){return this.HN},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"screenOverlayGraphics",{get:function(){return this.Go},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layoutRoot",{get:function(){return this.IU},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"map",{get:function(){return this.GS},set:function(n){n&&(this.GS=n,this.Ex=new f(this,this.GX))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"coordSystem",{get:function(){return this.Ie},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"renderContext",{get:function(){return this.GX},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isEarthCoord",{get:function(){return this.Dw},set:function(n){this.Dw=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layers",{get:function(){return this.GS.layers},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"operDevice",{get:function(){return this.IJ},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"mousePosition",{get:function(){return this.HX.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"mouseScreenPosition",{get:function(){return this.HM.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isMouseCoordVisible",{get:function(){return this.Ex.isCoordVisible},set:function(t){this.Ex.isCoordVisible=t;this.Ex.isCoordVisible?(this.Hp.visibility=n.Visibility.Visible,this.Hz.visibility=n.Visibility.Visible):(this.Hp.visibility=n.Visibility.Collapsed,this.Hz.visibility=n.Visibility.Collapsed)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"mouseCoordPosition",{get:function(){return this.Hp.horizontalAlignment},set:function(n){this.Hp.horizontalAlignment=n;this.Hz.horizontalAlignment=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxLevel",{get:function(){return n.CoordSystem2._LevelToScale(this.coordSystem._minScale)},set:function(t){this.coordSystem._minScale=n.CoordSystem2._LevelToScale(t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minLevel",{get:function(){return n.CoordSystem2._LevelToScale(this.coordSystem._maxScale)},set:function(t){this.coordSystem._maxScale=n.CoordSystem2._LevelToScale(t)},enumerable:!1,configurable:!0}),r.prototype.handleMessage=function(){var t=this.ID.getNextMessage();t&&(t.isKeyDown?this.IF(t.keyCode):(t.point=this.renderContext.coordSystem.screenToMap(t.point),n.OperMouseMsgType.MouseWheel===t.mouseMsg?t.mouseParam>0?this.zoomIn():t.mouseParam<0&&this.zoomOut():n.OperMouseMsgType.MouseMove===t.mouseMsg&&(this.HX=new n.Vector2(t.point.x,t.point.y),this.HM=new n.Vector2(t.pointDevice.x,t.pointDevice.y),this.setMouseCoordString(this.HX))),this.IX.handleMessage(t))},r.prototype.IF=function(n){if(n<=47)switch(n){case 23:this.moveLeft();break;case 24:this.moveUp();break;case 25:this.moveRight();break;case 26:this.moveDown();break;default:n===47&&(this.isDrawDebugInfo=!this.isDrawDebugInfo)}else if(n!==61)if(n!==66)switch(n){case 85:this.zoomIn();break;case 87:this.zoomOut()}else this.whole();else this.redraw(!0)},r.prototype.raiseRedrawScreenCompleteEvent=function(){this.IX.onDraw();this.Hc();n.SystemHelper.FireEvent(this.onRedrawScreenFinish,new n.EventArgs)},r.prototype.raiseTrackerCompleteEvent=function(t,i){t&&n.SystemHelper.FireEvent(this.onTrackFinish,new n.GeoObjectPickEventArgs(t,i))},r.prototype.raiseObjectClickedEvent=function(t){n.SystemHelper.FireEvent(this.onPickObject,new n.GeoObjectPickEventArgs(t,null))},r.prototype.raiseMapOpenFinishEvent=function(){},r.prototype.Hn=function(t){var i=n.WindowsHelper.IsDoubleClick(t);i&&(this.Ex.isDegreeFormat=!this.Ex.isDegreeFormat)},r.prototype.setMouseCoordString=function(n){n||(n=this.IS);n?(this.Hp.text=this.Ex.getMouseCoordString(n),this.IS=n):this.Hp.text=""},r.prototype.HP=function(t){this.GS=new i;this.GX=new n.RenderContext2(new n.CanvasGraphics(t.htmlCanvas));this.Ie=this.GX.coordSystem;this.Ie.isUseProjection=!0;this.HN=new n.CanvasGraphics(this.Fa.htmlCanvas);this.Go=new n.CanvasGraphics(this.Cz.htmlCanvas);this.Ex=new f(this,this.GX);this.isTabStop=!0;this.IJ=new n.OperDevice(this);this.IX=new n.OperationManager(this);this.setCurrentTool(u.Pan,null)},r.prototype.oneDrawingStep=function(){this.visibility!==n.Visibility.Collapsed&&(this.Hb(),this.GS.isReady()&&(this.GR(),this.handleMessage(),this.HK(),this.Ex.oneDrawingStep()&&(this.setMouseCoordString(null),this.raiseRedrawScreenCompleteEvent(),this.HV.invalidateArrange())))},r.prototype.GR=function(){if(this.isEarthCoord){var n=this.GS.layers.calcCoordType();this.GX.coordSystem.isEarthCoord=n===1?!1:!0}else this.GX.coordSystem.isEarthCoord=!1},r.prototype.IH=function(){},r.prototype.Hb=function(){(this.HV.actualWidth!==this.Hl||this.HV.actualHeight!==this.GE)&&(this.Hl=this.HV.actualWidth,this.GE=this.HV.actualHeight,this.IH(this.HV,new n.Rect(0,0,this.Hl,this.GE)),this.IH(this.Fa,new n.Rect(0,0,this.Hl,this.GE)),this.IH(this.Cz,new n.Rect(0,0,this.Hl,this.GE)),this.Ie.viewportRect=new n.Rect(0,0,this.Hl,this.GE),this.Ie.level>0&&(this.Ie.zoomToLevel(this.Ie.center,this.Ie.level),this.Ie.applyTransform()),this.redraw(!1))},r.prototype.initializeComponent=function(){var o=this,u=new n.Grid(null,this),r,f,e,t,i;u.name="gridLayoutRoot";u.background="#ffffffff";u.horizontalAlignment=n.HorizontalAlignment.Stretch;u.verticalAlignment=n.VerticalAlignment.Stretch;this.IU=u;this.IU.onMouseLeftButtonDown.add(function(n){o.GL(n)});r=new n.Canvas(null,this.IU);r.name="canvasMap";r.background="#ffffffff";r.margin=new n.Thickness(0,0,0,0);r.isHitTestVisible=!1;this.HV=r;f=new n.Canvas(null,this.IU);f.name="canvasTracker";f.isHitTestVisible=!1;this.Fa=f;e=new n.Canvas(null,this.IU);e.name="canvasScreenOverlay";e.isHitTestVisible=!1;this.Cz=e;t=new n.RectangleElement(null,this.IU);t.name="rectMousePosition";t.height=18;t.horizontalAlignment=n.HorizontalAlignment.Left;t.margin=new n.Thickness(0,0,0,0);t.verticalAlignment=n.VerticalAlignment.Bottom;t.width=350;t.fill="#3cffffff";t.stroke="#00ffffff";t.isHitTestVisible=!1;t.background="#55000000";t.horizontalAlignment=n.HorizontalAlignment.Stretch;this.Hz=t;i=new n.TextBlock(null,this.IU);i.name="labelMousePosition";i.text="";i.height=18;i.horizontalAlignment=n.HorizontalAlignment.Left;i.margin=new n.Thickness(4,0,4,0);i.verticalAlignment=n.VerticalAlignment.Bottom;i.width=350;i.foreground="#ffffffff";i.isHitTestVisible=!1;this.Hp=i;this.Hp.onMouseLeftButtonDown.add(function(n){o.Hn(n)});this.IU.updateLayout()},r.prototype.setForceNotRedraw=function(n){this.CN=n},r.prototype.getCurrentOperation=function(){return this.IX.sonOper},r.prototype.setCurrentOperation=function(n,t,i){this.IX.setCurrentOperation(n,t,i)},r.prototype.setCurrentTool=function(n,t){t===void 0&&(t=null);this.IX.setCurrentTool(n,t)},r.prototype.isCurrentTool=function(n){return this.IX.isCurrentTool(n)},r.prototype.redraw=function(n){n===void 0&&(n=!0);n&&this.Ex.clearBkSurface();this.Ex.redraw()},r.prototype.whole=function(){this.IR=!0;this.redraw(!1)},r.prototype.zoomIn=function(){this.Dt();this.Ie.zoomIn(this.Ie.center);this.redraw(!1)},r.prototype.zoomOut=function(){this.Dt();this.Ie.zoomOut(this.Ie.center);this.redraw(!1)},r.prototype.zoomToLevel=function(n,t){this.Dt();this.Ie.zoomToLevel(n,t);this.redraw(!1)},r.prototype.zoomToScale=function(n,t){this.Dt();this.Ie.zoomToScale(n,t);this.redraw(!1)},r.prototype.zoomToRect=function(n){this.Dt();this.Ie.zoomToRect(n);this.redraw(!1)},r.prototype.moveUp=function(){var n=this.HB;this.Ie.move(0,this.Ie.screenToMapLength(n));this.redraw(!1)},r.prototype.moveDown=function(){var n=-this.HB;this.Ie.move(0,this.Ie.screenToMapLength(n));this.redraw(!1)},r.prototype.moveLeft=function(){var n=-this.Hm;this.Ie.move(this.Ie.screenToMapLength(n),0);this.redraw(!1)},r.prototype.moveRight=function(){var n=this.HB;this.Ie.move(this.Ie.screenToMapLength(n),0);this.redraw(!1)},r.prototype.Dt=function(){this.IR=!1},r.prototype.HK=function(){this.IR&&(this.Ie.worldRect=this.GS.calcBounds(),this.Ie.worldRect.width>0&&this.Ie.viewportRect.width>0&&(this.Ie.whole(),this.IR=!1,this.redraw(!1)))},r.prototype.addPickedObjects=function(n){for(var i,t=0;t<n.length;t++)i=n[t],this.Gv.add(i);this.Hc()},r.prototype.clearPickedObjects=function(){this.Gv.clear();this.Hc()},r.prototype.Hc=function(){this.screenOverlayGraphics.clear();this.DE()},r.prototype.DE=function(){var i=this.screenOverlayGraphics,u=this.Gv.getEnumerator(),t,r;try{while(u.moveNext())t=u.current,r=this.GX.coordSystem.mapToScreenPoints(t.points),t.geoType===n.GeoType.Point&&this.focusNodeLegend?this.focusNodeLegend.drawPoint(i,r[0],0):t.geoType===n.GeoType.LineString&&this.focusLineLegend?this.focusLineLegend.drawPolyline(i,r):this.focusPolyLegend&&(t.geoType===n.GeoType.Ellipse?i.drawEllipse(this.GX.coordSystem.mapToScreenRect(t.bounds),null,this.focusPolyLegend.brush):this.focusPolyLegend.fillPolygon(i,r))}finally{u.dispose()}},r.prototype.clearTrackerResult=function(){this.HN.clear()},r.prototype.getTopMostUI=function(){return this.Cz},r.prototype.GL=function(){t.prototype.focus.call(this)},r}(n.UserControl);n.MapViewer=e;var r=[],o=!1,s=function(){function t(t){this.Fe=t;r.push(t);o||(this.startThread(),o=!0);n._SPP.V()}return t.prototype.startThread=function(){var t=this;p(function(){var i,u;for(n.SystemTime._UpdateFrameMs(),i=0;i<r.length;i++)u=r[i],u.oneDrawingStep();t.startThread()})},t}();n.MapViewerThreadingManager=s}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t,p,r,e,s,w,i,h,u,c,l,f,a,o,v,y;(function(n){n[n.None=0]="None";n[n.Point=10]="Point";n[n.Rect=20]="Rect";n[n.Ellipse=30]="Ellipse";n[n.Circle=31]="Circle";n[n.Polyline=40]="Polyline";n[n.Polygon=50]="Polygon"})(t=n.TrackType||(n.TrackType={}));p=function(){function t(n){this.HR=!1;this.Fe=n;this.Ie=this.Fe.renderContext.coordSystem;this.Gh=this.Fe.trackerGraphics}return Object.defineProperty(t.prototype,"mapViewer",{get:function(){return this.Fe},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphics",{get:function(){return this.Gh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"coordSystem",{get:function(){return this.Ie},enumerable:!1,configurable:!0}),t.prototype.setCapture=function(){},t.prototype.releaseCapture=function(){},t.prototype.getWindowRect=function(){var t=this.Ie.windowRect.clone();return new n.Rect(t.x,t.y,t.width,t.height)},t.prototype.clear=function(){this.Gh.clear()},t.prototype.updateScreen=function(){},t.prototype.redraw=function(){this.Fe.redraw(!1)},t.prototype.getTrackerPen=function(){return this.Ht||(this.Ht=new n.Pen2(n.Color.Red,.5)),this.Ht},t.prototype.getTrackerBrush=function(){return this.Es||(this.Es=new n.SolidColorBrush(n.Color.FromIntRgba(255,255,0,128))),this.Es},t.prototype.setProcessTag=function(n){this.HR=n},t.prototype.isProcessed=function(){return this.HR},t}();n.OperDevice=p;r=function(n){function t(t,i){i===void 0&&(i=null);var r=n.call(this)||this;return r._operDevice=t,r.fatherOper=i,r}return __extends(t,n),Object.defineProperty(t.prototype,"operDevice",{get:function(){return this._operDevice},enumerable:!1,configurable:!0}),t.prototype.cancelTask=function(){n.prototype.cancelTask.call(this);this.DK()},t.prototype.failTask=function(){n.prototype.failTask.call(this);this.DK()},t.prototype.DK=function(){this._operDevice&&(this._operDevice.clear(),this._operDevice.updateScreen())},t}(n.OperationBase);n.MapViewerOperation=r;e=function(n){function t(t){var i=n.call(this,t)||this,r;return i.isZoomIn=!1,i.isZoomIn=!0,r=new u(t),i.sonOper=r,i}return __extends(t,n),t.prototype.onSonOperCompleteTask=function(){if(this._operDevice){var n=this.sonOper.bounds.clone();this._operDevice.coordSystem.zoomToRect(n);this._operDevice.redraw()}},t.prototype.onSonOperFailTask=function(){if(this._operDevice){var n=this.sonOper.bounds.clone();this._operDevice.coordSystem.zoomToRect(n);this._operDevice.redraw()}},t}(r);n.RectZoomOperation=e;s=function(t){function i(i){var r=t.call(this,i)||this;return r.He=new n.Vector2,r.GJ=new n.Vector2,r.DI=0,r}return __extends(i,t),i.prototype.onLeftButtonDown=function(n){return(this._operDevice.setProcessTag(!0),this.startTask(),!this.isTaskStarted)?!1:(this.He=n.pointDevice.clone(),this.GJ=this._operDevice.coordSystem.center,this.DI=this._operDevice.coordSystem.scale,this._operDevice.setCapture(),this.onDraw(),!0)},i.prototype.onLeftButtonUp=function(){return this.isTaskStarted?(this._operDevice.setProcessTag(!0),this._operDevice.releaseCapture(),this.completeTask(),!0):!1},i.prototype.onMouseMove=function(t){var i;if(!this.isTaskStarted||(i=t.pointDevice.clone(),Math.abs(i.x-this.He.x)<5&&Math.abs(i.y-this.He.y)<5))return!1;this._operDevice.setProcessTag(!0);var r=new n.Vector2,u=i.x-this.He.x,f=i.y-this.He.y;return u=this._operDevice.coordSystem.screenToMapLength(u),f=this._operDevice.coordSystem.screenToMapLength(f),r.x=this.GJ.x-u,r.y=this.GJ.y+f,this._operDevice.coordSystem.zoomToScale(r,this.DI),this._operDevice.redraw(),!0},i}(r);n.PanOperation=s;w=function(t){function r(n){var i=t.call(this,n.operDevice)||this;return i.Fe=n,i.HC=new e(i._operDevice),i.IG=new e(i._operDevice),i.IG.isZoomIn=!1,i.Hk=new s(i._operDevice),i.HW=new h(i._operDevice),i.HD=new f(i._operDevice),i.Hs=new o(i._operDevice),i.Fp=new u(i._operDevice),i.Ic=new l(i._operDevice),i.IA=new c(i._operDevice),i.Gn=new a(i._operDevice),i.IP=new v(i._operDevice),i.Fo=new y(i.Fe),i}return __extends(r,t),r.prototype.handleMessage=function(n){return t.prototype.handleMessage.call(this,n),this.sonOper!==this.Hk&&this.Hk.handleMessage(n),!0},r.prototype.onSonOperCompleteTask=function(){var r,u;this._operDevice.clear();this.sonOper instanceof i&&(r=n.SystemHelper.CastObject(this.sonOper),r&&(u=r.createGeoObject(),this._operDevice.mapViewer.raiseTrackerCompleteEvent(u,r.callerInfo)));t.prototype.onSonOperCompleteTask.call(this)},r.prototype.onSonOperFailTask=function(){this._operDevice.clear();t.prototype.onSonOperFailTask.call(this)},r.prototype.onSonOperCancelTask=function(){this._operDevice.clear();t.prototype.onSonOperCancelTask.call(this)},r.prototype.setCurrentOperation=function(t,i,r){this.sonOper=t;this.resetTask();this.Fe.cursor=t===this.Hk?n.Cursor.Hand:n.Cursor.Arrow;this._operDevice.clear();this._operDevice.updateScreen();i&&i.isCacheDrawingMode!==r&&(i.isCacheDrawingMode=r,this.Fe.redraw(!0))},r.prototype.HJ=function(t){if(t<=n.MapToolType.TrackPoly)if(t<=n.MapToolType.TrackPoint)switch(t){case n.MapToolType.None:return null;case n.MapToolType.Pan:return this.Hk;default:if(t===n.MapToolType.TrackPoint)return this.HW}else if(t!==n.MapToolType.TrackLine){if(t===n.MapToolType.TrackPoly)return this.Hs}else return this.HD;if(t<=n.MapToolType.TrackCircle)if(t!==n.MapToolType.TrackRect)switch(t){case n.MapToolType.TrackEllipse:return this.IA;case n.MapToolType.TrackCircle:return this.Ic}else return this.Fp;if(t!==n.MapToolType.MeasureLength)if(t!==n.MapToolType.MeasureArea){if(t===n.MapToolType.PointPick)return this.Fo}else return this.IP;return this.Gn},r.prototype.setCurrentTool=function(n,t){t===void 0&&(t=null);var i=this.HJ(n);i&&(i.callerInfo=t);this.setCurrentOperation(i,null,!1)},r.prototype.isCurrentTool=function(n){var t=this.HJ(n);return this.sonOper===t},r}(r);n.OperationManager=w;i=function(t){function i(r){var u=t.call(this,r)||this;return u.lastPt=new n.Vector2,u.bounds=new n.Rect,u.isFill=!1,u.isDblclk=!1,u.lengthScale=0,u._type=0,u._selBrush=new n.SolidColorBrush(n.Color.FromIntRgba(255,255,0,128)),u._selPen=new n.Pen2(n.Color.FromIntRgba(255,0,0,128),5),i.If=n.Color.FromIntRgba(255,0,0,128),u.isDblclk=!1,u._pen=u._operDevice.getTrackerPen(),u._brush=u._operDevice.getTrackerBrush(),u.bounds=new n.Rect,u.lengthScale=100,u}return __extends(i,t),i.prototype.getTrackerType=function(){return this._type},i.prototype.adjustDeviceGridCoord=function(n){return n.clone()},i.prototype.calcRectOnDevice=function(t,i,r){var u=this._operDevice.coordSystem.mapToScreen(t),f=new n.Rect(u.x-i*.5,u.y-r*.5,i,r);return f.clone()},i.prototype.createGeoObject=function(){return null},i.If=new n.Color,i}(r);n.Tracker=i;h=function(i){function r(n){var r=i.call(this,n)||this;return r._type=t.Point,r}return __extends(r,i),r.prototype.onLeftButtonDblClk=function(n){return this.isDblclk=!0,this._operDevice.setProcessTag(!0),this.startTask(),this.lastPt=n.point.clone(),this.completeTask(),!0},r.prototype.createGeoObject=function(){return n.GeoObject.CreateFromPoint(this.lastPt)},r}(i);n.PointTracker=h;u=function(i){function r(n){var r=i.call(this,n)||this;return r._type=t.Rect,r}return __extends(r,i),r.prototype.onLeftButtonDown=function(t){return this._operDevice.setProcessTag(!0),this.isTaskStarted?(this._operDevice.setProcessTag(!0),this.bounds=n.Rect.CreateFromPoint(new n.Vector2(this.bounds.left,this.bounds.top),this.lastPt),this._operDevice.clear(),this._operDevice.updateScreen(),this.bounds.isEmpty?this.failTask():this.completeTask()):(this.startTask(),this.bounds=new n.Rect(t.point.x,t.point.y,0,0),this.lastPt=t.point.clone()),!0},r.prototype.onRightButtonDown=function(){return this.isTaskStarted?(this.cancelTask(),!0):!1},r.prototype.onMouseMove=function(n){if(!this.isTaskStarted)return!1;this._operDevice.setProcessTag(!0);var t=this.bounds.clone();return this.lastPt=n.point.clone(),t=this.bounds.clone(),this.onDraw(),!0},r.prototype.onDraw=function(){if(this.isTaskStarted){var t=new n.Vector2(this.bounds.x,this.bounds.y),i=this.lastPt.clone(),r=n.Rect.CreateFromPoint(t,i);this._operDevice.clear();this._operDevice.graphics.drawRectangle(this._operDevice.coordSystem.mapToScreenRect(r),this._pen,this._brush);this._operDevice.updateScreen()}},r.prototype.createGeoObject=function(){return n.GeoObject.CreateFromRect(n.GeoType.Rect,this.bounds)},r}(i);n.RectTracker=u;c=function(i){function r(n){var r=i.call(this,n)||this;return r._type=t.Ellipse,r}return __extends(r,i),r.prototype.onDraw=function(){if(this.isTaskStarted){var t=new n.Vector2(this.bounds.x,this.bounds.y),i=this.lastPt.clone(),r=n.Rect.CreateFromPoint(t,i);this._operDevice.clear();this._operDevice.graphics.drawEllipse(this._operDevice.coordSystem.mapToScreenRect(r),this._pen,this._brush);this._operDevice.updateScreen()}},r.prototype.createGeoObject=function(){return n.GeoObject.CreateFromRect(n.GeoType.Ellipse,this.bounds)},r}(u);n.EllipseTracker=c;l=function(i){function r(n){var r=i.call(this,n)||this;return r._type=t.Ellipse,r}return __extends(r,i),r.prototype.onDraw=function(){if(this.isTaskStarted){var t=this._operDevice.coordSystem.mapToScreen(new n.Vector2(this.bounds.x,this.bounds.y)),i=this._operDevice.coordSystem.mapToScreen(this.lastPt),r=n.Math2.Distance(t.x,t.y,i.x,i.y),u=new n.Rect(t.x-r,t.y-r,2*r,2*r);u=this._operDevice.coordSystem.screenToMapRect(u);this._operDevice.clear();this._operDevice.graphics.drawEllipse(this._operDevice.coordSystem.mapToScreenRect(u),this._pen,this._brush);var f=new n.Vector2(this.bounds.x,this.bounds.y),e=this.lastPt.clone(),o=n.EarthMath2.Distance(f.x,f.y,e.x,e.y);this._operDevice.graphics.drawText(n.StringHelper.FormatLengthString(o,!0),new n.Vector2(i.x,i.y-16),null,!1);this._operDevice.updateScreen()}},r.prototype.onLeftButtonDown=function(t){var f;if(!this.isTaskStarted)return i.prototype.onLeftButtonDown.call(this,t);this._operDevice.setProcessTag(!0);var r=this._operDevice.coordSystem.mapToScreen(new n.Vector2(this.bounds.x,this.bounds.y)),e=this._operDevice.coordSystem.mapToScreen(this.lastPt),u=n.Math2.Distance(r.x,r.y,e.x,e.y);return this._operDevice.clear(),this._operDevice.updateScreen(),f=new n.Rect(r.x-u,r.y-u,2*u,2*u),f=this._operDevice.coordSystem.screenToMapRect(f),this.bounds=f.clone(),this.bounds.isEmpty?this.failTask():this.completeTask(),!0},r.prototype.createGeoObject=function(){return n.GeoObject.CreateFromRect(n.GeoType.Ellipse,this.bounds)},r}(u);n.CircleTracker=l;f=function(i){function r(n){var r=i.call(this,n)||this;return r.points=[],r._type=t.Polyline,r}return __extends(r,i),r.prototype.resetTask=function(){i.prototype.resetTask.call(this);n.ArrayHelper.Clear(this.points)},r.prototype.onLeftButtonDown=function(n){if(this._operDevice.setProcessTag(!0),this.isTaskStarted){var t=this.points.length;this.lastPt=n.point.clone();(this.lastPt.x!==this.points[t-1].x||this.lastPt.y!==this.points[t-1].y)&&this.points.push(this.lastPt);this.onDraw();this.pointMax&&this.pointMax===this.points.length&&this.completeTask()}else{if(0!==this.points.length&&this.resetTask(),this.startTask(),!this.isTaskStarted)return!1;this.points.push(n.point);this.lastPt=n.point.clone()}return this.notifyFather(),!0},r.prototype.onMouseMove=function(n){var t,r,u;return!this.isTaskStarted||n.point.x===this.lastPt.x&&n.point.y===this.lastPt.y?!1:(t=this.points.length,t<1)?!1:(i.prototype.adjustDeviceGridCoord.call(this,n.point),this._operDevice.setProcessTag(!0),this.onDraw(),this.lastPt=n.point.clone(),r=this._operDevice.coordSystem.mapToScreen(this.lastPt),u=this._operDevice.coordSystem.screenToMap(r),!0)},r.prototype.onLeftButtonDblClk=function(n){return this.isTaskStarted?this.points.length<=1?!1:(this._operDevice.setProcessTag(!0),i.prototype.adjustDeviceGridCoord.call(this,n.point),this._operDevice.clear(),this._operDevice.updateScreen(),this.completeTask(),!0):!1},r.prototype.onRightButtonDown=function(){return this.isTaskStarted?(this._operDevice.setProcessTag(!0),this.HF(),!0):!1},r.prototype.onDraw=function(){if(this.isTaskStarted&&(this._operDevice.setProcessTag(!0),0!==this.points.length)){this._operDevice.clear();var t=n.ArrayHelper.CloneArray(this.points);t.push(this.lastPt);this._operDevice.graphics.drawPolyline(this._operDevice.coordSystem.mapToScreenPoints(t),this._pen);this.notifyFatherDraw();this._operDevice.updateScreen()}},r.prototype.HF=function(){if(!this.isTaskStarted)return!1;var n=this.points.length;return n<1?!1:(this.lastPt=this.points[n-1],this.points.splice(n-1,1),this.points.length===0&&this.cancelTask(),this.onDraw(),!0)},r.prototype.createGeoObject=function(){return n.GeoObject.CreateFromPoints(n.GeoType.LineString,this.points)},r}(i);n.LineTracker=f;a=function(t){function i(n){var i=t.call(this,n)||this;return i.Bj=[],i}return __extends(i,t),i.prototype.onLeftButtonDblClk=function(n){return t.prototype.onLeftButtonDblClk.call(this,n),this.onDraw(),!0},i.prototype.cancelTask=function(){t.prototype.cancelTask.call(this);n.ArrayHelper.Clear(this.Bj)},i.prototype.onDraw=function(){var i,r;this.isTaskStarted?(t.prototype.onDraw.call(this),this.Bj=n.ArrayHelper.CloneArray(this.points),this.Bj.push(this.lastPt)):(this._operDevice.clear(),this._operDevice.graphics.drawPolyline(this._operDevice.coordSystem.mapToScreenPoints(this.Bj),this._pen));i=0;i=this._operDevice.coordSystem.isEarthCoord?n.EarthMath2.Length(this.Bj):n.Math2.Length(this.Bj);i>0&&(r=this._operDevice.coordSystem.mapToScreen(this.lastPt),this._operDevice.graphics.drawText(n.StringHelper.FormatLengthString(i,!0),new n.Vector2(r.x,r.y-16),null,!0),this._operDevice.updateScreen())},i}(f);n.LineRuler=a;o=function(i){function r(n){var r=i.call(this,n)||this;return r._type=t.Polygon,r}return __extends(r,i),r.prototype.onDraw=function(){if(this.isTaskStarted&&(this._operDevice.setProcessTag(!0),0!==this.points.length)){this._operDevice.clear();var t=n.ArrayHelper.CloneArray(this.points);t.push(this.lastPt);t.push(t[0]);this._operDevice.graphics.drawPolygon(this._operDevice.coordSystem.mapToScreenPoints(t),this._pen,this._brush);this._operDevice.updateScreen()}},r.prototype.createGeoObject=function(){return n.GeoObject.CreateFromPoints(n.GeoType.Polygon,this.points)},r}(f);n.PolyTracker=o;v=function(t){function i(n){var i=t.call(this,n)||this;return i.Bj=[],i}return __extends(i,t),i.prototype.onLeftButtonDblClk=function(n){return t.prototype.onLeftButtonDblClk.call(this,n),this.onDraw(),!0},i.prototype.cancelTask=function(){t.prototype.cancelTask.call(this);n.ArrayHelper.Clear(this.Bj)},i.prototype.onDraw=function(){var i,r;this.isTaskStarted?(t.prototype.onDraw.call(this),this.Bj=n.ArrayHelper.CloneArray(this.points),this.Bj.push(this.lastPt)):(this._operDevice.clear(),this._operDevice.graphics.drawPolygon(this._operDevice.coordSystem.mapToScreenPoints(this.Bj),this._pen,this._brush));i=0;i=this._operDevice.coordSystem.isEarthCoord?n.EarthMath2.Area(this.Bj):n.Math2.Area(this.Bj);i>0&&(r=this._operDevice.coordSystem.mapToScreen(this.lastPt),this._operDevice.graphics.drawText(n.StringHelper.FormatAreaString(i,!0),new n.Vector2(r.x,r.y-16),null,!0),this._operDevice.updateScreen())},i}(o);n.AreaRuler=v;y=function(n){function t(t){var i=n.call(this,t.operDevice)||this;return i.pixelPrecision=5,i.Fe=t,i}return __extends(t,n),t.prototype.resetTask=function(){n.prototype.resetTask.call(this)},t.prototype.onLeftButtonUp=function(n){var r=this.Fe.renderContext.coordSystem.screenToMapLength(this.pixelPrecision),i,t;return this.FT=this.Fe.layers.selectOneObject(n.point,r),this.Fe.clearPickedObjects(),this.FT&&(i=this.Fe,t=[],t.push(this.FT),i.addPickedObjects(t)),this.Fe.raiseObjectClickedEvent(this.FT),this.completeTask(),this.Fe.redraw(!1),!0},t}(i);n.PointPickOperation=y}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(){}return t.JA=function(){if(!this.JM)return!1;var n=this._C&&Math.abs(this.Kd-this.JM)<=2;return!n,n},t.V=function(){},t.Sn=function(t){var i,r,u;this._C=!0;this.JM=t;i=this.Kd.toString();r=this.JM.toString();i.length!==r.length&&(u=Math.min(i.length,r.length),i=n.TString.Substring(i,0,u),r=n.TString.Substring(r,0,u),this.Kd=parseFloat(i),this.JM=parseFloat(r))},t.Parse4=function(n){t.JA(n)},t.Parse3=function(n,i,r){t.Gm(n.value);n.value=t.Mv(n.value,i[0],r)},t.Parse10=function(){return null},t.Gm=function(n){for(var t=1,i=0;i<32;i++){if(t>=n)break;t=t<<1}return t},t.Ho=function(t,i){var f,r,e,u;for(i===void 0&&(i=3),f=n.SystemHelper.ToInt(t),t=t-f,i=i+1,r=1,e=0;e<i;e++)r=r*10;return u=n.SystemHelper.ToInt(t*r),u=n.SystemHelper.ToInt((u+5)/10)*10,f+u/r},t.Im=function(n,t,i){return n+t/30+i/1800},t.Mv=function(i){var u,r;return i=(i+parseFloat("573729"))/parseFloat("1675"),i=t.Ho(i,2),i=Math.min(parseFloat("78024036"),i),i=i*parseFloat("336489.73"),u=n.NumberHelper.ToString(i),u=n.TString.Replace(u,".",""),r=parseFloat(u).toString(),r.length>13&&(r=n.TString.Substring(r,0,13)),parseFloat(r)},t.Rb=function(t){var u=new n.MemoryStream(t),i=new n.BinaryReader(u),r,f;return i.readBytes(8),r=i.readByte(),f=i.readBytes(r),i.readDouble()},t._C=!1,t}(),i;n._SPP=t;i=function(){function i(){}return i.Parse4=function(n,r,u,f){f=i.GV(f,4);var e=i.Gr(u);t.Parse4(n,r,u,i.JP(f,e,n.value))},i.Parse2=function(n,r){var u=i.Gr(n.value),f=i.GV(r.value,4);t.Parse3(n,r,i.JP(f,u,n.value))},i.Parse10=function(n,r){var u=i.GV(r,4);return t.Parse10(n,r+u)},i.Gr=function(n){for(var t=1,i=0;i<32;i++){if(t>=n)break;t=t<<1}return t},i.GV=function(t,i){var f,r,e,u;for(i===void 0&&(i=3),f=n.SystemHelper.ToInt(t),t=t-f,i=i+1,r=1,e=0;e<i;e++)r=r*10;return u=n.SystemHelper.ToInt(t*r),u=n.SystemHelper.ToInt((u+5)/10)*10,f+u/r},i.JP=function(n,t,i){return n+t/30+i/1800},i}();n._ParamEvaluater=i}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(n){this.Ei=0;this.Dy=0;this.Ia=n.pixels;this.Ei=n.pixelWidth;this.Dy=n.pixelHeight}return t.prototype.setPixel=function(t,i,r){this.Ia[i*this.Ei+t]=n.Color.ColorToInt(r)},t.prototype.getPixel=function(t,i){var r=this.Ia[i*this.Ei+t];return n.Color.IntToColor(r)},t}(),r,i;n.BitmapData=t;r=function(){function r(){}return r.IK=function(t,i,r,u,f){var e=n.Color.IntToColor(t[i]),o=Math.abs(r.r-e.r),s=Math.abs(r.g-e.g),h=Math.abs(r.b-e.b);return o<=f&&s<=f&&h<=f?(t[i]=n.Color.ColorToInt(u),!0):!1},r.ReplaceColor=function(n,t,i,u,f){var h=n.pixelWidth,v=n.pixelHeight,o,l,e,c,a,s;if(f)for(e=0;e<v;e++){for(c=e*h,o=0,o=0;o<h;o=o+1)if(s=c+o,!r.IK(n.pixels,s,t,i,u))break;for(l=h-1;l>=o;l=l-1)if(s=c+l,!r.IK(n.pixels,s,t,i,u))break}else for(e=0;e<v;e++)for(c=e*h,a=0;a<h;a++)s=c+a,r.IK(n.pixels,s,t,i,u);n.commitPixelUpdate()},r.ReplaceMainColorRGB=function(t,i){for(var h,r,e,o,s=t.pixelWidth,c=t.pixelHeight,u=i,f=0;f<c;f++)for(h=f*s,r=0;r<s;r++)e=h+r,o=n.Color.FromIntRgba(u.r,u.g,u.b,n.Color.IntToColor(t.pixels[e]).a),t.pixels[e]=o.a===0?0:n.Color.ColorToInt(o);t.commitPixelUpdate()},r.FilterByMask=function(n,r){var u,f,o,s;if(n.pixelWidth!==r.pixelWidth||n.pixelHeight!==r.pixelHeight)return null;var e=new i(n.pixelWidth,n.pixelHeight),h=n.pixelWidth,c=n.pixelHeight,l=new t(e),a=new t(r),v=new t(n);for(u=0;u<h;u++)for(f=0;f<c;f++)o=a.getPixel(u,f),s=v.getPixel(u,f),o.a>0&&l.setPixel(u,f,s);return e.commitPixelUpdate(),e},r.JS=function(t,i,r){var u=n.Color.IntToColor(t[i]),f=n.SystemHelper.ToInt(Math.max(Math.max(u.r,u.g),u.b)*r),e;return f>255&&(f=255),e=n.Color.FromIntRgba(u.r,u.g,u.b,f),t[i]=n.Color.ColorToInt(e),!0},r.MakeBitmapTransparentByColor=function(n,t){for(var e,i,o,f=n.pixelWidth,s=n.pixelHeight,u=0;u<s;u++)for(e=u*f,i=0;i<f;i++)o=e+i,r.JS(n.pixels,o,t);n.commitPixelUpdate()},r.SetBitmapAlpha=function(t,i){for(var f,e=n.SystemHelper.ToInt(255*i),u=t.pixels,o=t.pixels.length,r=0;r<o;r++)f=n.SystemHelper.ToInt(u[r]),u[r]=n.SystemHelper.ToInt(f&16777215|e<<24&-16777216)},r}();n.BitmapHelper=r;i=function(){function t(n,t){this.HT=!0;arguments.length===2&&this.Io(n,t)}return t.prototype.Io=function(t,i){if(!this.graphics){var r=document.createElement("canvas");r.width=t;r.height=i;this.Ha=new n.CanvasGraphics(r);this.Ju=r;this.JN=r}},t.prototype.Ga=function(){return this.Ha?this.Ha.getContext():null},t.prototype.clone=function(){var n=new t(this.pixelWidth,this.pixelHeight);return this.copyTo(n),n},Object.defineProperty(t.prototype,"imageSource",{get:function(){return this.Ju},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvas",{get:function(){return this.Ha?this.Ju:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pixelHeight",{get:function(){return this.Ju?this.Ju.height:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pixelWidth",{get:function(){return this.Ju?this.Ju.width:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphics",{get:function(){return this.Ha},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pixels",{get:function(){return this.Ia||(this.Ia=this.Iw()),this.Ia},enumerable:!1,configurable:!0}),t.prototype.isReady=function(){return this.HT},t.prototype.resizeAndCopyFrom=function(n){if(n){var t=n.pixelWidth,i=n.pixelHeight;this.JN?(this.JN.width=t,this.JN.width=t):this.Io(t,i);n.copyTo(this)}},t.prototype.copyTo=function(t){this.copyToRect(0,0,t,new n.Rect(0,0,t.pixelWidth,t.pixelHeight))},t.prototype.copyToRect=function(n,t,i,r){this.Ju&&i&&i.Ga()&&i.Ga().drawImage(this.Ju,n,t,r.width,r.height,r.left,r.top,r.width,r.height)},t.prototype.copyToRectStretch=function(n,t,i){this.Ju&&t&&t.Ga()&&t.Ga().drawImage(this.Ju,n.x,n.y,n.width,n.height,i.left,i.top,i.width,i.height)},t.prototype.clear=function(){this.Ga()&&this.Ga().clearRect(0,0,this.Ju.width,this.Ju.height)},t.Jj=function(n){t.HG||(t.HG=this.Jz.getContext("2d"));var i=n.pixelWidth,r=n.pixelHeight;t.Jz.width=i;t.Jz.height=r;t.HG.drawImage(n.Ju,0,0)},t.HA=function(n,t,i,r){return n<<24&4278190080|t<<16&16711680|i<<8&65280|r&255},t.KU=function(t){for(var s,h=t.getContext("2d"),u=h.getImageData(0,0,t.width,t.height),f=u.data.length,e=new Int32Array(n.SystemHelper.ToInt(f/4)),r=u.data,o=0,i=0;i<f;i+=4)s=this.HA(r[i+3],r[i],r[i+1],r[i+2]),e[o]=s,o++;return e},t.prototype.Iw=function(){if(!this.Ju||!this.isReady())return null;var n;return this.Ga()?n=this.Ju:(t.Jj(this),n=t.Jz),t.KU(n)},t.prototype.JD=function(){var t,i;if(this.Ia&&this.Ju&&this.Ga()){var f=this.Ga(),u=f.getImageData(0,0,this.Ju.width,this.Ju.height),o=u.data.length,r=u.data,e=0,s=this.Ia;for(t=0;t<o;t+=4)i=n.Color.IntToColor(s[e]),r[t]=i.r,r[t+1]=i.g,r[t+2]=i.b,r[t+3]=i.a,e++;f.putImageData(u,0,0)}},t.prototype.commitPixelUpdate=function(){this.JD()},t.CreateFromUrl=function(i,r){var u,f;return r===void 0&&(r=null),i=n.SystemHelper.ParseImageUrl(i),u=new t,u.HT=!1,f=n.WindowsHelper.CreateImage(),f.src=i,f.onload=function(){u.Ju=f;u.HT=!0;r&&r(u)},u},t.CreateFromBytes=function(i){var r=new t,u;return r.HT=!1,u=n.WindowsHelper.CreateImage(),u.src=n.SystemHelper.EncodeArrayBufferTobase64(i),u.onload=function(){r.Ju=u;r.HT=!0},r},t.CreateFromHtmlImage=function(n){var i=new t;return i.Ju=n,i},t.Jz=document.createElement("canvas"),t}();n.WriteableBitmap=i}(Drawsee||(Drawsee={})),function(n){var r=function(){function t(){this.penColor=new n.Color;this.penWidth=0;this.penStyle=0;this.brushColor=new n.Color;this.brushStyle=0;this.fontName="";this.textColor=new n.Color;this.textAngle=0;this.textHeight=0}return t.prototype.copyFrom=function(n){this.penColor=n.penColor.clone();this.penWidth=n.penWidth;this.penStyle=n.penStyle;this.brushColor=n.brushColor.clone();this.brushStyle=n.brushStyle;this.fontName=n.fontName;this.textColor=n.textColor.clone();this.textAngle=n.textAngle;this.textHeight=n.textHeight},t}(),t,i;n.DrawStyle=r;t=function(){function t(t,i){this.Cc=new n.Color;this.Ei=1;this.Ek=[];this.DX(t,i)}return Object.defineProperty(t.prototype,"color",{get:function(){return this.Cc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.Ei},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"brush",{get:function(){return this.Di},enumerable:!1,configurable:!0}),t.prototype.Ep=function(t){this.Di&&t.equals(this.Cc)||(this.Cc=t.clone(),this.Di=new n.SolidColorBrush(this.Cc))},t.prototype.DX=function(n,t){this.Ep(n);this.Ei=t},t.prototype.setDashPattern=function(n){var t,i;if(this.Ek=[],n)for(t=0;t<n.length;t++)i=n[t],this.Ek.push(i)},Object.defineProperty(t.prototype,"dashArrayH5",{get:function(){if(!this.Ek)return null;if(this.BM)return this.BM;this.BM=[];for(var n=0;n<this.Ek.length;n++)this.BM.push(this.Ek[n]*5);return this.BM},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dashArrayString",{get:function(){return this.Em||(this.Em=t.BT(this.dashArrayH5)),this.Em},enumerable:!1,configurable:!0}),t.BT=function(n){var i,t;if(!n||n.length<=0)return"";for(i="",t=0;t<n.length;t++)i+=n[t].toString()+"-";return i},t}();n.Pen2=t;i=function(){function t(t){this.Cv=n.Color.Black;this.Bo=n.Color.FromIntRgba(255,255,255,128);this.EZ=0;this.CJ=0;this.En=n.Color.FromIntRgba(0,0,0,192);t&&(this.BP=t,this.BP&&(this.EN=this.BP.getContext("2d"),this.Ei=n.SystemHelper.ToInt(this.BP.width),this.Dy=n.SystemHelper.ToInt(this.BP.height),this.EN.lineJoin="round"))}return t.prototype.getCanvas=function(){return this.BP},t.prototype.getContext=function(){return this.EN},t.prototype.attachContext=function(n,t,i){this.EN=n;this.Ei=t;this.Dy=i;this.EZ=t;this.CJ=i},t.prototype.drawLine=function(n,t,i){this.drawPolyline([n,t],i)},t.prototype.drawPolyline=function(n,t){var i,r;if(n&&n.length>1){for(i=this.EN,i.beginPath(),i.moveTo(n[0].x,n[0].y),r=1;r<n.length;r++)i.lineTo(n[r].x,n[r].y);t&&(this.Eb(t),i.stroke())}},t.prototype.drawPolygon=function(n,t,i){var r,u;if(n&&n.length>2){for(r=this.EN,r.beginPath(),r.moveTo(n[0].x,n[0].y),u=1;u<n.length;u++)r.lineTo(n[u].x,n[u].y);r.lineTo(n[0].x,n[0].y);i&&(this.Ef(i),r.fill());t&&(this.Eb(t),r.stroke())}},t.prototype.drawRectangle=function(n,t,i,r){var u,f;if((i===void 0&&(i=null),r===void 0&&(r=0),n)&&!(n.width<=0)&&!(n.height<=0))if(u=this.EN,i&&this.Ef(i),t&&this.Eb(t),f=r,f>0){var e=n.x,o=n.y,s=n.width,h=n.height;u.save();u.beginPath();u.moveTo(e+f,o);u.arcTo(e+s,o,e+s,o+f,f);u.arcTo(e+s,o+h,e+s-f,o+h,f);u.arcTo(e,o+h,e,o+h-f,f);u.arcTo(e,o,e+f,o,f);i&&u.fill();t&&u.stroke();u.restore()}else i&&u.fillRect(n.x,n.y,n.width,n.height),t&&u.strokeRect(n.x,n.y,n.width,n.height)},t.prototype.drawEllipse=function(n,t,i){if((i===void 0&&(i=null),n)&&n.width>0&&n.height>0){var r=this.EN;r.beginPath();r.ellipse(n.x+n.width*.5,n.y+n.height*.5,n.width*.5,n.height*.5,0,0,2*Math.PI);i?(this.Ef(i),r.fill()):t&&(this.Eb(t),r.stroke())}},t.prototype.EG=function(){if(this.BP){var t=n.SystemHelper.ToInt(this.BP.width),i=n.SystemHelper.ToInt(this.BP.height);(t!==this.Ei||i!==this.Dy)&&(this.Ds(),this.Ei=t,this.Dy=i)}},t.prototype.clear=function(){var n=this.EN;n&&(this.EG(),this.EZ=Math.max(this.EZ,this.Ei),this.CJ=Math.max(this.CJ,this.Dy),n.clearRect(0,0,this.EZ,this.CJ))},t.prototype.CY=function(n,i,r){n===void 0&&(n=12);i===void 0&&(i=null);r===void 0&&(r=!0);t.Dc(this.EN,n,i,r)},t.prototype.measureText=function(n,i,r){return t.MeasureText(n,i,r)},t.prototype.drawText=function(n,t,i,r){r===void 0&&(r=!1);var u=this.EN;r&&(u.strokeStyle=this.Bo.toColorString(),u.lineWidth=3,u.strokeText(n,t.x,t.y));this.drawTextAdvance(n,t,0,i)},t.prototype.drawTextAdvance=function(t,i,r,u,f,e,o,s,h){var c,l,a,v;f===void 0&&(f=12);e===void 0&&(e=null);o===void 0&&(o=!0);s===void 0&&(s=0);h===void 0&&(h=null);c=this.EN;this.CY(f,e,o);s>0&&(h||(h=this.Bo),c.strokeStyle=h.toColorString(),c.lineWidth=3,l=i.x-.5,a=i.y+.5,r!==0?(c.save(),c.translate(l,a),c.rotate(n.MathHelper.ToRadians(r)),c.strokeText(t,0,0),c.restore()):c.strokeText(t,l,a));v="";u?(v=u.toColorString(),c.fillStyle=v):c.fillStyle=this.Cv.toColorString();r!==0?(c.save(),c.translate(i.x,i.y),c.rotate(n.MathHelper.ToRadians(r)),c.fillText(t,0,0),c.restore()):c.fillText(t,i.x,i.y)},t.prototype.drawTextFont3d=function(n,t,i,r){this.El(n,t,this.En,r,4,1,1);this.El(n,t,i,r,1,1,1)},t.prototype.El=function(n,t,i,r,u,f,e){var s="",o=this.EN;i&&(s=i.toColorString(),o.fillStyle="");this.CY(r,"Simsun",!1);o.lineWidth=u;o.strokeStyle=s;o.strokeText(n,t.x+f,t.y+e)},t.prototype.drawImage=function(n,t,i){if(n&&n.imageSource&&!(n.imageSource.width<=0)&&!(n.imageSource.height<=0)){var r=this.EN;i===0?r.drawImage(n.imageSource,t.x,t.y):this.Ej(n,t,i)}},t.prototype.Ej=function(t,i,r){var u=this.EN;u.save();u.translate(i.x+t.pixelWidth*.5,i.y+t.pixelHeight*.5);u.rotate(n.MathHelper.ToRadians(r));u.translate(-t.pixelWidth*.5,-t.pixelHeight*.5);u.drawImage(t.imageSource,0,0);u.restore()},t.prototype.drawImageStretch=function(n,t){if(n&&n.imageSource&&!(n.imageSource.width<=0)&&!(n.imageSource.height<=0)){var i=this.EN;i.drawImage(n.imageSource,0,0,n.imageSource.width,n.imageSource.height,t.x,t.y,t.width,t.height)}},t.prototype.Ef=function(n){if(n){var t=this.EN;t.fillStyle=n.color.toColorString()}},t.prototype.Ds=function(){this.Dd=null},t.prototype.Eb=function(n){var t,i;n&&(t=this.EN,t.strokeStyle=n.color.toColorString(),t.lineWidth=n.width,i=n.dashArrayH5,i?n.dashArrayString!==this.Dd&&(t.setLineDash(i),this.Dd=n.dashArrayString):this.Dd!==""&&(t.setLineDash([]),this.Dd=""))},t.CO=function(){if(!this.Cg){var n=document.createElement("canvas");n.width=256;n.width=256;this.Cg=new t(n)}return this.Cg},t.Dc=function(n,t,i,r){t===void 0&&(t=12);i===void 0&&(i=null);r===void 0&&(r=!0);i||(i=this.ER);var u;return u=r?"bold "+t.toString()+"px "+i:t.toString()+"px "+i,n.font=u,u},t.MeasureText=function(t,i,r){var u,f;return t?(u=this.CO().getContext(),i&&this.Dc(u,i,r),f=n.SystemHelper.ToInt(u.measureText(t).width),new n.Size(f,i)):new n.Size(0,0)},t.ER="微软雅黑",t}();n.CanvasGraphics=i}(Drawsee||(Drawsee={})),function(n){var r,t,i;(function(n){n[n.Opaque=0]="Opaque";n[n.Add=1]="Add";n[n.Transparent=2]="Transparent";n[n.HalfTransparent=3]="HalfTransparent"})(r=n.BlendingMode||(n.BlendingMode={}));t=function(){function n(n,t,i,r,u,f,e,o){r===void 0&&(r=!1);u===void 0&&(u=null);f===void 0&&(f=null);e===void 0&&(e=0);o===void 0&&(o=0);this.world=n;this.clipCenter=t;this.clipRadius=i;this.isTransparent=r;this.texture=u;this.elmentBuffer=f;this.indexStart=e;this.indexCount=o}return n}();n.RenderMeshChunk=t;i=function(){function t(){}return t._GetLodCacheRatio=function(){return this.LodRatio*this.CacheRatio},t._GetCombinedLodRatio=function(){return this.NL||t._Init(),this.LodRatio*this.NL},t._GetIsLowMemoryDevice=function(){return this.Me},t._Init=function(){var t=document.body.clientHeight;t!==this.Nc&&(this.Nc=t,this.NL=Math.max(.6,Math.floor(Math.sqrt(t/1e3)*20)/20));this.Me===undefined&&(this.Me=n.SystemHelper.GetMemoryLimitMBytes()<512)},t.LightDirection=new n.Vector3(-.5,-1.2,1),t.AmbientLightBrightness=.5,t.DepthBufferNearFarRatio=1e6,t.DeviceSensitiveRatio=1,t.MaxTextureDetailLod=0,t.LodRatio=1,t.CacheRatio=1,t.FontScaleRatio=.7,t.TerrainZeroBaseHeight=0,t.Antialias=!1,t.HighPrecisionHeight=!1,t.Nc=0,t}();n.Drawing3DSetting=i}(Drawsee||(Drawsee={})),function(n){var t=BABYLON.Engine,r,i;(function(n){n[n.Zero=0]="Zero";n[n.ShadowVolume=1]="ShadowVolume";n[n.Clip=1]="Clip"})(r=n.StencilValue||(n.StencilValue={}));i=function(){function i(t){this.LM=!1;this.ND=1;this.Mh=!1;this.Nj=new n.Dictionary;this.Jo=[];this.JN=t;this.NT(t);this.NI=new n.ElementBufferManager(this);this.OR()}return i.prototype.NT=function(t){var i={},r,u;i.stencil=!0;i.antialias=n.Drawing3DSetting.Antialias;i.preserveDrawingBuffer=!0;r=t.htmlCanvas.getContext("webgl2",i)||t.htmlCanvas.getContext("experimental-webgl2",i);r||(r=t.htmlCanvas.getContext("webgl",i)||t.htmlCanvas.getContext("experimental-webgl",i));r||alert("不能初始化WebGL，请升级支持Html5的浏览器(谷歌浏览器,IE11等)！");this.OU=r;u=new BABYLON.Engine(r);u._setDeterministicLockStep(!0);this.LK=u;this.LK.setViewport(new n.Viewport(0,0,1,1))},i.prototype.OR=function(){this.terrainChunkRender=new n.TerrainChunkRender(this,"Terrain","TerrainChunkRender");this.fixedMeshChunkRender=new n.SimpleTextureMeshChunkRender(this,"SimpleTextureMesh","FixedChunkRender");this.fontChunkRender=new n.FontChunkRender(this);this.portraitChunkRender=new n.PortraitChunkRender(this);this.skyAtmosphereRender=new n.SkyAtmosphereRender(this)},Object.defineProperty(i.prototype,"engine",{get:function(){return this.LK},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isWireFrameMode",{get:function(){return this.LM},set:function(n){this.LM=n},enumerable:!1,configurable:!0}),i.prototype.updateGlobalVars=function(){this.ND=Math.min(2,Math.max(1,1024/this.JN.height))},i.prototype.getViewportRect=function(){return new n.Rect(0,0,this.JN.width,this.JN.height)},i.prototype.getLodViewRatio=function(){return this.ND},i.prototype.getDeltaTime=function(){return 20},i.prototype.clear=function(t,i,r,u){var f=null;t&&(f=n.VectorHelper.ToColor4(t));this.LK.clear(f,i,r,u)},i.prototype.beginFrame=function(){this.LK.beginFrame();this.LK._forceNotClear=!1;this.resetStates();this.LK.unbindAllTextures()},i.prototype.endFrame=function(){this.LK.endFrame()},i.prototype.resetStates=function(){this.LK._resetStates();this.LK.applyStates()},i.prototype.applyStates=function(){this.LK.applyStates()},Object.defineProperty(i.prototype,"isCulling",{get:function(){return this.LK._getCull()},set:function(n){n?this.LK.setState(!0,0,!0,!1):this.LK.setState(!1,0,!0,!1);this.LK.applyStates()},enumerable:!1,configurable:!0}),i.prototype.setBlendingMode=function(i){var r=this.OU;switch(i){case n.BlendingMode.Opaque:this.LK.setAlphaMode(t.ALPHA_DISABLE);this.LK._setAlphaBlendFunctionParametersDirect(r.ONE,r.ZERO,r.ONE,r.ZERO);break;case n.BlendingMode.Transparent:this.LK._setAlphaBlendFunctionParametersDirect(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE);break;case n.BlendingMode.Add:this.LK._setAlphaBlendFunctionParametersDirect(r.SRC_ALPHA,r.ONE,r.ZERO,r.ONE)}},i.prototype.setNearObjectMode=function(n,t){if(t===void 0&&(t=.9999),n!==this.Mh){var i=this.OU;n?i.depthRange(0,t):i.depthRange(0,1);this.Mh=n}},i.prototype.getNearObjectMode=function(){return this.Mh},i.prototype.enableStencilBuffer=function(n,i,r){i===void 0&&(i=!1);r===void 0&&(r=0);var u=this.LK;n?(u.setStencilBuffer(!0),u.setStencilFunctionMask(255),u.setStencilFunction(t.GEQUAL),u.setStencilOperationFail(t.KEEP),u.setStencilOperationDepthFail(t.KEEP),i?(u.setStencilFunctionReference(Math.max(1,r)),u.setStencilOperationPass(t.REPLACE)):(u.setStencilFunctionReference(Math.max(0,r)),u.setStencilOperationPass(t.KEEP))):this.LK.setStencilBuffer(!1)},i.prototype.enableVolumeBlendSrcPassOne=function(n){var i=this.LK;n?(i.setDepthWrite(!1),i.setColorWrite(!1),i.cullBackFaces=!1,this.isCulling=!0,i.setStencilBuffer(!0),i.setStencilFunction(t.ALWAYS),i.setStencilOperationFail(t.KEEP),i.setStencilOperationPass(t.KEEP),i.setStencilOperationDepthFail(t.INCR)):(this.engine.setDepthWrite(!0),this.engine.setColorWrite(!0),i.setStencilBuffer(!1),i.setStencilOperationFail(t.KEEP),i.setStencilOperationDepthFail(t.KEEP),i.setStencilOperationPass(t.KEEP))},i.prototype.enableVolumeBlendSrcPassTwo=function(n){var i=this.LK;n?(this.LK.setDepthWrite(!1),i.setColorWrite(!1),i.cullBackFaces=!0,this.isCulling=!0,i.setStencilBuffer(!0),i.setStencilFunction(t.ALWAYS),i.setStencilOperationFail(t.KEEP),i.setStencilOperationPass(t.KEEP),i.setStencilOperationDepthFail(t.DECR)):(this.engine.setDepthWrite(!0),this.engine.setColorWrite(!0),i.setStencilBuffer(!1),i.setStencilOperationFail(t.KEEP),i.setStencilOperationDepthFail(t.KEEP),i.setStencilOperationPass(t.KEEP))},i.prototype.enableVolumeBlendTarget=function(n){var i=this.LK;n?(i.setStencilBuffer(!0),i.setStencilFunction(t.LEQUAL),i.setStencilFunctionReference(1),i.setStencilFunctionMask(255),i.setStencilOperationPass(this.OU.ZERO),i.setStencilOperationDepthFail(t.KEEP)):i.setStencilBuffer(!1)},i.prototype.renderNoOverlap=function(n){var t=this.LK;t.setStencilBuffer(!0);t.setStencilFunctionReference(1);t.setStencilFunction(BABYLON.Engine.GREATER);t.setStencilOperationFail(BABYLON.Engine.KEEP);t.setStencilOperationPass(BABYLON.Engine.INCR);t.setStencilOperationDepthFail(BABYLON.Engine.KEEP);n();t.setStencilBuffer(!1);t.setStencilOperationFail(BABYLON.Engine.KEEP);t.setStencilOperationDepthFail(BABYLON.Engine.KEEP);t.setStencilOperationPass(BABYLON.Engine.KEEP)},i.prototype.createEffect=function(n,t){var i=this.Nj.getValue(n),r;return i?i:(t||(t={}),t&&(t.defines||(t.defines=""),t.attributes||(t.attributes=[]),t.uniformsNames||(t.uniformsNames=[]),t.samplers||(t.samplers=[])),r="ds"+n,i=this.LK.createEffect(r,t,this.LK,t.samplers),this.Nj.add(n,i),i)},i.prototype.enableEffect=function(n){n&&n.isReady()&&(n._checkProgram(),this.LK.enableEffect(n))},i.prototype.createElement=function(t,i,r,u,f){return u===void 0&&(u=n.ElementType.Triangles),f===void 0&&(f=!1),this.NI._createBuffer(t,i,r,u,f)},i.prototype.updateElement=function(t,i,r,u,f){f===void 0&&(f=n.ElementType.Triangles);t&&this.NI._updateBuffer(t.id,i,r,u,f)},i.prototype.createElementFromBuffers=function(t,i,r,u){if(r===void 0&&(r=n.ElementType.Triangles),u===void 0&&(u=!1),!t||!i)return null;var f=new n.ElementBuffer(this.NI);return this.NI._createElementFromBuffers(f.id,t,i,r,u),f},i.prototype._releaseVertextBuffers=function(n){var i,t,r;if(n)for(i=Object.keys(n),t=0;t<i.length;t++)r=n[i[t]],r&&r.dispose()},i.prototype.MR=function(n){return n?n.bind(this.isWireFrameMode):!1},i.prototype.drawElements=function(n,t,i){if(t===void 0&&(t=-1),i===void 0&&(i=-1),n){var r=n.internalBuffer;r&&(i<0&&(i=r.indexCount),t<0&&(t=0),this.applyStates(),this.drawInternalElements(r,t,i))}},i.prototype.drawInternalElements=function(t,i,r){var f;if(this.MR(t)){this.applyStates();var u=this.OU,e=t.elmentType,o=t.is32Bits,s=o?u.UNSIGNED_INT:u.UNSIGNED_SHORT,h=o?4:2;this.isWireFrameMode&&(e===n.ElementType.Triangles||e===n.ElementType.TriangleStrip)&&(e=n.ElementType.Lines,i*=2,r*=2);switch(e){case n.ElementType.LineStrip:f=u.LINE_STRIP;break;case n.ElementType.Lines:f=u.LINES;break;case n.ElementType.TriangleStrip:f=u.TRIANGLE_STRIP;break;case n.ElementType.Triangles:f=u.TRIANGLES;break;default:return}u.drawElements(f,r,s,i*h)}},i.prototype.bindTexture=function(n,t){var i=t?t.internalTexture:null;i||(i=this.LK.emptyTexture);this.LK._bindTexture(n,i)},i.prototype.deleteTexture=function(n){n&&n.internalTexture&&this._deleteInternalTexture(n.internalTexture)},i.prototype._deleteInternalTexture=function(n){n&&this.LK._releaseTexture(n)},i.prototype.createTexture=function(t){var i=this._createInternalTexture(t);return new n.DirectTexture(this,i,!1)},i.prototype.createTextureFromUrl=function(t,i,r){return new n.AutoloadUrlTexture(this,t,i,r)},i.prototype.createTextureFromBytes=function(t,i){return new n.BlobTexture(this,t,!1,i)},i.prototype.createTextureFromBitmap=function(t){var i=this._createInternalTexture(t.imageSource,!1);return i?new n.DirectTexture(this,i):null},i.prototype.updateTexture=function(n,t){if(!0&&n){var r=n.internalTexture._webGLTexture,i=this.OU;i.bindTexture(i.TEXTURE_2D,r);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t);i.generateMipmap(i.TEXTURE_2D);i.bindTexture(i.TEXTURE_2D,null)}},i.prototype.OB=function(){this.Mv||(this.Mv=document.createElement("canvas"),this.Ni=this.Mv.getContext("2d"))},i.prototype.createTextureFromBitmapRect=function(t,i){this.OB();this.Mv.width=i.width;this.Mv.height=i.height;this.Ni.drawImage(t.imageSource,i.left,i.top,i.width,i.height,0,0,i.width,i.height);var r=this._createInternalTexture(this.Mv,!1);return r?new n.DirectTexture(this,r):null},i.prototype.NA=function(n,t,i){var f;if(t===void 0&&(t=!0),i===void 0&&(i=!0),!n)return null;var r=this.OU,u=new BABYLON.InternalTexture(this.LK,BABYLON.InternalTexture.DATASOURCE_TEMP),e=u._webGLTexture;return r.bindTexture(r.TEXTURE_2D,e),f=r.getParameter(r.UNPACK_FLIP_Y_WEBGL),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,0),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),i?r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_NEAREST):r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),t?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT)),i&&r.generateMipmap(r.TEXTURE_2D),r.bindTexture(r.TEXTURE_2D,null),f&&r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,1),u.baseWidth=n.width,u.baseHeight=n.height,u.width=n.width,u.height=n.height,u.generateMipMaps=!0,u.isReady=!0,u},i.prototype._createInternalTexture=function(n,t,i,r,u){if((t===void 0&&(t=!0),r===void 0&&(r=!0),u===undefined)||(u=Math.max(16,u),n.width<u&&n.height<u))return this.NA(n,t,r,i);this.OB();var s=Math.max(n.width,n.height),f=u/s,e=Math.floor(n.width*f),o=Math.floor(n.height*f);return this.Mv.width=e,this.Mv.height=o,this.Ni.drawImage(n,0,0,e,o),this.NA(this.Mv,t,r,i)},i.prototype._registerRenderTexture=function(n){this.Jo.push(n)},i.prototype._removeRenderTexture=function(n){for(var i=this.Jo,t=0;t<i.length;t++)if(n===i[t]){i.splice(t,1);break}},i.prototype._prepareDrawingData=function(n){n.isTimeOut()||this.fontChunkRender.prepareDrawingData(n)},i.prototype._processRenderTexture=function(){for(var t,n=0;n<this.Jo.length;n++)t=this.Jo[n],t&&t.render()},i}();n.Graphics3=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t,i,r,u,o,s,f,h,c,l,e,a,v,y;(function(n){n[n.Single=0]="Single";n[n.Vector2=1]="Vector2";n[n.Vector3=2]="Vector3";n[n.Vector4=3]="Vector4";n[n.Color=4]="Color";n[n.Byte4=5]="Byte4";n[n.Short2=6]="Short2";n[n.Short4=7]="Short4";n[n.NormalizedShort2=8]="NormalizedShort2";n[n.NormalizedShort4=9]="NormalizedShort4";n[n.HalfVector2=10]="HalfVector2";n[n.HalfVector4=11]="HalfVector4"})(t=n.VertexElementFormat||(n.VertexElementFormat={}));i=function(){function n(t,i){this.OX=0;this.offset=t;this.format=i;this.OX=n.NO(this.format)}return Object.defineProperty(n.prototype,"stride",{get:function(){return this.OX},enumerable:!1,configurable:!0}),n.NO=function(n){switch(n){case t.Single:return 1;case t.Vector2:return 2;case t.Vector3:return 3;case t.Vector4:case t.Color:return 4;case t.Byte4:case t.Short2:case t.Short4:case t.NormalizedShort2:case t.NormalizedShort4:return 1;case t.HalfVector2:return 1;case t.HalfVector4:return 2}},n}();n.VertexElement=i;r=function(){function n(n){if(this.Ov=0,this.QP=n,n)for(var t=0;t<n.length;t++)this.Ov+=n[t].stride*4}return Object.defineProperty(n.prototype,"vertexByteStride",{get:function(){return this.Ov},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"vertexFloatStride",{get:function(){return this.Ov/4},enumerable:!1,configurable:!0}),n.prototype.getVertexElements=function(){return this.QP},n}();n.VertexDeclaration=r;u=function(){function n(){}return n.prototype.appendVector2=function(n,t){n.push(t.x);n.push(t.y)},n.prototype.appendVector3=function(n,t){n.push(t.x);n.push(t.y);n.push(t.z)},n.prototype.appendVector4=function(n,t){n.push(t.x);n.push(t.y);n.push(t.z);n.push(t.w)},n.prototype.appendColor=function(n,t){n.push(t.r);n.push(t.g);n.push(t.b);n.push(t.a)},n}();n.VertexBase=u;o=function(u){function f(t){t===void 0&&(t=n.Vector3.Zero());var i=u.call(this)||this;return i.position=t,i}return __extends(f,u),f.VertexPosition_cctor=function(){var n=[new i(0,t.Vector3)],u=new r(n);f.VertexDeclaration=u},Object.defineProperty(f.prototype,"VertexDeclaration",{get:function(){return f.VertexDeclaration},enumerable:!1,configurable:!0}),f.prototype.clone=function(){return new f(this.position)},f.prototype.appendData=function(n){this.appendVector3(n,this.position)},f}(u);n.VertexPosition=o;s=function(u){function f(t,i,r){t===void 0&&(t=n.Vector3.Zero());i===void 0&&(i=n.Vector3.Zero());r===void 0&&(r=n.Vector2.Zero());var f=u.call(this)||this;return f.position=t,f.normal=i,f.textureCoordinate=r,f}return __extends(f,u),Object.defineProperty(f.prototype,"VertexDeclaration",{get:function(){return f.VertexDeclaration},enumerable:!1,configurable:!0}),f.VertexPositionNormalTexture_cctor=function(){var n=[new i(0,t.Vector3),new i(12,t.Vector3),new i(24,t.Vector2)],u=new r(n);f.VertexDeclaration=u},f.prototype.clone=function(){return new f(this.position,this.normal,this.textureCoordinate)},f.prototype.appendData=function(n){this.appendVector3(n,this.position);this.appendVector3(n,this.normal);this.appendVector2(n,this.textureCoordinate)},f.prepareVertexBufferData=function(n,t,i,r){var c;r===void 0&&(r=!1);var l=n.length,u=new Float32Array(8*l),a=t&&t.length>0,o=n.data,v=i.data,s;a&&(s=t.data);var f=0,e=0,h=0;for(c=0;c<l;c++)u[f]=o[e],u[f+1]=o[e+1],u[f+2]=o[e+2],r?(u[f+3]=o[e],u[f+4]=o[e+1],u[f+5]=o[e+2]):a&&(u[f+3]=s[e],u[f+4]=s[e+1],u[f+5]=s[e+2]),u[f+6]=v[h],u[f+7]=v[h+1],f+=8,e+=3,h+=2;return u},f}(u);n.VertexPositionNormalTexture=s;f=function(u){function f(t,i){t===void 0&&(t=n.Vector3.Zero());i===void 0&&(i=n.Vector2.Zero());var r=u.call(this)||this;return r.position=t,r.textureCoordinate=i,r}return __extends(f,u),Object.defineProperty(f.prototype,"VertexDeclaration",{get:function(){return f.VertexDeclaration},enumerable:!1,configurable:!0}),f.VertexPositionTexture_cctor=function(){var n=[new i(0,t.Vector3),new i(12,t.Vector2)],u=new r(n);f.VertexDeclaration=u},f.prototype.clone=function(){return new f(this.position,this.textureCoordinate)},f.prototype.appendData=function(n){this.appendVector3(n,this.position);this.appendVector2(n,this.textureCoordinate)},f}(u);n.VertexPositionTexture=f;h=function(u){function f(t,i,r){t===void 0&&(t=n.Vector3.Zero());i===void 0&&(i=new n.Color);r===void 0&&(r=n.Vector2.Zero());var f=u.call(this)||this;return f.position=t,f.color=i,f.textureCoordinate=r,f}return __extends(f,u),Object.defineProperty(f.prototype,"VertexDeclaration",{get:function(){return f.VertexDeclaration},enumerable:!1,configurable:!0}),f.VertexPositionColorTexture_cctor=function(){var n=[new i(0,t.Vector3),new i(12,t.Color),new i(16,t.Vector2)];f.VertexDeclaration=new r(n)},f.prototype.clone=function(){return new f(this.position,this.color,this.textureCoordinate)},f.prototype.appendData=function(n){this.appendVector3(n,this.position);this.appendColor(n,this.color);this.appendVector2(n,this.textureCoordinate)},f}(u);n.VertexPositionColorTexture=h;c=function(u){function f(t,i){t===void 0&&(t=n.Vector3.Zero());i===void 0&&(i=new n.Color);var r=u.call(this)||this;return r.position=t,r.color=i,r}return __extends(f,u),Object.defineProperty(f.prototype,"VertexDeclaration",{get:function(){return f.VertexDeclaration},enumerable:!1,configurable:!0}),f.VertexPositionColor_cctor=function(){var n=[new i(0,t.Vector3),new i(12,t.Color)],u=new r(n);f.VertexDeclaration=u},f.prototype.clone=function(){return new f(this.position,this.color)},f.prototype.appendData=function(n){this.appendVector3(n,this.position);this.appendColor(n,this.color)},f}(u);n.VertexPositionColor=c;l=function(u){function f(t,i,r,f){t===void 0&&(t=n.Vector3.Zero());i===void 0&&(i=n.Vector3.Zero());r===void 0&&(r=n.Vector2.Zero());f===void 0&&(f=n.Vector2.Zero());var e=u.call(this)||this;return e.position=t,e.normal=i,e.textureCoordinate=r,e.textureCoordinate2=f,e}return __extends(f,u),f.VertexPositionNormalTexture2_cctor=function(){var n=[new i(0,t.Vector3),new i(12,t.Vector3),new i(24,t.Vector2),new i(32,t.Vector2)],u=new r(n);f.VertexDeclaration=u},Object.defineProperty(f.prototype,"VertexDeclaration",{get:function(){return f.VertexDeclaration},enumerable:!1,configurable:!0}),f.prototype.clone=function(){return new f(this.position,this.normal,this.textureCoordinate,this.textureCoordinate2)},f.prototype.appendData=function(n){this.appendVector3(n,this.position);this.appendVector3(n,this.normal);this.appendVector2(n,this.textureCoordinate);this.appendVector2(n,this.textureCoordinate2)},f}(u);n.VertexPositionNormalTexture2=l;e=function(u){function f(t,i){t===void 0&&(t=n.Vector3.Zero());i===void 0&&(i=n.Vector3.Zero());var r=u.call(this)||this;return r.position=t,r.normal=i,r}return __extends(f,u),f.VertexPositionNormal_cctor=function(){var n=[new i(0,t.Vector3),new i(12,t.Vector3)],u=new r(n);f.VertexDeclaration=u},Object.defineProperty(f.prototype,"VertexDeclaration",{get:function(){return f.VertexDeclaration},enumerable:!1,configurable:!0}),f.prototype.clone=function(){return new f(this.position,this.normal)},f.prototype.appendData=function(n){this.appendVector3(n,this.position);this.appendVector3(n,this.normal)},f}(u);n.VertexPositionNormal=e;a=function(u){function f(t,i,r,f){t===void 0&&(t=n.Vector3.Zero());i===void 0&&(i=new n.Color);r===void 0&&(r=n.Vector4.Zero());f===void 0&&(f=n.Vector4.Zero());var e=u.call(this)||this;return e.position=t,e.color=i,e.options=r,e.cellInfo=f,e}return __extends(f,u),f.SpriteVertex_cctor=function(){var n=[new i(0,t.Vector3),new i(12,t.Color),new i(16,t.Vector4),new i(32,t.Vector4)],u=new r(n);f.VertexDeclaration=u},Object.defineProperty(f.prototype,"VertexDeclaration",{get:function(){return f.VertexDeclaration},enumerable:!1,configurable:!0}),f.prototype.clone=function(){return new f(this.position,this.color,this.options,this.cellInfo)},f.prototype.appendData=function(n){this.appendVector3(n,this.position);this.appendColor(n,this.color);this.appendVector4(n,this.options);this.appendVector4(n,this.cellInfo)},f}(u);n.SpriteVertex=a;v=function(u){function f(t,i,r){t===void 0&&(t=n.Vector3.Zero());i===void 0&&(i=n.Vector2.Zero());r===void 0&&(r=n.Vector2.Zero());var f=u.call(this)||this;return f.position=t,f.uvParam=i,f.imageSize=r,f}return __extends(f,u),f.PortraitVertex_cctor=function(){var n=[new i(0,t.Vector3),new i(12,t.Vector2),new i(20,t.Vector2)],u=new r(n);f.VertexDeclaration=u},Object.defineProperty(f.prototype,"VertexDeclaration",{get:function(){return f.VertexDeclaration},enumerable:!1,configurable:!0}),f.prototype.clone=function(){return new f(this.position,this.uvParam,this.imageSize)},f.prototype.appendData=function(n){this.appendVector3(n,this.position);this.appendVector2(n,this.uvParam);this.appendVector2(n,this.imageSize)},f}(u);n.PortraitVertex=v;y=function(){function t(){}return t.ToPositionNormal=function(n){var i,r,t,u;if(!n||n.length<=0)return null;for(i=n.length,r=new Array(i),t=0;t<i;t++)u=new e,u.position=n.getAt(t),r[t]=u.clone();return r},t.ToPositionTexture=function(t){var e,o,r,i,u;if(!t)return null;for(e=t.length,o=new Array(e),r=0;r<e;r++)i=t.getAt(r),u=new f,u.position=new n.Vector3(i.x,i.y,i.z),u.textureCoordinate=new n.Vector2(i.u,i.v),o[r]=u.clone();return o},t.ToPositionNormalTexture=function(n){return n.data},t}();n.VertexDataConvertHelper=y;s.VertexPositionNormalTexture_cctor();f.VertexPositionTexture_cctor();h.VertexPositionColorTexture_cctor();c.VertexPositionColor_cctor();o.VertexPosition_cctor();l.VertexPositionNormalTexture2_cctor();e.VertexPositionNormal_cctor();a.SpriteVertex_cctor();v.PortraitVertex_cctor()}(Drawsee||(Drawsee={})),function(n){var u,e,t,i,f,r,o;(function(n){n[n.Triangles=0]="Triangles";n[n.TriangleStrip=1]="TriangleStrip";n[n.Lines=2]="Lines";n[n.LineStrip=3]="LineStrip"})(u=n.ElementType||(n.ElementType={}));e=function(){function n(n,t){this.vertexs=n;this.indices=t}return n}();n.ElementBufferData=e;t=function(){function n(n,t,i){this.Lc=0;this.Id=[];this.JW=0;this.Ha=n;this.LK=this.Ha.engine;this.Lf=t;t.length>65535&&(i=!0);this.LQ=i?this.LK.createIndexBuffer(new Uint32Array(t),!1):this.LK.createIndexBuffer(new Uint16Array(t),!1);this.Lt=this.LQ.is32Bits;t&&this.setData(t)}return Object.defineProperty(n.prototype,"is32Bits",{get:function(){return this.Lt},enumerable:!1,configurable:!0}),n.prototype.getBuffer=function(){return this.LQ},Object.defineProperty(n.prototype,"length",{get:function(){return this.Lf.length},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){this.LQ&&(this.LK._releaseBuffer(this.LQ),this.LQ=null);this.Gq&&(this.LK._releaseBuffer(this.Gq),this.Gq=null)},n.prototype.setData=function(n,t){var r,i;(t===void 0&&(t=0),n&&this.LQ)&&(this.Kz(n,t),this.LK._bindIndexBufferDirect(this.LQ),r=this.LK._gl,this.Lt?(i=new Uint32Array(n),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,t*4,i),this.Lc=i.length*4):(i=new Uint16Array(n),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,t*2,i),this.Lc=i.length*2))},n.prototype._getByteSize=function(){return this.Lc},n.prototype.getLinesBuffer=function(){return this.Gq||this.Kh(),this.JE(),this.Gq},n.prototype.Kz=function(n,t){var r,u,i;if(t===void 0&&(t=0),n&&this.Lf){for((!t||t<0)&&(t=0),r=Math.min(this.Lf.length-t,n.length),u=this.Lf,i=0;i<r;i++)u[t+i]=n[i];this.JW+=n.length;this.MW()||this.Id.push(t,n.length)}},n.prototype.MW=function(){return this.JW>this.Lf.length/8},n.prototype.JE=function(){var n,t,r,i,u,f;if(!(this.JW<=0)){if(n=this.LK._gl,this.Gq)if(this.LK._bindIndexBufferDirect(this.Gq),t=void 0,this.Lt)if(this.MW())t=this.Lh(this.Lf),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,new Uint32Array(t));else for(r=this.Id,i=0;i<r.length;i+=2)u=r[i],f=r[i+1],t=this.Lh(this.Lf,u,f),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,u*8,new Uint32Array(t));else t=this.Lh(this.Lf),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(t));this.Id.length=0;this.JW=0}},n.prototype.Kh=function(){var n,t;if(!this.Gq){if(n=this.Lf,!n)return;t=this.Lh(n);this.Gq=this.Lt?this.LK.createIndexBuffer(new Uint32Array(t)):this.LK.createIndexBuffer(new Uint16Array(t))}},n.prototype.Lh=function(n,t,i){var u=[],r;for(t||(t=0),i||(i=n.length),r=t;r<t+i;r+=3)u.push(n[r],n[r+1],n[r+1],n[r+2],n[r+2],n[r]);return u},n}();n.IndexBufferWrapper=t;i=function(){function n(n,t,i){this.MY=[];this.Lc=0;this.Ha=n;this.LK=this.Ha.engine;t&&(this.JH=t,this.MY=this.LC(t));i&&this.setData(i)}return n.CreateFromBuffers=function(t,i){var r=new n(t);return r.Ku=i,r},n.prototype.dispose=function(){this.LQ&&(this.LK._releaseBuffer(this.LQ),this.LQ=null);this.Ku&&(this.Ha._releaseVertextBuffers(this.Ku),this.Ku=null)},n.prototype.bind=function(n,t){var i=this.LK._getCurrentEffect(),r;return(r=t?n.getLinesBuffer():n.getBuffer(),i)?(this.Ku?this.LK.bindBuffers(this.Ku,r,i):this.LK.bindBuffersDirectly(this.LQ,r,this.MY,this.JH.vertexByteStride,i),!0):!1},n.prototype.setData=function(n,t){var i,r;t===void 0&&(t=0);i=this.FD(n,0,-1);i&&(this.Lc=i.length*4);this.LQ?(this.LK.bindArrayBuffer(this.LQ),t<0&&(t=0),r=this.LK._gl,r.bufferSubData(r.ARRAY_BUFFER,t*4,i)):this.LQ=this.LK.createVertexBuffer(i)},n.prototype.FD=function(n,t,i){if(n)return n instanceof Float32Array?n:this.Kt(n,t,i)},n.prototype.Kt=function(n,t,i){var e=this.JH.vertexByteStride,u,r,f;for(i<0&&(i=n.length),u=[],r=0;r<i;r++)f=n[t+r],f.appendData(u);return new Float32Array(u)},n.prototype.LC=function(n){for(var i=[],r=n.getVertexElements(),t=0;t<r.length;t++)i[t]=r[t].stride;return i},n.prototype._getByteSize=function(){return this.Lc},n}();n.VertexBufferWrapper=i;f=function(){function t(t,i){i===void 0&&(i=null);this.OP=!1;this.Ll=i?i:n.Guid.Next();this.Ix=t}return Object.defineProperty(t.prototype,"id",{get:function(){return this.Ll},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"internalBuffer",{get:function(){return this.OP?null:(this.LQ||(this.LQ=this.Ix._getInternalBuffer(this.Ll)),this.LQ)},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.OP||(this.Ix._recycle(this.Ll),this.LQ=null,this.OP=!0)},t}();n.ElementBuffer=f;r=function(){function n(n,t,i,r){this.elmentType=t;this.Ll=n;this.elmentType=t;this.Mn=i;this.Nt=r;this.Lt=r.is32Bits;this.JF=t===u.Triangles||t===u.TriangleStrip}return Object.defineProperty(n.prototype,"id",{get:function(){return this.Ll},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"is32Bits",{get:function(){return this.Lt},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"indexCount",{get:function(){return this.Nt.length},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){this.Mn.dispose();this.Nt.dispose();this.Mn=null;this.Nt=null},n.prototype.bind=function(n){return this.Mn&&this.Nt?this.Mn.bind(this.Nt,n&&this.JF):!1},n.prototype.setVertexData=function(n,t){t===void 0&&(t=0);this.Mn&&this.Mn.setData(n,t)},n.prototype.setIndexData=function(n,t){t===void 0&&(t=0);this.Nt&&this.Nt.setData(n,t)},n.prototype._getByteSize=function(){return this.Mn._getByteSize()+this.Nt._getByteSize()},n}();n.InternalElementBuffer=r;o=function(){function u(t){this.Mp=new n.StringKeyDictionary;this.Ha=t}return Object.defineProperty(u.prototype,"count",{get:function(){return this.Mp.count},enumerable:!1,configurable:!0}),u.prototype.contains=function(n){return this.Mp.containsKey(n)},u.prototype._getInternalBuffer=function(n){return this.Mp.getValue(n)},u.prototype._recycle=function(n){var t=this.Mp.getValue(n);t&&(t.dispose(),this.Mp.remove(n))},u.prototype._createBuffer=function(n,u,e,o,s){if((!n||n.length<=0)&&(!u||u.length<=0))return null;var c=new i(this.Ha,e,n),l=new t(this.Ha,u,s),h=new f(this),a=new r(h.id,o,c,l);return this.Nx(a),h},u.prototype.Nx=function(n){n&&(this.Mp.containsKey(n.id)||this.Mp.add(n.id,n))},u.prototype._createElementFromBuffers=function(n,u,f,e,o){var s,h,c;return!u||!f?null:(s=this._getInternalBuffer(n),s)?s:(h=i.CreateFromBuffers(this.Ha,u),c=new t(this.Ha,f,o),s=new r(n,e,h,c),this.Nx(s),s)},u.prototype._updateBuffer=function(n,t,i,r){if(t){var u=this._getInternalBuffer(n);u&&this.Mo(u,t,i,r)}},u.prototype.Mo=function(n,t,i){t&&(t&&n.setVertexData(t),i&&n.setIndexData(i))},u}();n.ElementBufferManager=o}(Drawsee||(Drawsee={})),function(n){var t=function(){function n(n,t,i,r,u){this.mergedBuffer=n;this.buffer=t;this.no=i;this.indexStart=r;this.indexCount=u}return n.prototype.dispose=function(){this.OP||(this.mergedBuffer._onSubDispose(this),this.OP=!0)},n}(),i=function(){function n(n,t,i){this.buffer=n;this.indexStart=t;this.indexCount=i}return n.prototype.dispose=function(){this.OP||(this.buffer.dispose(),this.OP=!0)},n}(),r=function(){function r(t,i,r,u,f,e){f===void 0&&(f=n.ElementType.Triangles);e===void 0&&(e=128);this.vertexDeclaration=u;this.elmentType=f;this.allocMax=e;this.Ha=t;this.Nr=i;this.OG=r;this.LJ=this.Nr/u.vertexFloatStride;this.No=t.engine._isUintIndices();this.Nn()}return r.prototype.alloc=function(n,t){if(this.No)return this.LW(n,t);var r=this.Ha.createElement(n,t,this.vertexDeclaration,this.elmentType);return new i(r,0,r.internalBuffer.indexCount)},r.prototype.dispose=function(){},r.prototype.Nn=function(){if(this.No&&!this.LQ){var n=this.Ha,t=new Float32Array(this.Nr*this.allocMax),i=new Uint32Array(this.OG*this.allocMax);this.LQ=n.createElement(t,i,this.vertexDeclaration,this.elmentType,this.No);this.Li()}},r.prototype.Li=function(){this.OH=new Array(this.allocMax);for(var n=0;n<this.allocMax;n++)this.OH[n]=!1;this.Mf=0;this.LD=0},r.prototype.LW=function(i,r){var u,f,e;if(this.LD>=this.allocMax||!i||!r||i.length!==this.Nr||r.length!=this.OG)return null;for(u=this.Mf;u<this.allocMax;u++)if(!this.OH[u])return this.LQ.internalBuffer.setVertexData(i,u*this.Nr),f=u*this.OG,e=r.slice(0),n.TypeArrayHelper.AddIntValue(e,this.LJ*u),this.LQ.internalBuffer.setIndexData(e,f),this.OH[u]=!0,this.Mf=u+1,this.LD++,new t(this,this.LQ,u,f,r.length);return null},r.prototype._onSubDispose=function(n){if(n){var t=n.no;t<0||t>=this.allocMax||(this.OH[t]=!1,t<this.Mf&&(this.Mf=t),this.LD--)}},r}();n.MergedElementBuffer=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(t,i){this.renderContext=t;this.color=new n.Color(1,1,1,1);this.alpha=1;this._isUseDepthBuffer=!0;this.isUseLight=!0;this._lightDirection=new n.Vector3(-.5,-1,-1);this.graphics=t.graphics;this.name=i}return Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(n){this._texture=n&&n.length?this.graphics.createTextureFromUrl(n,!1):n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isReadyForDraw",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype.bindWorldOnly=function(n,t){this._effect&&this._effect.isReady()&&(this.graphics.enableEffect(this._effect),this._bindWorld(this._effect,n,t))},t.prototype.bindForRender=function(n,i){this._effect&&this._effect.isReady()&&(this.graphics.enableEffect(this._effect),this.graphics.isCulling=this.isCulling,this.graphics.engine.setDepthBuffer(this._isUseDepthBuffer),t.BindClipPlane(this._effect,n),this.bindEffectParam(this._effect,n,i))},t.prototype.onAttachGeoObject=function(){},t.prototype.bindEffectParam=function(){},t.BindClipPlane=function(t,i){if(i.clipPlane){var r=i.clipPlane;t.setFloat("IsUseClipPlane",1);t.setVector4("vClipPlane",new n.Vector4(r.normal.x,r.normal.y,r.normal.z,r.d))}else t.setFloat("IsUseClipPlane",0)},t.prototype.setAnimationValue=function(){return!1},t.prototype._bindWorld=function(t,i,r){var u=n.Matrix.IdentityReadOnly;r?t.setMatrix("World",r):t.setMatrix("World",n.Matrix.Identity());t.setMatrix("ViewProjection",i.viewProjectionMatrix)},t.prototype.bindTexture=function(n,t){this.graphics.bindTexture(n,t)},t.prototype.dispose=function(){this._effect=null},t}(),i,r;n.MaterialRoot=t;i=function(t){function i(i,r){r===void 0&&(r="");var u=t.call(this,i,r)||this;return u.uvOffset=n.Vector2.Zero(),u.uvScaling=new n.Vector2(1,1),u.ambientLightColor=new n.Color(.2,.2,.2,1),u.isFogEnabled=!1,u.isVertexColorEnabled=!1,u.Mj=u.graphics.createEffect("Basic",{attributes:["Position","Normal","TextureCoords"],uniformsNames:["World","View","Projection","ViewProjection","CameraPos","IsUseLight","LightDirection","AmbientLightBrightness","IsUseAlphaTest","IsTextureEnabled","Alpha","Color","IsFogEnabled","FogStart","FogEnd","FogColor","uvParams","IsUseClipPlane","vClipPlane"],samplers:["TextureSampler"]}),u.Ld=u.graphics.createEffect("BasicVertexColor",{attributes:["Position","VertexColor"],uniformsNames:["World","View","Projection","ViewProjection","Alpha","Color","IsUseClipPlane","vClipPlane"],samplers:[]}),u.Ne(),u}return __extends(i,t),Object.defineProperty(i.prototype,"isReadyForDraw",{get:function(){return this.Mj&&this.Mj.isReady()},enumerable:!1,configurable:!0}),i.prototype.bindForRender=function(n,i){this.Ne();t.prototype.bindForRender.call(this,n,i)},i.prototype.Ne=function(){this._effect=this.isVertexColorEnabled?this.Ld:this.Mj},i.prototype.bindEffectParam=function(t,i,r){var e,u,f,o,s;this._bindWorld(t,i,r);e=this.alpha*this.color.a;u=!1;this.texture?(f=this.texture,o=void 0,o=f.url!==undefined?f.texture:f,u=!0,this.bindTexture(0,this._texture),t.setVector4("uvParams",new n.Vector4(this.uvOffset.x,this.uvOffset.y,this.uvScaling.x,this.uvScaling.y))):this.bindTexture(0,null);t.setColor4("Color",n.VectorHelper.ToColor3(this.color),1);t.setFloat("Alpha",e);t.setBool("IsTextureEnabled",u);s=i.eye;t.setVector3("CameraPos",new n.Vector3(0,0,0));t.setBool("IsUseLight",this.isUseLight);this.isUseLight&&(t.setFloat("AmbientLightBrightness",.3),t.setVector3("LightDirection",this._lightDirection));t.setBool("IsFogEnabled",this.isFogEnabled);this.isFogEnabled&&(t.setFloat("FogStart",this.NE),t.setFloat("FogEnd",this.MU),this.ON&&t.setColor3("FogColor",n.VectorHelper.ToColor3(this.ON)));e<1||u?this.graphics.setBlendingMode(n.BlendingMode.Transparent):this.graphics.setBlendingMode(n.BlendingMode.Opaque)},i.prototype.setMaterailObjectDefaults=function(){this.isVertexColorEnabled=!1},i.prototype.setColorVertexMaterailObjectDefaults=function(){this.isVertexColorEnabled=!0},i.prototype.setFogParam=function(n,t,i){this.isFogEnabled=!0;this.NE=Math.min(Math.abs(n),Math.abs(t));this.MU=Math.max(Math.abs(n),Math.abs(t));this.ON=i},i}(t);n.BasicMaterial=i;r=function(t){function i(n,i){i===void 0&&(i="");var r=t.call(this,n,i)||this;return r._effect=r.graphics.createEffect("Color",{attributes:["Position"],uniformsNames:["World","ViewProjection","Color","IsUseClipPlane","vClipPlane"]}),r}return __extends(i,t),i.prototype.bindEffectParam=function(t,i,r){this._bindWorld(t,i,r);this._effect.setColor4("Color",n.VectorHelper.ToColor3(this.color),this.color.a)},i}(t);n.ColorMaterial=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i,r){r===void 0&&(r=1024);var u=t.call(this,i,"")||this;return u.isUseTerrain=!0,u.layers=[],u.isUseRefraction=!0,u._isUseReflection=!0,u.onBeforeRenderReflection=new n.Observable,u.onAfterRenderReflection=new n.Observable,u.onBeforeRenderRefraction=new n.Observable,u.onAfterRenderRefraction=new n.Observable,u.windForce=.5,u.windDirection=new n.Vector2(0,1),u.waveLength=.1,u.waterColor=new n.Color(.1,.1,.6,.2),u._bumpHeight=.2,u.Ly=0,u._effect=u.graphics.createEffect("Water",{attributes:["position","normal","uv"],uniformsNames:["World","View","Projection","ViewProjection","isUseRefraction","vEyePosition","alpha","upVector","bumpHeight","time","waterColor","worldReflectionViewProjection","windDirection","waveLength","windForce","windBaseDistance",],samplers:["reflectionSampler","refractionSampler","normalSampler"]}),u.LO(),u.Oq(u.graphics,i.camera.worldCamera,r),u}return __extends(i,t),i.prototype.bindEffectParam=function(t,i,r){var l,f,u,a,e,o,s,h,c;this._bindWorld(t,i,r);l=this.graphics;this.PK||(this.PK=this.bumpTexture&&this.bumpTexture.length?l.createTextureFromUrl(this.bumpTexture,!1):this.bumpTexture);this.PK&&this.PK.isReady&&t._bindTexture("normalSampler",this.PK.internalTexture);f=n.Matrix.Identity();u=n.Vector3.Up();this.Eu&&(f=r,a=this.Eu.renderContext,a.isEarthCoord?(u=this.Eu.positionWorld.clone(),u.normalize()):u=n.Vector3.UpReadOnly);this.PJ&&(e=f.multiply(this.PJ.multiply(i.projectionMatrix)));o=i.eye.clone();o.subtractInPlace(i.center);t.setVector3("vEyePosition",o);t.setVector3("upVector",u);t.setFloat("alpha",this.alpha);s=null;h=null;this._isUseReflection&&this.QK.texture&&(s=this.QK.texture.internalTexture);this.isUseRefraction&&this.PE.texture&&(h=this.PE.texture.internalTexture);t.setBool("isUseRefraction",this.isUseRefraction);t._bindTexture("reflectionSampler",s);t._bindTexture("refractionSampler",h);c=this.graphics.getDeltaTime()*.0001;this.Ly+=c*this.windForce;e&&t.setMatrix("worldReflectionViewProjection",e);t.setVector2("windDirection",this.windDirection);t.setFloat("waveLength",this.waveLength);t.setFloat("time",c);t.setFloat("windBaseDistance",this.Ly);t.setFloat("windForce",this.windForce);t.setFloat("bumpHeight",this._bumpHeight);t.setColor4("waterColor",this.waterColor,this.waterColor.a);this.alpha<1?this.graphics.setBlendingMode(n.BlendingMode.Transparent):this.graphics.setBlendingMode(n.BlendingMode.Opaque)},i.prototype.onAttachGeoObject=function(n){n&&this.Oc(n)},i.prototype.Oc=function(t){t&&!this.Eu&&(this.Eu=t,t.layer.isAnimation=!0,this.OY=new n.RectClipRegion(t.bounds.toRect()))},Object.defineProperty(i.prototype,"refractionTexture",{get:function(){return this.PE},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"reflectionTexture",{get:function(){return this.QK},enumerable:!1,configurable:!0}),i.prototype.LO=function(){var n=this;this.Nu=function(){if(n.Eu){var t=n.Eu.layer.earthViewer,i=t.isTerrainVisible;n.isUseLayer&&t.layers._setFilterLayers(n.layers);t.isTerrainVisible=n.isUseTerrain;n.Eu.layer.earthViewer.drawContents();t.layers._clearFilterLayers();t.isTerrainVisible=i}}},i.prototype.Oy=function(){return this.Eu?n.Layer3Collection._IsLayerVisible(this.Eu.layer)&&this.Eu.checkObjectVisible():!1},i.prototype.PV=function(){var t=n.Vector3.Up();return this.Eu&&(this.Eu.renderContext.isEarthCoord&&(t=this.Eu.positionWorld.clone(),t.normalize()),this.Eu.bounds.center.y>this.Eu.renderContext.camera.eye.y&&(t=t.negate())),t},i.prototype.PT=function(){var t=n.Vector3.Zero(),i;return this.Eu&&(i=this.renderContext,t=i.coordSystem.earthToWorld(this.Eu.bounds.center),t=t.subtract(i.camera.worldCenter)),t},i.prototype.Oq=function(t,i,r){var u=this,f,e,o,s,h;this.QK=new n.RenderTexture(name+"_reflection",t,r);this.PE=new n.RenderTexture(name+"_refraction",t,r);s=.01;this.QK.checkVisible=function(){return u.Oy()&&u._isUseReflection};this.QK.renderFunc=this.Nu;this.QK.onBeforeRender=function(){if(u._isUseReflection){u.Eu&&(f=u.Eu.layer.isVisible,u.Eu.layer.isVisible=!1);var r=u.PV(),t=u.PT();e=i.clipPlane;i.clipPlane=n.Plane.FromPositionAndNormal(new n.Vector3(t.x,t.y-s,t.z),r.negate());o=u.graphics._includeRegion;u.graphics._includeRegion=u.OY;i.enableMirrorMode();h=u.graphics.engine.cullBackFaces;u.graphics.engine.cullBackFaces=!1;u.onBeforeRenderReflection.hasObservers()&&u.onBeforeRenderReflection.notifyObservers()}};this.QK.onAfterRender=function(){u._isUseReflection&&(u.Eu&&(u.Eu.layer.isVisible=f),i.clipPlane=e,u.graphics._includeRegion=o,i.mirroredViewMatrix&&(u.PJ=i.mirroredViewMatrix.clone()),i.disableMirrorMode(),u.graphics.engine.cullBackFaces=h,u.onAfterRenderReflection.hasObservers()&&u.onAfterRenderReflection.notifyObservers())};this.PE.checkVisible=function(){return u.Oy()&&u.isUseRefraction&&u.alpha>=1};this.PE.renderFunc=this.Nu;this.PE.onBeforeRender=function(){if(u.isUseRefraction){u.Eu&&(f=u.Eu.layer.isVisible,u.Eu.layer.isVisible=!1);var r=u.PV(),t=u.PT();e=i.clipPlane;i.clipPlane=n.Plane.FromPositionAndNormal(new n.Vector3(t.x,t.y+s,t.z),r);o=u.graphics._includeRegion;u.graphics._includeRegion=u.OY;u.onBeforeRenderRefraction.hasObservers()&&u.onBeforeRenderRefraction.notifyObservers()}};this.PE.onAfterRender=function(){u.isUseRefraction&&(u.Eu&&(u.Eu.layer.isVisible=f),i.clipPlane=e,u.graphics._includeRegion=o,u.onAfterRenderRefraction.hasObservers()&&u.onAfterRenderRefraction.notifyObservers())}},i}(n.MaterialRoot);n.WaterMaterial=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var i=function(t){function i(i){var r=t.call(this)||this;return r.url=null,r._graphics=null,r._internalTexture=null,r._isDisposed=!1,r._size=new n.Size(0,0),r._graphics=i,r.url="",r}return __extends(i,t),Object.defineProperty(i.prototype,"isReady",{get:function(){var n=this.getInternalTexture();return n&&n.isReady},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"internalTexture",{get:function(){return this.getInternalTexture()},enumerable:!1,configurable:!0}),i.prototype.getInternalTexture=function(){return this._internalTexture},i.prototype.dispose=function(){this._isDisposed||(this._internalTexture&&this._graphics&&!this._isSharedTexture&&this._graphics._deleteInternalTexture(this._internalTexture),this._internalTexture=null,this._isDisposed=!0)},i}(n.TObject),u,t,r,f,e,o;n.TextureRefBase=i;u=function(t){function i(i,r,u){u===void 0&&(u=!1);var f=t.call(this,i)||this;return f._internalTexture=r,f._isSharedTexture=u,f._internalTexture&&(f._size=new n.Size(r.width,r.height)),f}return __extends(i,t),i}(i);n.DirectTexture=u;t=function(t){function i(i,r,u,f){var e=t.call(this,i)||this;return e.isUseMipmap=!0,e._tag=f,e._isWrap=u,r&&(e._size=new n.Size(r.width,r.height),e.createTextureImmediate(r)),e}return __extends(i,t),i.prototype.prepareTexture=function(){},i.prototype.OI=function(n){if(!n)return undefined;if(this._scaleRatio){var t=Math.max(n.width,n.height);if(!this._minStartSize||t>this._minStartSize)return t*this._scaleRatio}return undefined},i.prototype.createTextureImmediate=function(n){if(!n||this._internalTexture)return!1;var t=this.OI(n);return this._internalTexture=this._graphics._createInternalTexture(n,this._isWrap,this._tag,this.isUseMipmap,t),!0},i.PR=0,i}(i);n.ImageTexture=t;r=function(t){function i(n,i,r,u){var f=t.call(this,n,null,r,u)||this;return f.BN=!1,f._url=i,f.prepareTexture(),f}return __extends(i,t),i.prototype.prepareTexture=function(){var t=this;this._url&&!this._internalTexture&&(this.BN||(this.DG||(this.DG=new n.PromiseDelegate(function(){n.AsyncRenderContext.LoadData(n.AsyncDataLoadType.Image,t._url,t._tag).then(function(i){if(t.DG.onThen(),i)if(i.isBadUrl)t.BN=!0;else if(i.data){var r=i.data;t.createTextureImmediate(r);t._size=new n.Size(r.width,r.height)}})})),this.DG.tryInvoke()))},i}(t);n.UrlTexture=r;f=function(n){function t(t,i,r,u){var f=n.call(this,t,i,r,u)||this;return f.prepareTexture(),f}return __extends(t,n),t.prototype.getInternalTexture=function(){return this._internalTexture||this.prepareTexture(),this._internalTexture},t}(r);n.AutoloadUrlTexture=f;e=function(t){function i(n,i,r,u,f){f===void 0&&(f=!0);var e=t.call(this,n,null,r,u)||this;return e.Gz=i,f&&e.loadImage(),e}return __extends(i,t),i.prototype.getInternalTexture=function(){return this._internalTexture},i.prototype.Oj=function(t){if(t[0]===82&&t[1]===73&&t[2]===70&&t[3]===70){var i=void 0,r=void 0;if(t[15]===88)i=t[24]&255|(t[25]&255)<<8|(t[26]&255)<<17,r=t[27]&255|(t[28]&255)<<8|(t[29]&255)<<17;else if(t[15]===32)i=(t[27]&255)<<8|t[26]&255,r=(t[29]&255)<<8|t[28]&255;else return null;return i>8192||r>8192?null:new n.Size(i,r)}return null},i.prototype.loadImage=function(){var r=this,i,t,u,f,e;this.Gz&&(i={},this._minStartSize&&this._scaleRatio&&(t=this.Oj(this.Gz),t&&(t.width>this._minStartSize||t.height>this._minStartSize)&&(u=t.width*this._scaleRatio,f=t.height*this._scaleRatio,i={resizeWidth:u,resizeHeight:f},this._minStartSize=undefined,this._scaleRatio=undefined)),e=new Blob([this.Gz]),this.Gz=null,createImageBitmap(e,i).then(function(t){t&&(r.createTextureImmediate(t),r._size=new n.Size(t.width,t.height))}))},i}(t);n.BlobTexture=e;o=function(n){function t(t,i,r,u,f){var e=n.call(this,r,null,u,f)||this;return t&&(e.DZ=t,e.OO=i),e}return __extends(t,n),t.prototype.prepareTexture=function(){if(this._internalTexture||!this.DZ)return!1;var t=this.DZ.getTextureImage(this.OO);return n.prototype.createTextureImmediate.call(this,t)},t}(t);n._TileImageTexture=o}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(t,i,r,u){u===void 0&&(u=!1);this._isGenerateMipMaps=!1;this.PG=0;this.Po=null;this._graphics=i;this.name=t;this.PG=r;this._isGenerateMipMaps=u;this.Po=i.engine.createRenderTargetTexture(r,!1);this._textureRef=new n.DirectTexture(i,this.Po);i._registerRenderTexture(this)}return Object.defineProperty(t.prototype,"texture",{get:function(){return this._textureRef},enumerable:!1,configurable:!0}),t.prototype.isReady=function(){return this.texture&&this.texture.isReady},t.prototype.getRenderSize=function(){return this.PG},t.prototype.QS=function(n){for(var t,r=this._graphics.engine,i=0;i<r.scenes.length;i++)t=r.scenes[i],t._isDsTextureRendering=n,t._isNeedRestoreFrameBuffer=!n,t.renderTargetsEnabled=!n},t.prototype.render=function(){if(this.renderFunc){var n=!0;this.checkVisible&&(n=this.checkVisible());n&&(this.QS(!0),this.onBeforeRender&&(this.onBeforeRender(),this.QF()),this.renderFunc(),this.Oe(),this.onAfterRender&&this.onAfterRender(),this.QS(!1))}},t.prototype.QF=function(){this.Po&&(this._graphics.engine.bindFramebuffer(this.Po),this._graphics._isRenderToTexture=!0)},t.prototype.Oe=function(){this._graphics.engine.restoreDefaultFramebuffer();this._graphics._isRenderToTexture=!1},t.prototype.dispose=function(){this._graphics&&(this._graphics._removeRenderTexture(this),this._graphics=null);this.Po&&(this.Po.dispose(),this.Po=null);this._textureRef=null;this.onBeforeRender=null;this.onAfterRender=null;this.renderFunc=null},t}();n.RenderTexture=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var s=function(){function i(){}return i.prototype.createFontBitmap=function(i,r){var b=t.FontPixelSize,k=512,d=new n.WriteableBitmap(k,k),g=new n.CanvasGraphics(d.canvas),nt=new n.SolidColorBrush(n.Color.White),c=b-4,l=new Array(1),a=b,h,y,p,o,s,v,w,e,u,f;if(r===0)for(h=0;h<128;h++)v=n.SystemHelper.ToInt(h),l[0]=n.EncodingHelper.Gb2Unicode(v),e=n.TString.FromChars(l),!e||(u=new n.RefValue(0),f=new n.RefValue(0),i.extractBlockCoord(0,h,u,f),u.value=u.value*a+1,f.value=f.value*a+1,g.drawTextFont3d(e,new n.Vector2(u.value,f.value+c),nt.color,c));else for(y=new n.RefValue(0),p=new n.RefValue(0),i.getBlockBase(r,y,p),o=y.value;o<p.value;o=o+1)for(s=160;s<255;s=s+1)v=n.SystemHelper.ToInt(o<<8|s),w=n.EncodingHelper.Gb2Unicode(v),w!==0&&(l[0]=w,e=n.TString.FromChars(l),!e||(u=new n.RefValue(0),f=new n.RefValue(0),i.extractBlockCoord(o,s,u,f),u.value=u.value*a+1,f.value=f.value*a+1,g.drawTextFont3d(e,new n.Vector2(u.value,f.value+c),nt.color,c)));return d},i}(),t=function(){function t(t){this.NV=n.ArrayHelper.CreateDataArray(16);this.LF=!1;this.Nl=new Array(65536);this.OV=[];this.Ha=t;for(var i=0;i<this.Nl.length;i++)this.Nl[i]=null;this.LF=!1}return t.prototype.dispose=function(){this.OL(this.NV)},t.prototype.OL=function(n){for(var t=0;t<n.length;t++)n[t]=null},t.prototype.getBlockIndex=function(t){return t===0?0:n.SystemHelper.ToInt((t-161)/6)+1},t.prototype.getBlockBase=function(n,t,i){n=n-1;t.value=161+n*6;i.value=161+(n+1)*6},t.prototype.extractBlockCoord=function(t,i,r,u){var f=0,e;t===0?f=i:(e=this.getBlockIndex(t),f=95*(t-161-6*(e-1))+(i-160));u.value=n.SystemHelper.ToInt(f/25);r.value=n.SystemHelper.ToInt(f%25)},t.prototype.prepareFont=function(){var n,t;if(!this.LF)if(this.OV.length>0)n=this.OV[0],this.OV.splice(0,1),this.NV[n]||(this.NV[n]=this.Nk(!0,n));else{for(t=0;t<16;t++)if(!this.NV[t]){this.LF=!1;return}this.LF=!0}},t.prototype.Nk=function(n,t){var r=new s,i=r.createFontBitmap(this,t);if(i)return this.Ha.createTextureFromBitmap(i)},t.prototype.getCharTexture=function(t,i,r){var u=new n.RefValue(0),f=new n.RefValue(0);return this.Mq(t,u,f),this.Md(u.value,f.value,i,r),this.MD(u.value)},t.prototype.MD=function(n){var i,t=this.getBlockIndex(n);return t<0||t>=16?i:(i=this.NV[t],i||this.OV.indexOf(t)<0&&this.OV.push(t),i)},t.prototype.Md=function(i,r,u,f){var e=new n.RefValue(0),o=new n.RefValue(0);this.extractBlockCoord(i,r,e,o);u.value=e.value*t.FontPixelSize/512;f.value=o.value*t.FontPixelSize/512},t.prototype.Mq=function(t,i,r){var u=n.EncodingHelper.Unicode2Gb(t);i.value=u>>8;r.value=u&255},t.prototype.prepareTextTextureInfo=function(t){for(var u,f=[],r=0;r<t.length;r++){var e=t.charCodeAt(r),o=new n.RefValue(0),i=new n.RefValue(0);if(this.Mq(e,o,i),o.value!==0||i.value>32&&i.value<128&&i.value!==34){if(u=this.Jd(e,.8,.037109375),!u)return[];f.push(u)}}return f},t.prototype.Jd=function(t,i,r){var u=this.Nl[t],e;if(!u){var o=new n.RefValue(0),f=new n.RefValue(0),s=this.getCharTexture(t,o,f);if(!s)return null;e=.04;f.value=f.value+r*e*4;r=r*(1-e);u=new h(t,s,o.value,f.value);this.Nl[t]=u}return u},t.ChineseBase=161,t.FontBlockCount=16,t.FontPixelSize=20,t.BlockSize=512,t.CountPerLine=25,t.UvStep=.037109375,t}(),h=function(){function n(n,t,i,r){n===void 0&&(n=0);t===void 0&&(t=null);i===void 0&&(i=0);r===void 0&&(r=0);this.char=n;this.texture=t;this.u=i;this.v=r}return n}(),f=function(){function t(t,i,r,u){t===void 0&&(t=n.Vector3.Zero());i===void 0&&(i="");r===void 0&&(r=n.Color.Black);u===void 0&&(u=n.Vector2.Zero());this.position=t;this.text=i;this.color=r;this.screenOffset=u}return t.prototype.copyFrom=function(n,t,i,r){this.position.copyFrom(n);this.text=t;this.color.copyFrom(i);this.screenOffset.copyFrom(r)},t.Reset=function(){t.NH=0},t.AllocNew=function(){var n,i;if(t.NH>=t.NP.length)for(n=0;n<128;n++)t.NP.push(new t);return i=t.NP[t.NH],t.NH++,i},t.NH=0,t.NP=[],t}(),e=function(){function t(t,i,r,u,f){t===void 0&&(t=n.Vector3.Zero());i===void 0&&(i=n.Color.Black);r===void 0&&(r=null);u===void 0&&(u=0);f===void 0&&(f=n.Vector2.Zero());this.position=t;this.color=i;this.textureInfo=r;this.positionIndex=u;this.screenOffset=f}return t.prototype.copyFrom=function(n,t,i,r,u){this.position.copyFrom(n);this.color.copyFrom(t);this.textureInfo=i;this.positionIndex=r;this.screenOffset.copyFrom(u)},t.Reset=function(){t.NH=0},t.AllocNew=function(){var n,i;if(t.NH>=t.NP.length)for(n=0;n<128;n++)t.NP.push(new t);return i=t.NP[t.NH],t.NH++,i},t.NH=0,t.NP=[],t}(),o=function(){function n(n,t,i,r){n===void 0&&(n=null);t===void 0&&(t=0);i===void 0&&(i=0);r===void 0&&(r=[]);this.texture=n;this.indexStart=t;this.indexCount=i;this.charUnits=r}return n.Reset=function(){n.NH=0},n.AllocNew=function(t){var r,i;if(n.NH>=n.NP.length)for(r=0;r<128;r++)n.NP.push(new n);return i=n.NP[n.NH],i.texture=t,i.charUnits=[],n.NH++,i},n.NH=0,n.NP=[],n}(),i=function(t){function i(i,r,u,f,e){i===void 0&&(i=n.Vector3.Zero());r===void 0&&(r=new n.Color);u===void 0&&(u=n.Vector3.Zero());f===void 0&&(f=n.Vector3.Zero());e===void 0&&(e=n.Vector2.Zero());var o=t.call(this)||this;return o.position=i,o.color=r,o.posParams=u,o.uvParams=f,o.pixelOffset=e,o}return __extends(i,t),i.FontVertex_cctor=function(){var t=[new n.VertexElement(0,n.VertexElementFormat.Vector3),new n.VertexElement(12,n.VertexElementFormat.Color),new n.VertexElement(16,n.VertexElementFormat.Vector3),new n.VertexElement(28,n.VertexElementFormat.Vector3),new n.VertexElement(40,n.VertexElementFormat.Vector2)],r=new n.VertexDeclaration(t);i.VertexDeclaration=r},Object.defineProperty(i.prototype,"VertexDeclaration",{get:function(){return i.VertexDeclaration},enumerable:!1,configurable:!0}),i.prototype.clone=function(){return new i(this.position,this.color,this.posParams,this.uvParams,this.pixelOffset)},i.prototype.appendData=function(n){this.appendVector3(n,this.position);this.appendColor(n,this.color);this.appendVector3(n,this.posParams);this.appendVector3(n,this.uvParams);this.appendVector2(n,this.pixelOffset)},i}(n.VertexBase),c=function(n){function t(t){return n.call(this,t,15)||this}return __extends(t,n),t.Create=function(n){return new t(new Float32Array(n*15))},t.prototype.clone=function(){return new t(new Float32Array(this._data.buffer.slice(0)))},t.prototype.setVertex=function(n,t,i,r,u,f){var e=n*this._strideSize,o=this._data;o[e++]=t.x;o[e++]=t.y;o[e++]=t.z;o[e++]=i.r;o[e++]=i.g;o[e++]=i.b;o[e++]=i.a;o[e++]=r.x;o[e++]=r.y;o[e++]=r.z;o[e++]=u.x;o[e++]=u.y;o[e++]=u.z;o[e++]=f.x;o[e++]=f.y},t}(n.FloatTypeArrayBase),l=function(){function n(n){this.Ha=n;this.NB=new t(this.Ha);this.LT=this.Ha.createEffect("Font",{attributes:["Position","Color","PosParams","UvParams","PixelOffset"],uniformsNames:["World","View","Projection","IsUseAlphaTest","ScaleRatio","CameraPos","FontSize","IsReversed","IsUseClipPlane","vClipPlane"],samplers:["TextureSampler"]})}return n.prototype.dispose=function(){},n.prototype.prepareDrawingData=function(){this.NB&&this.NB.prepareFont()},n.prototype.createList=function(){return new r(this.Ha,this.NB,this.LT)},n.prototype.renderOneList=function(n,t){var i=t;i.render(n)},n.prototype.getGlobalList=function(){return this.HO||(this.HO=new r(this.Ha,this.NB,this.LT)),this.HO},n.prototype.reset=function(){f.Reset();e.Reset();o.Reset()},n}(),r,u;n.FontChunkRender=l;r=function(){function n(n,t,i){this.Ha=n;this.Mg=new u(this.Ha,t,i);this.Jr=new u(this.Ha,t,i)}return n.prototype.dispose=function(){},n.prototype.clear=function(){this.Mg.clear();this.Jr.clear()},n.prototype.addTextChunk=function(n,t,i,r,u,f){r===void 0&&(r=0);u===void 0&&(u=0);f===void 0&&(f=!1);f?this.Jr.addTextChunk(n,t,i,r,u):this.Mg.addTextChunk(n,t,i,r,u)},n.prototype.render=function(n){this.Mg.render(n,!1);this.Jr.render(n,!0)},n}();u=function(){function r(n,t,i){this.Kl=[];this.Mz=[];this.KH=0;this.Ha=n;this.NB=t;this.LT=i}return r.prototype.dispose=function(){},r.prototype.clear=function(){this.KH=0;n.ArrayHelper.Clear(this.Kl);n.ArrayHelper.Clear(this.Mz)},r.prototype.addTextChunk=function(t,i,r,u,e){u===void 0&&(u=0);e===void 0&&(e=0);this.KH=this.KH+i.length;var o=f.AllocNew();o.copyFrom(t,i,r,new n.Vector2(u,e));this.Kl.push(o)},r.prototype.render=function(n,t){this.LT.isReady()&&(this.Mz.length<=0&&(this.Mz=this.Cm(this.Kl)),this.OE(n,this.Mz,t))},r.prototype.OE=function(i,r,u){var c,l,h,s;if(r.length>0){var f=this.LT,e=this.Ha,o=e.engine;for(e.enableEffect(f),e.isCulling=!1,u&&o.setDepthBuffer(!1),c=e.getNearObjectMode(),e.setNearObjectMode(!0),f.setMatrix("World",n.Matrix.IdentityReadOnly),f.setMatrix("View",i.viewMatrix),f.setMatrix("Projection",i.projectionMatrix),f.setFloat("ScaleRatio",n.Drawing3DSetting.FontScaleRatio/i.viewport.height),f.setFloat("FontSize",t.FontPixelSize),f.setVector3("CameraPos",i.eye.subtract(i.center)),n.MaterialRoot.BindClipPlane(f,i),l=i.mirroredViewMatrix?!0:!1,f.setBool("IsReversed",l),h=0;h<r.length;h++)s=r[h],e.bindTexture(0,s.texture),f.setBool("IsUseAlphaTest",!0),o.setColorWrite(!1),e.drawElements(this.Mn,s.indexStart,s.indexCount),o.setColorWrite(!0),f.setBool("IsUseAlphaTest",!1),e.setBlendingMode(n.BlendingMode.Transparent),o.setDepthWrite(!1),e.drawElements(this.Mn,s.indexStart,s.indexCount),e.setBlendingMode(n.BlendingMode.Opaque),o.setDepthWrite(!0);u&&o.setDepthBuffer(!0);e.setNearObjectMode(c)}},r.prototype.Cm=function(t){var w=[],c,s,a,h,u,v,y,k,i,r,p;if(t.length<=0)return w;for(c=[],i=0;i<t.length;i++){var l=t[i],d=this.NB.prepareTextTextureInfo(l.text),f=0;for(s=0;s<d.length;s=s+1)a=d[s],h=e.AllocNew(),h.copyFrom(l.position,l.color,a,f,l.screenOffset),c.push(h),a.char<256?(u=a.char,f=u===105||u===108?f+.5:u===109||u===77||u===119||u===87||u===64||u===36||u===37?f+1:f+.7):f=f+1}for(v=new n.Dictionary,i=0;i<c.length;i++){var h=c[i],b=h.textureInfo.texture,r=v.getValue(b);r||(r=o.AllocNew(b),v.add(b,r));r.charUnits.push(h)}for(y=[],k=v.values,i=0;i<k.length;i++)for(r=k[i],w.push(r),r.indexStart=y.length*6,r.indexCount=r.charUnits.length*6,p=0;p<r.charUnits.length;p++)y.push(r.charUnits[p]);return this.Mb(y),w},r.prototype.LX=function(n){for(var t=64;t<n;)t*=2;return t},r.prototype.MA=function(){var r,t,u;if(!this.Mn||this.Nm<this.KH){for(this.Mn&&(this.Mn.dispose(),this.Mn=null),this.Nm=this.LX(this.KH),r=[],t=0,u=0;u<this.Nm;u++)r.push(t),r.push(t+2),r.push(t+1),r.push(t),r.push(t+3),r.push(t+2),t=t+4;this.OK=c.Create(this.Nm*4);this.Mn=this.Ha.createElement(this.OK.data,r,i.VertexDeclaration,n.ElementType.Triangles)}},r.prototype.Mb=function(t){var e=t.length,u,f,r;if(e>0){for(this.MA(),u=0,f=0;f<e;f++)r=t[f],r&&(this.NS(u++,r,.01,.01),this.NS(u++,r,.99,.01),this.NS(u++,r,.99,.99),this.NS(u++,r,.01,.99));this.Ha.updateElement(this.Mn,this.OK.data,null,i.VertexDeclaration,n.ElementType.Triangles)}},r.prototype.NS=function(n,t,i,r){var o=t.position,e=t.color,s=t.textureInfo,h=t.screenOffset,u=n*15,f=this.OK.data;f[u++]=o.x;f[u++]=o.y;f[u++]=o.z;f[u++]=e.r;f[u++]=e.g;f[u++]=e.b;f[u++]=e.a;f[u++]=i;f[u++]=r;f[u++]=t.positionIndex;f[u++]=s.u;f[u++]=s.v;f[u++]=.037109375;f[u++]=h.x;f[u++]=h.y},r}();i.FontVertex_cctor()}(Drawsee||(Drawsee={})),function(n){var t=function(){function n(n,t,i,r,u,f,e){e===void 0&&(e=null);this.position=n;this.texture=t;this.width=i;this.height=r;this.offset=u;this.isIgnoreDepthBuffer=f;this.rotationMatrix=e}return n}(),i=function(){function i(n){this._chunks=[];this.Ha=n}return i.prototype.dispose=function(){this.Mn&&(this.Mn.dispose(),this.Mn=null)},i.prototype.clear=function(){n.ArrayHelper.Clear(this._chunks)},i.prototype.addPortraitChunk=function(i,r,u,f,e,o,s,h){s===void 0&&(s=!1);h===void 0&&(h=null);r&&r.internalTexture&&this._chunks.push(new t(i,r,u,f,new n.Vector2(e,o),s,h))},Object.defineProperty(i.prototype,"vertexBuffer",{get:function(){return this.Mn},enumerable:!1,configurable:!0}),i.prototype.LX=function(n){for(var t=64;t<n;)t*=2;return t},i.prototype.MA=function(){var i,t,r;if(!this.Mn||this.Nm<this._chunks.length){for(this.Mn&&(this.Mn.dispose(),this.Mn=null),this.Nm=this.LX(this._chunks.length),i=[],t=0,r=0;r<this.Nm;r++)i.push(t),i.push(t+2),i.push(t+1),i.push(t),i.push(t+3),i.push(t+2),t=t+4;this.Mn=this.Ha.createElement(new Float32Array(this.Nm*n.PortraitVertex.VertexDeclaration.vertexByteStride*4),i,n.PortraitVertex.VertexDeclaration,n.ElementType.Triangles);this.OK=[]}},i.prototype.updateVertexBuffer=function(){var u=this._chunks,f=u.length,i,r,t;if(f>0){for(this.MA(),i=0,r=0;r<f;r++)t=u[r],t&&(this.NS(i++,t,0,0),this.NS(i++,t,1,0),this.NS(i++,t,1,1),this.NS(i++,t,0,1));this.Ha.updateElement(this.Mn,this.OK,null,n.PortraitVertex.VertexDeclaration,n.ElementType.Triangles)}},i.prototype.NS=function(t,i,r,u){r===0?r=.01:r===1&&(r=.99);u===0?u=.01:u===1&&(u=.99);var f=this.OK[t];f||(f=new n.PortraitVertex,this.OK[t]=f);f.position.copyFrom(i.position);f.uvParam.set(r,u);f.imageSize.set(i.width,i.height)},i}(),r=function(){function t(n){this.Ha=n;this.NK=this.Ha.createEffect("Portrait",{attributes:["Position","UvParams","ImageSize"],uniformsNames:["World","View","Projection","IsUseAlphaTest","ScaleRatio","CameraPos","FontSize","ImageOffset","IsUseRotation","RotationMatrix","IsReversed","IsUseClipPlane","vClipPlane"],samplers:["TextureSampler"]})}return t.prototype.createList=function(){return new i(this.Ha)},t.prototype.dispose=function(){},t.prototype.renderOneList=function(t,i){var o,s,r,u,c,l,h,f,e;if(this.NK.isReady()&&(o=i,s=o._chunks,s.length>0)){for(o.updateVertexBuffer(),r=this.NK,u=this.Ha,u.enableEffect(r),u.isCulling=!1,r.setMatrix("World",n.Matrix.IdentityReadOnly),r.setMatrix("View",t.viewMatrix),r.setMatrix("Projection",t.projectionMatrix),r.setVector3("CameraPos",t.eye.subtract(t.center)),r.setFloat("ScaleRatio",.8/t.viewport.height),n.MaterialRoot.BindClipPlane(r,t),c=t.mirroredViewMatrix?!0:!1,r.setBool("IsReversed",c),l=u.getNearObjectMode(),u.setNearObjectMode(!0),h=o.vertexBuffer,f=0;f<s.length;f++)e=s[f],this.Ha.bindTexture(0,e.texture),r.setVector2("ImageOffset",e.offset),e.rotationMatrix?(r.setBool("IsUseRotation",!0),r.setMatrix("RotationMatrix",e.rotationMatrix)):r.setBool("IsUseRotation",!1),r.setBool("IsUseAlphaTest",!0),this.Ha.engine.setColorWrite(!1),this.Ha.drawElements(h,f*6,6),this.Ha.engine.setColorWrite(!0),r.setBool("IsUseAlphaTest",!1),this.Ha.setBlendingMode(n.BlendingMode.Transparent),this.Ha.engine.setDepthBuffer(!e.isIgnoreDepthBuffer),this.Ha.engine.setDepthWrite(!1),this.Ha.drawElements(h,f*6,6),this.Ha.setBlendingMode(n.BlendingMode.Opaque),this.Ha.engine.setDepthWrite(!0);u.setNearObjectMode(l)}},t.Nh=6,t.Js=4,t}();n.PortraitChunkRender=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var u=function(){function t(t,i,r,u,f,e,o,s,h,c,l,a,v){t===void 0&&(t=null);i===void 0&&(i=null);r===void 0&&(r=null);u===void 0&&(u=0);f===void 0&&(f=null);e===void 0&&(e=null);o===void 0&&(o=!1);s===void 0&&(s=!0);h===void 0&&(h=0);c===void 0&&(c=0);l===void 0&&(l=null);a===void 0&&(a=null);v===void 0&&(v=n.Drawing3DSetting.AmbientLightBrightness);this.elmentBuffer=t;this.basePoint=i;this.clipCenter=r;this.clipRadius=u;this.transformMatrix=f;this.texture=e;this.isTransparent=o;this.isWriteDepthBuffer=s;this.indexStart=h;this.indexCount=c;this.diffuseColor=l;this.highlightColor=a;this.ambientLightBrightness=v}return t.prototype.clone=function(){return new t(this.elmentBuffer,this.basePoint,this.clipCenter,this.clipRadius,this.transformMatrix,this.texture,this.isTransparent,this.isWriteDepthBuffer,this.indexStart,this.indexCount,this.diffuseColor,this.highlightColor,this.ambientLightBrightness)},t}(),t,i,r;n.SimpleTextureMeshChunk=u;t=function(t){function i(){var i=t!==null&&t.apply(this,arguments)||this;return i.lightDirection=n.Drawing3DSetting.LightDirection.clone(),i.sortBuffer=!0,i}return __extends(i,t),i}(n.RenderStateBase);n.SimpleTextureMeshRenderSetting=t;i=function(){function i(n,i){this._noDepthTextureChunks=[];this._textureChunks=[];this._transparentTextureChunks=[];this._transparentColorTextureChunks=[];this._transparentColorChunks=[];this._colorChunks=[];this.OT=[];this.Mg=n;this.name=i;this.setting=new t}return Object.defineProperty(i.prototype,"count",{get:function(){return this.OT.length},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){},i.prototype.clear=function(){n.ArrayHelper.Clear(this.OT);n.ArrayHelper.Clear(this._noDepthTextureChunks);n.ArrayHelper.Clear(this._textureChunks);n.ArrayHelper.Clear(this._transparentTextureChunks);n.ArrayHelper.Clear(this._transparentColorTextureChunks);n.ArrayHelper.Clear(this._transparentColorChunks);n.ArrayHelper.Clear(this._colorChunks);this.LS=!1},i.prototype.addChunk=function(n){n.elmentBuffer&&(n.texture||n.diffuseColor)&&this.OT.push(n)},i.prototype.addChunks=function(n){for(var t=0;t<n.length;t++)this.addChunk(n[t])},i.prototype.prepareBeforeRender=function(){var t;t=this.setting.sortBuffer?this.OT.sort(function(t,i){return n.g_compareTo(t.elmentBuffer.id,i.elmentBuffer.id)}):this.OT;this.LH(t)},i.prototype.enumChunks=function(){return n.ArrayHelper.CloneArray(this.OT)},i.prototype.LH=function(t){var u,i;if(!this.LS){for(this.LS=!0,u=0;u<t.length;u++)i=t[u],i.isWriteDepthBuffer?i.texture?i.isTransparent?r.IsTransparentColorTextureChunk(i)?this._transparentColorTextureChunks.push(i):this._transparentTextureChunks.push(i):this._textureChunks.push(i):i.diffuseColor&&(n.Color.IsTransparentFloatAlpha(i.diffuseColor.a)?this._transparentColorChunks.push(i):this._colorChunks.push(i)):this._noDepthTextureChunks.push(i);this._colorChunks.length>0&&(this._colorChunks=this._colorChunks.sort(function(t,i){var r=t.diffuseColor.toColorString(),u=i.diffuseColor.toColorString();return n.g_compareTo(r,u)}))}},i}();n.SimpleTextureMeshChunkList=i;r=function(){function t(t,i){this.LZ=new n.Vector3;this.MX=[];this.OS=n.Matrix.Identity();this.Kq=-1;this.NU=n.Vector4.Zero();this.Ha=t;this.ME=new n.DefaultSimpleMeshChunkMaterial(t,i)}return t.prototype.createList=function(){var n=new i(this,"list"+this.MX.length);return this.MX.push(n),n},t.prototype.releaseList=function(t){n.ArrayHelper.RemoveByItem(this.MX,t)},t.prototype.La=function(){this.OS=n.Matrix.Identity();this.Ng=null;this.Gu=null},t.IsTransparentColorTextureChunk=function(t){return t.diffuseColor&&n.Color.IsTransparentFloatAlpha(t.diffuseColor.a)&&t.diffuseColor.a>0},t.prototype.MS=function(t,i){var r=this.Ha,u=r.engine;u.setDepthWrite(i.setting.isEnableDepthWrite);u.setColorWrite(i.setting.isEnableColorWrite);u.setDepthBuffer(i.setting.isEnableDepthBuffer);r.isCulling=i.setting.isCulling;i.setting.alpha<1?(r.setBlendingMode(n.BlendingMode.Transparent),u.setDepthWrite(!1)):r.setBlendingMode(n.BlendingMode.Opaque);this.Ns.setupDefault(t,i)},t.prototype.NW=function(t,i,r){var u=i.basePoint.subtract(r),o=t.eye.subtract(r);this.LZ=i.basePoint.clone();var f=n.Matrix.Translation(u.x,u.y,u.z),s=t.viewMatrix,e=n.Matrix.Identity();e=i.transformMatrix?i.transformMatrix.multiply(f):f.clone();this.Ns.bindWorldOnly(e)},t.prototype.Mt=function(n){if(n.highlightColor){if(!n.highlightColor.equals(this.Gu)){var t=n.highlightColor.toVector4();this.Ns.bindHighlightColor(t);this.Gu=n.highlightColor.clone()}}else this.Gu&&(this.Ns.bindHighlightColor(null),this.Gu=null);n.ambientLightBrightness!==this.Kq&&(this.Ns.bindAmbientBrightness(n.ambientLightBrightness),this.Kq=n.ambientLightBrightness)},t.prototype.Nz=function(n,t){var i,r,u;n.isSphereInFrustum(t.clipCenter,t.clipRadius)&&(this.Ha._includeRegion&&t._earthRange&&!this.Ha._includeRegion.inRegion(t._earthRange)||(i=t.elmentBuffer.internalBuffer,i&&(r=0,u=0,t.indexCount>0?(r=t.indexStart,u=t.indexCount):(r=0,u=i.indexCount),this.Ha.drawInternalElements(i,r,u))))},t.prototype.renderOneList=function(t,i){var u,f,r,h,c,e,s,o;i.count<=0||(i.prepareBeforeRender(),this.Ns=i.setting.customChunkMaterial?i.setting.customChunkMaterial:this.ME,u=this.Ns,u.isReady())&&(u.scene=i.setting._customScene,this.La(),i&&i.count>0&&(f=this.Ha,r=f.engine,u.enableEffect(),r.cacheStencilState(),this.MS(t,i),h=i.setting._customScene,c=i.setting.isReceiveShadow&&h&&h.lights.length>0,u.bindShadow(t,h,c),e=t.center,s=i.setting.isUseLight,i._noDepthTextureChunks.length>0&&(u.bindBasicParams(!1,!1,s),o=r.getDepthWrite(),r.setDepthWrite(!1),this.Nw(i._noDepthTextureChunks,t,e,i.setting.alpha,!1),r.setDepthWrite(o)),i._textureChunks.length>0&&(u.bindBasicParams(!1,!1,s),this.Nw(i._textureChunks,t,e,i.setting.alpha,!1)),i._colorChunks.length>0&&(this.Ng=null,u.bindBasicParams(!0,!1,s),this.Om(i._colorChunks,t,e)),i._transparentTextureChunks.length>0&&(u.bindBasicParams(!1,!0,!1),i.setting.alpha>=1&&(u.bindUseAlphaTest(!0),r.setColorWrite(!1),this.Nw(i._transparentTextureChunks,t,e,i.setting.alpha,!1)),r.setColorWrite(!0),u.bindUseAlphaTest(!1),f.setBlendingMode(n.BlendingMode.Transparent),o=r.getDepthWrite(),r.setDepthWrite(!1),this.Nw(i._transparentTextureChunks,t,e,i.setting.alpha,!1),f.setBlendingMode(n.BlendingMode.Opaque),r.setDepthWrite(o)),i._transparentColorTextureChunks.length>0&&(u.bindBasicParams(!1,!0,s),f.isCulling=!1,r.setColorWrite(!0),u.bindUseAlphaTest(!1),f.setBlendingMode(n.BlendingMode.Transparent),o=r.getDepthWrite(),r.setDepthWrite(!1),this.Nw(i._transparentColorTextureChunks,t,e,i.setting.alpha,!0),f.setBlendingMode(n.BlendingMode.Opaque),r.setDepthWrite(o)),i._transparentColorChunks.length>0&&(u.bindBasicParams(!0,!0,s),f.isCulling=!1,i.setting.alpha>=1&&(u.bindUseAlphaTest(!0),r.setColorWrite(!1),this.Om(i._transparentColorChunks,t,e)),r.setColorWrite(!0),u.bindUseAlphaTest(!1),f.setBlendingMode(n.BlendingMode.Transparent),o=r.getDepthWrite(),r.setDepthWrite(!1),this.Om(i._transparentColorChunks,t,e),f.setBlendingMode(n.BlendingMode.Opaque),r.setDepthWrite(o)),r.restoreStencilState()))},t.prototype.Nw=function(i,r,u,f,e){var s,h,o,c,l,a;for(e===void 0&&(e=!1),this.Ns.updateBindingParams(r),e?(s=n.ArrayHelper.CloneArray(i),s.reverse()):s=i,h=0;h<s.length;h++)o=s[h],this.Ha.bindTexture(0,o.texture),c=t.IsTransparentColorTextureChunk(o),c&&this.Ns.bindAlpha(f*o.diffuseColor.a),l=!o.basePoint.equals(this.LZ)||o.transformMatrix&&!o.transformMatrix.equals(this.OS),a=h===0,(c||a||l||o.highlightColor)&&(a||l)&&(this.NW(r,o,u),o.transformMatrix&&(this.OS=o.transformMatrix)),this.Mt(o),this.Nz(r,o)},t.prototype.Om=function(n,t,i){var u;for(this.Ns.updateBindingParams(t),u=0;u<n.length;u++){var r=n[u],e=!r.basePoint.equals(this.LZ)||r.transformMatrix&&!r.transformMatrix.equals(this.OS),o=!this.Ng||r.diffuseColor&&!r.diffuseColor.equals(this.Ng),f=u===0;(f||e||o)&&((f||e)&&(this.NW(t,r,i),r.transformMatrix&&(this.OS=r.transformMatrix)),(f||o)&&(this.Ng?this.Ng.copyFrom(r.diffuseColor):this.Ng=r.diffuseColor.clone(),r.diffuseColor.toVector4ToRef(this.NU),this.Ns.bindColor(this.NU)));this.Mt(r);this.Nz(t,r)}},t}();n.SimpleTextureMeshChunkRender=r}(Drawsee||(Drawsee={})),function(n){var i=function(){function t(n,t){this.Ha=n;var i=n.createEffect(t,{attributes:["Position","Normal","TextureCoords"],uniformsNames:["World","View","Projection","ViewProjection","CameraPos","IsUseLight","LightDirection","AmbientLightBrightness","IsUseAlphaTest","IsTextureEnabled","Alpha","Color","IsFogEnabled","FogStart","FogEnd","FogColor","IsColorOnly","IsUseHighlight","HighlightColor","IsReceiveShadow","vDiffuseColor","vIntensity","lightMatrix_0","shadowsInfo_0","depthValues_0","IsUseOverlayTexture","OverlayTextureMatrix","IsErrorCheck","IsUseClipPlane","vClipPlane"],samplers:["TextureSampler","shadowSampler_0","OverlayTexture"]});this.Mi=i}return t.prototype.isReady=function(){return this.Mi&&this.Mi.isReady()},t.prototype.enableEffect=function(){this.Ha.engine.enableEffect(this.Mi)},t.prototype.setupDefault=function(t,i){var r;this.Mi.setBool("IsUseAlphaTest",!1);this.Mi.setBool("IsUseHighlight",!1);this.Mi.setMatrix("ViewProjection",t.viewProjectionMatrix);this.Mi.setBool("IsUseLight",i.setting.isUseLight);this.Mi.setBool("IsErrorCheck",i.setting.isErrorCheck);this.Mi.setFloat("Alpha",i.setting.alpha);var u=i.setting.lightDirection,f=new n.Vector4(1,1,1,1),e=1;this.scene&&this.scene.lights.length>0&&(r=this.scene.lights[0],f=new n.Vector4(r.diffuse.r,r.diffuse.g,r.diffuse.b,1),e=r.intensity,u=r.direction);this.Mi.setVector4("vDiffuseColor",f);this.Mi.setFloat("vIntensity",e);this.Mi.setVector3("LightDirection",u);i.setting.overlayTexture?(this.Mi.setBool("IsUseOverlayTexture",!0),this.Mi.setMatrix("OverlayTextureMatrix",i.setting.overlayTextureMatrix),this.Mi.setTexture("OverlayTexture",i.setting.overlayTexture)):this.Mi.setBool("IsUseOverlayTexture",!1);n.MaterialRoot.BindClipPlane(this.Mi,t)},t.prototype.bindWorldOnly=function(n){this.Mi.setMatrix("World",n)},t.prototype.bindColor=function(n){this.Mi.setVector4("Color",n)},t.prototype.bindAlpha=function(n){this.Mi.setFloat("Alpha",n)},t.prototype.bindTexture=function(n,t){this.Mi._bindTexture(n,t)},t.prototype.bindHighlightColor=function(n){n?(this.Mi.setBool("IsUseHighlight",!0),this.Mi.setVector4("HighlightColor",n)):this.Mi.setBool("IsUseHighlight",!1)},t.prototype.bindAmbientBrightness=function(n){this.Mi.setFloat("AmbientLightBrightness",n)},t.prototype.bindShadow=function(n,t,i){if(i){var r=t.getTransformMatrix();this.Mi.setBool("IsReceiveShadow",!0);this.Ms(t.lights[0],n,t,this.Mi)}else this.Mi.setBool("IsReceiveShadow",!1)},t.prototype.Ms=function(n,t,i,r){var f,u,e,o,s;i.shadowsEnabled&&n.shadowEnabled&&(f=i.activeCamera,f)&&(u=n.getShadowGenerator(),u)&&(e="_0",o=u.getShadowMap(),o)&&(s=u.getTransformMatrix(),r.setMatrix("lightMatrix"+e,s),r.setTexture("shadowSampler"+e,u.getShadowMapForRendering()),r.setFloat4("shadowsInfo"+e,u.getDarkness(),u.blurScale/o.getSize().width,u.depthScale,u.frustumEdgeFalloff),r.setFloat2("depthValues"+e,u.getLight().getDepthMinZ(f),u.getLight().getDepthMinZ(f)+u.getLight().getDepthMaxZ(f)))},t.prototype.bindBasicParams=function(n,t,i){n?this.Mi.setBool("IsColorOnly",!0):this.Mi.setBool("IsColorOnly",!1);this.Mi.setBool("IsUseLight",i)},t.prototype.bindUseAlphaTest=function(n){this.Mi.setBool("IsUseAlphaTest",n)},t.prototype.updateBindingParams=function(){},t}(),t;n.DefaultSimpleMeshChunkMaterial=i;t=function(){function n(n,t){this.Nb=!1;this.NF=!1;this.NY=!1;this.OA=!1;this.Ha=n;this.LK=n.engine;this.Mu=t;this.OF=new BABYLON.StandardMaterial("chunkTexture",t);var i=this.OF;i.diffuseTexture=new BABYLON.BaseTexture(t);i.diffuseTexture._texture=this.LK.emptyTexture;i.diffuseTexture.hasAlpha=!0;i.specularColor=new BABYLON.Color3(0,0,0);i.ambientColor=new BABYLON.Color3(.5,.5,.5);this.Nv=new BABYLON.StandardMaterial("chunkColor",t);this.Nv.specularColor=new BABYLON.Color3(0,0,0);this.Nv.ambientColor=new BABYLON.Color3(.5,.5,.5)}return n.prototype.Mc=function(){return this.Nb?this.Nv:this.OF},n.prototype.isReady=function(){return this.Nv.isReadyForDraw&&this.OF.isReadyForDraw},n.prototype.enableEffect=function(){var n=this.Mc().getEffect();this.Ha.enableEffect(n)},n.prototype.setupDefault=function(){},n.prototype.bindWorldOnly=function(n){this.Mc().bindOnlyWorldMatrix(n)},n.prototype.bindColor=function(n){this.Np(n)},n.prototype.bindAlpha=function(){},n.prototype.bindTexture=function(){},n.prototype.bindHighlightColor=function(){},n.prototype.bindAmbientBrightness=function(){},n.prototype.bindShadow=function(n,t,i){this.Mc().isReceiveShadow=i},n.prototype.bindBasicParams=function(n,t,i){this.Nb=n;this.NF=t;this.NY=i},n.prototype.bindUseAlphaTest=function(n){this.OA=n},n.prototype.updateBindingParams=function(n){var i=this.Mc(),t,r;i.diffuseTexture&&(i.diffuseTexture.hasAlpha=this.NF);this.OA&&(i.alphaCutOff=.95);this.NY?i.emissiveColor=new BABYLON.Color3(0,0,0):(t=1,this.Mu.lights.length>0&&(r=this.Mu.lights[0],t*=r.intensity),t=Math.min(1,t),i.emissiveColor=new BABYLON.Color3(t,t,t));this.Mc().bindForRender(n,null);this.Ha.isCulling=!1},n.prototype.Np=function(n){var i=new BABYLON.Color3(n.x,n.y,n.z),t=this.Mc();t._uniformBuffer.bindToEffect(this.Nv.getEffect(),"Material");t._uniformBuffer.updateColor4("vDiffuseColor",i,n.w);t._uniformBuffer.update()},n}();n.BabylonStandardSimpleMeshChunkMaterial=t}(Drawsee||(Drawsee={})),function(n){var r=function(){function n(n,t,i,r,u,f,e,o,s,h){h===void 0&&(h=null);this.elmentBuffer=n;this.level=t;this.basePoint=i;this.clipCenter=r;this.clipRadius=u;this.texture=f;this.isTransparent=e;this.indexStart=o;this.indexCount=s;this.overlayTextures=h}return n}(),t,i;n.TerrainChunk=r;t=function(){function t(){this.isUseTexture=!0;this.isUseAtmosphere=!1;this.isUseLight=!1;this.cameraPos=n.Vector3.Zero();this.lightDirection=n.Drawing3DSetting.LightDirection.clone();this.terrainColor=new n.Color(.5,.5,.5);this.alpha=1;this.isFogEnabled=!1;this.fogStart=0;this.fogEnd=0;this.fogColor=new n.Color;this.zIndex=0}return t}();n.TerrainRenderSetting=t;i=function(){function i(i,r){this.LZ=new n.Vector3;this.QB=[];this.Oa=[];this.Mx=[];this.OW=0;this.LB=0;this.Ha=i;this.Mi=i.createEffect(r,{attributes:["Position","Normal","TextureCoords"],uniformsNames:["World","View","Projection","ViewProjection","CameraPos","CameraPosWorld","IsUseLight","LightDirection","AmbientLightBrightness","IsUseAlphaTest","IsTextureEnabled","Alpha","Color","IsFogEnabled","FogStart","FogEnd","FogColor","OverlayTextureCount","IsUseAtmosphere","IsUseClipPlane","vClipPlane"],samplers:["TextureSampler","OverlayTexture0","OverlayTexture1","OverlayTexture2","OverlayTexture3"]});this.Mr=this.Mi;this.setting=new t}return i.prototype.clear=function(){n.ArrayHelper.Clear(this.Mx);n.ArrayHelper.Clear(this.QB);n.ArrayHelper.Clear(this.Oa)},i.prototype.addTerrainChunks=function(n){for(var t,r=[],u=[],f=[],i=0;i<n.length;i++)t=n[i],t.isNoDepth?r.push(t):t.isToClearDepth?u.push(t):f.push(t);this.QB=r;this.Oa=u;this.Mx=f},i.prototype.PS=function(t,i,r,u){var h,s;u===void 0&&(u=!1);var f=this.Mi,o=this.Ha,e=this.setting;f.setMatrix("ViewProjection",t.viewProjectionMatrix);h=t.eye.subtract(t.center);f.setVector3("CameraPos",h);f.setVector3("CameraPosWorld",t.eye);f.setBool("IsUseTexture",i);f.setBool("IsUseLight",r);f.setFloat("Alpha",e.alpha);f.setColor3("TerrainColor",n.VectorHelper.ToColor3(e.terrainColor));e.isUseAtmosphere?f.setBool("IsUseAtmosphere",!0):f.setBool("IsUseAtmosphere",!1);e.alpha<1?(o.setBlendingMode(n.BlendingMode.Transparent),o.engine.setDepthWrite(!1),o.engine.setDepthBuffer(!0)):(u?o.setBlendingMode(n.BlendingMode.Transparent):o.setBlendingMode(n.BlendingMode.Opaque),o.engine.setDepthWrite(this.PI),o.engine.setDepthBuffer(!0));f.setVector3("LightDirection",e.lightDirection);s=e.isFogEnabled&&!o.isWireFrameMode;f.setBool("IsFogEnabled",s);s&&(f.setFloat("FogStart",e.fogStart*.8),f.setFloat("FogEnd",e.fogEnd*1.2),f.setColor3("FogColor",n.VectorHelper.ToColor3(e.fogColor)));n.MaterialRoot.BindClipPlane(f,t)},i.prototype.render=function(n){var i=this.Mi,t=this.Ha;t.enableEffect(i);this.QB.length>0&&(this.PI=!1,this.Ob(n,this.QB,n.projectionMatrix));this.PI=!0;this.Oa.length>0&&(this.Ob(n,this.Oa,n.projectionMatrix),t.clear(null,!1,!0,!1));this.Ob(n,this.Mx,n.projectionMatrix)},i.prototype.Ob=function(n,t,i){var f,r,h,u;if(!(t.length<=0)){var e=[],o=[],s=[];for(f=0;f<t.length;f++)r=t[f],n.isSphereInFrustum(r.clipCenter,r.clipRadius)&&(r.isTransparent?e.push(r):r.texture?o.push(r):s.push(r));h=this.Mi;u=this.Ha;u.isCulling=!0;u.enableStencilBuffer(!0,!1);u.enableEffect(h);o.length>0&&(this.PS(n,!0,this.setting.isUseLight,!1),this.Ph(n,o,i));s.length>0&&(this.PS(n,!1,this.setting.isUseLight,!1),this.Ph(n,s,i));e.length>0&&(this.PS(n,!0,!1,!0),this.Ph(n,e,i));u.enableStencilBuffer(!1)}},i.prototype.Ph=function(n,t,i){for(var u,f=n.center,r=0;r<t.length;r++)u=t[r],this.LI(n,u,f,i,r===0)},i.prototype.LI=function(t,i,r,u,f){var h=this.Ha,e,o,a,c,s,l;if(h.bindTexture(0,i.texture),e=i.overlayTextures,e&&e.length>0)for(this.Mi.setFloat("OverlayTextureCount",e.length),o=0;o<e.length;o++)h.bindTexture(o+1,e[o]);else this.Mi.setFloat("OverlayTextureCount",0);a=!i.basePoint.equals(this.LZ);(f||a)&&(c=n.Matrix.Identity(),s=i.basePoint.subtract(r),this.LZ=i.basePoint.clone(),c=n.Matrix.Translation(s.x,s.y,s.z),this.Mi.setMatrix("World",c));l=i.elmentBuffer.internalBuffer;l&&h.drawInternalElements(l,i.indexStart,i.indexCount)},i}();n.TerrainChunkRender=i}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(n){this.Ha=n;this.Kg=n.createEffect("SkyAtmosphere",{attributes:["position"],uniformsNames:["viewProjection","cameraHeight","eyePosition"],samplers:[]})}return t.prototype.PP=function(){if(!this.Kn){var t=n.PrimitivesFactory.CreateSphere(6378137*1.025*2,128),i=n.TypeArrayHelper.ToVector3Array(t.positions),r=n.TypeArrayHelper.ToTriangleArray(t.indices,!0);this.Kn=this.Ha.createElement(i.data,r.data,n.VertexPosition.VertexDeclaration,n.ElementType.Triangles)}},t.prototype.dispose=function(){this.Kn&&(this.Kn.dispose(),this.Kn=null)},t.prototype.render=function(n){this.QA(n)},t.prototype.QA=function(t){var i,u,f,r;this.PP();i=this.Kg;this.Ha.enableEffect(i);i.setMatrix("viewProjection",t.viewProjectionMatrix);u=t.eye;i.setVector3("eyePosition",u);f=n.Vector3.Distance(u,n.Vector3.Zero());i.setFloat("cameraHeight",f);r=this.Kn.internalBuffer;r&&this.Ha.drawInternalElements(r,0,r.indexCount)},t}();n.SkyAtmosphereRender=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(t,i,r,u,f){(this.worldMatrix=n.Matrix.Identity(),this.viewMatrix=n.Matrix.Identity(),this.projectionMatrix=n.Matrix.Identity(),this._center=new n.Vector3,this.Ou=n.Vector3.Zero(),this.Op=n.Vector3.Zero(),arguments.length!==0)&&(this.viewport=t.clone(),this.worldMatrix=i.clone(),this.viewMatrix=r.clone(),this.projectionMatrix=u.clone(),this._center=f.clone())}return t.CreateFromClone=function(n){var i=new t(n.viewport,n.worldMatrix,n.viewMatrix,n.projectionMatrix,n._center);return i._isGlobalTransform=n._isGlobalTransform,i},t.prototype.worldToScreenDouble=function(t,i,r){var u=n.Vector2.Zero();return this.worldToScreenDoubleRef(t,i,r,u),u},t.prototype.worldToScreenDoubleRef=function(t,i,r,u){var f=this.Ou,e;this._isGlobalTransform?f.set(t,i,r):f.set(t-this._center.x,i-this._center.y,r-this._center.z);e=n.Vector3.Project(f,this.worldMatrix,this.viewMatrix.multiply(this.projectionMatrix),this.viewport);u.set(e.x,e.y)},t.prototype.screenToWorldDouble=function(t,i,r){var u=n.Vector3.Zero();return this.screenToWorldDoubleRef(t,i,r,u),u},t.prototype.screenToWorldDoubleRef=function(t,i,r,u){if(!this.viewport){u.setAll(0);return}var e=this.Ou,f=this.Op;e.set(t,i,r);n.Vector3.UnprojectToRef(e,this.viewport.width,this.viewport.height,this.worldMatrix,this.viewMatrix,this.projectionMatrix,f);this._isGlobalTransform?u.copyFrom(f):u.set(f.x+this._center.x,f.y+this._center.y,f.z+this._center.z)},t.prototype.screenToWorldLine=function(n,t,i){t.copyFrom(this.screenToWorldDouble(n.x,n.y,0));i.copyFrom(this.screenToWorldDouble(n.x,n.y,1))},t}(),i;n.WorldCoordSystem=t;i=function(t){function i(){var i=t!==null&&t.apply(this,arguments)||this;return i.fov=0,i.nearPlane=0,i.farPlane=0,i.aspectRatio=1,i.PH=new n.Vector3,i.Ml=new n.Vector3,i.QR=new n.Vector3,i.PW=new n.Vector3,i.mirroredCameraPosition=n.Vector3.Zero(),i.mirroredViewMatrix=n.Matrix.Identity(),i._isMirrorMode=!1,i.Ps=n.Vector3.Zero(),i}return __extends(i,t),Object.defineProperty(i.prototype,"eye",{get:function(){return this.PW.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"center",{get:function(){return this._center.clone()},enumerable:!1,configurable:!0}),i.prototype.getViewportRect=function(){return new n.Rect(0,0,this.viewport.width,this.viewport.height)},i.prototype.initViewport=function(t,i,r,u){this.fov=i;this.nearPlane=r;this.farPlane=u;this.aspectRatio=t.width/Math.max(1,t.height);this.projectionMatrix=n.Matrix.PerspectiveFovLH(i,this.aspectRatio,r,u);this.viewport=new n.Viewport(t.left,t.top,t.width,t.height)},i.prototype.updateLookAt=function(t,i,r,u,f,e){var o,s;this._isGlobalTransform=e;o=n.Matrix.Identity();this.PH=t.clone();this.Ml=i.clone();this.QR=r.clone();o=n.Matrix.LookAtLH(this.PH,this.Ml,this.QR);this._isMirrorMode?(s=n.Matrix.Reflection(this.clipPlane),this.mirroredCameraPosition=n.Vector3.TransformCoordinates(this.eye,s),this.mirroredViewMatrix=s.multiply(o),o=this.mirroredViewMatrix.clone()):(this.mirroredViewMatrix=null,this.mirroredCameraPosition=null);this.PW=u.clone();this._center=f.clone();this.viewMatrix=o;this.worldMatrix=n.Matrix.Identity();this.projectionMatrix&&(this.Px=this.viewMatrix.multiply(this.projectionMatrix));this.Le()},i.prototype.worldToScreen=function(i){var r=t.prototype.worldToScreenDouble.call(this,i.x,i.y,i.z);return new n.Vector2(r.x,r.y)},i.prototype.worldToScreenToRef=function(n,i){t.prototype.worldToScreenDoubleRef.call(this,n.x,n.y,n.z,i)},i.prototype.screenToWorld=function(n,i){return t.prototype.screenToWorldDouble.call(this,n.x,n.y,i)},i.prototype.screenToWorldToRef=function(n,i,r){t.prototype.screenToWorldDoubleRef.call(this,n.x,n.y,i,r)},i.prototype.enableMirrorMode=function(){this._isMirrorMode=!0},i.prototype.disableMirrorMode=function(){this.mirroredViewMatrix=null;this.mirroredCameraPosition=null;this._isMirrorMode=!1},Object.defineProperty(i.prototype,"viewProjectionMatrix",{get:function(){return this.Px},enumerable:!1,configurable:!0}),i.prototype.Le=function(){this.frustumPlanes?n.Frustum.GetPlanesToRef(this.Px,this.frustumPlanes):this.frustumPlanes=n.Frustum.GetPlanes(this.Px)},i.prototype.isSphereInFrustum=function(n,t){var u,r,i;if(n.subtractToRef(this._center,this.Ps),u=this.Ps,r=this.frustumPlanes,!r)return!1;for(i=0;i<6;i++)if(r[i].dotCoordinate(u)<=-t)return!1;return!0},i}(t);n.WorldCamera=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(n){function t(){var t=n.call(this)||this;return t.CLIPPLANE=!1,t.POINTSIZE=!1,t.FOG=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.rebuild(),t}return __extends(t,n),t}(BABYLON.MaterialDefines),i=function(n){function i(t,i){var r=n.call(this,t,i)||this;return r.luminance=1,r.turbidity=10,r.rayleigh=2,r.mieCoefficient=.005,r.mieDirectionalG=.8,r.distance=500,r.inclination=.49,r.azimuth=.25,r.sunPosition=new BABYLON.Vector3(0,100,0),r.useSunPosition=!1,r.Pv=BABYLON.Vector3.Zero(),r}return __extends(i,n),i.prototype.needAlphaBlending=function(){return this.alpha<1},i.prototype.needAlphaTesting=function(){return!1},i.prototype.getAlphaTestTexture=function(){return null},i.prototype.isReadyForSubMesh=function(n,i){var r,u,f,e,o,s;return this.isFrozen&&this._wasPreviouslyReady&&i.effect?!0:(i._materialDefines||(i._materialDefines=new t),r=i._materialDefines,u=this.getScene(),!this.checkReadyOnEveryCall&&i.effect&&this.OZ===u.getRenderId())?!0:(BABYLON.MaterialHelper.PrepareDefinesForMisc(n,u,!1,this.pointsCloud,this.fogEnabled,!1,r),BABYLON.MaterialHelper.PrepareDefinesForAttributes(n,r,!0,!1),r.isDirty&&(r.markAsProcessed(),u.resetCachedMaterial(),f=new BABYLON.EffectFallbacks,r.FOG&&f.addFallback(1,"FOG"),e=[BABYLON.VertexBuffer.PositionKind],r.VERTEXCOLOR&&e.push(BABYLON.VertexBuffer.ColorKind),o="sky",s=r.toString(),i.setEffect(u.getEngine().createEffect(o,e,["world","viewProjection","view","vFogInfos","vFogColor","pointSize","vClipPlane","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition"],[],s,f,this.onCompiled,this.onError),r)),!i.effect||!i.effect.isReady())?!1:(this.OZ=u.getRenderId(),this._wasPreviouslyReady=!0,!0)},i.prototype.bindForSubMesh=function(n,t,i){var r=this.getScene(),c=i._materialDefines,f,u,s,e,h,o;c&&(f=i.effect,f)&&(this._activeEffect=f,this.bindOnlyWorldMatrix(n),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),this._mustRebind(r,f)&&(r.clipPlane&&(u=r.clipPlane,this._activeEffect.setFloat4("vClipPlane",u.normal.x,u.normal.y,u.normal.z,u.d)),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize)),r.fogEnabled&&t.applyFog&&r.fogMode!==BABYLON.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),BABYLON.MaterialHelper.BindFogParameters(r,t,this._activeEffect),s=r.activeCamera,s&&(e=s.getWorldMatrix(),this.Pv.x=e.m[12],this.Pv.y=e.m[13],this.Pv.z=e.m[14],this._activeEffect.setVector3("cameraPosition",this.Pv)),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),this.useSunPosition||(h=Math.PI*(this.inclination-.5),o=2*Math.PI*(this.azimuth-.5),this.sunPosition.x=this.distance*Math.cos(o),this.sunPosition.y=this.distance*Math.sin(o)*Math.sin(h),this.sunPosition.z=this.distance*Math.sin(o)*Math.cos(h)),this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(t,this._activeEffect))},i.prototype.getAnimatables=function(){return[]},i.prototype.dispose=function(t){n.prototype.dispose.call(this,t)},i.prototype.clone=function(n){var t=this;return BABYLON.SerializationHelper.Clone(function(){return new i(n,t.getScene())},this)},i.prototype.getClassName=function(){return"SkyMaterial"},i}(BABYLON.PushMaterial);n.SkyMaterial=i}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(t,i,r,u){u===void 0&&(u=4096);this.Je=0;this.Iz=0;this.DY=0;this.MZ=0;this.LP=0;this.Ie=t;this.Iu=n.ArrayHelper.CloneArray(n.VectorHelper.FilterDuplicatedVector3(i,1e-9,!1));this.Hw=this.Iu[0].clone();this.Iu=t.earthToLocalArray(this.Hw,this.Iu);r=n.NumberHelper.VerifyRange(r,1,17976931348623157e292);this.Je=r;this.Iz=n.Math3.Length(this.Iu);this.DY=this.Iz/r;this.MZ=u;this.LP=this.Je/this.MZ;this.Kb=new Array(this.MZ+1);for(var f=0;f<this.Kb.length;++f)this.Kb[f]=new n.Vector3;this.Kc()}return t.prototype.getPosition=function(t){var i,r,u;if(t>this.Je)if(this.isLoop)t=t-this.Je*Math.floor(t/this.Je);else return null;return i=n.SystemHelper.ToInt(t/this.LP),i>=this.MZ-1?r=this.Kb[this.MZ-1]:(u=(t-i*this.LP)/this.LP,r=n.Vector3.Lerp(this.Kb[i],this.Kb[i+1],u)),this.Ie.localToEarth(this.Hw,r)},t.prototype.Kc=function(){for(var o,e,i,s,r,u=0,t=0,f=0;f<this.MZ;f++){if(o=f*this.LP,e=o*this.DY,e>this.Iz)break;for(i=0,s=this.Iu.length,r=t;r<s-1;r++){if(i=n.Vector3.Distance(this.Iu[r],this.Iu[r+1]),e<u+i)break;u=u+i;t=t+1}var h=(e-u)/i,c=this.Iu[t].clone(),l=this.Iu[t+1].clone(),a=n.Vector3.Lerp(c,l,h);this.Kb[f]=a}},t}();n.LineInterpolation=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var e=function(){function t(){}return t.prototype.DistancePoint=function(t,i){return n.EarthMath2.DistancePoint(t,i)},t.prototype.DistancePointLine=function(t,i){return n.EarthMath2.DistancePointLine(t,i)},t.prototype.Distance=function(t,i,r,u){return n.EarthMath2.Distance(t,i,r,u)},t.prototype.Length=function(t){return n.EarthMath2.Length(t)},t.prototype.Area=function(t){return n.EarthMath2.Area(t)},t.prototype.Angle=function(t,i,r,u){return n.EarthMath2.Angle(t,i,r,u)},t.prototype.Buffer=function(t,i,r,u){return n.EarthMath2.Buffer(t,i,r,u)},t.prototype.bufferPoly=function(t,i){return n.EarthMath2.BufferPoly(t,i)},t.prototype.BufferPoint=function(t,i){return n.EarthMath2.BufferPoint(t,i)},t}(),o=function(){function t(){}return t.prototype.DistancePointLineAdvance=function(t,i,r){return n.EarthMath3.DistancePointLineAdvance(t,i,r)},t.prototype.DistancePointLine=function(t,i){return n.EarthMath3.DistancePointLine(t,i)},t.prototype.DistanceLineLineAdvance=function(t,i,r){return n.EarthMath3.DistanceLineLineAdvance(t,i,r)},t.prototype.DistanceLineLine=function(t,i){return n.EarthMath3.DistanceLineLine(t,i)},t.prototype.Distance=function(t,i,r,u,f,e){return n.EarthMath3.Distance(t,i,r,u,f,e)},t.prototype.DistancePoint=function(t,i){return n.EarthMath3.DistancePoint(t,i)},t.prototype.Length=function(t){return n.EarthMath3.Length(t)},t.prototype.Area=function(t){return n.EarthMath3.Area(t)},t}(),r=function(){function t(){}return t.prototype.DistancePoint=function(t,i){return n.Math2.DistancePoint(t,i)},t.prototype.DistancePointLine=function(t,i){return n.Math2.DistancePointLine(t,i)},t.prototype.Distance=function(t,i,r,u){return n.Math2.Distance(t,i,r,u)},t.prototype.Length=function(t){return n.Math2.Length(t)},t.prototype.Area=function(t){return n.Math2.Area(t)},t.prototype.Angle=function(t,i,r,u){return n.Math2.Angle(t,i,r,u)},t.prototype.Buffer=function(t,i,r,u,f){return n.Math2.Buffer(t,i,r,u,f)},t.prototype.BufferPoint=function(t,i){return n.Math2.BufferPoint(t,i)},t}(),i,t,u,f;n.Math2Impl=r;i=function(){function t(){}return t.prototype.DistancePointLineAdvance=function(t,i,r){return n.Math3.DistancePointLineAdvance(t,i,r)},t.prototype.DistancePointLine=function(t,i){return n.Math3.DistancePointLine(t,i)},t.prototype.DistanceLineLineAdvance=function(t,i,r){return n.Math3.DistanceLineLineAdvance(t,i,r)},t.prototype.DistanceLineLine=function(t,i){return n.Math3.DistanceLineLine(t,i)},t.prototype.Distance=function(t,i,r,u,f,e){return n.Math3.Distance(t,i,r,u,f,e)},t.prototype.DistancePoint=function(t,i){return n.Math3.DistancePoint(t,i)},t.prototype.Length=function(t){return n.Math3.Length(t)},t.prototype.Area=function(t){return n.Math3.Area(t)},t}();n.Math3Impl=i;t=function(){function t(n){this.MV=n}return t.prototype.worldToScreen=function(t){var i=n.Vector2.Zero();return this.worldToScreenToRef(t,i),i},t.prototype.worldToScreenToRef=function(n,t){this.MV&&this.MV.worldToScreenDoubleRef(n.x,n.y,n.z,t)},t.prototype.screenToWorldLine=function(n){return[this.screenToWorld(n,0),this.screenToWorld(n,1)]},t.prototype.screenToWorld=function(t,i){var r=n.Vector3.Zero();return this.screenToWorldToRef(t,i,r),r},t.prototype.screenToWorldToRef=function(n,t,i){this.MV&&this.MV.screenToWorldDoubleRef(n.x,n.y,t,i)},t.prototype.localToEarthToRef=function(){},t.prototype.earthToLocalToRef=function(){},t.prototype.localToEarth=function(t,i){var r=n.Vector3.Zero();return this.localToEarthToRef(t,i,r),r},t.prototype.earthToLocal=function(t,i){var r=n.Vector3.Zero();return this.earthToLocalToRef(t,i,r),r},t.prototype.localToEarthArray=function(t,i){for(var u,f=[],r=0;r<i.length;r++)u=n.Vector3.Zero(),this.localToEarthToRef(t,i[r],u),f.push(u);return f},t.prototype.earthToLocalArray=function(t,i){for(var u,f=[],r=0;r<i.length;r++)u=n.Vector3.Zero(),this.earthToLocalToRef(t,i[r],u),f.push(u);return f},t}();n.CoordSystemBase=t;u=function(t){function i(n){var i=t.call(this,n)||this;return i.Kj=new e,i.Lu=new o,i}return __extends(i,t),Object.defineProperty(i.prototype,"math2",{get:function(){return this.Kj},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"math3",{get:function(){return this.Lu},enumerable:!1,configurable:!0}),i.prototype.earthToWorld=function(t){return n.EarthMath3.EarthToWorld(t)},i.prototype.earthToWorldToRef=function(t,i){n.EarthMath3.EarthToWorldToRef(t,i)},i.prototype.worldToEarth=function(t){return n.EarthMath3.WorldToEarth(t)},i.prototype.worldToEarthToRef=function(t,i){n.EarthMath3.WorldToEarthToRef(t,i)},i.prototype.earthToWorldArray=function(t){return n.EarthMath3.EarthToWorldArray(t)},i.prototype.worldToEarthArray=function(t){return n.EarthMath3.WorldToEarthArray(t)},i.prototype.localToEarthToRef=function(t,i,r){var u=n.EarthMath2.LatitudePerMeter(),f=n.EarthMath2.LongitudePerMeter(t.z);r.set(t.x+i.x*f,t.y+i.y,t.z+i.z*u)},i.prototype.earthToLocalToRef=function(t,i,r){var u=n.EarthMath2.LatitudePerMeter(),f=n.EarthMath2.LongitudePerMeter(t.z);r.set((i.x-t.x)/f,i.y-t.y,(i.z-t.z)/u)},i.prototype.meterToEarth=function(t){return n.EarthMath2.LatitudePerMeter()*t},i.prototype.earthToMeter=function(t){return t/n.EarthMath2.LatitudePerMeter()},i.prototype.calcUpVector=function(t){return n.EarthMath3.GetUpVector(t)},i.prototype.calcRotationMatrix=function(t){return n.EarthMath3._RotateMatrixLH(t)},i.prototype.transformLightDirection=function(t,i){var u=n.EarthMath3._RotateQuaternionLH(t),r=n.Math3._RotateVector(u,i);return r.normalize(),r},i}(t);n.EarthCoordSystem=u;f=function(t){function u(n){var u=t.call(this,n)||this;return u.Kj=new r,u.Lu=new i,u}return __extends(u,t),Object.defineProperty(u.prototype,"math2",{get:function(){return this.Kj},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"math3",{get:function(){return this.Lu},enumerable:!1,configurable:!0}),u.prototype.earthToWorld=function(t){return new n.Vector3(t.x,t.y,t.z)},u.prototype.earthToWorldToRef=function(n,t){t.copyFrom(n)},u.prototype.worldToEarth=function(t){return new n.Vector3(t.x,t.y,t.z)},u.prototype.worldToEarthToRef=function(n,t){t.copyFrom(n)},u.prototype.Lx=function(t){for(var r,i=0;i<t.length;i++)r=t[i].clone(),t[i]=new n.Vector3(r.x,r.y,r.z)},u.prototype.earthToWorldArray=function(t){var i=n.ArrayHelper.CloneArray(t);return this.Lx(i),i},u.prototype.worldToEarthArray=function(t){var i=n.ArrayHelper.CloneArray(t);return this.Lx(i),i},u.prototype.localToEarthToRef=function(n,t,i){i.set(n.x+t.x,n.y+t.y,n.z+t.z)},u.prototype.earthToLocalToRef=function(n,t,i){i.set(t.x-n.x,t.y-n.y,t.z-n.z)},u.prototype.meterToEarth=function(n){return n},u.prototype.earthToMeter=function(n){return n},u.prototype.calcUpVector=function(){return new n.Vector3(0,1,0)},u.prototype.calcRotationMatrix=function(){return n.Matrix.Identity()},u.prototype.transformLightDirection=function(n,t){return t.clone()},u}(t);n.NonEarthCoordSystem=f}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function n(n,t,i,r,u){this.centerX=0;this.eyeDistance=0;this.centerZ=0;this.heading=0;this.pitch=0;this.centerX=n;this.eyeDistance=t;this.centerZ=i;this.heading=r;this.pitch=u}return n.prototype.equals=function(n){return this.centerX===n.centerX&&this.eyeDistance===n.eyeDistance&&this.centerZ===n.centerZ&&this.heading===n.heading&&this.pitch===n.pitch},n.prototype.clone=function(){return new n(this.centerX,this.eyeDistance,this.centerZ,this.heading,this.pitch)},n}();n.CameraPositionInfo=t;var i=function(){function t(t,i,r){this.range=new n.Rect;this.minHeight=0;this.maxHeight=17976931348623157e292;this.range=t.clone();this.minHeight=i;this.maxHeight=r}return t}(),u=function(){function t(){this.Ks=[]}return t.prototype.addHeightCondition=function(n,t,r){this.Ks.push(new i(n,t,r))},t.prototype.verifyHeight=function(t,i){for(var r,o,h=this.Ks.length,f=i,u,s=17976931348623157e292,e=0;e<h;e++)r=this.Ks[e],r.range.contains(t)&&(o=r.range.width+r.range.height,o<s&&(s=o,u=r));return u&&(f=n.NumberHelper.VerifyRange(f,u.minHeight,u.maxHeight)),f},t.prototype.clear=function(){this.Ks=[]},t}(),r=function(i){function r(t){var r=i.call(this)||this;return r._isFirstRole=!1,r.isAdvanceRotateMode=!0,r.baseEyeHeight=0,r.isLockCenter=!1,r.speedRatio=1,r._heightSpeedRatio=.05,r._worldCamera=new n.WorldCamera,r.MB=new n.Viewport(0,0,1,1),r._eye=new n.Vector3,r._center=new n.Vector3,r._up=new n.Vector3,r._worldEye=new n.Vector3,r._worldCenter=new n.Vector3,r._upVector=new n.Vector3,r._pitch=0,r._heading=0,r._eyeDistance=0,r.LA=0,r._renderContext=t,r.LK=r._renderContext.graphics.engine,r.inertia=.9,r}return __extends(r,i),r.prototype.initViewport=function(n,t,i,r){this._renderContext.graphics._isRenderToTexture||this.LK.setViewport(this.MB,n.width,n.height);this._worldCamera.initViewport(n,t,i,r)},Object.defineProperty(r.prototype,"renderContext",{get:function(){return this._renderContext},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"coordSystem",{get:function(){return this.getCoordSystem()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"worldCamera",{get:function(){return this._worldCamera},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inertia",{get:function(){return this.KY},set:function(t){this.KY=n.MathHelper.Clamp(t,0,1);this._smoothedInertia=Math.pow(this.inertia,.1)*.96},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isPanStarted",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.getCoordSystem=function(){throw new n.NotImplementedException;},Object.defineProperty(r.prototype,"isDirty",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype._updateCamera=function(){var t,i;this.cameraAnimation&&(this.cameraAnimation.isActive?(t=this.cameraAnimation.nextPosition,t&&(t._eye?this.lookAt(t._eye,t._center):this._commitSetView(t.centerX,t.eyeDistance,t.centerZ,t.heading,t.pitch))):this.MN&&(i=this.MN,this.MN=null,this.cameraAnimation.isActive||i()));(this.isDirty||n.SystemTime._IsTimer1000)&&this.updateCameraFromDefineParams()},r.prototype.updateCameraFromDefineParams=function(){},Object.defineProperty(r.prototype,"position",{get:function(){return new n.Vector3(this._center.x,this._eyeDistance,this._center.z)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"eye",{get:function(){return this._eye},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"worldEye",{get:function(){return this._worldEye},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"center",{get:function(){return this._center},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"worldCenter",{get:function(){return this._worldCenter},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"up",{get:function(){return this._up},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"heading",{get:function(){return this._heading},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"pitch",{get:function(){return this._pitch},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"eyeDistance",{get:function(){return this._eyeDistance},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"baseCenterHeight",{get:function(){return this.LA},set:function(n){this.LA=n},enumerable:!1,configurable:!0}),r.prototype._transformWorld=function(){this._worldCamera&&this._worldCamera.updateLookAt(this._worldEye,this._worldCenter,this._upVector,this._worldEye,this._worldCenter,!0)},r.prototype._transformLocalWorld=function(){if(this._worldCamera){var t=this._worldEye.subtract(this._worldCenter),i=n.Vector3.Zero();this._worldCamera.updateLookAt(t,i,this._upVector,this._worldEye,this._worldCenter,!1)}},r.prototype.lookAt=function(t,i,r){this._eye=t.clone();this._center=i.clone();var u=this.coordSystem;this._worldEye=u.earthToWorld(this._eye);this._worldCenter=u.earthToWorld(this._center);r||(r=n.Vector3.UpReadOnly);this.renderContext.isEarthCoord&&(r=this._worldCenter.clone(),r.normalize());this._up=r.clone();this._upVector=r.clone();this._eyeDistance=n.Vector3.Distance(this._worldEye,this._worldCenter);this._transformLocalWorld()},r.prototype.setView=function(t,i,r,u){i===void 0&&(i=this._heading);r===void 0&&(r=this._pitch);n.defined(u)&&(this.baseCenterHeight=u);this._commitSetView(t.x,t.y,t.z,i,r,u);this._updateCamera()},r.prototype.setViewByRange=function(t,i,r){i===void 0&&(i=this._heading);r===void 0&&(r=this._pitch);var u=t.left+t.width*.5,f=t.top+t.height*.5,e=this.coordSystem.math2.Distance(t.left,t.top,t.right,t.bottom)*.5;this.setView(new n.Vector3(u,e,f),i,r)},r.prototype.zoomToLayer=function(n){var t=this;return new Promise(function(i){if(!n||!n.bounds){i(t);return}var r=n.bounds;r.radius<=0?n.onAfterLoad.addOnce(function(n){t.MO(n.bounds);i(t)}):(t.MO(r),i(t))})},r.prototype.MO=function(t){var i=n.Rect.CreateFromPoint(new n.Vector2(t.min.x,t.min.z),new n.Vector2(t.max.x,t.max.z));this.setViewByRange(i,0,-45)},r.prototype._commitSetView=function(){},r.prototype.flyTo=function(i,r,u,f,e){var o=this;return r===void 0&&(r=this._heading),u===void 0&&(u=this._pitch),f===void 0&&(f=5e3),e===void 0&&(e=1e3),new Promise(function(s){o.MN=function(){s(o)};o.stopAnimation();o._updateCamera();var h=new t(o._center.x,o._eyeDistance,o._center.z,o._heading,o._pitch),c=new t(i.x,i.y,i.z,r,u);f=n.NumberHelper.VerifyRange(f,2e3,1e5);o.cameraAnimation=new n.FlyingAnimation(o,f,h,c,e)})},r.prototype.flyRoute=function(t,i,r){var u=this;return r===void 0&&(r=-45),new Promise(function(f){u.MN=function(){f(u)};u.cameraAnimation=new n.RouteFlyingAnimation(u,t,i,r)})},r.prototype.stopAnimation=function(){this.cameraAnimation&&(this.cameraAnimation.clear(),this.cameraAnimation=null)},Object.defineProperty(r.prototype,"isMoving",{get:function(){return this.hasActiveAnimation()},enumerable:!1,configurable:!0}),r.prototype.hasActiveAnimation=function(){return this.cameraAnimation&&this.cameraAnimation.isActive},r.prototype.verifyHeadingAndPitch=function(){this.maxPitch!==undefined&&this._pitch>this.maxPitch&&(this._pitch=this.maxPitch-n.MathHelper.EPSILON);this.minPitch!==undefined&&this._pitch<this.minPitch&&(this._pitch=this.minPitch+n.MathHelper.EPSILON);this.maxHeading!==undefined&&this._heading>this.maxHeading&&(this._heading=this.maxHeading-n.MathHelper.EPSILON);this.minHeading!==undefined&&this._heading<this.minHeading&&(this._heading=this.minHeading+n.MathHelper.EPSILON)},r.prototype.setNavigateRange=function(t,i){var r=this.coordSystem.meterToEarth(i),f=new n.Rect(t.x-r,t.z-r,2*r,2*r),u;this.Ko=i;this.Lk=f;u=n.Vector3.Distance(this.worldCenter,this.coordSystem.earthToWorld(t));u>i&&this.setView(new n.Vector3(t.x,this.eyeDistance,t.z),this.heading,this.pitch)},r.prototype.clearNavigateRange=function(){this.Lk=null},r.prototype.verifyHeightByLimit=function(t,i){return this.Lk?n.NumberHelper.VerifyRange(i,0,this.Ko):i},r.prototype.verifyPositionByLimit=function(t){if(this.Lk){var i=n.NumberHelper.VerifyRange(t.x,this.Lk.left,this.Lk.right),r=n.NumberHelper.VerifyRange(t.y,this.Lk.top,this.Lk.bottom);return new n.Vector2(i,r)}return t},r}(n.OperationBase);n.Camera=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(t,i){this._isEnabled=!0;this._startMs=0;this._delayMs=0;this._camera=t;this._delayMs=i;this._startMs=n.SystemTime.Now()}return t}(),i,r;n.CameraAnimationBase=t;i=function(t){function i(n,i,r,u,f){var e=t.call(this,n,f)||this;return e.LG=[],e.MT=0,e.KE=50,e.MT=0,e.LE(n,i,r.centerX,r.eyeDistance,r.centerZ,r.heading,r.pitch,u.centerX,u.eyeDistance,u.centerZ,u.heading,u.pitch),e}return __extends(i,t),Object.defineProperty(i.prototype,"isActive",{get:function(){return this._isEnabled&&this.MT<this.LG.length},set:function(n){this._isEnabled=n},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"nextPosition",{get:function(){var i,t,r;if(this.MT<this.LG.length){if(i=n.SystemTime.Now(),t=i-(this._startMs+this._delayMs),t<0)return null;if(this.MT===0)return this.MT=this.MT+1,this.LG[0];if(r=n.SystemHelper.ToInt(t/this.KE),this.MT=r,this.MT<this.LG.length)return this.LG[this.MT]}return null},enumerable:!1,configurable:!0}),i.prototype.LE=function(t,i,r,u,f,e,o,s,h,c,l,a){var ft=600,y,rt,ut,p,d;this.clear();var ot=t.coordSystem.earthToMeter(Math.abs(r-s)),st=t.coordSystem.earthToMeter(Math.abs(f-c)),tt=Math.sqrt(ot*ot+st*st),w=Math.max(u,h)+tt,it=Math.min(w,h*4),ht=n.SystemHelper.ToInt(ft*(tt/w)),et=n.SystemHelper.ToInt(ft/2*Math.min(1,tt*20/w)),nt=n.SystemHelper.ToInt(ft*((w-h)/w)),ct=n.SystemHelper.ToInt(nt/2);nt=n.SystemHelper.ToInt(nt/2);var b=r,v=u,k=f,g=0;if(g=o,y=0,Math.max(u,h)<tt*.2)for(y=n.MathHelper._Log10(Math.abs(w/u))/ht,y=Math.pow(10,y),p=0;p<ht;p++)v=v*y,v>w&&(v=w),d=new n.CameraPositionInfo(b,v,k,e,g),this.LG.push(d);else v=w;for(rt=(s-r)/et,ut=(c-f)/et,p=0;p<et;p++)Math.abs(s-b)<=rt&&(rt=s-b),Math.abs(c-k)<=ut&&(ut=c-k),b=b+rt,k=k+ut,d=new n.CameraPositionInfo(b,v,k,e,g),this.LG.push(d);for(y=n.MathHelper._Log10(Math.abs(w/it))/nt,y=Math.pow(10,y),p=0;p<nt;p++)v=v/y,v<it&&(v=it),d=new n.CameraPositionInfo(b,v,k,e,g),this.LG.push(d);for(y=n.MathHelper._Log10(Math.abs(it/h))/ct,y=Math.pow(10,y),p=0;p<ct;p++)v=v/y,v<h&&(v=h),d=new n.CameraPositionInfo(b,v,k,e,g),this.LG.push(d);this.Ma(u,h,e,l,g,a);this.KE=i/this.LG.length},i.prototype.Ma=function(n,t,i,r,u,f){for(var o,c=Math.max(5e4,n*.5+t*.5),s=-1,e=0;e<this.LG.length;e++)if(o=this.LG[e],o.eyeDistance<c){s=e;break}if(s>=0){var h=this.LG.length-s-1,l=(r-i)*(1/h),a=(f-u)*(1/h);for(e=0;e<=h;e++)o=this.LG[s+e],o.heading=i+l*e,o.pitch=u+a*e}},i.prototype.clear=function(){this.MT=0;n.ArrayHelper.Clear(this.LG)},i.KZ=5e4,i}(t);n.FlyingAnimation=i;r=function(t){function i(i,r,u,f){var e=t.call(this,i,0)||this;return e.Ez=0,e.MK=0,e.JU=!1,e.MK=u,e.Ez=e._startMs+u,e.LN=new n.LineInterpolation(i.coordSystem,r,u,1024),f&&(e.Ij=f),e}return __extends(i,t),Object.defineProperty(i.prototype,"isActive",{get:function(){var t=this._isEnabled&&n.SystemTime.Now()<this.Ez;return this.JU&&!t&&this.clear(),this.JU=t,this.JU},set:function(n){this._isEnabled=n},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"nextPosition",{get:function(){var u=n.SystemTime.Now()-this._delayMs-this._startMs,i=this.LN.getPosition(u),r,t,f,e;return i?(r=this.LN.getPosition(u+500),!r&&(r=this.LN.getPosition(u+50),!r))?null:(t=new n.CameraPositionInfo(i.x,i.y,i.z,0,0),this.Ij!==undefined?(t.pitch=this.Ij,f=this._camera.coordSystem.earthToLocal(i,r),e=n.MathHelper.ToDegrees(n.Math2.Angle(0,0,f.x,f.z)),t.heading=e-90):(t._eye=i,t._center=r,t._up=this._camera.coordSystem.calcUpVector(t._eye)),t):null},enumerable:!1,configurable:!0}),i.prototype.clear=function(){},i.prototype.Jw=function(){this._startMs=n.SystemTime.Now();this.Ez=this._startMs+this.MK},i}(t);n.RouteFlyingAnimation=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i){var r=t.call(this,i.renderContext)||this;return r.earthViewer=i,r._xDelta=0,r._zDelta=0,r._headingDelta=0,r._pitchDelta=0,r._eyeDistanceDelta=0,r.KP=0,r.Lb=0,r.JB=0,r.Lm=!1,r.LL=1,r.Lg=0,r.ML=0,r.Kp=.5,r.Ky=0,r.LR=0,r.Kk=0,r.Ip=!1,r.Kv=new n.Vector2,r.Kr=0,r.Iv=new n.Vector3,r._renderContext=i.renderContext,r}return __extends(i,t),Object.defineProperty(i.prototype,"isMoving",{get:function(){return t.prototype.hasActiveAnimation.call(this)||this.KR()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isDirty",{get:function(){return this.KR()},enumerable:!1,configurable:!0}),i.prototype.setTranslateDelta=function(n,t){this._xDelta=n;this._zDelta=t;this.isNeedInitParam?this.KP=0:(this.KP=this.inertia,this.Lb=this._xDelta,this.JB=this._zDelta)},i.prototype.setAngleDelta=function(n,t){this._headingDelta=n;this._pitchDelta=t},i.prototype.setEyeDistanceDelta=function(n){this._eyeDistanceDelta=n},i.prototype.setPosDeltaWrapper=function(n,t,i,r,u,f){f===void 0&&(f=!1);this.setTranslateDelta(n,i);this.setAngleDelta(r,u);this.setEyeDistanceDelta(t)},i.prototype.KR=function(){return this._zDelta!==0||this._xDelta!==0||this._headingDelta!==0||this._pitchDelta!==0||this._eyeDistanceDelta!==0},i.prototype.MQ=function(){if(this.isNeedInitParam||this.inertia<=0)this._pitchDelta=0,this._headingDelta=0,this._zDelta=0,this._xDelta=0,this._eyeDistanceDelta=0;else{var n=this._smoothedInertia*.8;this._pitchDelta=this._pitchDelta*n;this._headingDelta=this._headingDelta*n;Math.abs(this._pitchDelta)<.1&&(this._pitchDelta=0);Math.abs(this._headingDelta)<.1&&(this._headingDelta=0);this.KP>0?(this.KP*=this._smoothedInertia,this._zDelta=this.JB*this.KP,this._xDelta=this.Lb*this.KP,this.KP<.01&&(this.KP=0)):(this._zDelta=0,this._xDelta=0);this._eyeDistanceDelta=0}},i.prototype.MH=function(){this.isNeedInitParam?(this._pitch=this._pitchDelta,this._heading=this._headingDelta,this._eyeDistance=this._eyeDistanceDelta):(this._pitch=this._pitch+this._pitchDelta,this._heading=this._heading+this._headingDelta,this._eyeDistance+this._eyeDistanceDelta>0&&(this._eyeDistance=this._eyeDistance+this._eyeDistanceDelta));t.prototype.verifyHeadingAndPitch.call(this);var n=4e7;this._eyeDistance>n&&(this._eyeDistance=n)},i.prototype.calcSurfaceHitPoint=function(){return!0},Object.defineProperty(i.prototype,"isNeedInitParam",{get:function(){return this.Lm},enumerable:!1,configurable:!0}),i.prototype.setIsNeedInitParamDirty=function(){this.Lm=!0},i.prototype.Lp=function(n){this.Lm=n},i.prototype.updateCameraFromDefineParams=function(){this.Is();t.prototype.updateCameraFromDefineParams.call(this);this.MH();this.EV&&this.updateCameraCenterHeight();this.prepareLookAtParam();this.MQ();this.Lp(!1)},i.prototype.prepareLookAtParam=function(){throw new n.Exception("camera derive class must override prepareLookAtParam");},i.prototype.adjustEyePos=function(){return this.Jc(this._renderContext.terrainCalculator),this.IE(this._isEyeHeightLimitByBaseHeight)},i.prototype.IE=function(i){var e,u,r,f,o,s;return i===void 0&&(i=!0),e=Math.max(1,this._eyeDistance*.05),u=this.baseEyeHeight,u=t.prototype.verifyHeightByLimit.call(this,new n.Vector2(this._eye.x,this._eye.z),u),this._eyeDistance=t.prototype.verifyHeightByLimit.call(this,new n.Vector2(this._center.x,this._center.z),this._eyeDistance),r=t.prototype.verifyPositionByLimit.call(this,new n.Vector2(this._eye.x,this._eye.z)),f=!1,i&&this._eye.y<u&&(this._eye.y=u+e,f=!0),n.MathHelper.NearEqual(r.x,this._eye.x,1e-13)&&n.MathHelper.NearEqual(r.y,this._eye.z,1e-13)||(o=r.x-this._eye.x,s=r.y-this._eye.z,this._eye.x=r.x,this._eye.z=r.y,this._center.x=this._center.x+o,this._center.z=this._center.z+s,f=!0),f&&(this._worldEye=this.coordSystem.earthToWorld(this._eye),this._worldCenter=this.coordSystem.earthToWorld(this._center)),f},i.prototype.onKeyDown=function(i){var h=Math.max(1,Math.abs(this.eye.y-this.baseCenterHeight)),e=this._heightSpeedRatio*h*this.speedRatio,r=e*.5,u=1,f=this.coordSystem,s=!0,o=i.keyCode;o===n._Key.Up||o===n._Key.Down||this.Lr();switch(o){case n._Key.Escape:t.prototype.stopAnimation.call(this);break;case n._Key.PageUp:this.setAngleDelta(0,-u);break;case n._Key.PageDown:this.setAngleDelta(0,u);break;case n._Key.Left:this.isLockCenter||this.setTranslateDelta(-f.meterToEarth(r),0);break;case n._Key.Up:this.isLockCenter||(this.setTranslateDelta(0,f.meterToEarth(r)),this.Jf?this.Kp*=1.01:this.Ip&&this.KQ());break;case n._Key.Right:this.isLockCenter||this.setTranslateDelta(f.meterToEarth(r),0);break;case n._Key.Down:this.isLockCenter||(this.Jf?this.Kp*=.95:this.setTranslateDelta(0,-f.meterToEarth(r)));break;case n._Key.M:this.setAngleDelta(2*u,0);break;case n._Key.N:this.setAngleDelta(-2*u,0);break;case n._Key.Add:this.setEyeDistanceDelta(-e*.5);this.updateCameraCenterHeight();break;case n._Key.Subtract:this.setEyeDistanceDelta(e*.5);this.updateCameraCenterHeight();break;default:s=!1}return s},i.prototype.Is=function(){if(this.Jf){this.Kp=n.MathHelper.Clamp(this.Kp,.1,2);var t=Math.min(5e3,Math.max(1,Math.abs(this.eye.y-this.baseCenterHeight))),i=this._heightSpeedRatio*t*this.speedRatio*this.Kp,r=i*.5;this.isLockCenter||this.setTranslateDelta(0,this.coordSystem.meterToEarth(r))}},i.prototype.KQ=function(){this.Jf=!0;this.earthViewer.htmlCursor=n.Cursor.None},i.prototype.Lr=function(){this.Jf=!1;this.earthViewer.htmlCursor=n.Cursor.Default},i.prototype.onMouseWheel=function(t){var u,i,f,r;return this.hasActiveAnimation()?!1:(u=t.mouseParam,i=n.SystemHelper.ToInt(-u),i!==0)?(this.updateCameraCenterHeight(),f=Math.abs(this.eyeDistance),r=Math.max(0,f),i>0?this.setEyeDistanceDelta(r/2):this.setEyeDistanceDelta(-r/4),!0):!1},i.prototype.KJ=function(t,i,r){var u,f,e;return this.MI?(u=new n.Vector3,f=new n.Vector3,this.MI.screenToWorldLine(t,u,f),e=new n.Vector3,this.calcSurfaceHitPoint(u,f,i,e)?(r.copyFrom(this.coordSystem.worldToEarth(e)),!0):!1):!1},i.prototype.calculateMouseDownSurfaceHeight=function(){return this.center.y},Object.defineProperty(i.prototype,"isPanStarted",{get:function(){return this.KT&&this.Jv},enumerable:!1,configurable:!0}),i.prototype.onLeftButtonDown=function(t){if((this.Ip=!1,this.Lr(),this.isLockCenter)||this.hasActiveAnimation())return!1;this.MJ=t.point.clone();this.Ky=this.calculateMouseDownSurfaceHeight();this.Lo=n.SystemTime.Now();this.KT=!0;this.MI=n.WorldCoordSystem.CreateFromClone(this._worldCamera);var i=new n.Vector3;return this.KJ(t.point,this.Ky,i)&&(this.LR=this.pitch,this.Kk=this.heading,this.LU=this.center.clone(),this.Lz=i.clone()),!0},i.prototype.onLeftButtonUp=function(t){var u=this,i,r;if(this.KT&&(i=(n.SystemTime.Now()-this.Lo)*.001,i>.01&&i<.4&&(i=Math.max(.05,i)*30,r=n.Vector3.Zero(),this.KJ(t.point,this.Ky,r)))){var f=r.x-this.Lz.x,e=r.z-this.Lz.z,o=f/i,s=e/i;setTimeout(function(){u.setTranslateDelta(-o,-s);u.earthViewer.redraw()},0)}return this.KT=!1,this.Jv=!1,!1},i.prototype.onMouseMove=function(n){return this.hasActiveAnimation()?!1:this.Ip?this.Jl(n):this.KT?this.Lw(n):!1},i.prototype.Lw=function(t){var r,i,u,f;return this.MJ.equals(t.point)?!1:(this.Jv=!0,r=!1,i=new n.Vector3,this.KJ(t.point,this.Ky,i)?(u=this.LU.x-(i.x-this.Lz.x),f=this.LU.z-(i.z-this.Lz.z),this._commitSetView(u,this.eyeDistance,f,this.Kk,this.LR,this.baseCenterHeight),this.Jv=!0,r=!0):this.MI=null,r)},i.prototype.onRightButtonDown=function(t){return this.Kv=t.point.clone(),this.Ip||(this.Kr=n.SystemTime._FrameNow()),this.Ip=!0,this.Lr(),!0},i.prototype.onRightButtonUp=function(t){return this.isAdvanceRotateMode&&n.Math2.DistancePoint(this.Kv,t.point)<10&&n.SystemTime._FrameNow()-this.Kr<1e3?!1:(this.Ip=!1,!0)},i.prototype.Jl=function(t){var u=0,f=100,i=n.SystemHelper.ToInt(t.point.x-this.Kv.x),r=n.SystemHelper.ToInt(t.point.y-this.Kv.y);return Math.abs(i)>u||Math.abs(r)>u?(this.Kv=t.point.clone(),Math.abs(i)<f&&Math.abs(r)<f&&(Math.abs(r)+this.ML<=Math.abs(i)+this.Lg?(r=0,this.Lg=this.Lg+2):(i=0,this.ML=this.ML+2),this.setAngleDelta(-i/3*n.Drawing3DSetting.DeviceSensitiveRatio,-r/3*n.Drawing3DSetting.DeviceSensitiveRatio),this.Lg=this.Lg-1,this.ML=this.ML-1,this.Lg<0&&(this.Lg=0),this.Lg>this.LL&&(this.Lg=this.LL),this.ML<0&&(this.ML=0),this.ML>this.LL&&(this.ML=this.LL)),!0):!1},i.prototype.onSetViewBaseCenterHeight=function(t){this.EV=n.defined(t)?!1:!0},i.prototype.updateCameraCenterHeight=function(){this.LV(this._renderContext.terrainCalculator)},i.prototype.LV=function(t){var f;if(!this.isPanStarted){if(!this.earthViewer._canCalcTerrainHeight){this.renderContext.isEarthCoord&&(this.baseCenterHeight=n.Drawing3DSetting.TerrainZeroBaseHeight,this.EV=!1);return}if(t&&!(this.eye.y>i.IQ)){var r=this.center,e=new n.RefValue(0),u=new n.RefValue(0);if(t.calculateHeightAdvance(r.x,r.z,e,u,i.KK)){if(f=new n.Vector2(r.x,r.z),this.Kx&&n.Math2.NearEqual(this.Kx,f)){if(u.value<this.MM)return}else this.Kx=f;this.MM=u.value;this.baseCenterHeight=e.value;this.EV=!1}}}},i.prototype.Jc=function(t){var r,f,u,e;!this.isPanStarted&&this.earthViewer._canCalcTerrainHeight&&t&&(r=this.eye,f=n.Math3.NearEqual(r,this.Iv,1e-13),!f&&r.y-this.baseCenterHeight<2e3&&r.y>0&&(u=new n.RefValue(0),e=new n.RefValue(0),t.calculateHeightAdvance(r.x,r.z,u,e,i.KK)&&(this.baseEyeHeight=u.value),this.Iv=r.clone()))},i.IQ=2e4,i.KK=9,i}(n.Camera);n.CentricCamera=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(){}return t.CalcThirdRoleLookAtParamLHToRef=function(t,i,r,u,f,e,o){u=90+u;o.x=0;o.y=0;o.z=-(n.EarthMath2.EARTH_RADIUS+i);var h=n.MathHelper.ToRadians(u),c=r*Math.sin(h),s=r*Math.cos(h);e.x=0;s>0?(e.z=o.z-s,e.y=0-c):(e.z=o.z,e.y=-r,o.z=o.z+s);e.copyFrom(n.Math3._RotateVector(f,e));o.copyFrom(n.Math3._RotateVector(f,o))},t.CalcFirstRoleLookAtParamToRef=function(t,i,r,u,f,e,o){e.x=0;e.y=0;e.z=-(n.EarthMath2.EARTH_RADIUS+i+r);var s=n.MathHelper.ToRadians(u),h=Math.abs(r)*Math.sin(s),c=Math.abs(r)*Math.cos(s);o.x=0;o.y=0+h;o.z=e.z+c;e.copyFrom(n.Math3._RotateVector(f,e));o.copyFrom(n.Math3._RotateVector(f,o))},t.ToThirdParamToRef=function(t,i,r,u,f,e,o,s,h){var c=u.clone(),a=new n.Vector3,v=!1,l,y;r>-90&&n.Math3._IntersectSphere(f.x,f.y,f.z,u.x,u.y,u.z,n.EarthMath2.EARTH_RADIUS,a)&&(c=a.clone(),v=!0);s.value=n.Vector3.Distance(c,f);s.value>i&&(s.value=s.value-i);v||(s.value=s.value*2);l=t.worldToEarth(c);y=(t.worldToEarth(f).y-l.y-i)/s.value;h.value=Math.acos(y);h.value=n.MathHelper.ToDegrees(h.value);o.copyFrom(l.clone())},t.CalcRotationQuaternionLH=function(t,i,r){var u=n.Quaternion.RotationAxis(new n.Vector3(0,1,0),n.MathHelper.ToRadians(-t)),f=n.Quaternion.RotationAxis(new n.Vector3(1,0,0),n.MathHelper.ToRadians(r)),e=n.Quaternion.RotationAxis(new n.Vector3(0,0,1),n.MathHelper.ToRadians(i));return u.multiply(f).multiply(e)},t.UpdateRotationQuaternionLH=function(t,i,r,u){var f,e;r!==0&&(f=n.Math3._RotateVector(t,new n.Vector3(0,0,1)),e=n.Quaternion.RotationAxis(f,n.MathHelper.ToRadians(r)),t.copyFrom(e.multiply(t)));u!==0&&(f=n.Math3._RotateVector(t,new n.Vector3(1,0,0)),e=n.Quaternion.RotationAxis(f,n.MathHelper.ToRadians(u)),t.copyFrom(e.multiply(t)));i!==0&&(f=n.Math3._RotateVector(t,new n.Vector3(0,1,0)),e=n.Quaternion.RotationAxis(f,n.MathHelper.ToRadians(-i)),t.copyFrom(e.multiply(t)));t.normalize()},t}(),i=function(i){function r(t){var r=i.call(this,t)||this;return r.IT=!0,r.Kw=!1,r.LY=new n.Quaternion,r.GF=new n.EarthCoordSystem(r._worldCamera),r._pitch=-90,r.maxPitch=-1,r._isEyeHeightLimitByBaseHeight=!0,r}return __extends(r,i),r.prototype.getCoordSystem=function(){return this.GF},r.prototype._commitSetView=function(n,t,r,u,f,e){this.Kw=!1;i.prototype.setIsNeedInitParamDirty.call(this);i.prototype.setTranslateDelta.call(this,n,r);i.prototype.setAngleDelta.call(this,u,f);i.prototype.setEyeDistanceDelta.call(this,t);var o=!1,s=this.eyeDistance;Math.abs(t-s)>s*.5&&(o=!0);(this.IT||o&&!this.hasActiveAnimation())&&(i.prototype._updateCamera.call(this),i.prototype._transformWorld.call(this),this.IT=!1);this.onSetViewBaseCenterHeight(e)},r.prototype.lookAt=function(t,r,u){var f=this.coordSystem.math3.DistancePoint(t,r);this.setView(new n.Vector3(r.x,f,r.z),0,-90);i.prototype.lookAt.call(this,t,r,u);this._eyeDistance=1.5*(this._center.y-this.baseCenterHeight+f);this.Kw=!0},r.prototype.prepareLookAtParam=function(){if(this.Lj(),!this.Kw){this.Kf();var n=this._worldEye,i=this._worldCenter;this._isFirstRole?t.CalcFirstRoleLookAtParamToRef(this.coordSystem,this.baseCenterHeight,this._eyeDistance,this._pitch,this.LY,n,i):t.CalcThirdRoleLookAtParamLHToRef(this.coordSystem,this.baseCenterHeight,this._eyeDistance,this._pitch,this.LY,n,i);this.JJ(this._upVector);this.coordSystem.worldToEarthToRef(this._worldCenter,this._center);this.coordSystem.worldToEarthToRef(this._worldEye,this._eye);this.adjustEyePos()}this.Kw=!1},r.prototype.updateCameraFromDefineParams=function(){i.prototype.updateCameraFromDefineParams.call(this)},r.prototype.Lj=function(){if(this.isNeedInitParam)this.LY=t.CalcRotationQuaternionLH(this._xDelta,this._heading,this._zDelta);else if(this._xDelta!==0&&this._zDelta!==0){var n=this.center.x+this._xDelta,i=this.center.z+this._zDelta;this.LY=t.CalcRotationQuaternionLH(n,this._heading,i)}else t.UpdateRotationQuaternionLH(this.LY,this._xDelta,this._headingDelta,this._zDelta)},r.prototype.JJ=function(t){t.copyFrom(new n.Vector3);this._pitch===0?(t.x=0,t.y=1,t.z=0):(t.x=0,t.y=1,t.z=0);t.copyFrom(n.Math3._RotateVector(this.LY,t));t.normalize()},r.prototype.Kf=function(){if(!this._isFirstRole){var n=0;n=this._eyeDistance<100?this.maxPitch:-1;this._pitch>n&&(this._pitch=n);this._pitch<-90&&(this._pitch=-90)}this.baseCenterHeight=Math.max(.01,this.baseCenterHeight)},r.prototype.calcSurfaceHitPoint=function(t,i,r,u){return n.Math3._IntersectSphere(t.x,t.y,t.z,i.x,i.y,i.z,n.EarthMath3.GetWorldRadius()+r,u)},r.prototype.calculateMouseDownSurfaceHeight=function(){var i=this.pitch,t=this.eye.y,n=0;return n=i>=-120?this.earthViewer.mousePosition.y:t+Math.max(Math.abs(t)*.1,100),n<0&&(n=0),n},r}(n.CentricCamera);n.EarthCentricCamera=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i){var r=t.call(this,i)||this;return r.MC=0,r.Km=0,r.MF=new n.NonEarthCoordSystem(r._worldCamera),r.baseCenterHeight=0,r.maxPitch=90,r._isEyeHeightLimitByBaseHeight=!1,r}return __extends(i,t),i.prototype.getCoordSystem=function(){return this.MF},i.prototype._commitSetView=function(n,i,r,u,f,e){t.prototype.setIsNeedInitParamDirty.call(this);t.prototype.setPosDeltaWrapper.call(this,n,i,r,u,f,!1);this.onSetViewBaseCenterHeight(e)},i.prototype.calcSurfaceHitPoint=function(t,i,r,u){var c=new n.Plane(0,1,0,-r),o=new n.Vector3,l=new n.RefValue(0);if(n.VectorHelper.IntersectSegmentPlane(t,i,c,o,l))u.copyFrom(o);else{var f=t.x,a=t.y,e=t.z,s=i.x,v=i.y,h=i.z;this._heading!==90&&this._heading!==180?(u.x=f-(s-f)/(h-e)*e,u.z=0,u.y=r):(u.x=0,u.z=e-(h-e)/(s-f)*f,u.y=r)}return!0},i.prototype.Lj=function(){if(this.isNeedInitParam)this.MC=this._xDelta,this.Km=this._zDelta;else if(this._xDelta!==0&&this._zDelta!==0)this.MC+=this._xDelta,this.Km+=this._zDelta;else if(this._xDelta!==0||this._zDelta!==0){var t=n.MathHelper.ToRadians(this._heading);this._xDelta!==0?(this.MC=this.MC+this._xDelta*Math.cos(t),this.Km=this.Km+this._xDelta*Math.sin(t)):this._zDelta!==0&&(this.MC=this.MC-this._zDelta*Math.sin(t),this.Km=this.Km+this._zDelta*Math.cos(t))}},i.prototype.Kf=function(){this._eyeDistance=t.prototype.verifyHeightByLimit.call(this,new n.Vector2(this._center.x,this._center.z),this._eyeDistance);this._eyeDistance<.10000000149011612&&(this._eyeDistance=.10000000149011612);this._pitch=n.NumberHelper.VerifyRange(this._pitch,-89.99,90)},i.prototype.prepareLookAtParam=function(){this.Lj();this.Kf();var r=n.MathHelper.ToRadians(this._heading),f=n.MathHelper.ToRadians(this._pitch+90),e=this._eyeDistance,u=Math.abs(e*Math.sin(f)),t,i;this._isFirstRole?(t=new n.Vector3(this.MC,this.baseCenterHeight+this._eyeDistance,this.Km),i=n.Vector3.Zero(),i.y=t.y-e*Math.cos(f),i.x=t.x-u*Math.sin(r),i.z=t.z+u*Math.cos(r)):(i=new n.Vector3(this.MC,this.baseCenterHeight,this.Km),t=n.Vector3.Zero(),t.y=i.y+e*Math.cos(f),t.x=i.x+u*Math.sin(r),t.z=i.z-u*Math.cos(r));this._upVector=Math.abs(this._pitch)<1e-13?new n.Vector3(-Math.sin(r),0,Math.cos(r)):new n.Vector3(0,1,0);this._eye=this.MF.worldToEarth(t);this._center=this.MF.worldToEarth(i);this._worldEye=t;this._worldCenter=i;this.adjustEyePos()},i}(n.CentricCamera);n.NonEarthCentricCamera=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var r=function(){function t(t,i,r,u,f){if(u===void 0&&(u=null),f===void 0&&(f=!1),this.Uz=new Array(4),this.VM=!1,this.isTransparent=!1,this.isUseTexture=!1,arguments.length===5&&(!t||t instanceof n.Graphics3)&&(!i||i.constructor===String)&&(!r||r.constructor===Uint8Array)&&(!u||u instanceof n.Color)&&(!f||f.constructor===Boolean)){this.UP(t,i,r,u,f);return}this.Vm(t,i,r,u,f)}return Object.defineProperty(t.prototype,"isReadyForDraw",{get:function(){return!this.isUseTexture||this.VM},enumerable:!1,configurable:!0}),t.prototype.UP=function(n,t,r,u,f){this.graphics=n;this.initDefaultProperty();u&&(this.diffuseColor=u.clone());r&&(this.Uz[0]=new i(0,r));this.isTransparent=f;this.isUseTexture=!!r},t.prototype.Vm=function(n,t,r,u,f){var o,e;for(this.graphics=n,this.initDefaultProperty(),u&&(this.diffuseColor=u.clone()),this.isUseTexture=!1,o=Math.min(this.Uz.length,r.length),e=0;e<o;e++)r[e]&&(this.Uz[e]=new i(e,r[e]),this.isUseTexture=!0);this.isTransparent=f},t.prototype.initDefaultProperty=function(){this.isTransparent=!1;this.isUseTexture=!1;this.diffuseColor=n.Color.White;this.Uz=new Array(4);for(var t=0;t<4;t++)this.Uz[t]=null},t.prototype.getLodTexture=function(n){var t,i,r;if(n<0||n>4)return null;for(t=n;t<4;t++)if(i=this.Uz[t],i&&(r=i.getTexture(),r))return r;return null},t.prototype.loadTexture=function(n){var t,i,r;if(this.VM=!1,n>=0&&n<4)if(this.Uz[n]&&this.Uz[n].getTexture())this.VM=!0;else for(t=n;t<4;t++)if(i=this.Uz[t],i&&(r=i.prepareTexture(this.graphics,t),r)){this.VM=!0;break}},t}(),i=function(){function t(t,i){this.SC=0;this.SC=t;this.Vw=n.ArrayHelper.CloneDataArray(i)}return t.prototype.VR=function(n){var t=n;return this.Ro?!1:(this.Vw&&(this.Ro=t.createTextureFromBytes(this.Vw)),!0)},t.prototype.prepareTexture=function(t){var i=this;return this.Ro||(this.WA||(this.WA=n.AsyncRenderContext.PrepareData(t,function(n){return i.VR(n)})),this.WA&&this.WA.tryInvoke()),this.Ro},t.prototype.getTexture=function(){return this.Ro},t}(),u=function(){function n(){}return n.CreateMaterialSet=function(){var t=new f;return n.RP.push(t),t},n.RP=[],n}(),f=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.getMaterial=function(t){return n.prototype.getValue.call(this,t)},t.prototype.addMaterial=function(t,i){i&&n.prototype.add.call(this,t,i)},t}(n.Dictionary),e=function(){function i(){}return i.ExtractMeshFromXzDataWithMaterial=function(r,u,f,e,o){var s=t.FromXZData(f),h=new n.RefValue([]),c=i.ExtractOneMeshData(s.meshName,s.modelData,e,h);return o.value=i.CreateMaterialSet(r,s,u,h.value,""),c},i.ExtractMeshFromXzData=function(r,u){var f=t.FromXZData(r),e=new n.RefValue([]);return i.ExtractOneMeshData(f.meshName,f.modelData,u,e)},i.ExtractMeshArrayFromXzData=function(t,r){var o=new n.RefValue([]),e=[],f=i.ExtractOneMeshData(t.meshName,t.modelData,r,o),u,s;for(f&&e.push(f),u=0;u<t.imageNames.length;u++)s=t.imageNames[u],f=i.ExtractOneMeshData(t.imageNames[u],t.imageDatas[u],r,o),f&&e.push(f);return e},i.ExtractMeshFromDsxData=function(t,r,u,f){var e=new n.RefValue([]);return i.ExtractOneMeshData(r,u,f,e)},i.ExtractMeshSetInner=function(r,u,f,e,o){var s=t.FromXZData(f),c=new n.RefValue([]),a=new n.Dictionary,y=i.ExtractOneMeshData(s.meshName,s.modelData,e,c),h,l,v;for(o.value=i.CreateMaterialSet(r,s,u,c.value,""),a.add(s.meshName,y),h=0;h<s.imageNames.length;h++)l=s.imageNames[h],l.indexOf(".dsx")>=0&&(v=i.ExtractOneMeshData(l,s.imageDatas[h],e,c),o.value=i.CreateMaterialSet(r,s,u,c.value,""),a.add(l,v));return a},i.ExtractMeshData=function(i){var r=t.FromXZData(i),f=new n.Dictionary,u,e;for(f.add(r.meshName,r.modelData),u=0;u<r.imageNames.length;u++)e=r.imageNames[u],e.indexOf(".dsx")>=0&&f.add(e,r.imageDatas[u]);return f},i.ExtractOneMeshData=function(t,i,r,u){var f,e;u.value=[];try{e=new n.MemoryBinaryReader(i);t.indexOf(".dsx4")>0?f=n._FixedMeshDataReader.LoadDsx4Data(e,u):t.indexOf(".dsx3")>0?f=n._FixedMeshDataReader.LoadDsx3Data(e,u):t.indexOf(".dsx2")>0&&(f=n._FixedMeshDataReader.LoadDsx2Data(e,u,!0))}catch(o){}return f&&(f.scaleMesh(r),f.name=n.StringHelper.ExtractFileNameWithoutSuffix(t)),f},i.CreateOneMesh=function(t,i,r,u,f){var s,h,e,l;if(r.vertexes.length<=0)return null;for(s=[],h=r.subDatas,e=0;e<h.length;e++){var o=h[e],a=o.getBounds(),v=o.materialName,c=void 0;u&&(c=n.SystemHelper.CastObject(u.getMaterial(v)));l=new n.FixedSubMesh(o.indexStart,o.indexCount,c,a);s.push(l)}return new n.FixedMesh(i,t,r,s,f)},i.CreateMaterialSet=function(t,f,e,o,s){var l,h,c,w,b;for(s===void 0&&(s=""),l=u.CreateMaterialSet(),h=0;h<o.length;h++){var a=o[h],y=a.name,p=!1,v=a.textureFile;!v||(c=n.StringHelper.ExtractFileSuffix(v),c=c.toLowerCase(),c===".png"&&(p=!0));w=i.ExtractLodTexture(v,f);b=new r(t,y,w,a.diffuseColor,p);l.addMaterial(y,b)}return l},i.ExtractLodTexture=function(t,i){var r=[],u=n.StringHelper.ExtractFileNameWithoutSuffix(t),f=n.StringHelper.ExtractFileSuffix(t).toLowerCase();return r.push(i.readImageData(t)),r.push(i.readImageData(u+"_lod_1"+f)),r.push(i.readImageData(u+"_lod_2"+f)),r.push(i.readImageData(u+"_lod_3"+f)),r},i}(),t;n._XzMeshHelper=e;t=function(){function t(){this.meshName="";this.imageNames=[];this.imageDatas=[]}return t.prototype.readImageData=function(t){for(var u,r,i=0;i<this.imageNames.length;i++)if(u=this.imageNames[i],t.toLowerCase()===u.toLowerCase()&&(r=this.imageDatas[i],r))return n.ArrayHelper.CloneDataArray(r)},t.FromXZData=function(i){var u,l,e,a;if(!i||i.length<=0)return null;n.SystemHelper.IsCompressedData(i)&&(i=n.SystemHelper.Uncompress(i));var r=new n.BinaryReader(new n.MemoryStream(i)),f=new t,o=r.readInt32(),s=!0;o<0?o=r.readInt32():s=!1;u=r.readBytes(o);f.meshName=s?n.EncodingHelper.GetUtf8String(u):n.EncodingHelper.DecodingGb2String(u);l=r.readInt32();e=r.readBytes(l);try{for(;;){a=r.readInt32();u=r.readBytes(a);var v=r.readInt32(),h=r.readBytes(v),c=void 0;c=s?n.EncodingHelper.GetUtf8String(u):n.EncodingHelper.DecodingGb2String(u);f.imageNames.push(c);c.indexOf(".dsx")>=0&&(h=n.SystemHelper.Uncompress(h));f.imageDatas.push(h)}}catch(y){}return f.modelData=n.SystemHelper.IsCompressedData(e)?n.SystemHelper.Uncompress(e):e,f},t}();n._XzFileReader=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var i=function(){function t(){this.SY=[];this.Lf=[]}return Object.defineProperty(t.prototype,"vertices",{get:function(){return this.SY},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indices",{get:function(){return this.Lf},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentVertex",{get:function(){return this.SY.length},enumerable:!1,configurable:!0}),t.prototype.addVertex=function(t,i){this.SY.push(new n.VertexPositionNormal(t,i))},t.prototype.addIndex=function(n,t,i){this.Lf.push(n);this.Lf.push(i);this.Lf.push(t)},t}(),e=function(t){function i(r,u,f){var o,h,e,s;if(r===void 0&&(r=1),u===void 0&&(u=1),f===void 0&&(f=32),o=t.call(this)||this,f<3)throw new n.Exception("tessellation");for(r=r/2,h=u/2,e=0;e<f;e++)s=i.Oi(e,f),t.prototype.addVertex.call(o,n.Vector3.Up().scale(r),s),t.prototype.addVertex.call(o,s.scale(h).add(n.Vector3.Down().scale(r)),s),t.prototype.addIndex.call(o,e*2,e*2+1,(e*2+2)%(f*2)),t.prototype.addIndex.call(o,e*2+1,(e*2+3)%(f*2),(e*2+2)%(f*2));return o.Uj(f,r,h,n.Vector3.Down()),o}return __extends(i,t),i.prototype.Uj=function(n,r,u,f){for(var o,e=0;e<n-2;e++)f.y>0?t.prototype.addIndex.call(this,this.currentVertex,this.currentVertex+(e+1)%n,this.currentVertex+(e+2)%n):t.prototype.addIndex.call(this,this.currentVertex,this.currentVertex+(e+2)%n,this.currentVertex+(e+1)%n);for(e=0;e<n;e++)o=i.Oi(e,n).scale(u).add(f.scale(r)),t.prototype.addVertex.call(this,o,f)},i.Oi=function(t,i){var r=t*6.28318548/i,u=Math.cos(r),f=Math.sin(r);return new n.Vector3(u,0,f)},i}(i),r=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.createPatchIndices=function(n,i){for(var r,u,e=n+1,f=0;f<n;f++)for(r=0;r<n;r++)u=new Int32Array([f*e+r,(f+1)*e+r,(f+1)*e+r+1,f*e+r,(f+1)*e+r+1,f*e+r+1]),i&&(u=u.reverse()),t.prototype.addIndex.call(this,this.currentVertex+u[0],this.currentVertex+u[1],this.currentVertex+u[2]),t.prototype.addIndex.call(this,this.currentVertex+u[3],this.currentVertex+u[4],this.currentVertex+u[5])},i.prototype.createPatchVertices=function(r,u,f){for(var e,c,h=0;h<=u;h++)for(e=h/u,c=0;c<=u;c++){var o=c/u,l=i.SL(r[0],r[1],r[2],r[3],e),a=i.SL(r[4],r[5],r[6],r[7],e),v=i.SL(r[8],r[9],r[10],r[11],e),y=i.SL(r[12],r[13],r[14],r[15],e),p=i.SL(l,a,v,y,o),w=i.SL(r[0],r[4],r[8],r[12],o),b=i.SL(r[1],r[5],r[9],r[13],o),k=i.SL(r[2],r[6],r[10],r[14],o),d=i.SL(r[3],r[7],r[11],r[15],o),g=i.VI(l,a,v,y,o),nt=i.VI(w,b,k,d,e),s=n.Vector3.Cross(g,nt);s.length()>.0001?(s.normalize(),f&&(s=s.negate())):s=p.y>0?n.Vector3.Up():n.Vector3.Down();t.prototype.addVertex.call(this,p,s)}},i.Vx=function(n,t,i,r,u){return n*(1-u)*(1-u)*(1-u)+t*3*u*(1-u)*(1-u)+i*3*u*u*(1-u)+r*u*u*u},i.SL=function(t,r,u,f,e){var o=new n.Vector3;return o.x=i.Vx(t.x,r.x,u.x,f.x,e),o.y=i.Vx(t.y,r.y,u.y,f.y,e),o.z=i.Vx(t.z,r.z,u.z,f.z,e),o.clone()},i.Wt=function(n,t,i,r,u){return n*(-1+2*u-u*u)+t*(1-4*u+3*u*u)+i*(2*u-3*u*u)+r*u*u},i.VI=function(t,r,u,f,e){var o=new n.Vector3;return o.x=i.Wt(t.x,r.x,u.x,f.x,e),o.y=i.Wt(t.y,r.y,u.y,f.y,e),o.z=i.Wt(t.z,r.z,u.z,f.z,e),o.normalize(),o.clone()},i}(i),u=function(i){function r(t,u){var f,s,o,e;if(t===void 0&&(t=1),u===void 0&&(u=8),f=i.call(this)||this,u<1)throw new n.Exception("tessellation");for(s=r.teapotPatches,o=0;o<s.length;o++)e=s[o],f.tessellatePatch(e,u,new n.Vector3(t,t,t)),f.tessellatePatch(e,u,new n.Vector3(-t,t,t)),e.mirrorZ&&(f.tessellatePatch(e,u,new n.Vector3(t,t,-t)),f.tessellatePatch(e,u,new n.Vector3(-t,t,-t)));return f}return __extends(r,i),Object.defineProperty(r,"teapotPatches",{get:function(){if(!r.Wn){var n=[];n.push(new t(!0,new Int32Array([102,103,104,105,4,5,6,7,8,9,10,11,12,13,14,15])));n.push(new t(!0,new Int32Array([12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27])));n.push(new t(!0,new Int32Array([24,25,26,27,29,30,31,32,33,34,35,36,37,38,39,40])));n.push(new t(!0,new Int32Array([96,96,96,96,97,98,99,100,101,101,101,101,0,1,2,3])));n.push(new t(!0,new Int32Array([0,1,2,3,106,107,108,109,110,111,112,113,114,115,116,117])));n.push(new t(!1,new Int32Array([41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56])));n.push(new t(!1,new Int32Array([53,54,55,56,57,58,59,60,61,62,63,64,28,65,66,67])));n.push(new t(!1,new Int32Array([68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83])));n.push(new t(!1,new Int32Array([80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95])));n.push(new t(!0,new Int32Array([118,118,118,118,124,122,119,121,123,126,125,120,40,39,38,37])));r.Wn=n}return r.Wn},enumerable:!1,configurable:!0}),r.prototype.tessellatePatch=function(t,u,f){for(var h,o,s=new Array(16),e=0;e<16;e++)h=t.indices[e],s[e]=r.TeapotControlPoints[h].multiply(f);o=n.MathHelper.Sign(f.x)!==n.MathHelper.Sign(f.z);i.prototype.createPatchIndices.call(this,u,o);i.prototype.createPatchVertices.call(this,s,u,o)},r.TeapotControlPoints=[new n.Vector3(0,.345,-.05),new n.Vector3(-.028,.345,-.05),new n.Vector3(-.05,.345,-.028),new n.Vector3(-.05,.345,-0),new n.Vector3(0,.3028125,-.334375),new n.Vector3(-.18725,.3028125,-.334375),new n.Vector3(-.334375,.3028125,-.18725),new n.Vector3(-.334375,.3028125,-0),new n.Vector3(0,.3028125,-.359375),new n.Vector3(-.20125,.3028125,-.359375),new n.Vector3(-.359375,.3028125,-.20125),new n.Vector3(-.359375,.3028125,-0),new n.Vector3(0,.27,-.375),new n.Vector3(-.21,.27,-.375),new n.Vector3(-.375,.27,-.21),new n.Vector3(-.375,.27,-0),new n.Vector3(0,.13875,-.4375),new n.Vector3(-.245,.13875,-.4375),new n.Vector3(-.4375,.13875,-.245),new n.Vector3(-.4375,.13875,-0),new n.Vector3(0,.007499993,-.5),new n.Vector3(-.28,.007499993,-.5),new n.Vector3(-.5,.007499993,-.28),new n.Vector3(-.5,.007499993,-0),new n.Vector3(0,-.105,-.5),new n.Vector3(-.28,-.105,-.5),new n.Vector3(-.5,-.105,-.28),new n.Vector3(-.5,-.105,-0),new n.Vector3(0,-.105,.5),new n.Vector3(0,-.2175,-.5),new n.Vector3(-.28,-.2175,-.5),new n.Vector3(-.5,-.2175,-.28),new n.Vector3(-.5,-.2175,-0),new n.Vector3(0,-.27375,-.375),new n.Vector3(-.21,-.27375,-.375),new n.Vector3(-.375,-.27375,-.21),new n.Vector3(-.375,-.27375,-0),new n.Vector3(0,-.2925,-.375),new n.Vector3(-.21,-.2925,-.375),new n.Vector3(-.375,-.2925,-.21),new n.Vector3(-.375,-.2925,-0),new n.Vector3(0,.17625,.4),new n.Vector3(-.075,.17625,.4),new n.Vector3(-.075,.2325,.375),new n.Vector3(0,.2325,.375),new n.Vector3(0,.17625,.575),new n.Vector3(-.075,.17625,.575),new n.Vector3(-.075,.2325,.625),new n.Vector3(0,.2325,.625),new n.Vector3(0,.17625,.675),new n.Vector3(-.075,.17625,.675),new n.Vector3(-.075,.2325,.75),new n.Vector3(0,.2325,.75),new n.Vector3(0,.12,.675),new n.Vector3(-.075,.12,.675),new n.Vector3(-.075,.12,.75),new n.Vector3(0,.12,.75),new n.Vector3(0,.06375,.675),new n.Vector3(-.075,.06375,.675),new n.Vector3(-.075,.007499993,.75),new n.Vector3(0,.007499993,.75),new n.Vector3(0,-.04875001,.625),new n.Vector3(-.075,-.04875001,.625),new n.Vector3(-.075,-.09562501,.6625),new n.Vector3(0,-.09562501,.6625),new n.Vector3(-.075,-.105,.5),new n.Vector3(-.075,-.18,.475),new n.Vector3(0,-.18,.475),new n.Vector3(0,.02624997,-.425),new n.Vector3(-.165,.02624997,-.425),new n.Vector3(-.165,-.18,-.425),new n.Vector3(0,-.18,-.425),new n.Vector3(0,.02624997,-.65),new n.Vector3(-.165,.02624997,-.65),new n.Vector3(-.165,-.12375,-.775),new n.Vector3(0,-.12375,-.775),new n.Vector3(0,.195,-.575),new n.Vector3(-.0625,.195,-.575),new n.Vector3(-.0625,.17625,-.6),new n.Vector3(0,.17625,-.6),new n.Vector3(0,.27,-.675),new n.Vector3(-.0625,.27,-.675),new n.Vector3(-.0625,.27,-.825),new n.Vector3(0,.27,-.825),new n.Vector3(0,.28875,-.7),new n.Vector3(-.0625,.28875,-.7),new n.Vector3(-.0625,.2934375,-.88125),new n.Vector3(0,.2934375,-.88125),new n.Vector3(0,.28875,-.725),new n.Vector3(-.0375,.28875,-.725),new n.Vector3(-.0375,.298125,-.8625),new n.Vector3(0,.298125,-.8625),new n.Vector3(0,.27,-.7),new n.Vector3(-.0375,.27,-.7),new n.Vector3(-.0375,.27,-.8),new n.Vector3(0,.27,-.8),new n.Vector3(0,.4575,-0),new n.Vector3(0,.4575,-.2),new n.Vector3(-.1125,.4575,-.2),new n.Vector3(-.2,.4575,-.1125),new n.Vector3(-.2,.4575,-0),new n.Vector3(0,.3825,-0),new n.Vector3(0,.27,-.35),new n.Vector3(-.196,.27,-.35),new n.Vector3(-.35,.27,-.196),new n.Vector3(-.35,.27,-0),new n.Vector3(0,.3075,-.1),new n.Vector3(-.056,.3075,-.1),new n.Vector3(-.1,.3075,-.056),new n.Vector3(-.1,.3075,-0),new n.Vector3(0,.3075,-.325),new n.Vector3(-.182,.3075,-.325),new n.Vector3(-.325,.3075,-.182),new n.Vector3(-.325,.3075,-0),new n.Vector3(0,.27,-.325),new n.Vector3(-.182,.27,-.325),new n.Vector3(-.325,.27,-.182),new n.Vector3(-.325,.27,-0),new n.Vector3(0,-.33,-0),new n.Vector3(-.1995,-.33,-.35625),new n.Vector3(0,-.31125,-.375),new n.Vector3(0,-.33,-.35625),new n.Vector3(-.35625,-.33,-.1995),new n.Vector3(-.375,-.31125,-0),new n.Vector3(-.35625,-.33,-0),new n.Vector3(-.21,-.31125,-.375),new n.Vector3(-.375,-.31125,-.21)],r}(r),t=function(){function n(n,t){this.mirrorZ=!1;this.indices=t;this.mirrorZ=n}return n}(),o=function(t){function i(r,u,f,e){var s,c,l,o,h;if(r===void 0&&(r=1),u===void 0&&(u=1),f===void 0&&(f=1),e===void 0&&(e=32),s=t.call(this)||this,e<3)throw new n.Exception("tessellation");for(r=r/2,c=u/2,l=f/2,o=0;o<e;o++)h=i.Oi(o,e),t.prototype.addVertex.call(s,h.scale(c).add(n.Vector3.Up().scale(r)),h),t.prototype.addVertex.call(s,h.scale(l).add(n.Vector3.Down().scale(r)),h),t.prototype.addIndex.call(s,o*2,(o*2+2)%(e*2),o*2+1),t.prototype.addIndex.call(s,o*2+1,(o*2+2)%(e*2),(o*2+3)%(e*2));return s.Uj(e,r,c,n.Vector3.Up()),s.Uj(e,r,l,n.Vector3.Down()),s}return __extends(i,t),i.prototype.Uj=function(n,r,u,f){for(var o,e=0;e<n-2;e++)f.y>0?t.prototype.addIndex.call(this,this.currentVertex,this.currentVertex+(e+2)%n,this.currentVertex+(e+1)%n):t.prototype.addIndex.call(this,this.currentVertex,this.currentVertex+(e+1)%n,this.currentVertex+(e+2)%n);for(e=0;e<n;e++)o=i.Oi(e,n).scale(u).add(f.scale(r)),t.prototype.addVertex.call(this,o,f)},i.Oi=function(t,i){var r=t*6.28318548/i,u=Math.cos(r),f=Math.sin(r);return new n.Vector3(u,0,f)},i}(i),f=function(){function t(){}return t.CreateBox=function(t){var r,a,u,s;t===void 0&&(t=1);r=[];r.push(new n.Vector3(0,0,1));r.push(new n.Vector3(0,0,-1));r.push(new n.Vector3(1,0,0));r.push(new n.Vector3(-1,0,0));r.push(new n.Vector3(0,1,0));r.push(new n.Vector3(0,-1,0));var y=r,f=[],e=[],h=[],c=[];for(a=0;a<y.length;a++){var i=y[a],l=new n.Vector3(i.y,i.z,i.x),v=n.Vector3.Cross(i,l),o=e.length;f.push(o);f.push(o+1);f.push(o+2);f.push(o);f.push(o+2);f.push(o+3);u=i.subtract(l).subtract(v).scale(t/2);e.push(u);h.push(i);c.push(new n.Vector2(1,1));u=i.subtract(l).add(v).scale(t/2);e.push(u);h.push(i);c.push(new n.Vector2(0,1));u=i.add(l).add(v).scale(t/2);e.push(u);h.push(i);c.push(new n.Vector2(0,0));u=i.add(l).subtract(v).scale(t/2);e.push(u);h.push(i);c.push(new n.Vector2(1,0))}return s=new n.MeshVertexData,s.indices=f,s.positions=e,s.normals=h,s.uvs=c,s},t.CreateSphere=function(t,i){var e,l,p,s,a,r,o;t===void 0&&(t=1);i===void 0&&(i=32);var k=t/2,h=2+i,u=2*h,f=[],c=[],v=[],y=[];for(e=0;e<=h;e=e+1){for(l=e/h,p=l*3.14159274,s=0;s<=u;s=s+1){var w=s/u,d=w*3.14159274*2,g=n.Matrix.RotationZ(-p),nt=n.Matrix.RotationY(d),tt=n.Vector3.TransformCoordinates(n.Vector3.Up(),g),it=n.Vector3.TransformCoordinates(tt,nt),b=it.scale(k),rt=n.Vector3.Normalize(b);c.push(b);v.push(rt);y.push(new n.Vector2(l,w))}if(e>0)for(a=c.length,r=a-2*(u+1);r+u+2<a;r++)f.push(r),f.push(r+1),f.push(r+u+1),f.push(r+u+1),f.push(r+1),f.push(r+u+2)}return o=new n.MeshVertexData,o.indices=f,o.positions=c,o.normals=v,o.uvs=y,o},t.CreateTorus=function(t,i,r){var u,f,c,l,s;t===void 0&&(t=1);i===void 0&&(i=.5);r===void 0&&(r=16);var o=[],v=[],y=[],p=[],e=r+1;for(u=0;u<=r;u++){var k=u/r,d=u*3.14159274*2/r-1.57079637,w=n.Matrix.Translation(t/2,0,0).multiply(n.Matrix.RotationY(d));for(f=0;f<=r;f++){var g=1-f/r,b=f*3.14159274*2/r+3.14159274,nt=Math.cos(b),tt=Math.sin(b),h=new n.Vector3(nt,tt,0),a=h.scale(i/2),it=new n.Vector2(k,g);a=n.Vector3.TransformCoordinates(a,w);h=n.Vector3.TransformNormal(h,w);v.push(a);y.push(h);p.push(it);c=(u+1)%e;l=(f+1)%e;o.push(u*e+f);o.push(u*e+l);o.push(c*e+f);o.push(u*e+l);o.push(c*e+l);o.push(c*e+f)}}return s=new n.MeshVertexData,s.indices=o,s.positions=v,s.normals=y,s.uvs=p,s},t.CreateGround=function(t,i,r){var l,a,u,f,o;t===void 0&&(t=1);i===void 0&&(i=1);r===void 0&&(r=1);var e=[],s=[],h=[],c=[];for(u=0;u<=r;u++)for(f=0;f<=r;f++)l=new n.Vector3(f*t/r-t/2,0,(r-u)*i/r-i/2),a=new n.Vector3(0,1,0),s.push(l),h.push(a),c.push(new n.Vector2(f/r,u/r));for(u=0;u<r;u++)for(f=0;f<r;f++)e.push(f+1+(u+1)*(r+1)),e.push(f+1+u*(r+1)),e.push(f+u*(r+1)),e.push(f+(u+1)*(r+1)),e.push(f+1+(u+1)*(r+1)),e.push(f+u*(r+1));return o=new n.MeshVertexData,o.indices=e,o.positions=s,o.normals=h,o.uvs=c,o},t.CreatePlane=function(t){var u;t===void 0&&(t=1);var r=[],f=[],e=[],o=[],i=t/2;return f.push(new n.Vector3(-i,-i,0)),e.push(new n.Vector3(0,0,-1)),o.push(new n.Vector2(0,0)),f.push(new n.Vector3(i,-i,0)),e.push(new n.Vector3(0,0,-1)),o.push(new n.Vector2(1,0)),f.push(new n.Vector3(i,i,0)),e.push(new n.Vector3(0,0,-1)),o.push(new n.Vector2(1,1)),f.push(new n.Vector3(-i,i,0)),e.push(new n.Vector3(0,0,-1)),o.push(new n.Vector2(0,1)),r.push(0),r.push(1),r.push(2),r.push(0),r.push(2),r.push(3),u=new n.MeshVertexData,u.indices=r,u.positions=f,u.normals=e,u.uvs=o,u},t.Xt=function(t,i,r,u){var o=Math.cos(t),s=Math.sin(t),f=u/r*t,e=Math.cos(f),h=i*(2+e)*.5*o,c=i*(2+e)*s*.5,l=i*Math.sin(f)*.5;return new n.Vector3(h,c,l)},t.CreateTorusKnot=function(i,r,u,f,e,o){var s,h,a;i===void 0&&(i=2);r===void 0&&(r=.5);u===void 0&&(u=32);f===void 0&&(f=32);e===void 0&&(e=2);o===void 0&&(o=3);var c=[],p=[],k=[],d=[];for(s=0;s<=u;s++){var et=s%u,g=et/u*2*e*3.14159274,v=t.Xt(g,i,e,o),nt=t.Xt(g+.01,i,e,o),tt=nt.subtract(v),l=nt.add(v),y=n.Vector3.Cross(tt,l);for(l=n.Vector3.Cross(y,tt),y.normalize(),l.normalize(),h=0;h<f;h++){var ot=h%f,it=ot/f*2*3.14159274,w=-r*Math.cos(it),b=r*Math.sin(it);p.push(new n.Vector3(v.x+w*l.x+b*y.x,v.y+w*l.y+b*y.y,v.z+w*l.z+b*y.z));d.push(new n.Vector2(s/u,h/f))}}for(s=0;s<u;s++)for(h=0;h<f;h++){var rt=(h+1)%f,st=s*f+h,ut=(s+1)*f+h,ht=(s+1)*f+rt,ft=s*f+rt;c.push(ft);c.push(ut);c.push(st);c.push(ft);c.push(ht);c.push(ut)}return k=n.VectorHelper.CalcNormals(p,c),a=new n.MeshVertexData,a.indices=c,a.positions=p,a.normals=k,a.uvs=d,a},t.CreateTeapot=function(i,r){var e=new u(i,r),o=new n.RefValue(null),s=new n.RefValue(null),f;return t.Wz(e.vertices,o,s),f=new n.MeshVertexData,f.positions=o.value,f.normals=s.value,f.indices=n.ArrayHelper.CloneArray(e.indices),f},t.CreateCylinder=function(t,i,r,u,f){t===void 0&&(t=1);i===void 0&&(i=.5);r===void 0&&(r=1);u===void 0&&(u=16);f===void 0&&(f=1);var e=BABYLON.VertexData.CreateCylinder({height:t,diameterTop:i,diameterBottom:r,tessellation:u,subdivisions:f});return n.MeshVertexData.FromBabylon(e)},t.Wz=function(n,t,i){var r,u;for(t.value=[],i.value=[],r=0;r<n.length;r++)u=n[r],t.value.push(u.position),i.value.push(u.normal)},t.CreateRect=function(t,i,r,u,f,e){var o=new n.MeshVertexData;return o.positions.push(new n.Vector3(-.5*t,-.5*i,0)),o.uvs.push(new n.Vector2(r,e)),o.positions.push(new n.Vector3(-.5*t,.5*i,0)),o.uvs.push(new n.Vector2(r,u)),o.positions.push(new n.Vector3(.5*t,.5*i,0)),o.uvs.push(new n.Vector2(f,u)),o.positions.push(new n.Vector3(.5*t,-.5*i,0)),o.uvs.push(new n.Vector2(f,e)),o.indices.push(0),o.indices.push(3),o.indices.push(1),o.indices.push(1),o.indices.push(3),o.indices.push(2),o},t.CreatePolygon=function(t){var e=[],r=n.Math3.PolygonToTriangles(t,null),o,i,u;if(!r)return null;for(o=[],i=0;i<r.length;i++)e.push(i);var f=n.Box.CalcRange(t),s=f.min,c=f.max.x-f.min.x,l=f.max.z-f.min.z,a=c,v=l;for(i=0;i<r.length;i++){var h=r[i],y=(h.x-s.x)/a,p=1-(h.z-s.z)/v;o.push(new n.Vector2(y,p))}return u=new n.MeshVertexData,u.indices=e,u.positions=r,u.uvs=o,u.normals=n.VectorHelper.CalcNormals(r,e),u},t.Wg=function(t,i){var u=[],l=[],f=[],r,e;if(t.length!==i.length)return null;var a=n.Math3.Length(t),v=a,y=1,o=0,d=t.length;for(r=0;r<d-1;r++){var g=(r+1)%d,nt=t[r],p=t[g],tt=i[r],ut=i[g];u.push(nt.clone());u.push(tt.clone());u.push(p.clone());u.push(tt.clone());u.push(ut.clone());u.push(p.clone());var w=n.Math3.DistancePoint(nt,p),h=void 0,s=void 0,b=void 0,it=void 0;v>0?(h=o/v,s=(o+w)/v):(h=o/a,s=(o+w)/a);b=h;it=s;var rt=0,c=void 0,k=void 0;y>0?(c=1/y,k=1/y):(c=1,k=1);o+=w;f.push(new n.Vector2(h,0));f.push(new n.Vector2(b,c));f.push(new n.Vector2(s,rt));f.push(new n.Vector2(b,c));f.push(new n.Vector2(it,k));f.push(new n.Vector2(s,rt))}for(r=0;r<u.length;r++)l.push(r);return e=new n.MeshVertexData,e.indices=l,e.positions=u,e.uvs=f,e.normals=n.VectorHelper.CalcNormals(u,l),e},t.CreatePolyBox=function(i,r,u,f){var e,o,s;return i.length!==r.length?null:(i.push(i[0].clone()),r.push(r[0].clone()),i=n.PolygonMath.ToCounterClockwise3(i),r=n.PolygonMath.ToCounterClockwise3(r),e=t.Wg(i,r),u&&(o=t.CreatePolygon(i),n.MeshVertexData.Merge(e,o)),f&&(s=t.CreatePolygon(r),n.MeshVertexData.Merge(e,s)),e)},t._CreateShadowVolumnPolyBox=function(t,i,r){var s,e,f,o;r===void 0&&(r=!1);var u=[],h=[];if(t.length!==i.length)return null;for(s=t.length,f=0;f<s;f++){var c=(f+1)%s,v=t[f],l=t[c],a=i[f],y=i[c];u.push(v.clone());u.push(a.clone());u.push(l.clone());u.push(a.clone());u.push(y.clone());u.push(l.clone())}for(n.ArrayHelper.AddRange(u,n.Math3.PolygonToTriangles(t,null)),e=n.Math3.PolygonToTriangles(i,null),!r&&e&&(e=e.reverse()),n.ArrayHelper.AddRange(u,e),f=0;f<u.length;f++)h.push(f);return o=new n.MeshVertexData,o.indices=h,o.positions=u,o.uvs=[],o},t.CreateWall=function(i,r,u,f){var h=[],e,c=!0,l=!0,o,s;for(u>0?e=n.Math3.Buffer(i,u*.5,f,!1,!1):(e=i,c=!1,l=!1),o=0;o<e.length;o++)s=e[o].clone(),s.y=s.y+r,h.push(s);return u>0?t.CreatePolyBox(h,e,c,l):t.Wg(h,e)},t}();n.PrimitivesFactory=f}(Drawsee||(Drawsee={})),function(n){var f=function(){function n(){this.xIndex=0;this.yIndex=0;this.xCount=0;this.yCount=0}return n.CreateFromCopy=function(t){if(!t)return null;var i=new n;return i.textureFile=t.textureFile,i.xIndex=t.xIndex,i.yIndex=t.yIndex,i.xCount=t.xCount,i.yCount=t.yCount,i},n}(),r,i,t,u;n.BlockTextureInfo=f;r=function(){function t(){this.power=0;this.name="";this.textureFile="";this.ambientColor=new n.Color(0,0,0,0);this.diffuseColor=new n.Color(1,1,1,1);this.specularColor=new n.Color(0,0,0,0);this.emissiveColor=new n.Color(0,0,0,0);this.power=3.2;this.blockTextureInfos=new Array(4);for(var t=0;t<this.blockTextureInfos.length;++t)this.blockTextureInfos[t]=null}return t.prototype.isTransparent=function(){var t=n.StringHelper.ExtractFileSuffix(this.textureFile).toLowerCase();return t===".png"||this.diffuseColor.a<.99},t}();n.MeshMaterialDefine=r;i=function(){function t(t,i,r){this.vertexes=n.ArrayHelper.CloneArray(t);this.normals=n.ArrayHelper.CloneArray(i);this.textureCoords=n.ArrayHelper.CloneArray(r)}return t.FromTextureVertexData=function(n,i){for(var r,f=[],e=[],o=[],u=0;u<n.length;u++)r=n[u],f.push(r.position),i&&e.push(r.normal),o.push(r.textureCoordinate);return new t(f,e,o)},t}();n.MeshData_PositionData=i;t=function(){function t(n,t,i,r){t===void 0&&(t="");i===void 0&&(i=0);r===void 0&&(r=0);this.materialName="";this.startTriIndex=0;this.triCount=0;this.mesh=n;this.materialName=t;this.startTriIndex=i;this.triCount=r}return t.CreateFromCopy=function(n,i){return new t(n,i.materialName,i.startTriIndex,i.triCount)},t.prototype.enumTriNos=function(){for(var t=[],n=0;n<this.triCount;n++)t.push(this.startTriIndex+n);return t},t.prototype.getBounds=function(){var t,i;return this.bounds?t=this.bounds:(i=this.getAllMeshPoints(),t=n.Box.CalcRange(i)),t},t.prototype.getAllMeshPoints=function(){for(var n=[],r=this.enumTriNos(),t=0;t<r.length;t++){var u=r[t],i=this.mesh.triangles.getAt(u),f=this.mesh.vertexes.getAt(i.v0),e=this.mesh.vertexes.getAt(i.v2),o=this.mesh.vertexes.getAt(i.v1);n.push(f);n.push(e);n.push(o)}return n},t}();n.SubMeshData=t;u=function(){function r(t){this.name="";this.materialName="";this.packFile="";this.vertexes=new n.CloneList;this.normals=new n.CloneList;this.textureCoords=new n.CloneList;this.triangles=new n.CloneList;this.materials=new n.CloneList;this.subs=new n.CloneList;this.name=t}return r.prototype.getPositionData=function(){return new i(this.vertexes.toArray(),this.normals.toArray(),this.textureCoords.toArray())},r.prototype.setPositionData=function(t){this.vertexes=new n.CloneList(t.vertexes);this.normals=new n.CloneList(t.normals);this.textureCoords=new n.CloneList(t.textureCoords);this.Uy=null},r.prototype.prepareTextureVertexes=function(t){var u,f,i,r;if(t===void 0&&(t=!1),t&&(this.Uy=null),this.Uy)u=this.Uy;else{for(f=this.vertexes.count,this.Uy=n.ArrayHelper.CloneArray(f),i=0;i<f;i++)r=new n.VertexPositionNormalTexture,r.position=this.vertexes.getAt(i),this.normals.count>i&&(r.normal=this.normals.getAt(i)),r.textureCoordinate=this.textureCoords.getAt(i),this.Uy.push(r);u=this.Uy}return u},r.prototype.getAllMeshPoints=function(){for(var n=[],t=0;t<this.triangles.count;t++){var i=this.triangles.getAt(t),r=this.vertexes.getAt(i.v0),u=this.vertexes.getAt(i.v2),f=this.vertexes.getAt(i.v1);n.push(r);n.push(u);n.push(f)}return n},r.prototype.enumTriNos=function(){for(var i=n.ArrayHelper.CloneArray(this.triangles.count),t=0;t<this.triangles.count;t++)i.push(t);return i},r.prototype.scaleMesh=function(t){var u,i,r;if(n.MathHelper.NearEqual(t,1,1e-13))return!0;for(u=this.vertexes.count,i=0;i<u;i++)r=this.vertexes.getAt(i),r=r.scale(t),this.vertexes.setAt(i,r);return!0},r.prototype.calcRange=function(){return this.bounds=n.Box.CalcRange(this.vertexes.toArray()),this.bounds},r.prototype.calculateNormal=function(){var t=n.Triangle3.ToIndexArray(this.triangles.toArray());this.normals=new n.CloneList(n.VectorHelper.CalcNormals(this.vertexes.toArray(),t))},r.prototype.calculateSubMeshRange=function(){for(var i,u,r=[],f=n.Triangle3.ToIndexArray(this.triangles.toArray()),e=this.vertexes.toArray(),t=0;t<this.subs.count;t++)i=this.subs.getAt(t),u=n.VectorHelper.CalcBoundingBoxIndexed(e,f,i.startTriIndex,i.triCount*3),r.push(u);return r},r.prototype.copyTriangleAndSubMeshes=function(i){var r,u;for(this.triangles=new n.CloneList(i.triangles),this.subs.clear(),r=0;r<i.subs.count;r++)u=i.subs.getAt(r),this.subs.add(t.CreateFromCopy(this,u))},r.FromVertexData=function(i){var u=new r(""),f,e,o;for(u.vertexes=new n.CloneList(i.positions),u.normals=new n.CloneList(i.normals),u.textureCoords=new n.CloneList(i.uvs),f=0;f<i.indices.length;f=f+3)e=new n.Triangle3,e.v0=i.indices[f],e.v1=i.indices[f+2],e.v2=i.indices[f+1],u.triangles.add(e);return o=new t(u,"",0,0),o.startTriIndex=0,o.triCount=n.SystemHelper.ToInt(i.indices.length/3),u.subs.add(o),u.calculateNormal(),u},r}();n.MeshData=u}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(n,t,i,r){this.positions=n;this.indices=t;this.normals=i;this.uvs=r}return t.prototype.clone=function(){var i=this.positions?n.ArrayHelper.CloneArray(this.positions,!0):null,r=this.indices?n.ArrayHelper.CloneArray(this.indices,!1):null,u=this.normals?n.ArrayHelper.CloneArray(this.normals,!0):null,f=this.uvs?n.ArrayHelper.CloneArray(this.uvs,!0):null;return new t(i,r,u,f)},t.FromBabylon=function(i){var r=new t;return r.positions=n.VectorHelper.FloatToVector3Array(i.positions),r.normals=n.VectorHelper.FloatToVector3Array(i.normals),r.indices=n.ArrayHelper.CloneArray(i.indices),r.uvs=n.VectorHelper.FloatToVector2Array(i.uvs),r},t.Transform=function(t,i){for(var f=t.positions,u=t.normals,e=u&&u.length>0,r=0;r<t.normals.length;r++)f[r]=n.Vector3.TransformCoordinates(f[r],i);if(e)for(r=0;r<t.normals.length;r++)u[r]=n.Vector3.TransformCoordinates(u[r],i)},t.Scale=function(n,t){for(var i=0;i<n.positions.length;i++)n.positions[i].multiplyInPlace(t)},t.Merge=function(t,i){var u=t.positions.length,r;if(i.indices)for(r=0;r<i.indices.length;r++)t.indices.push(i.indices[r]+u);i.positions&&n.ArrayHelper.AddRange(t.positions,i.positions);i.normals&&n.ArrayHelper.AddRange(t.normals,i.normals);i.uvs&&n.ArrayHelper.AddRange(t.uvs,i.uvs)},t.ToVertexNormal=function(t){for(var r,f=new Array(t.positions.length),e=t.positions,u=t.normals,o=e.length,s=u&&u.length>0,i=0;i<o;i++)r=new n.VertexPositionNormal,r.position=e[i].clone(),s&&(r.normal=u[i].clone()),f[i]=r;return f},t.ToVertexPositionNormalTexture=function(t){for(var r,f=t.positions,u=t.normals,e=f.length,s=!!t.uvs,o=new Array(e),h=u&&u.length>0,i=0;i<e;i++)r=new n.VertexPositionNormalTexture,r.position=f[i].clone(),h&&(r.normal=u[i].clone()),s&&(r.textureCoordinate=t.uvs[i].clone()),o[i]=r;return o},t.Create=function(i,r,u,f){var c,l,s,e;if(!i||i.length<3)return null;var o=n.Box.CalcRange(i),a=o.max.x-o.min.x,v=o.max.z-o.min.z,h=i.length;if(!f)for(f=[],c=a,l=v,e=0;e<h;e++)s=i[e],f.push(new n.Vector2(s.x/c,1-s.z/l));if(!r)for(r=[],e=0;e<h;e++)r.push(e);return u||(u=n.ArrayHelper.CloneArray(n.VectorHelper.CalcNormals(i,r))),new t(i,r,u,f)},t.CreateFromEarthToRelativeWorld=function(i,r,u,f,e){var c,a,v,l,o;if(!r||r.length<3)return null;var h=n.Box.CalcRange(r),s=[],y=h.max.x-h.min.x,p=h.max.z-h.min.z;if(s=i?i.earthToLocalArray(r[0],r):r,c=s.length,!e)for(e=[],a=y,v=p,o=0;o<c;o++)l=s[o],e.push(new n.Vector2(l.x/a,l.z/v));if(!u)for(u=[],o=0;o<c;o++)u.push(o);return f||(f=n.ArrayHelper.CloneArray(n.VectorHelper.CalcNormals(s,u))),new t(s,u,f,e)},t.TransformToLocalCalc=function(n,t,i){var u=t[0].clone(),f=n.earthToLocalArray(u,t),r=i(f);return r.positions=n.localToEarthArray(u,r.positions),r},t.TransformToLocalCalc2=function(n,t,i,r){var u=t[0].clone(),e=n.earthToLocalArray(u,t),o=n.earthToLocalArray(u,i),f=r(e,o);return f.positions=n.localToEarthArray(u,f.positions),f},t}();n.MeshVertexData=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(n){function t(t){return n.call(this,new Float32Array(t*8),8)||this}return __extends(t,n),t.prototype.update=function(n,t,i){var e,u,f,o,s,r,h;if(n===void 0&&(n=null),t===void 0&&(t=null),i===void 0&&(i=null),u=0,f=this.data,n)for(e=Math.min(n.length,this.length),r=0;r<e;r++){if(r>=this.length)break;o=n[r];f[u]=o.x;f[u+1]=o.y;f[u+2]=o.z;u+=this._strideSize}if(u=0,t)for(e=Math.min(t.length,this.length),r=0;r<e;r++){if(r>=this.length)break;s=t[r];f[u+3]=s.x;f[u+4]=s.y;f[u+5]=s.z;u+=this._strideSize}if(u=0,i)for(e=Math.min(i.length,this.length),r=0;r<e;r++){if(r>=this.length)break;h=i[r];f[u+6]=h.x;f[u+7]=h.y;u+=this._strideSize}},t}(n.FloatTypeArrayBase),i=function(){function i(n,t){this.Ha=n;this.updateMesh(t)}return Object.defineProperty(i.prototype,"boundingInfo",{get:function(){return this.Sl},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this.Mn&&(this.Mn.dispose(),this.Mn=null)},i.prototype.render=function(t,i,r,u){if((u===void 0&&(u=null),!r||r.isReadyForDraw)&&this.Mn){var f=void 0;f=u?u:n.Matrix.IdentityReadOnly;r&&r.bindForRender(i,f);t.drawElements(this.Mn,0,this.Uq.indices.length)}},i.prototype.enumRenderChunks=function(t,i,r){var f=[];if(this.Mn){var u=this.Sl.boundingBox,e=n.Vector3.Distance(u.minimum,u.maximum)*.5,o=new n.RenderMeshChunk(i,r.add(u.center),e,!1,null,this.Mn,0,this.Uq.indices.length);f.push(o)}return f},i.prototype.intersects=function(t,i){var u,e,f,r;if(i===void 0&&(i=!1),!t.intersectsBox(this.Sl.boundingBox))return null;for(e=this.Uq.positions,f=this.Uq.indices,r=0;r<f.length;r=r+3){var s=e[f[r]].clone(),h=e[f[r+1]].clone(),c=e[f[r+2]].clone(),o=n.VectorHelper.IntersectRayTriangle(t,s,h,c);if(o&&(i||!u||o.distance<u.distance)&&(u=o,u.faceId=n.SystemHelper.ToInt(r/3),i))break}return u},i.prototype.getTrianglePoints=function(){for(var i=this.Uq.indices.length,r=n.Vector3Array.Create(i),u=this.Uq.positions,f=this.Uq.indices,t=0;t<i;t++)r.setAt(t,u[f[t]]);return r},i.prototype.XB=function(t){var i=this.Uq;i||(i=new n.MeshVertexData,this.Uq=i);t.positions&&(i.positions=t.positions);t.indices&&(i.indices=t.indices);t.normals&&(i.normals=t.normals);t.uvs&&(i.uvs=t.uvs)},i.prototype.updateMesh=function(i){var f,u,r;this.XB(i);this.Ub();f=!1;u=0;i.indices&&(u=i.indices.length);(!this.WU||this.WU.length<u)&&(this.WU=new t(u),f=!0);r=this.Uq;this.WU.update(r.positions,r.normals,r.uvs);f&&this.Mn&&(this.Mn.dispose(),this.Mn=null);var e=this.Ha,o=this.WU.data,s=r.indices;this.Mn?e.updateElement(this.Mn,o,s,n.VertexPositionNormalTexture.VertexDeclaration,n.ElementType.Triangles):this.Mn=e.createElement(o,s,n.VertexPositionNormalTexture.VertexDeclaration,n.ElementType.Triangles)},i.prototype.Ub=function(){if(this.Uq&&this.Uq.positions){var t=n.VectorHelper.CalcBoundingBox(this.Uq.positions);this.Sl=n.VectorHelper.CreateBoundingInfo(t.min,t.max)}},i}();n.RenderMesh=i}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(n,i,r,u){u===void 0&&(u=!1);this.originWorld=i;t.Tq(n);this.Nn(n.graphics,r,u)}return t.prototype.dispose=function(){this.Vn()},t.Tq=function(i){t.RE||(t.RE=new n.ColorMaterial(i))},t.prototype.Nn=function(t,i,r){var f,e,o,u,s,h;if(!this.LQ){for(f=[],u=0;u<i.length;u++)f.push(u);for(e=i.length,o=new Array(e),u=0;u<e;u++)s=new n.VertexPosition,s.position=i[u].clone(),o[u]=s.clone();h=0;h=r?n.ElementType.Lines:n.ElementType.LineStrip;this.LQ=t.createElement(o,f,n.VertexPosition.VertexDeclaration,h)}},t.prototype.Vn=function(){this.LQ&&(this.LQ.dispose(),this.LQ=null)},t.prototype.draw=function(i,r,u,f,e){if(f===void 0&&(f=!0),e===void 0&&(e=null),this.LQ){e||(e=n.Matrix.Identity());var o=t.RE;o.color=u;o._isUseDepthBuffer=f;o.bindForRender(r,e);i.drawElements(this.LQ,-1,-1)}},t}();n.LineRenderMesh=t}(Drawsee||(Drawsee={})),function(n){var t,r,i,u;(function(n){n[n.Round=0]="Round";n[n.Mitter=1]="Mitter";n[n.Bevel=2]="Bevel"})(t||(t={}));r=function(){function n(){}return n.CreatePipeMesh=function(n,t,i,r,f){i===void 0&&(i=!0);r===void 0&&(r=null);f===void 0&&(f=null);var e=new u;return e.createPipeMeshFromShape(n,t,i,r,f)},n}();n.PipelineMeshFactory=r;i=function(){function n(n,t){this.center=n;this.isTurn=t}return n}();u=function(){function r(){this.Ur=new n.Vector3(0,1,0)}return r.prototype.createPipeMeshFromShape=function(i,r,u,f,e){var c,o,l,a,h,y,s,p,v;return(u===void 0&&(u=!0),f===void 0&&(f=null),e===void 0&&(e=null),r=n.VectorHelper.FilterDuplicatedVector2(r,1e-5,!0),i.length<2||r.length<3)?null:(c=this.UI(r),r.push(r[0].clone()),c&&(r=this.WF(r)),o=n.Rect.CalcRange(r),l=Math.max(o.width,o.height)*.5,l=n.Math2.Distance(o.left,o.top,o.right,o.bottom)*.5,u&&(f||e)&&(h=[],f&&h.push(f),n.ArrayHelper.AddRange(h,i),e&&h.push(e),i=h),y=u?t.Round:t.Bevel,s=this.Ug(i,y,l),s=this.Vq(s,u&&!!f,u&&!!e),p=this.Un(r),a=this.UQ(s,p),v=this.Uw(s,a),c||this.Ul(v,s.length,a[0].length),v)},r.prototype.WF=function(n){for(var i=[],t=0;t<n.length;t++)i.push(n[t]),i.push(n[t].clone());return i},r.prototype.UI=function(t){for(var u=Math.PI/6,i=0;i<t.length-2;i++){var f=t[i],r=t[i+1],e=t[i+2],o=r.subtract(f),s=e.subtract(r);if(Math.abs(n.Math2.AngleBetween(o,s))>u)return!0}return!1},r.prototype.Ul=function(n,t,i){for(var f=n.normals,r=0,e=0;e<t;e++){var o=f[r],s=f[r+i-1],u=o.add(s);u.normalize();o.copyFrom(u);s.copyFrom(u);r+=i}},r.prototype.Un=function(t){for(var r=[],i=0;i<t.length;i++)r.push(new n.Vector3(t[i].x,t[i].y,0));return r},r.prototype.Sz=function(t,i){for(var r,o,f,h,e=[],s=t.length,u=0;u<s;u++)if(r=t[u],o=t[(u+1)%s],e.push(r),!n.Math3.NearEqual(r,o))for(f=1;f<i;f++)h=r.add(o.subtract(r).scale(f/i)),e.push(h);return e},r.prototype.VG=function(t,i){var f=t,r=i.clone(),u;return f.normalize(),r.normalize(),u=n.Vector3.Cross(f,r),n.Math3.NearZero(u,1e-13)&&(r=new n.Vector3(0,0,1),u=n.Vector3.Cross(f,r)),u.normalize(),r=n.Vector3.Cross(f,u).negate(),r.normalize(),n.Quaternion.RotationQuaternionFromAxis(u.negate(),r,f)},r.prototype.Sw=function(t,i){t.normalize();i.normalize();var r=n.Vector3.Cross(t,i);return n.MathHelper.NearZero(r.length())&&(r=this.Ur.clone()),r.normalize(),r},r.prototype.Vl=function(n,t,i){var r=n.subtract(t),u=i.subtract(t);return this.Sw(r,u)},r.prototype.Vq=function(t,i,r){for(var k,c,v,o,h,f,e=[],l,u=0;u<t.length;u++)t[u].isTurn?l&&l.subTurns.push(t[u]):(l=t[u],l.subTurns=[],e.push(l));if(e.length<=2){for(u=0;u<t.length;u++)t[u].normal=this.Ur.clone();return t}var tt=e[0].center,s=this.Ur.clone(),w=s.clone();for(e[0].normal=s,e[1].normal=s,u=2;u<e.length;u+=2)n.Vector3.Dot(s,w)<0&&(s=s.negate()),e[u].normal=s,e[u+1].normal=s,w=s.clone();for(u=0;u<e.length-1;u++){var a=e[u].normal,b=e[u+1].normal,y=n.Vector3.Cross(a,b),p=e[u],h=p.subTurns.length;if(n.MathHelper.NearZero(y.length()))for(f=0;f<h;f++)p.subTurns[f].normal=a.clone();else for(k=n.Vector3.GetAngleBetweenVectors(a,b,y),f=0;f<h;f++){var g=p.subTurns[f],nt=n.Quaternion.RotationAxis(y,k*(f/(h+1))),d=new n.Vector3;a.rotateByQuaternionToRef(nt,d);g.normal=d}}if(i||r){for(c=[],v=e.length,u=0;u<v;u++)if(o=e[u],i&&(u===0||u===1)){if(u===1&&o.subTurns.length>0)for(h=Math.floor(o.subTurns.length/2-1),f=h;f<o.subTurns.length;f++)c.push(o.subTurns[f])}else if(r&&u>=v-3){if(u===v-3&&o.subTurns.length>0)for(h=Math.floor(o.subTurns.length/2+1),f=0;f<h;f++)c.push(o.subTurns[f])}else c.push(o),o.subTurns&&n.ArrayHelper.AddRange(c,o.subTurns);return c}return t},r.prototype.UQ=function(t,i){var u=t.length,r,s,h,c;if(u<2)return[];var e=[],f=new n.Vector3(0,0,1),o=n.Matrix.Identity();for(r=0;r<u;r++)r<u-1&&(f=t[r+1].center.subtract(t[r].center),f.normalize()),s=t[r].normal,h=this.VG(f,s),n.Matrix.FromQuaternionToRef(h,o),c=this.UV(t[r].center,i,o),e.push(c);return e},r.prototype.UV=function(t,i,r){for(var u,e=[],f=0;f<i.length;f++)u=i[f].clone(),u=n.Vector3.TransformNormal(u,r),e.push(new n.Vector3(u.x+t.x,u.y+t.y,u.z+t.z));return e},r.prototype.Tx=function(n,t,r){r.push(new i(n,t))},r.prototype.Qu=function(n,t){for(var u,r=0;r<n.length;r++)u=n[r],t.push(new i(u,!1))},r.prototype.VP=function(i,r,u,f,e,o){var a,v;r=r.subtract(i);u=u.subtract(i);var s=n.Vector3.Cross(r,u),h=n.Vector3.GetAngleBetweenVectors(r,u,s),c=Math.ceil(Math.abs(h)/n.MathHelper.ToRadians(5)),l;if(e?(s=s.negate(),l=n.Quaternion.RotationAxis(s,-h/(c+1))):l=n.Quaternion.RotationAxis(s,h/(c+1)),a=n.Matrix.Identity(),n.Matrix.FromQuaternionToRef(l,a),f===t.Round)for(v=0;v<c;v++)r=n.Vector3.TransformNormal(r,a),this.Tx(r.add(i),!0,o)},r.prototype.VQ=function(n,t,i){var r=i.add(n),u=i.add(t);return u.x*r.z-u.z*r.x>=0},r.prototype.Ug=function(i,r,u){var e,h,c,w,y,p,nt,o,tt,b,d,g,it;u===void 0&&(u=1);var l=[],rt=i.length,k,a,s=i[0],v=i[1],f=v.subtract(s);for(f.normalize(),k=f.clone(),e=this.Ur.clone(),h=n.Vector3.Cross(e,f).negate(),h.normalize(),e=n.Vector3.Cross(h,f),e.normalize(),a=s.clone(),s=v,c=f.negate(),w=1;w<rt-1;w++)v=i[w+1],f=v.subtract(s),f.normalize(),y=e.scale(n.Vector3.Dot(f,e)),y=f.subtract(y),y.normalize(),p=e.scale(n.Vector3.Dot(c,e)),p=c.subtract(p),p.normalize(),nt=!n.MathHelper.NearEqual(Math.abs(n.Vector3.Dot(y,p)),1e-7),nt?(o=f.add(c),o.normalize(),e=n.Vector3.Cross(f,c),e.normalize(),o=n.Vector3.Cross(o,e),o=n.Vector3.Cross(e,o),o.normalize(),tt=1/Math.max(.25,n.Vector3.Cross(o,c).length()),b=s.add(o.scale(tt*u)),h=n.Vector3.Cross(e,k).negate(),h.normalize(),d=b.add(h.scale(u)),this.Qu([a.clone(),d.clone()],l),h=n.Vector3.Cross(e,f).negate(),h.normalize(),g=b.add(h.scale(u)),it=!this.VQ(f,c,s),r===t.Round||r===t.Bevel?this.VP(b,d,g,r,it,l):(o=o.negate(),this.Tx(s,!1,l)),a=g.clone(),c=f.negate()):(this.Tx(a,!1,l),a=s),s=v,k=f.clone();return this.Qu([a.clone(),s.clone()],l),l},r.prototype.Uw=function(t,i){var u=new n.MeshVertexData([],[],[],[]),o,f,e,r,s;if(t.length<2||t.length!==i.length)return u;for(o=n.Math3.Length(i[0]),f=[],r=0;r<t.length;r++)f.push(t[r].center);if(e=0,i.length>=2){for(r=0;r<i.length-1;r++)s=e/o,this.RT(i[r],i[r+1],u,s),e+=n.Vector3.Distance(f[r],f[r+1]);this.Vt(u,i[i.length-1],e/o)}return u.normals=n.ArrayHelper.CloneArray(n.VectorHelper.CalcNormals(u.positions,u.indices)),u},r.prototype.Vt=function(t,i,r){for(var e=t.positions,o=t.uvs,f=i.length,s=1/(f-1),u=0;u<f;u++)e.push(i[u]),o.push(new n.Vector2(u*s,r))},r.prototype.RT=function(n,t,i,r){var e,u,o,f;if(n.length===t.length)for(e=i.positions.length,u=n.length,this.Vt(i,n,r),o=u,f=0;f<u;f++){var h=e+f%o,s=e+(f+1)%o,c=h+u,l=s+u;i.indices.push(h);i.indices.push(c);i.indices.push(s);i.indices.push(c);i.indices.push(l);i.indices.push(s)}},r}()}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(){this.onUpdate=new n.Observable;this.reset()}return t.prototype.Bm=function(){this.WW=new n.Vector3(0,0,0);this.Xh=new n.Vector3(1,1,1);this.Wj=new n.Vector3(0,0,0);this.XE=n.Quaternion.Identity();this.Iy=n.Matrix.Identity()},t.prototype.reset=function(){this.Bm();this.XT(!0)},Object.defineProperty(t.prototype,"matrix",{get:function(){return this.Iy.clone()},set:function(n){n.decompose(this.Xh,this.XE,this.WW);this.YO();this.XT(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"quaternion",{get:function(){return this.XE.clone()},set:function(n){this.XE=n.clone();this.XE.normalize();this.YO();this.XT(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_eulerRotation",{get:function(){return this.Wj.clone()},set:function(t){this.Wj=t.clone();this.XE=n.Quaternion.RotationYawPitchRoll(n.MathHelper.ToRadians(this.Wj.y),n.MathHelper.ToRadians(this.Wj.x),n.MathHelper.ToRadians(this.Wj.z));this.XT(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"heading",{get:function(){return this.Wj.y},set:function(t){this._eulerRotation=new n.Vector3(this.Wj.x,t,this.Wj.z)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return this.Wj.x},set:function(t){this._eulerRotation=new n.Vector3(t,this.Wj.y,this.Wj.z)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roll",{get:function(){return this.Wj.z},set:function(t){this._eulerRotation=new n.Vector3(this.Wj.x,this.Wj.y,t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xScale",{get:function(){return this.Xh.x},set:function(n){this.Xh.x=n;this.XT()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"yScale",{get:function(){return this.Xh.y},set:function(n){this.Xh.y=n;this.XT()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zScale",{get:function(){return this.Xh.z},set:function(n){this.Xh.z=n;this.XT()},enumerable:!1,configurable:!0}),t.prototype.XT=function(t){t===void 0&&(t=!0);this.Iy=n.Matrix.Scaling(this.Xh.x,this.Xh.y,this.Xh.z);var i=n.Matrix.Zero();n.Matrix.FromQuaternionToRef(this.XE,i);this.Iy=this.Iy.multiply(i);this.Iy=this.Iy.multiply(n.Matrix.Translation(this.WW.x,this.WW.y,this.WW.z));t&&n.SystemHelper.FireEvent(this.onUpdate,new n.EventArgs)},t.prototype.YO=function(){this.Wj=this.XE.toEulerAngles();this.Wj.x=n.NumberHelper.RestrictPrecision(this.Wj.x,2);this.Wj.y=n.NumberHelper.RestrictPrecision(this.Wj.y,2);this.Wj.z=n.NumberHelper.RestrictPrecision(this.Wj.z,2)},t.prototype.scale=function(t,i,r){t===void 0&&(t=1);i===void 0&&(i=1);r===void 0&&(r=1);this.Xh=new n.Vector3(t,i,r);this.XT()},t.prototype.rotateBetweenVectors=function(t,i){t.normalize();i.normalize();var r=n.Vector3.Cross(t,i),u=n.Vector3.GetAngleBetweenVectors(t,i,r),f=n.Quaternion.RotationAxis(r,u),e=f.toEulerAngles();this.quaternion=e.toQuaternion()},t}(),i;n.Transform3=t;i=function(i){function r(){var t=i.call(this)||this;return t.ZU=n.Matrix.Identity(),t.Zw=n.Matrix.Identity(),t.ZV=new n.RenderObservableBase,t}return __extends(r,i),r.prototype.Yx=function(){this.Pe()},Object.defineProperty(r.prototype,"localTransform",{get:function(){var n=this;return this.Ys||(this.Ys=new t,this.Ys.onUpdate.add(function(){n.Yx()})),this.Ys},enumerable:!1,configurable:!0}),r.prototype._setExternLocalTransform=function(n){this.Ys=n},Object.defineProperty(r.prototype,"worldMatrix",{get:function(){return this.ZU},enumerable:!1,configurable:!0}),r.prototype.onWorldMatrixUpdated=function(){},r.prototype.Pe=function(){var t=this.Yj?this.Yj:n.Matrix.Identity();this.ZU=this.Ys?this.Ys.matrix.multiply(t):t;this.Zw=n.Matrix.Invert(this.ZU);this.onWorldMatrixUpdated()},r.prototype.setGlobalWorldMatrix=function(n){n&&(this.Yj=n);this.Pe()},r.prototype.calcSelfOnlyRenderMatrix=function(){return this.Ys.matrix},r.prototype.localToWorld=function(t){var i=n.Vector3.Zero();return this.localToWorldToRef(t,i),i},r.prototype.localToWorldToRef=function(t,i){this.ZU.isIdentity()?i.copyFrom(t):n.Vector3.TransformCoordinatesToRef(t,this.ZU,i)},r.prototype.worldToLocal=function(t){var i=n.Vector3.Zero();return this.worldToLocalToRef(t,i),i},r.prototype.worldToLocalToRef=function(t,i){this.Zw.isIdentity()?i.copyFrom(t):n.Vector3.TransformCoordinatesToRef(t,this.Zw,i)},Object.defineProperty(r.prototype,"onBeforeRender",{get:function(){return this.ZV.onBeforeRender},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onAfterRender",{get:function(){return this.ZV.onAfterRender},enumerable:!1,configurable:!0}),r.prototype.notifyOnBeforeRender=function(){this.ZV.notifyOnBeforeRender(this)},r.prototype.notifyOnAfterRender=function(){this.ZV.notifyOnAfterRender(this)},r}(n.PickableObject);n.Object3=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var r=function(){function n(){}return n}(),i,u,t;n.RichTextLayoutInfo=r;i=function(n){function t(t,i){i===void 0&&(i=!1);var r=n.call(this)||this;return r.graphics=t,r.isCancel=i,r}return __extends(t,n),t}(n.EventArgs);n.RichTextRenderEventArgs=i;u=function(){function r(){this.Xl=n.Color.White;this.Xe=18;this.Yp=!0;this.YS=4;this.Ux=2;this.Zm=!1;this.Yr=n.Color.White;this._textures=[];this.PQ=!0;this.ZG=n.Rect.Empty}return Object.defineProperty(r.prototype,"_fontColor",{get:function(){return this.Xl},set:function(n){this.PQ=!n||!n.equals(this.Xl);this.Xl=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"_fontSize",{get:function(){return this.Xe},set:function(n){this.PQ=this.Xe!==n;this.Xe=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"fontFamilyName",{get:function(){return this.ZY},set:function(n){this.PQ=this.ZY!==n;this.ZY=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isBold",{get:function(){return this.Yp},set:function(n){this.PQ=this.Yp!==n;this.Yp=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"padding",{get:function(){return this.YS},set:function(n){this.PQ=this.YS!==n;this.YS=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"borderWidth",{get:function(){return this.Ux},set:function(n){this.PQ=this.Ux!==n;this.Ux=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"borderColor",{get:function(){return this.WV},set:function(n){this.PQ=!n||!n.equals(this.WV);this.WV=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"backgroundColor",{get:function(){return this.Uu},set:function(n){this.PQ=!n||!n.equals(this.Uu);this.Uu=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"roundRadius",{get:function(){return this.Yu},set:function(n){this.PQ=this.Yu!==n;this.Yu=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isAnchor",{get:function(){return this.Zm},set:function(n){this.PQ=this.Zm!==n;this.Zm=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"anchorColor",{get:function(){return this.Yr},set:function(n){this.PQ=!n||!n.equals(this.Yr);this.Yr=n},enumerable:!1,configurable:!0}),r.prototype.update=function(n,r,u){var e,f,o;if(u===void 0&&(u=!1),this.PQ||this.XW!==r){if(this.onBeforeRender){e=new i(t.GetRenderGraphics(this));this.onBeforeRender(e)}if(!e||!e.isCancel){if(u)for(f=0;f<r.length;f++)o=r.charAt(f),this._textures[f]&&n.deleteTexture(this._textures[f]),t.PrepareLayoutInfo(o,this),this._textures[f]=this.Um(n,o,null);else t.PrepareLayoutInfo(r,this),this.Zk(r)&&this._texture&&(n.deleteTexture(this._texture),this._texture=null),this._texture=this.Um(n,r,this._texture);this.XW=r;this.PQ=!1;this.onAfterRender&&this.onAfterRender()}}},r.prototype.Zk=function(n){var f=!1,u,i,r;return t.PrepareLayoutInfo(n,this),u=this.ZG,u&&(i=u,r=this._layoutInfo.canvasBounds,f=i.width<r.width||i.height<r.height||i.width>r.width*2||i.height>r.height*2,this.ZG.copyFrom(this._layoutInfo.canvasBounds)),f},r.prototype.Um=function(n,i,r){t.Render(n,i,this);r&&(n.deleteTexture(r),r=null);var u=t.GetCanvas();return r?n.updateTexture(r,u):r=n.createTexture(u),r},r}();n.RichTextProperty=u;t=function(){function t(){}return t.GetCanvas=function(){return this.Yd},t.GetRenderGraphics=function(t){var i=this.Yd,r;return i||(i=document.createElement("canvas"),this.ZC=new n.CanvasGraphics(i),this.Yd=i),r=t._layoutInfo.canvasBounds,i.width=r.width,i.height=r.height,this.ZC},t.Render=function(n,t,i){var r=this.GetRenderGraphics(i);r.clear();this.Zf(r,i);this.Wq(r,i);this.Xk(r,t,i)},t.PrepareLayoutInfo=function(t,i){var u=i._layoutInfo;u||(u=new r,i._layoutInfo=u);var e=n.CanvasGraphics.MeasureText(t,i._fontSize,i.fontFamilyName),o=i.padding,f=i.padding+i.borderWidth;u.textBounds=new n.Rect(0,0,e.width+2*f,e.height+2*f);u.textOrg=new n.Vector2(f,i._fontSize+f-i._fontSize*.15);i._anchorHeight=i.isAnchor?Math.max(i.padding*2,i._fontSize*.2):0;u.canvasBounds=new n.Rect(0,0,u.textBounds.width,u.textBounds.height+i._anchorHeight)},t.Xk=function(n,t,i){var r=i._layoutInfo;n.drawTextAdvance(t,r.textOrg,0,i._fontColor,i._fontSize,i.fontFamilyName,i.isBold)},t.Zf=function(t,i){var u=null,f=null,e,r,o;i.borderColor&&i.borderWidth&&(r=Math.max(1,i.borderWidth),u=new n.Pen2(i.borderColor,i.borderWidth));i.backgroundColor&&(f=new n.SolidColorBrush(i.backgroundColor));e=i._layoutInfo;(u||f)&&(r=i.borderWidth,o=new n.Rect(r,r,e.textBounds.width-r*2,e.textBounds.height-r*2),t.drawRectangle(o,u,f,i.roundRadius))},t.Wq=function(t,i){if(i.isAnchor){var e=i._layoutInfo,o=new n.Pen2(i.anchorColor,2),r=4,u=e.textBounds.width*.5,f=e.textBounds.height+i._anchorHeight-2,s=[new n.Vector2(u-r,f-r),new n.Vector2(u,f),new n.Vector2(u+r,f-r)];t.drawPolyline(s,o)}},t}()}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(){this.Xu=!1;this.XY=0}return t.prototype.initFromCenter=function(n,i){this.KB=n.clone();this.Db=i;this.XY=t.XK(i);this.Xu=!0},t.prototype.isObjectVisible=function(n,i){return(i===void 0&&(i=!1),!this.Xu)?!1:i?this.Wm(n):t.XC(n,this.KB,this.XY)&&this.Wm(n)},t.prototype.Wm=function(n){return n.camera.worldCamera.isSphereInFrustum(this.KB,this.Db)},t.IsDistanceWeightVisible=function(n,i,r){var u=t.XK(r);return t.XC(n,i,u)},t.XC=function(t,i,r){if(!t.isEarthCoord)return!0;var f=t.camera.worldEye,u=n.Vector3.DistanceSquared(f,i);return u<400&&r<u*.25?!1:r<u?!1:!0},t.XK=function(n){return n*n*1e4},t}(),i,r;n.GeoBoundingClip=t;i=function(n){function t(t,i,r){var u=n.call(this)||this;return u.geoObject=t,u.position=i,u.screenPosition=r,u}return __extends(t,n),Object.defineProperty(t.prototype,"layerName",{get:function(){return this.geoObject?this.geoObject.layerName:""},enumerable:!1,configurable:!0}),t}(n.EventArgs);n.GeoObject3PickEventArgs=i;r=function(i){function r(r,u){var f=i.call(this)||this;return f.name="",f.tag="",f.lodDistanceRatio=1,f.Uv=new n.Vector3,f.Bt=new n.Box,f.XN=new n.Box,f.XQ=new t,f._frustumOnlyClip=!0,f.TT=new n.Box,f.OC=!0,f.Xj=0,f._isClampHeightReady=!1,f._tempBindingWorld=n.Matrix.Identity(),f.Xw=!1,f.anno="",f.Xl=n.Color.White,f.isAnnoVisible=!0,f.isAnnoIgnoreDepthBuffer=!1,f.annoHorizontalAlignment=n.HorizontalAlignment.Center,f.annoVerticalAlignment=n.VerticalAlignment.Top,f.material=new n.BasicMaterial(r),f.geometry=u,f.GX=r,f.geometry&&(f.geometry._onUpdateCallback=function(n){f.We(n)}),f}return __extends(r,i),r.prototype.dispose=function(){this.Xb()},Object.defineProperty(r.prototype,"material",{get:function(){return this.Ns},set:function(n){if(this.Ns=n,n&&n.onAttachGeoObject)n.onAttachGeoObject(this)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"renderContext",{get:function(){return this.GX},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"layerName",{get:function(){return this.layer?this.layer.name:""},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isDataLoaded",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isReadyForDraw",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"color",{get:function(){return this.material.color},set:function(n){this.material.color=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"position",{get:function(){return this.geometry.position},set:function(n){this.geometry.updateFromPoint(n)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"points",{get:function(){return this.geometry.points},set:function(n){this.geometry.updateFromPointArray(n)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"positionWorld",{get:function(){return this.Uv},enumerable:!1,configurable:!0}),r.prototype.We=function(n){this.GX&&(this.Uv=this.GX.camera.coordSystem.earthToWorld(this.position));this.Xp();this.onUpdateDefineSpatialData(n);this.onAfterUpdateGeometry&&this.onAfterUpdateGeometry.hasObservers()&&this.onAfterUpdateGeometry.notifyObservers(this)},r.prototype.onUpdateDefineSpatialData=function(){},r.prototype.Xp=function(){this.setGlobalWorldMatrix(this.renderContext.camera.coordSystem.calcRotationMatrix(this.position))},Object.defineProperty(r.prototype,"bounds",{get:function(){return this.Bt},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"worldBounds",{get:function(){return this.XN},enumerable:!1,configurable:!0}),r.prototype.updateWorldBounds=function(t){this.XN=t;this.initBoundingClip(t.center,t.radius);var i=t.toBoundingPoints(),r=this.GX.coordSystem.worldToEarthArray(i);this.Bt=n.Box.CalcRange(r)},Object.defineProperty(r.prototype,"localBounds",{get:function(){return this.TT},enumerable:!1,configurable:!0}),r.prototype.updateLocalBounds=function(n){this.TT=n.clone()},r.prototype.initBoundingClip=function(n,t){this.XQ.initFromCenter(n,t)},r.prototype.updateWorldBoundsFromLocal=function(){var t=this.localBounds,i,r;t&&(i=this.localToWorldPoints(t.toBoundingPoints()),r=n.Box.CalcRange(i),this.updateWorldBounds(r))},Object.defineProperty(r.prototype,"isVisible",{get:function(){return this.OC},set:function(n){this.OC=n;this.Xy&&(this.Xy.isVisible=n)},enumerable:!1,configurable:!0}),r.prototype.checkObjectVisible=function(n){return this.layer&&this.layer.isObjectAlwaysVisible?!0:this.visibleFunc&&!this.visibleFunc()?!1:n!==undefined&&!this._checkObjectVisibleByDistance(n)?!1:this.isVisible&&this.geometry.points.length>0&&this.XQ.isObjectVisible(this.renderContext,this._frustumOnlyClip)},r.prototype._checkObjectVisibleByDistance=function(n){return(!this.minVisibleDistance||this.minVisibleDistance&&n>=this.minVisibleDistance)&&(!this.maxVisibleDistance||this.maxVisibleDistance&&n<=this.maxVisibleDistance)},r.prototype.checkAnnoVisible=function(){return this.isAnnoVisible&&this.checkObjectVisible()},r.prototype.localToEarth=function(n){var t=this.localToWorld(n);return this.renderContext.camera.coordSystem.worldToEarth(t)},r.prototype.earthToLocal=function(n){var t=this.renderContext.camera.coordSystem.earthToWorld(n);return this.worldToLocal(t)},r.prototype.localToEarthPoints=function(n){for(var r,i=[],t=0;t<n.length;t++)r=n[t],i.push(this.localToEarth(r));return i},r.prototype.earthToLocalPoints=function(n){for(var r,i=[],t=0;t<n.length;t++)r=n[t],i.push(this.earthToLocal(r));return i},r.prototype.worldToLocal=function(t){var i=n.Vector3.Zero();return this.worldToLocalToRef(t,i),i},r.prototype.worldToLocalToRef=function(n,t){n.subtractToRef(this.positionWorld,t);i.prototype.worldToLocalToRef.call(this,t,t)},r.prototype.worldToLocalPoints=function(n){for(var r,i=[],t=0;t<n.length;t++)r=n[t],i.push(this.worldToLocal(r));return i},r.prototype.localToWorld=function(t){var i=n.Vector3.Zero();return this.localToWorldToRef(t,i),i},r.prototype.localToWorldToRef=function(n,t){i.prototype.localToWorldToRef.call(this,n,t);t.addInPlace(this.positionWorld)},r.prototype.localToWorldPoints=function(n){for(var r,i=[],t=0;t<n.length;t++)r=n[t],i.push(this.localToWorld(r));return i},r.prototype.Xb=function(){this.Xy&&(this.Xy.dispose(),this.Xy=null)},r.prototype.setGroundHole=function(n,t){t===void 0&&(t=null);this.Xy=this.renderContext.stencilHoleManager.addHole("",n,t)},Object.defineProperty(r.prototype,"groundHeight",{get:function(){return this.Xj},set:function(n){var t=this.Xj!==n;if(this.Xj=n,t&&this.isClampToGround)this.onUpdateDefineSpatialData(this.geometry.geoType)},enumerable:!1,configurable:!0}),r.prototype._getIsClampHeightReady=function(){return this.isClampToGround?this._isClampHeightReady:!0},r.prototype._setIsClampHeightReady=function(n){this._isClampHeightReady=n},r.prototype.prepareBindingWorldInPlace=function(t,i,r){r===void 0&&(r=!1);n.Matrix.TranslationToRef(i.x-t.x,i.y-t.y,i.z-t.z,this._tempBindingWorld);r&&this.worldMatrix.multiplyToRef(this._tempBindingWorld,this._tempBindingWorld)},r.prototype.prepareBindingWorldClone=function(t,i,r){r===void 0&&(r=!1);var u=n.Matrix.Translation(i.x-t.x,i.y-t.y,i.z-t.z);return r&&(u=this.worldMatrix.multiply(u)),u},r.prototype.prepareParamsWhenDetachFromFather=function(n,t){n.copyFrom(this.Uv);t.copyFrom(this.localTransform.matrix)},r.prototype.initFirstForDraw=function(){this.Xw||(this.We(this.geometry.geoType),this.Xw=!0)},r.prototype._isTransparent=function(){var n=this.material,t;return n&&(t=n.color?n.color.a:1,n.alpha*t<1)?!0:!1},r.prototype.updateContents=function(){return!1},r.prototype.registerDataTask=function(){},r.prototype.drawContents=function(){return!1},r.prototype.recycle=function(){return!1},r.prototype.enumRenderMeshChunks=function(){return[]},r.prototype._prepareMaterialForMeshRender=function(){var n=this.highlightMaterial?this.highlightMaterial:this.material;return n&&n.isUseLight&&(n._lightDirection=this.renderContext.lightDirection),n},Object.defineProperty(r.prototype,"annoProperty",{get:function(){return this._annoProperty||(this._annoProperty=new n.RichTextProperty,this._annoProperty._fontColor=this.Xl),this._annoProperty},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"fontColor",{get:function(){return this._annoProperty?this._annoProperty._fontColor:this.Xl},set:function(n){this._annoProperty&&(this._annoProperty._fontColor=n);this.Xl=n},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"fontSize",{get:function(){var n=this.annoProperty;return n._fontSize},set:function(n){var t=this.annoProperty;t._fontSize=n},enumerable:!1,configurable:!0}),r.prototype.getAnnoPosition=function(){return null},r.prototype.getAnnoLocalBounds=function(){return this.localBounds},r.prototype.getAnnoScreenBounds=function(){return null},r.prototype.VV=function(t,i){var f=this.getAnnoPosition(),r,u;f?this.renderContext.camera.coordSystem.earthToWorldToRef(f,t):(r=this.getAnnoScreenBounds(),r?(t.copyFrom(this.positionWorld),r.width+=2,u=n.WindowsHelper.CalcPixelAlignOffsetToLeftBottom(this.annoHorizontalAlignment,this.annoVerticalAlignment,r.width,r.height),i.set(r.right+u.x,r.bottom+u.y)):(t.copyFrom(this.So(this.localBounds,this.annoVerticalAlignment)),i.set(0,0)))},r.prototype.So=function(t,i){var u=(t.min.x+t.max.x)*.5,f=(t.min.z+t.max.z)*.5,r;switch(i){case n.VerticalAlignment.Bottom:r=t.min.y;break;case n.VerticalAlignment.Center:r=(t.min.y+t.max.y)*.5;break;case n.VerticalAlignment.Top:r=t.max.y}return this.localToWorld(new n.Vector3(u,r,f))},r.prototype.XG=function(t){var r,i;return t?(r=this.renderContext.camera,(this.maxAnnoVisibleDistance||this.minAnnoVisibleDistance)&&((i=n.Vector3.DistanceSquared(t,r.worldEye),this.maxAnnoVisibleDistance&&i>this.maxAnnoVisibleDistance*this.maxAnnoVisibleDistance)||this.minAnnoVisibleDistance&&i<this.minAnnoVisibleDistance*this.minAnnoVisibleDistance))?!1:!0:!0},r.prototype.drawAnno=function(){var h,c;if(this.WE&&this.WE.length>0)return this.Xv(),this.Xi(this.UX,this.Xz);if(this.geometry.points.length<=0||!this.anno||!this.checkAnnoVisible())return!1;var s=this.isAnnoIgnoreDepthBuffer,i=n.Vector3.Zero(),t=n.Vector2.Zero();if(this.VV(i,t),!this.XG(i))return!1;h=this.renderContext.camera;c=h.worldCenter;i.subtractInPlace(c);var y=this.renderContext.graphics,f=this.annoHorizontalAlignment,e=this.annoVerticalAlignment,r=this._annoProperty,u=n.WindowsHelper.CalcPixelPaddingOffset(f,e,2);if(r){if(r.update(y,this.anno),r._texture){var o=r._texture,v=r._layoutInfo.canvasBounds,a=n.WindowsHelper.CalcPixelAlignOffsetToLeftBottom(f,e,v.width,v.height);t.addInPlace(a);this.layer._portraitChunkRenderList.addPortraitChunk(i,o,o.size.width,o.size.height,t.x+u.x,t.y+u.y,s)}}else{var l=20,p=this.anno.length*l,w=l,a=n.WindowsHelper.CalcPixelAlignOffsetToLeftBottom(f,e,p,w);t.addInPlace(a);this.layer._fontChunkRenderList.addTextChunk(i,this.anno,this.fontColor,t.x+u.x,t.y+u.y,s)}return!0},r.prototype._setAnnoWorldPositions=function(n,t){t===void 0&&(t=!1);this.WE=n;this.Xz=t;this.WN=!0},r.prototype._getAnnoWorldPositions=function(){return this.WE},r.prototype.Xi=function(t,i){var l,o,e,f,p,s,r,c;if((i===void 0&&(i=!1),this.geometry.points.length<=0||!this.anno||!this.checkAnnoVisible())||(t.length>1&&(o=n.SystemHelper.ToInt(t.length/2-1),l=t[o].add(t[o+1]).scale(.5)),!this.XG(l))||(e=t,f=e.length,f<=0))return!1;var w=this.renderContext.camera,a=w.worldCenter,b=this.renderContext.graphics,v=this.isAnnoIgnoreDepthBuffer,y=4,u=this._annoProperty;if(u){if(u.update(b,this.anno,!0),u._textures&&u._textures.length===f){var h=u._fontSize,k=u._textures,d=-Math.floor(h/2),g=this.layer._portraitChunkRenderList;for(r=0;r<f;r++)c=void 0,c=i?this.anno.length-r-1:r,g.addPortraitChunk(e[c].subtract(a),k[r],h,h,d,y,v)}}else for(p=this.layer._fontChunkRenderList,r=0;r<f;r++)s=void 0,s=i?this.anno.charAt(this.anno.length-r-1):this.anno.charAt(r),p.addTextChunk(e[r].subtract(a),s,this.fontColor,-10,y,v)},r.prototype.Xv=function(){this.WN&&(this.UX=this.UW(this.WE,this.anno),this.WN=!1)},r.prototype.UW=function(t,i){var u=[],o;if(!i||!t||t.length<=0)return u;var l=i.length+1,h=n.Math3.Length(t)/l,f=0,r=t[0],e,s=1;do if(e=t[s],o=n.Vector3.Distance(r,e),f+o>h){var a=(h-f)/o,v=e.subtract(r),c=r.add(v.scale(a));if(u.push(c),r=c,f=0,u.length>=i.length)break}else f+=o,r=e,s++;while(s<t.length);return u},r.prototype.buildIndex=function(){return!1},r.prototype.intersectRay=function(){return!1},r.prototype.clampLine=function(){return null},r.prototype.clampPolygon=function(){return null},r}(n.Object3);n.GeoObject3=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i,r){var u=t.call(this,i,n.Geometry.CreateFromPoint(r))||this;return u.Wc=n.TerrainConst.RootLevel,u.ZO(),u}return __extends(i,t),i.prototype.onUpdateDefineSpatialData=function(){this.isClampToGround&&(this.WP?this.WP=!1:(this.ZO(),this.Zi=!0));t.prototype.updateWorldBoundsFromLocal.call(this)},i.prototype.updateContents=function(){return this.isClampToGround&&this.ZJ?this.Yg():!1},i.prototype.ZO=function(){this.ZW=null;this.ZJ=!0;this.Wc=n.TerrainConst.RootLevel;this.YT=n.Vector3.Zero()},i.prototype.Yg=function(){var f,t,e,r,u,o,h;if(!this.isDataLoaded||this.Wc>=this.renderContext.terrainLeafLevel-2)return!1;if(f=this.renderContext.terrainCalculator,f){if(t=this.ZW,t||(e=this.worldBounds,e.radius<=0?t=this.points[0]:(t=e.center,t=this.renderContext.camera.coordSystem.worldToEarth(t)),this.ZW=t),this.Wc>n.TerrainConst.RootLevel&&!this.Zi){r=i.WZ;r||(r=n._TerrainPatchLevelConst.GetPatchRadius(n.TerrainConst.MinDetailLevel),r*=r,i.WZ=r);var c=n.Vector3.DistanceSquared(this.YT,this.renderContext.camera.worldEye),l=Math.max(0,n.TerrainConst.MinDetailLevel-this.Wc),s=n.MathHelper.IntPowOfTwo(l);if(c>r*s*s)return!1}if(this.Zi=!1,u=new n.RefValue(0),o=new n.RefValue(t.y),f.calculateHeightAdvance(t.x,t.z,o,u,this.Wc,n.TerrainConst.MinDetailLevel)&&(t.y=o.value,u.value>this.Wc))return this.Wc=u.value,this.WP=!0,h=t.y+this.groundHeight+this.localBounds.size.y*.5,this.geometry.updateFromPoint(new n.Vector3(t.x,h,t.z)),this._isClampHeightReady=!0,this.ZJ=this.Wc<n.TerrainConst.MinDetailLevel+2,this.renderContext.camera.coordSystem.earthToWorldToRef(t,this.YT),!0}else this._isClampHeightReady=!0;return!1},i}(n.GeoObject3),i;n.PointGeoObject=t;i=function(n){function t(t,i,r){var u=n.call(this,t,i)||this;return u.anno=r,u}return __extends(t,n),t}(t);n.AnnoGeoObject=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i,r,u,f){var e=t.call(this,i,r)||this;return e.focusEnlargeRatio=1.2,e.Ei=0,e.Dy=0,e.Xa=1,e.WS=1,e._frustumOnlyClip=!0,e.horizontalAlignment=n.HorizontalAlignment.Center,e.verticalAlignment=n.VerticalAlignment.Top,e.pixelOffset=new n.Vector2(0,0),e.attachImage(u,f),e}return __extends(i,t),i.prototype.getAnnoScreenBounds=function(){var t=this.Wr();return new n.Rect(t.x,t.y,this.Ei,this.Dy)},i.prototype.attachImage=function(t,i){var r=this;t&&(this.Vo=i,typeof t=="string"?n.WriteableBitmap.CreateFromUrl(t,function(n){r.Uo(n)}):this.Uo(t))},i.prototype.Uo=function(n){n&&(this.Gb=n,this.Ro&&(this.Ro.dispose(),this.Ro=null,this.Vo=null),this.Wu(n),this.XU())},Object.defineProperty(i.prototype,"localBounds",{get:function(){var t=1;return new n.Box(new n.Vector3(-t,-t,-t),new n.Vector3(t,t,t))},enumerable:!1,configurable:!0}),i.prototype.Wu=function(n){var t=this.localTransform.xScale,i=this.localTransform.yScale;this.Vo&&(t=this.Vo.x/n.pixelWidth,i=this.Vo.y/n.pixelHeight);this.Xa=t;this.WS=i},i.prototype.XU=function(){if(!this.Ro){var n=this.Gb;n&&(this.Ei=n.pixelWidth*this.Xa,this.Dy=n.pixelHeight*this.WS,n.isReady&&(this.Ro=this.renderContext.graphics.createTextureFromBitmap(n)),this.Ro&&(this.Gb=null))}},i.prototype.Wr=function(){var t=n.WindowsHelper.CalcPixelAlignOffsetToLeftBottom(this.horizontalAlignment,this.verticalAlignment,this.Ei,this.Dy);return new n.Vector2(t.x+this.pixelOffset.x,t.y+this.pixelOffset.y)},i.prototype.registerDataTask=function(){this.XU()},i.prototype.drawContents=function(){var i;if(!this._getIsClampHeightReady())return!1;if(this.Ro){this.notifyOnBeforeRender();var f=this.renderContext.camera.worldCenter,t=1,e=this.renderContext._isHighlightPickedObject;this.isPicked&&e&&(t=t*this.focusEnlargeRatio);i=!1;this.material&&(i=!this.material._isUseDepthBuffer);var r=this.Wr(),u=void 0,o=this.localTransform._eulerRotation;return o.equals(n.Vector3.Zero())&&this.localTransform.xScale==1&&this.localTransform.yScale==1&&this.localTransform.zScale==1||(u=this.localTransform.matrix),this.layer._portraitChunkRenderList.addPortraitChunk(this.positionWorld.subtract(f),this.Ro,this.Ro.size.width*t*this.Xa,this.Ro.size.height*t*this.WS,r.x,r.y,i,u),this.notifyOnAfterRender(),!0}return!1},i.prototype.TE=function(t){var i=this.Wr();return new n.Rect(i.x+t.x,i.y+t.y-this.Dy,this.Ei,this.Dy)},i.prototype.intersectRay=function(n,t,i,r){if(!this.Ro)return!1;var u=n.camera.coordSystem.worldToScreen(t),f=n.camera.coordSystem.worldToScreen(this.positionWorld);return this.TE(f).contains(u)?(r.copyFrom(t),!0):!1},i}(n.PointGeoObject);n.ImageGeoObject=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i,r){var u=t.call(this,i,n.Geometry.CreateFromPointArray(n.GeoType.LineString,r))||this;return u.Ei=1,u.Wv=[],u.UN=null,u}return __extends(i,t),i.prototype.dispose=function(){this.Vk()},i.prototype.Vk=function(){this.Xm&&(this.Xm.dispose(),this.Xm=null);this.UN&&(this.UN.dispose(),this.UN=null)},i.prototype.WM=function(){return!!this.Xm||!!this.UN},i.prototype.drawContents=function(n){var r=this.renderContext;if(this.WM()){var u=this.isClampToGround,f=void 0,i=r.graphics;t.prototype.notifyOnBeforeRender.call(this);u&&(f=i.getNearObjectMode(),i.setNearObjectMode(!0));this.Ei>1?this.WJ(n):this.Xo(r,this.Xm);u&&i.setNearObjectMode(f);t.prototype.notifyOnAfterRender.call(this)}return!0},i.prototype.Xo=function(n,i,r){var u=n.camera.worldCenter,f=i.originWorld;t.prototype.prepareBindingWorldInPlace.call(this,u,f,!1);r||(r=this.material.color);i.draw(n.graphics,n.camera.worldCamera,r,this.material._isUseDepthBuffer,this._tempBindingWorld)},Object.defineProperty(i.prototype,"width",{get:function(){return this.Ei},set:function(n){n=Math.max(1,n);var t=n!==this.Ei;if(this.Ei=n,t)this.onUpdateDefineSpatialData(this.geometry.geoType)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lineProperty",{get:function(){return this.VN||(this.width=Math.max(this.width,2),this.VN=new n.WideLineProperty),this.VN},enumerable:!1,configurable:!0}),i.prototype.WJ=function(){var n;if(this.isVisible){if(n=this.UN,n){var i=this.renderContext,r=i.camera.worldCenter,u=n._originWorld;t.prototype.prepareBindingWorldInPlace.call(this,r,u,!1);n.render(i.graphics,i.camera.worldCamera,this._tempBindingWorld)}return!0}},i.prototype.updateContents=function(){return this.prepareGroundHeight(),!0},i.prototype.WR=function(t){if(t){this.Vk();var i=n.VectorHelper.ToLocalVector3Array(t);this.Ei>1?this.UN=new n._WideLineRenderMesh(this.renderContext,[t],this):this.Xm=new n.LineRenderMesh(this.renderContext,t[0],i,!1)}},i.prototype.onUpdateDefineSpatialData=function(){this.isClampToGround?this.XJ(!0):(this.Wv=this.renderContext.camera.coordSystem.earthToWorldArray(this.geometry.points),this.XD(this.Wv))},i.prototype.onUpdateRenderSpatialData=function(n){this.WR(n);this._setAnnoWorldPositions(n,this.isToReverseRenderText())},i.prototype.XD=function(i){t.prototype.updateWorldBounds.call(this,n.Box.CalcRange(i));this.onUpdateRenderSpatialData(i)},i.prototype.getWorldPointsForRender=function(){return this.YB?this.VS():this.renderContext.camera.coordSystem.earthToWorldArray(this.points)},i.prototype.XJ=function(t){if((t===void 0&&(t=!1),this.isClampToGround)&&(t&&this.YB&&(this.YB.dispose(),this.YB=null),!this.YB)){var i=this.renderContext.camera.coordSystem.earthToWorldArray(this.points);this.YB=new n.GroundLine(this.renderContext,i)}},i.prototype.VS=function(){var n,t,r,i;if(!this.YB)return[];if(n=this.YB.getWorldClampPoints(),this.groundHeight){for(t=this.renderContext.coordSystem.worldToEarthArray(n),r=this.groundHeight,i=0;i<t.length;i++)t[i].y+=r;n=this.renderContext.coordSystem.earthToWorldArray(t)}return n},i.prototype.prepareGroundHeight=function(){if(!this.isClampToGround)return!1;if(this.XJ(),this.YB.prepareGroundHeight()){this._isClampHeightReady=!0;var n=this.VS();this.XD(n)}},i.prototype.isToReverseRenderText=function(){var n=this.points[0],t=this.points[this.points.length-1],i=n.x-t.x,r=n.z-t.z;return Math.abs(i)>Math.abs(r)?i>0:r<0},i.prototype.getEyeDistanceToLine=function(t){if(this.geometry.points.length>0){var i=t.camera.worldEye;return this.Wv&&this.Wv.length>0?n.Math3.DistancePointLine(i,this.Wv):n.Math3.DistancePoint(i,this.positionWorld)}return 0},i.prototype.prepareAnnoWorldPoints=function(t,i){for(var r=n.ArrayHelper.CloneArray(t,!0),u=0;u<r.length;u++)r[u].y+=i;return this.renderContext.coordSystem.earthToWorldArray(r)},i}(n.GeoObject3),i,r;n.LineGeoObject=t;i=function(t){function i(n,i,r,u,f){var e=t.call(this,n,i)||this;return e.Dy=r,e.WY=u,e.Wa=f,e}return __extends(i,t),i.prototype.Wf=function(){this.YC&&(this.YC.dispose(),this.YC=null)},i.prototype.dispose=function(){this.Wf()},i.prototype.onUpdateRenderSpatialData=function(){this.Ud(this.getWorldPointsForRender())},i.prototype.Ud=function(t){var u=this,i,r;if(t&&t.length>0){this.Wf();var f=this.renderContext.coordSystem,o=f.worldToEarthArray(t),s=n.MeshVertexData.TransformToLocalCalc(f,o,function(t){return n.PrimitivesFactory.CreateWall(t,u.Dy,u.WY,u.Wa)}),e=new n.GlobalMeshGeoObject(this.renderContext,s);for(e.initFirstForDraw(),e.material.color=this.material.color,this.YC=e,i=o,r=0;r<i.length;r++)i[r].y+=this.Dy;this._setAnnoWorldPositions(f.earthToWorldArray(i),this.isToReverseRenderText())}},i.prototype.registerDataTask=function(n){this.YC&&this.YC.registerDataTask(n)},i.prototype.drawContents=function(){if(!this._getIsClampHeightReady())return!1;var n=this.YC;return n&&(n._setIsClampHeightReady(this._getIsClampHeightReady()),t.prototype.notifyOnBeforeRender.call(this),n.highlightMaterial=this.highlightMaterial,n.material=this.material,n.drawContents(null),t.prototype.notifyOnAfterRender.call(this)),!0},i.prototype.enumRenderMeshChunks=function(){var n=this.YC;return n?n.enumRenderMeshChunks():[]},i.prototype.intersectRay=function(n,t,i,r){return this.YC&&this.YC.intersectRay(n,t,i,r)},i}(t);n.WallGeoObject=i;r=function(t){function i(n,i,r,u,f,e){var o=t.call(this,n,i)||this;return o.Ws=r,o.WO=u,f===undefined&&(f=r*.1),o.Wy=f,e===undefined&&(e=o.Wy),o.XF=e,o}return __extends(i,t),i.prototype.Wf=function(){this.YC&&(this.YC.dispose(),this.YC=null)},i.prototype.dispose=function(){this.Wf()},i.prototype.onUpdateDefineSpatialData=function(i){i===n.GeoType.Point&&this.YC?(this.YC.position=this.position.clone(),this.Xq()):t.prototype.onUpdateDefineSpatialData.call(this,i)},i.prototype.onUpdateRenderSpatialData=function(){this.Ud(this.getWorldPointsForRender())},i.prototype.Xq=function(){var n=this._getAnnoWorldPositions(),t,u;if(n&&this.Wl){var r=this.renderContext.coordSystem,i=r.worldToEarthArray(n),f=this.position.subtract(this.Wl);for(t=0;t<i.length;t++)u=i[t],u.addInPlace(f);n=r.earthToWorldArray(i);this._setAnnoWorldPositions(n,this.isToReverseRenderText());this.Wl=this.position.clone()}},i.prototype.Ud=function(t){var c,e,s;if(t&&t.length>0){this.Wf();var u=this.renderContext.coordSystem,i=void 0,r=this.geometry.points,f=r[0],l=u.earthToLocalArray(f,r),a=this.Wh(l,this.WO,this.Ws),h=!1,o=u.localToEarthArray(f,a);!this.isClampToGround&&this.XF?(c=this.Wk(r[0],r[r.length-1],o,this.Wy,this.XF),e=n.MeshVertexData.TransformToLocalCalc2(this.renderContext.coordSystem,c,o,function(t,i){return n.PrimitivesFactory.CreatePolyBox(t,i,!0,!0)}),e.positions=u.earthToLocalArray(f,e.positions),i=new n.MeshGeoObject(this.renderContext,f,e),i._setExternLocalTransform(this.localTransform)):(i=new n.PolyGeoObject(this.renderContext,o),h=!0);i&&(i.initFirstForDraw(),i.material=this.material,i.isClampToGround=this.isClampToGround,this.YC=i);s=void 0;s=h?this.getWorldPointsForRender():u.earthToWorldArray(this.Vb(r,this.Wy,this.XF));this._setAnnoWorldPositions(s,this.isToReverseRenderText());this.Wl=this.position.clone()}},i.prototype.registerDataTask=function(n){this.YC&&this.YC.registerDataTask(n)},i.prototype.drawContents=function(){if(!this._getIsClampHeightReady())return!1;var n=this.YC;return n&&(n._setIsClampHeightReady(this._getIsClampHeightReady()),t.prototype.notifyOnBeforeRender.call(this),n.highlightMaterial=this.highlightMaterial,n.material=this.material,n.drawContents(null),t.prototype.notifyOnAfterRender.call(this)),!0},i.prototype.enumRenderMeshChunks=function(){var n=this.YC;return n?n.enumRenderMeshChunks():[]},i.prototype.intersectRay=function(n,t,i,r){return this.YC&&this.YC.intersectRay(n,t,i,r)},i.prototype.Vb=function(t,i,r){var f=n.ArrayHelper.CloneArray(t,!0),e,u;for(i||(i=0),r||(r=0),e=(i+r)*.5,u=0;u<f.length;u++)f[u].y+=e;return f},i.prototype.Wh=function(t,i,r){var f=n.Shape2.Arrow(n.VectorHelper.ToVector2Array(t),i,r),u=n.VectorHelper.ToVector3Array(f);return this.WQ(t[0],t[t.length-1],u),u},i.prototype.WQ=function(t,i,r){for(var e=i.subtract(t).normalize(),o=n.Vector3.Distance(t,i),u=0;u<r.length;u++){var f=r[u],s=n.Vector3.Dot(f.subtract(t),e),h=Math.min(s/o,1);f.y=n.MathHelper.Lerp(t.y,i.y,h)}},i.prototype.Wk=function(t,i,r,u,f){var s=[],h=i.subtract(t).normalize(),c=n.Vector3.Distance(t,i),e;for(u||(u=0),e=0;e<r.length;e++){var l=r[e],a=n.Vector3.Dot(l.subtract(t),h),v=Math.max(0,Math.min(a/c,1)),o=r[e].clone();o.y=o.y+n.MathHelper.Lerp(f,u,v);s.push(o)}return s},i}(t);n.ArrowGeoObject=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i,r,u){var f=t.call(this,i,r)||this;return f.Xu=!1,f.PG=new n.Size3,f.WK(u),f._frustumOnlyClip=!1,f.Uc=u,f.material.isCulling=!0,f}return __extends(i,t),Object.defineProperty(i.prototype,"vertexData",{get:function(){return this.Uc},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this.Oh&&(this.Oh.dispose(),this.Oh=null)},i._CreateFromEarthTrianglePoints=function(t,r,u,f,e){var s=t.coordSystem,o=r[0].clone(),h=s.earthToLocalArray(o,r),c=n.MeshVertexData.Create(h,u,e,f);return new i(t,o,c)},i.prototype.WK=function(t){if(!this.Oh){this.Oh=new n.RenderMesh(this.renderContext.graphics,t);var i=new n.Box(this.Oh.boundingInfo.boundingBox.minimum,this.Oh.boundingInfo.boundingBox.maximum);this.PG=i.size;this.Xu=!0;this.updateLocalBounds(i);this.updateWorldBoundsFromLocal()}},i.prototype.updateMesh=function(n){this.Oh&&this.Oh.updateMesh(n)},i.prototype.drawContents=function(){var n,i;return this.Oh?this._getIsClampHeightReady()?(t.prototype.notifyOnBeforeRender.call(this),n=this.renderContext,t.prototype.prepareBindingWorldInPlace.call(this,this.renderContext.camera.worldCenter,this.positionWorld,!0),i=this._prepareMaterialForMeshRender(),this.Oh.render(n.graphics,n.camera.worldCamera,i,this._tempBindingWorld),t.prototype.notifyOnAfterRender.call(this),!0):!1:!1},i.prototype.enumRenderMeshChunks=function(){var i=t.prototype.prepareBindingWorldClone.call(this,n.Vector3.Zero(),this.positionWorld,!0);return this.Oh.enumRenderChunks(this.renderContext.graphics,i,this.positionWorld)},i.prototype.buildIndex=function(){if(!this.Rv){var t=this.Oh.getTrianglePoints();this.Rv=new n.MeshTriangleIndex(t)}return!0},i.prototype.intersectRay=function(i,r,u,f){var o,s,h;if(!this.Oh)return!1;var c=t.prototype.worldToLocal.call(this,r),l=t.prototype.worldToLocal.call(this,u),e=n.VectorHelper.CreateRay(c,l);return this.Rv&&(o=this.Rv.intersectsRay(e),o)?(f.copyFrom(t.prototype.localToWorld.call(this,o)),!0):(s=this.Oh.intersects(e,!1),s)?(h=e.origin.add(e.direction.scale(s.distance)),f.copyFrom(t.prototype.localToWorld.call(this,h)),!0):!1},i}(n.PointGeoObject);n.MeshGeoObject=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var f,r,t,i,u;(function(n){n[n.None=0]="None";n[n.Terrain=1]="Terrain";n[n.Building=2]="Building"})(f=n.ModelObjectType||(n.ModelObjectType={}));r=function(){function t(n,t,i,r){this.SC=0;this.Vp=[];this.VJ=n;this.SC=t;this.Ha=i;this.Uk=r}return Object.defineProperty(t.prototype,"isNeedPrepareMesh",{get:function(){return this.Uk&&this.Vp.length<=0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"meshes",{get:function(){return this.Vp},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isReadyForDraw",{get:function(){var n,t,f,r,i,u;if(this.Vp.length<=0)return!1;for(n=0,t=0;t<this.Vp.length;t++)for(f=this.Vp[t],r=f.subMeshes,i=0;i<r.length;i++)u=r[i],u&&u.material&&(n=n+1);return n>0},enumerable:!1,configurable:!0}),t.prototype.createDrawingMesh=function(t,i){var u,f,r,o,e;if(this.isNeedPrepareMesh&&(u=this.Uk,u.vertexes.length>0))for(f=n.FixedMeshData.FromMeshDataArray(n._MeshSplitHelper.SplitMesh(u.toMeshData())),r=0;r<f.length;r++)o=f[r],e=n._XzMeshHelper.CreateOneMesh(this.SC,this.Ha,o,i,!0),e&&this.Vp.push(e)},t.prototype.registerMaterialPrepareTask=function(n){for(var f,u,i,r,t=0;t<this.Vp.length;t++)for(f=this.Vp[t],u=f.subMeshes,i=0;i<u.length;i++)r=u[i],r&&r.material&&(n.lodParam.objectCenter=this.VJ.centerPositionWorld,r.material.loadTexture(n.lodParam.lod))},t}();t=function(){function t(t,i){this.scaleRatio=1;this.QW=!1;this.VB=!1;this.XS=new n.Vector3;this.Qo=new Array(4);this.Ut=new Array(4);this.To=!1;this.Ha=t;this.BH=i}return Object.defineProperty(t.prototype,"centerPositionWorld",{get:function(){return this.XS.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"boundingInfo",{get:function(){return this.Sl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDataLoaded",{get:function(){return this.VB},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isReadyForDraw",{get:function(){return this.To},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"meshPoints",{get:function(){return this.RC},enumerable:!1,configurable:!0}),t.prototype.setCenterPositionWorld=function(n){this.XS=n.clone()},t.prototype.Xf=function(){this.VB=!1;this.To=!1;this.Sl=null;this.WG=null;this.Qo=new Array(4);for(var n=0;n<this.Qo.length;++n)this.Qo[n]=null;this.RC=null;this.Rv=null},t.prototype.getLodMeshes=function(t){var u,i,r;for(t=n._LodCommonHelper.VerifyLod(t),u=[],i=t;i<4;i++)if(r=this.Qo[i],r&&r.isReadyForDraw){n.ArrayHelper.AddRange(u,r.meshes);break}return u},t.prototype.registerDataTask=function(t){var r=this,i;this.QW||(this.isDataLoaded?this.TV(t):this.VB||!this.BH||(this.UM||(i=this.BH,this.UM=new n.PromiseDelegate(function(){n.AsyncRenderContext.LoadData(n.AsyncDataLoadType.ArrayBuffer,i).then(function(n){r.UM.onThen();n&&(n.isBadUrl?r.WC(i):n.data&&r.Qp(i,i,n.data))})})),this.UM.tryInvoke()))},t.prototype.TV=function(t){var e=this,f=t.lodParam.lod,i,r,u;for(f=n._LodCommonHelper.VerifyLod(f),this.To=!1,i=f;i<4;i++)if(r=this.Qo[i],r&&r.isReadyForDraw){this.To=!0;break}for(i=3;i>=f;i=i-1)r=this.Qo[i],r&&(r.isNeedPrepareMesh&&(u=this.Ut[i],u||(u=n.AsyncRenderContext.PrepareData(i,function(n){return e.Wb(n)}),this.Ut[i]=u),u&&u.tryInvoke()),r.registerMaterialPrepareTask(t))},t.prototype.Qp=function(n,t,i){i&&i.length>0&&(this.Ww(i),this.VB=!0)},t.prototype.WC=function(n){n===this.BH&&(this.QW=!0)},t.prototype.Ww=function(t){var s=new n.RefValue,u=n._XzMeshHelper.ExtractMeshFromXzDataWithMaterial(this.Ha,this.BH,t,this.scaleRatio,s),f,e,o,i;for(this.WG=s.value,f=u.toMeshData().calcRange(),this.Sl=n.VectorHelper.CreateBoundingInfo(f.min,f.max),e=n.TypeArrayHelper.GetTrianglePoints(u.vertexes,u.triangles),this.RC=e,this.Rv=new n.MeshTriangleIndex(e),o=n.FixedMeshData.FromMeshDataArray(n._MeshLodGrouppingHelper.GetLodMesh(u.toMeshData())),i=0;i<o.length;i++)this.Qo[i]=new r(this,i,this.Ha,o[i])},t.prototype.Wb=function(t){var i=n.SystemHelper.ToInt(t);return i=n._LodCommonHelper.VerifyLod(i),this.Qo[i]&&this.Qo[i].createDrawingMesh(this.Ha,this.WG),!0},t.prototype.intersects=function(n){return this.Rv?this.Rv.intersectsRay(n):null},t}();n.LodMeshInstance=t;i=function(t){function i(n,i,r){var u=t.call(this,n,i)||this;return u.lod=0,u.BH=r,u.material=null,u._frustumOnlyClip=!1,u}return __extends(i,t),Object.defineProperty(i.prototype,"url",{get:function(){return this.BH},enumerable:!1,configurable:!0}),i.prototype.getLodMeshes=function(){return[]},i.prototype.onUpdateLodParam=function(){},i.prototype.onUpdateDefineSpatialData=function(){t.prototype.updateWorldBoundsFromLocal.call(this)},i.prototype.enumRenderMeshChunks=function(){for(var f,r=this.getLodMeshes(this.lod),u=[],e=t.prototype.prepareBindingWorldClone.call(this,n.Vector3.Zero(),this.positionWorld,!0),o=this.worldBounds.center,s=this.worldBounds.radius,i=0;i<r.length;i++)f=r[i],n.ArrayHelper.AddRange(u,f.enumRenderChunks(e,o,s));return u},i.prototype.prepareParam=function(){var r=this.renderContext.camera.worldEye.scale(.9).add(this.renderContext.camera.worldCenter.scale(.1)),u=t.prototype.worldToLocal.call(this,r),i;return this.SE?(i=this.SE.lodParam,i.lod=this.lod,i.localEyePos=u.clone(),i.globalEyePos=r.clone()):(this.SE=new n.AsyncRenderableParam,this.SE.lodParam=n.AsyncRenderableParam_LodParams.CreatePoint(this.lod,u,r)),this.SE.lodParam.objectCenter=this.worldBounds.center,this.SE},i.prototype.updateLodParam=function(){var u=this.renderContext.camera.worldEye,f=this.worldBounds.center,i=this.worldBounds.radius,e=n.Vector3.Distance(u,f)-i*.5,o=i*2*this.lodDistanceRatio,t=o,r=this.localBounds,s=r.max.y-r.min.y;t=Math.sqrt(t*Math.max(t*.05,s*2));this.lod=this.Rx(e,t);this.onUpdateLodParam()},i.prototype.Rx=function(n,t){var i=this.Vg();return n<t*i*16?0:n<t*i*32?1:n<t*i*64?2:3},i.prototype.Vg=function(){return this.lodDistanceRatio*this.layer.lodRatio*n.Drawing3DSetting._GetCombinedLodRatio()},i}(n.PointGeoObject);n.ModelGeoObjectBase=i;u=function(i){function r(n,t,r,u){var f=i.call(this,t,n,r)||this;return f.Wo=!1,f.Ue=!1,f.Oh=f.WK(r,u),f.Wo=!0,f}return __extends(r,i),Object.defineProperty(r.prototype,"mesh",{get:function(){return this.Oh},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"localBounds",{get:function(){if(!this.Wo)return new n.Box;if(this.Oh&&this.Oh.isDataLoaded){var t=this.Oh.boundingInfo.minimum,i=this.Oh.boundingInfo.maximum;return new n.Box(t,i)}return new n.Box},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isDataLoaded",{get:function(){return this.Oh&&this.Oh.isDataLoaded},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isReadyForDraw",{get:function(){return this.Oh&&this.Oh.isReadyForDraw},enumerable:!1,configurable:!0}),r.prototype.getLodMeshes=function(n){return this.Oh.getLodMeshes(n)},r.prototype.getVertexPositions=function(){return[]},r.prototype.getIndices=function(){return[]},r.prototype.onUpdateLodParam=function(){this.Oh&&this.Oh.setCenterPositionWorld(this.worldBounds.center)},r.prototype.checkObjectVisible=function(){return i.prototype.checkObjectVisible.call(this)},r.prototype.registerDataTask=function(t){var u,r,f;this.Oh.isDataLoaded?(this.Ue||(i.prototype.updateWorldBoundsFromLocal.call(this),this.Ue=!0),this.checkObjectVisible()&&(i.prototype.updateLodParam.call(this),this.Oh.registerDataTask(i.prototype.prepareParam.call(this,t)))):(u=this.worldBounds.center,r=this.worldBounds.radius*2*.5,r<=0&&(r=50),f=this.layer&&this.layer.isObjectAlwaysVisible||n.GeoBoundingClip.IsDistanceWeightVisible(this.renderContext,u,r),f&&this.Oh.registerDataTask(i.prototype.prepareParam.call(this,t)))},r.prototype.drawContents=function(){var t,u,r,n,f;for(i.prototype.notifyOnBeforeRender.call(this),u=this.renderContext._isHighlightPickedObject,this.material?t=this.material.color:this.isPicked&&u&&(t=this.layer.highlightMaterial.color),r=this.XR(t),n=0;n<r.length;n++)f=r[n],this.layer._fixedMeshChunkRenderList.addChunk(f);return i.prototype.notifyOnAfterRender.call(this),!0},r.prototype.XR=function(n){var f=[],i,o,r,u,t,e;if(!this.isReadyForDraw||(i=this.getLodMeshes(this.lod),i.length<=0))return f;for(n&&(o=n.clone()),r=0;r<i.length;r++)for(u=i[r].prepareSubMeshChunk(this,!0,o),t=0;t<u.length;t++)e=u[t].clone(),e.clipCenter=this.worldBounds.center,e.clipRadius=this.worldBounds.radius,f.push(u[t].clone());return f},r.prototype.intersectRay=function(t,r,u,f){var o=i.prototype.worldToLocal.call(this,r),s=i.prototype.worldToLocal.call(this,u),e=this.Oh.intersects(n.VectorHelper.CreateRay(o,s));return e?(i.prototype.localToWorldToRef.call(this,e,f),!0):!1},r.prototype.WK=function(i,u){if(u===void 0&&(u=1),!i)return null;var e=i.toLowerCase()+"_"+n.NumberHelper.ToString(u),f=r.WI.getValue(e);return f||(f=new t(this.renderContext.graphics,i),f.scaleRatio=u,r.WI.add(e,f)),f},r.WI=new n.Dictionary,r}(i);n.ModelGeoObject=u}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i,r){var u=t.call(this,i,n.Geometry.CreateFromPointArray(n.GeoType.Triangle,r.positions))||this;return u.VF=new n.Vector3,u.VL=r,u}return __extends(i,t),i.prototype.WL=function(){this.Oh&&(this.Oh.dispose(),this.Oh=null)},i.prototype.dispose=function(){this.WL()},i.prototype.onUpdateDefineSpatialData=function(){this.updateMeshRelativePoints(this.geometry.points[0],this.geometry.points)},i.prototype.updateMeshRelativePoints=function(i,r){var e;if(r&&r.length>0){this.WL();this.VF=i.clone();var u=this.renderContext.camera.coordSystem,o=u.earthToWorld(this.VF),f=u.earthToWorldArray(r),s=n.VectorHelper.ToLocalVector3Array(f,o),h=n.MeshVertexData.Create(s,this.VL.indices,this.VL.normals,this.VL.uvs);this.Oh=new n.RenderMesh(this.renderContext.graphics,h);t.prototype.updateWorldBounds.call(this,n.Box.CalcRange(f));e=this.renderContext.camera.coordSystem.earthToLocalArray(this.VF,r);t.prototype.updateLocalBounds.call(this,n.Box.CalcRange(e))}},i.prototype.drawContents=function(){var i=this.Oh,n,r,u,f;return i?this._getIsClampHeightReady()?(t.prototype.notifyOnBeforeRender.call(this),n=this.renderContext,r=this.renderContext.camera.coordSystem.earthToWorld(this.VF),t.prototype.prepareBindingWorldInPlace.call(this,this.renderContext.camera.worldCenter,r,!1),u=n.graphics,f=this._prepareMaterialForMeshRender(),i.render(u,n.camera.worldCamera,f,this._tempBindingWorld),t.prototype.notifyOnAfterRender.call(this),!0):!1:!1},i.prototype.enumRenderMeshChunks=function(){var i=this.renderContext.camera.coordSystem.earthToWorld(this.VF),r=t.prototype.prepareBindingWorldClone.call(this,n.Vector3.Zero(),i,!1);return this.Oh.enumRenderChunks(this.renderContext.graphics,r,i)},i.prototype.intersectRay=function(t,i,r,u){var o;if(!this.Oh)return!1;var s=i.subtract(this.positionWorld),h=r.subtract(this.positionWorld),f=n.VectorHelper.CreateRay(s,h),e=this.Oh.intersects(f,!1);return e?(o=n.VectorHelper.RayPosition(f,e.distance),u.copyFrom(o.add(this.positionWorld)),!0):!1},i}(n.GeoObject3);n.GlobalMeshGeoObject=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var i=function(){function t(){this.outlineWidth=0;this.dashLength=0;this.dashRatio=.5;this.dashOffset=0;this.trailLength=0;this.trailSpeed=1;this.trailCount=1;this.trailColor=n.Color.Red;this.clipLeft=!1;this.clipRight=!1;this.glowRadius=0;this.glowColor=n.Color.Yellow;this.tapperPower=0}return t.prototype._bindEffectParams=function(t){if(t.setBool("clipLeft",this.clipLeft),t.setBool("clipRight",this.clipRight),this.outlineWidth||this.outlineColor){t.setFloat("outlineWidth",Math.max(1,this.outlineWidth));var i=this.outlineColor?this.outlineColor:n.Color.Black;t.setVector4("outlineColor",i.toVector4())}else t.setFloat("outlineWidth",0);t.setFloat("tapperPower",this.tapperPower);t.setFloat("glowRadius",this.glowRadius);this.glowRadius&&this.glowColor&&t.setVector4("glowColor",this.glowColor.toVector4());t.setFloat("dashLength",this.dashLength);this.dashLength>0&&(t.setFloat("dashRatio",this.dashRatio),t.setFloat("dashOffset",this.dashOffset),this.dashGapColor&&t.setVector4("dashGapColor",this.dashGapColor.toVector4()));t.setFloat("trailLength",this.trailLength);this.trailLength>0&&(this.trailStart||(this.trailStart=Math.random()),t.setFloat("trailStart",this.trailStart),t.setFloat("trailSpeed",this.trailSpeed),t.setFloat("trailCount",this.trailCount),this.trailColor&&t.setVector4("trailColor",this.trailColor.toVector4()),t.setFloat("time",.001*n.SystemTime._FrameNow()))},t.prototype.copyTo=function(n){n.clipLeft=this.clipLeft;n.clipRight=this.clipRight;n.outlineWidth=this.outlineWidth;this.outlineColor&&(n.outlineColor=this.outlineColor.clone());n.tapperPower=this.tapperPower;n.glowRadius=this.glowRadius;this.glowColor&&(n.glowColor=this.glowColor.clone());n.dashRatio=this.dashRatio;n.dashLength=this.dashLength;n.dashOffset=this.dashOffset;this.dashGapColor&&(n.dashGapColor=this.dashGapColor.clone());n.trailStart=this.trailStart;n.trailLength=this.trailLength;n.trailSpeed=this.trailSpeed;n.trailCount=this.trailCount;this.trailColor&&(n.trailColor=this.trailColor.clone())},t.prototype.clone=function(){var n=new t;return this.copyTo(n),n},t}(),r,t,u;n.WideLineProperty=i;r=function(){function n(n,t){this.indexStart=n;this.indexCount=t}return n}();t=function(){function t(n,t,i){this.geoObject=i;this.Ku={};this.YL=0;this.XH=[];this.Vu=[];this.Yt=[];this.YW=[];this.ZX=[];this.Zq=[];this.GX=n;this._originWorld=t[0][0].clone();this.Zh(this._originWorld,t);this.ZL()}return t.prototype.dispose=function(){if(this.Ku){this.Ku.position&&this.Ku.position.dispose();this.Ku.previous&&this.Ku.previous.dispose();this.Ku.next&&this.Ku.next.dispose();this.Ku.direction&&this.Ku.direction.dispose();this.Ku.lengths&&this.Ku.lengths.dispose();var n=this.Zn();this.Nt&&(n._releaseBuffer(this.Nt),this.Nt=null);this.Mi=null}this.OP=!0},t.prototype.Zn=function(){return this.GX.graphics.engine},t.prototype.ZL=function(){if(!this.Mi){var n=["world","viewProjection","cameraPos","aspect","width","color"];this.Yc(n);this.Mi=this.Zn().createEffect("dsWidePolyline",["position","previous","next","direction","lengths"],n,[""],"")}},t.prototype.Yc=function(n){n.push("outlineWidth","outlineColor");n.push("clipLeft","clipRight");n.push("tapperPower");n.push("glowRadius","glowColor");n.push("dashLength","dashOffset","dashRatio","dashGapColor");n.push("trailLength","trailStart","trailSpeed","trailCount","trailColor","time")},t.prototype.Yz=function(t){for(var i,u,r=0;r<t.length;r++)i=t[r],i&&i.length===2&&(u=[],u.push(i[0]),u.push(n.Vector3.Lerp(i[0],i[1],.5)),u.push(i[1]),t[r]=u)},t.prototype.Zh=function(t,i){var r,u,e,f;if(i){for(r=this.Zn(),this.ZD=[],this.Yz(i),u=0;u<i.length;u++)e=n.VectorHelper.ToLocalVector3Array(i[u],t),f=this.XL(e),f&&this.ZD.push(f);var o=n.TypeArrayHelper.JoinNumberArrays(this.XH),s=n.TypeArrayHelper.JoinNumberArrays(this.Vu),h=n.TypeArrayHelper.JoinFloat32Arrays(this.Yt),c=n.TypeArrayHelper.JoinFloat32Arrays(this.YW),l=n.TypeArrayHelper.JoinFloat32Arrays(this.ZX),a=n.TypeArrayHelper.CreateJoinTriangleIndiceArrays(this.Zq);this.Ku.position=new BABYLON.VertexBuffer(r,h,"position",!1,!1,3);this.Ku.previous=new BABYLON.VertexBuffer(r,c,"previous",!1,!1,3);this.Ku.next=new BABYLON.VertexBuffer(r,l,"next",!1,!1,3);this.Ku.direction=new BABYLON.VertexBuffer(r,o,"direction",!1,!1,1);this.Ku.lengths=new BABYLON.VertexBuffer(r,s,"lengths",!1,!1,1);this.Nt=r.createIndexBuffer(a)}},t.prototype.XL=function(n){for(var i,e,o,t=[],u=0;u<n.length;u++)i=n[u],t.push([i.x,i.y,i.z]);var s=this.VC(t.map(function(){return 1}),!0),h=this.Xx(n),c=this.Ym(this.VC(t)),l=this.Ym(this.VC(t.map(this.Yo(-1)))),a=this.Ym(this.VC(t.map(this.Yo(1)))),f=this.Wd(t.length);return this.XH.push(s),this.Vu.push(h),this.Yt.push(c),this.YW.push(l),this.ZX.push(a),this.Zq.push(f),e=(t.length-1)*6,o=new r(this.YL,e),this.YL+=f.length,o},t.prototype.VC=function(n,t){t===void 0&&(t=!1);var i=[];return n.forEach(function(n){var r=t?-n:n;i.push(r,n)}),i},t.prototype.Ym=function(n){for(var u=n.length,i=new Float32Array(u*3),r=0,t=0;t<u;t++)i[r]=n[t][0],i[r+1]=n[t][1],i[r+2]=n[t][2],r+=3;return i},t.prototype.Yo=function(n){return function(t,i,r){return i=i+n,i=Math.max(i,0),i=Math.min(i,r.length-1),r[i]}},t.prototype.Wd=function(n){for(var i,t=new Uint32Array(n*6),r=0,u=0,f=0;f<n;f++)i=u,t[r++]=i+0,t[r++]=i+2,t[r++]=i+1,t[r++]=i+2,t[r++]=i+3,t[r++]=i+1,u+=2;return t},t.prototype.Xx=function(t){for(var u,r=[],e=n.Math3.Length(t),f=0,o=t.length,i=0;i<o-1;i++)u=f/e,r.push(u,u),f+=n.Vector3.Distance(t[i],t[i+1]);return r.push(1,1),r},t.prototype.ZN=function(n,t){var i=this.Zn(),r,e,u,o,s,h,f;return i.enableEffect(n),r=this.GX.camera.worldCamera,e=this._originWorld,n.setMatrix("world",t),n.setMatrix("viewProjection",r.viewProjectionMatrix),u=r.eye.clone(),u.subtractInPlace(e),n.setVector3("cameraPos",u),o=i.getRenderWidth()/i.getRenderHeight(),n.setFloat("aspect",o),s=this.geoObject.width,h=this.geoObject.material.color,n.setFloat("width",s),n.setVector4("color",h.toVector4()),f=this.geoObject.lineProperty,f&&f._bindEffectParams(n),!0},t.prototype.render=function(t,i,r){var e=this,u;if(!this.OP&&(u=this.Mi,u&&u.isReady()&&this.ZN(u,r))){var f=this.Zn(),o=this.geoObject.width,s=this.geoObject.material.color,h=o>2&&s.a<1;t.setNearObjectMode(!0);t.setBlendingMode(n.BlendingMode.Transparent);h?t.renderNoOverlap(function(){e.YF(f,u)}):this.YF(f,u);t.setNearObjectMode(!1)}},t.prototype.YF=function(n,t){var r,u;n.bindBuffers(this.Ku,this.Nt,t);n.applyStates();var i=n._gl,e=i.TRIANGLES,o=this.Nt.is32Bits?4:2,s=this.Nt.is32Bits?i.UNSIGNED_INT:i.UNSIGNED_SHORT,f=this.ZD;for(r=0;r<f.length;r++)u=f[r],i.drawElements(e,u.indexCount,s,u.indexStart*o)},t}();n._WideLineRenderMesh=t;u=function(r){function u(t,u,f){var e=r.call(this,t,n.Geometry.CreateFromPoint(u[0][0].clone()))||this;return e.width=f,e.lineProperty=new i,e.WT=u,e}return __extends(u,r),u.prototype.YI=function(n){var r,u,i,f;if(!this.UN){for(r=[],u=this.renderContext.camera.coordSystem,i=0;i<n.length;i++)f=u.earthToWorldArray(n[i]),r.push(f);this.UN=new t(this.renderContext,r,this)}},u.prototype.drawContents=function(){var n;if(this.UN||this.YI(this.WT),n=this.UN,n){var t=this.renderContext,i=t.camera.worldCenter,u=n._originWorld;r.prototype.prepareBindingWorldInPlace.call(this,i,u,!1);n.render(t.graphics,t.camera.worldCamera,this._tempBindingWorld)}return!0},u}(n.GeoObject3);n.GroupWideLineGeoObject=u}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(n,r,u,f){u===void 0&&(u=null);f===void 0&&(f=null);var e=t.call(this,n,i.Zc(n,r,f))||this;return e.ZR=f,e.Us=r,e.Zs=e.Wp(u),e.YC=e.Ud(r,u,f),e.material.isUseLight=!1,e.material.isCulling=!1,e}return __extends(i,t),Object.defineProperty(i.prototype,"holes",{get:function(){return this.Zs},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){this.YC.dispose()},i.Zc=function(t,i,r){return r?n.Geometry.CreateFromPoint(r):n.Geometry.CreateFromPointArray(n.GeoType.LineString,i)},i.prototype.Wp=function(t){var r,i;if(!t)return null;for(r=[],i=0;i<t.length;i++)r.push(n.PolygonMath.ToClockwise3(t[i]));return r},i.prototype.Ud=function(t,i,r){i===void 0&&(i=null);r===void 0&&(r=null);t=n.PolygonMath.ToCounterClockwise3(t);var u=n.MeshVertexData.Create(n.Math3.PolygonToTriangles(t,this.Zs));return r?new n.MeshGeoObject(this.renderContext,r,u):new n.GlobalMeshGeoObject(this.renderContext,u)},i.prototype.onUpdateDefineSpatialData=function(i){if(this.isClampToGround)this.YA(),this._groundPoly.onUpdateDefineSpatialData();else{if(i===n.GeoType.Point&&this.ZR)this.YC.position=this.position.clone();else{var r=n.Math3.PolygonToTriangles(this.geometry.points,this.Zs);r&&(this.YC.points=r)}t.prototype.updateWorldBounds.call(this,this.YC.worldBounds)}this.Tf()},i.prototype.registerDataTask=function(n){this.isClampToGround&&(this.YA(),this._groundPoly&&this._groundPoly.registerDataTask(n),this.Tf())},i.prototype.drawContents=function(n){var t,i;if(this.isClampToGround){if(t=this._groundPoly,t)return t._material=this.material,t._isFastClamp=this.isFastClamp,t._clampHeightRange=this._clampHeightRange,t.drawContents(n)}else return i=this.YC,i.layer=this.layer,i.material=this.material,i.drawContents(n)},i.prototype.getAnnoPosition=function(){return this.Yl},i.prototype.Tf=function(){if(this.isClampToGround)this.Yl=this._groundPoly.getAnnoPosition().clone();else{var n=this.localBounds,t=n.center.clone(),i=n.size;t.y+=i.y*.5;this.Yl=this.localToEarth(t)}},i.prototype.Yn=function(n,t){var u,r,i;if(!t)return null;for(u=this.renderContext.coordSystem,r=[],i=0;i<t.length;i++)r.push(u.localToEarthArray(n,t[i]));return this.Wp(r)},i.prototype.YA=function(){var i=this;if(this.isClampToGround&&!this._groundPoly){var t=this.renderContext,r=this.ZR?t.coordSystem.localToEarthArray(this.ZR,this.Us):this.Us,u=this.ZR?this.Yn(this.ZR,this.Zs):this.Zs;this._groundPoly=new n._GroundPoly(t,r,u);this._groundPoly._onElevatinUpdate=function(n){i.Xn(n)}}},i.prototype.Xn=function(t){var f=this,u;if(this.isClampToGround){var e=this.bounds.center,r=t-e.y,i=this.bounds.clone();i.min.y+=r;i.max.y+=r;u=n.VectorHelper.TransformBox(i,function(n){return f.renderContext.coordSystem.earthToWorldArray(n)});this.updateWorldBounds(u)}},i.prototype.intersectRay=function(n,t,i,r){return this.YC.intersectRay(n,t,i,r)},i}(n.GeoObject3);n.PolyGeoObject=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i,r,u,f,e,o){f===void 0&&(f=!0);e===void 0&&(e=null);o===void 0&&(o=null);var s=t.call(this,i,r)||this;return s.XV=0,s.Wa=f,s.YM=u,s.Za=n.Rect.CalcRange(u),s.YR=e,s.SK=o,s}return __extends(i,t),i.prototype.WX=function(){this.YZ&&(this.YZ.dispose(),this.YZ=null)},i.prototype.YX=function(){this.Zy&&(this.Zy.dispose(),this.Zy=null)},i.prototype.dispose=function(){this.WX();this.YX()},i.prototype.onUpdateDefineSpatialData=function(){var i=this.YD(this.renderContext,!0),n;this.WX();this.YX();this.YZ=this.YH(this.renderContext,i);this.YZ&&t.prototype.updateWorldBounds.call(this,this.YZ.worldBounds);n=this.prepareAnnoWorldPoints(this.geometry.points,this.Za.height*.5);this._setAnnoWorldPositions(n,this.isToReverseRenderText())},i.prototype.YD=function(t,i){var r=t.camera.coordSystem,e=this.geometry.points,u,f=e[0],c=r.earthToLocalArray(f,e),o=null,s=null,h;return this.YR&&(o=r.earthToLocal(f,this.YR)),this.SK&&(s=r.earthToLocal(f,this.SK)),h=this.Wa&&!i,u=n.PipelineMeshFactory.CreatePipeMesh(c,this.YM,h,o,s),u.positions=r.localToEarthArray(f,u.positions),u},i.prototype.registerDataTask=function(n){this.YZ&&this.YZ.registerDataTask(n);this.Zy&&this.Zy.registerDataTask(n)},i.prototype.drawContents=function(){if(!this._getIsClampHeightReady())return!1;var i=this.renderContext,n=this.XX(i);return n&&(n._setIsClampHeightReady(this._getIsClampHeightReady()),t.prototype.notifyOnBeforeRender.call(this),n.highlightMaterial=this.highlightMaterial,n.material=this.material,n.drawContents(null),t.prototype.notifyOnAfterRender.call(this)),!0},i.prototype.enumRenderMeshChunks=function(){var n=this.XX(this.renderContext);return n?n.enumRenderMeshChunks():[]},i.prototype.XX=function(t){return this.Ye(t)&&(this.YE(t),this.Zy)?(this.XV=n.SystemTime._FrameNow(),this.Zy):this.YZ},i.prototype.Ye=function(n){var i=t.prototype.getEyeDistanceToLine.call(this,n);return i<this.Za.height*50},i.prototype.YE=function(t){if(!this.Zy){var r=t.camera.coordSystem,i=this.YD(this.renderContext,!1);this.YX();this.Zy=this.YH(t,i);this.XV=n.SystemTime._FrameNow()}},i.prototype.YH=function(t,i){var r;return i.positions.length>0&&(r=new n.GlobalMeshGeoObject(t,i),r.initFirstForDraw(),r.material.color=this.material.color),r},i.prototype.recycle=function(){if(!this.Zy)return!1;var t=n.SystemTime._FrameNow();return t>this.XV&&t-this.XV>i.ZQ?(this.Zy=null,!0):!1},i.prototype.intersectRay=function(n,t,i,r){return this.Zy?this.Zy.intersectRay(n,t,i,r):this.YZ?this.YZ.intersectRay(n,t,i,r):null},i.ZQ=1e4,i}(n.LineGeoObject);n.PipelineGeoObject=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i,r){var u=t.call(this)||this;return u.earthViewer=i,u.maxVisibleObjectCount=4096,u.isBackground=!1,u.lodRatio=1,u.isEnableColorWrite=!0,u.isEnableDepthWrite=!0,u.isEnableDepthBuffer=!0,u.isReceiveShadow=!1,u.isCulling=!1,u.isUseLight=!0,u.zIndex=0,u.isClipByGroundHole=!1,u.onAfterLoad=new n.Observable,u._bounds=new n.Box,!r||(u.name=r,i.layers.add(u)||alert("图层名称:"+u.name+"  重复，不能显示!")),u.GX=i.renderContext,u.highlightMaterial=new n.BasicMaterial(u.renderContext),u.highlightMaterial.color=new n.Color(1,1,0,.5),u}return __extends(i,t),i.prototype.dispose=function(){},Object.defineProperty(i.prototype,"renderContext",{get:function(){return this.GX},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"count",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bounds",{get:function(){return this.updateBounds(),this._bounds},enumerable:!1,configurable:!0}),i.prototype.updateBounds=function(){},i.prototype.updateContents=function(){return!1},i.prototype.registerDataTask=function(){},i.prototype._customSetupForDrawContents=function(){},i.prototype.drawContents=function(){return!1},i.prototype.recycle=function(){return!1},i.prototype.enumRenderMeshChunks=function(){return[]},i.prototype.drawVolumeBlendContents=function(){return!1},Object.defineProperty(i.prototype,"_portraitChunkRenderList",{get:function(){return this.SJ||(this.SJ=this.GX.graphics.portraitChunkRender.createList()),this.SJ},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_fontChunkRenderList",{get:function(){return this.QC||(this.QC=this.GX.graphics.fontChunkRender.createList()),this.QC},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_fixedMeshChunkRenderList",{get:function(){return this.Ra||(this.Ra=this.GX.graphics.fixedMeshChunkRender.createList()),this.Ra},enumerable:!1,configurable:!0}),i.prototype.RQ=function(){this.SJ&&(this.SJ.dispose(),this.SJ=null);this.QC&&(this.QC.dispose(),this.QC=null);this.Ra&&(this.Ra.dispose(),this.Ra=null)},i.prototype.clearChunkRenderLists=function(){this.SJ&&this.SJ.clear();this.QC&&this.QC.clear();this.Ra&&this.Ra.clear()},i.prototype.commitChunkRenderLists=function(){this.SJ&&this.GX.graphics.portraitChunkRender.renderOneList(this.GX.camera.worldCamera,this.SJ);this.QC&&this.GX.graphics.fontChunkRender.renderOneList(this.GX.camera.worldCamera,this.QC);this.Ra&&this.GX.graphics.fixedMeshChunkRender.renderOneList(this.GX.camera.worldCamera,this.Ra)},i.prototype._isVisibleByDistance=function(){var n,t,i;return this.maxVisibleDistance===undefined?!0:(n=this.bounds,!n)?!0:(t=n.center,i=this.GX.camera.coordSystem.math3.DistancePoint(t,this.GX.camera.eye),i<=this.maxVisibleDistance)},i.prototype.pickByRay=function(){return null},i.prototype.pick=function(n,t){var i=this.renderContext.camera.coordSystem.screenToWorldLine(n);return this.pickByRay(i[0],i[1],t)},i.prototype.clampLine=function(){return null},i.prototype.clampPolygon=function(){return null},i}(n.Layer);n.Layer3=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(n){var i=t.call(this)||this;return i.RA=n,i.GX=n.renderContext,i}return __extends(i,t),i.prototype.registerDataTask=function(n){for(var u,r=0;r<this.length;r++)u=t.prototype.getAt.call(this,r),i._IsLayerVisible(u)&&u.registerDataTask(n);for(r=0;r<this.length;r++)u=t.prototype.getAt.call(this,r),i._IsLayerVisible(u)&&u.registerDataTask(n)},i.prototype.updateContents=function(n){for(var u,r=0;r<this.length;r++)u=t.prototype.getAt.call(this,r),i._IsLayerVisible(u)&&u.updateContents(n);return!0},i.prototype.recycle=function(n){for(var r,i=0;i<this.length;i++)r=t.prototype.getAt.call(this,i),r&&r.recycle(n);return!0},i.prototype._setFilterLayers=function(n){if(!n){this._clearFilterLayers();return}this.Rn=[];for(var t=0;t<n.length;t++)this.Rn[n[t].name]=!0},i.prototype._clearFilterLayers=function(){this.Rn=undefined},i.prototype.Qk=function(n){var i,t;if(!this.Rn)return n;for(i=[],t=0;t<n.length;t++)this.Rn[n[t].name]&&i.push(n[t]);return i},i._IsLayerVisible=function(n){return n&&n.isVisible&&n._isVisibleByDistance()},i.prototype.Pn=function(){for(var f,r,o,n=[],e=!1,u=0;u<this.length;u++)f=t.prototype.getAt.call(this,u),i._IsLayerVisible(f)&&(n.push(f),f.zIndex>0&&(e=!0));if(e)for(u=0;u<n.length-1;u++)for(r=0;r<n.length-u-1;r++)n[r].zIndex>n[r+1].zIndex&&(o=n[r],n[r]=n[r+1],n[r+1]=o);return this.Qk(n)},i.prototype.Qw=function(n,t){t.notifyOnBeforeRender();this.GX.setupDefaultRenderState();t.isClipByGroundHole?this.GX.graphics.enableStencilBuffer(!0,!1):this.GX.graphics.enableStencilBuffer(!1);t.drawContents(n);t.notifyOnAfterRender()},i.prototype.drawLayers=function(n,t){var e,i,r;if(!this.isVisible)return!1;var o=this.GX.graphics,u=this.Pn(),f=u.length;for(i=0;i<f;i++)r=u[i],r._customSetupForDrawContents(n);for(e=0,i=0;i<f;i++)(r=u[i],r.isBackground===t)&&r.alpha>=1&&(r.zIndex>e&&(o.clear(null,!1,!0,!1),e=r.zIndex),this.Qw(n,r));for(i=0;i<f;i++)(r=u[i],r.isBackground===t)&&r.alpha<1&&this.Qw(n,r);return o.enableStencilBuffer(!1),!0},i.prototype.selectOne=function(i,r,u){for(var f,e,s,h,c=17976931348623157e292,o=0;o<this.length;o++)if(f=t.prototype.getAt.call(this,o),f&&f.isPickable&&f.isVisible&&f._isVisibleByDistance()&&(e=new n.Vector3,s=f.pickByRay(i,r,e),s&&(h=n.Vector3.Distance(i,e),h<c)))return c=h,u.copyFrom(e),s},i}(n.LayerCollection);n.Layer3Collection=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function n(){}return n}(),i,r;n.ObjectDisplayInfo=t;i=function(){function i(t,i){this.Iv=new n.Vector3(0,0,0);this.Qg=[];this.SG=Math.pow(10,10);this.PQ=!0;this.GX=t;this.EJ=i}return Object.defineProperty(i.prototype,"drawingInfos",{get:function(){return this.Qg},enumerable:!1,configurable:!0}),i.prototype.Qj=function(t){var i;if(t===void 0&&(t=!1),t||n.SystemTime._IsTimer100){var u=this.Qg,e=u.length,o=this.GX.camera.worldEye;for(i=0;i<e;i++){var f=u[i],r=f.object,s=r.worldBounds.center,h=Math.max(0,n.Vector3.Distance(s,o)-r.worldBounds.radius);f.visible=r.checkObjectVisible(h)}}},i.prototype.clear=function(){this.PQ=!0;this.Qg=[]},i.prototype.enumObjects=function(n,t){var i,u,o,r,f,e;for(t===void 0&&(t=!1),this.Qj(),i=[],i.length=0,u=this.Qg,o=u.length,r=0;r<o;r++)if(f=u[r],e=f.object,e){if(t&&!f.visible)continue;if(i.push(e),i.length>=n)break}return i},i.prototype.enumObjectsForDrawing=function(t,i){var f=[],e,s,u,o,r;i.value=!1;e=new n.RefValue(this.Qg.length);s=new n.RefValue(0);n._ParamEvaluater.Parse4(e,s,52,37);var c=n.SystemHelper.ToInt(e.value),h=this.Qg,l=h.length;for(u=0;u<c;u++)if(o=h[u],r=o.object,r&&o.visible&&r.isVisible&&r.isReadyForDraw&&(r.isPicked&&(i.value=!0),f.push(r),f.length>=t))break;return f},i.prototype.Rm=function(t){if(this.PQ)return!0;var i=!0,u=t.camera.eyeDistance*.01,r=t.camera.worldEye;return(n.SystemTime._IsTimer1000||n.Math3.NearEqual(r,this.Iv,u)&&(i=!1),!i)?!1:(this.Iv=r.clone(),!0)},i.prototype.update=function(n,t){if(t===void 0&&(t=!1),!t){if(this.EJ.count<=0){this.Qg=[];return}if(!this.Rm(n))return}this.RD(n,null);this.PQ=!1},i.prototype.calcDisplayInfo=function(i,r,u){var f=i._displayInfo,e,h,o,s;return(f||(f=new t,f.visible=i.checkObjectVisible(),f.object=i,i._displayInfo=f),e=i.worldBounds.radius*2,e>this.SG)?null:(f.size=e,h=i.worldBounds.center,o=n.Vector3.Distance(h,r),f.distance=o,u||(s=o*o,f.sqauredDistance=s,e=Math.max(10,e*.2),f.weight=s/(e*e)),f)},i.prototype.RD=function(t,i){var u,f,e,c,r,o,s,h;for(i===void 0&&(i=null),u=this.EJ._calcLodWorldCenter(),u||(u=t.camera.worldEye),f=i&&i.length>0,e=0,e=f?i.length:this.EJ.count,this.Qg.length=0,c=this.EJ._sortObjectOnlyByDistance,r=0;r<e;r++)o=0,o=f?i[r]:r,s=this.EJ.getAt(o),s&&(h=this.calcDisplayInfo(s,u,c),h&&this.Qg.push(h));return this.Qg=this.Qg.sort(function(t,i){return n.g_compareTo(t.distance,i.distance)}),this.Qj(!0),!0},i}();r=function(t){function r(n,r){var u=t.call(this,n,r)||this;return u._sortObjectOnlyByDistance=!1,u.GP=0,u.FI=[],u.Qv=[],u.RF=new i(n.renderContext,u),u}return __extends(r,t),Object.defineProperty(r.prototype,"count",{get:function(){return this.FI.length},enumerable:!1,configurable:!0}),r.prototype.getAt=function(n){return n>=0&&n<this.FI.length?this.FI[n]:null},r.prototype.getByNo=function(n){return this.Qv[n]},r.prototype.enumObjects=function(){return n.ArrayHelper.CloneArray(this.FI)},r.prototype.addObject=function(n){return n&&n.initFirstForDraw(),this.FI.push(n),n.no=this.GP,this.GP++,n.layer=this,this.Qv[n.no]=n,this.PQ=!0,this.OJ=!0,n},r.prototype.removeAt=function(n){if(n>=0&&n<this.FI.length){var t=this.FI[n];t&&(this.Qv[t.no]=null,t.dispose());this.FI.splice(n,1);this.PQ=!0;this.OJ=!0}},r.prototype.Rb=function(){for(var r,t=this.FI,i=0;i<t.length;i++)r=t[i],r&&r.dispose();n.ArrayHelper.Clear(t);this.Qv=[];this.PQ=!0;this.OJ=!0},r.prototype.clearPickedObjects=function(){for(var t,i=this.count,n=0;n<i;n++)t=this.getAt(n),t&&(t.isPicked=!1)},r.prototype.clear=function(){this.Rb();this.RF.clear()},r.prototype.updateBounds=function(){var n,i,r;if(this.OJ){var u=this.FI,e=u.length,f=!0,t;for(n=0;n<e;n++)i=u[n],i&&(r=i.bounds,f?(t=r.clone(),f=!1):t.unionInPlace(r));this._bounds=t;this.OJ=!1}},r.prototype._calcLodWorldCenter=function(){return null},r.prototype.updateIndex=function(n){(n===void 0&&(n=!1),!n||this.PQ)&&(this.RF.update(this.renderContext,this.PQ),this.PQ=!1)},r.prototype.updateContents=function(n){for(var i=this.enumObjectsInIndex(this.maxVisibleObjectCount,!0),t=0;t<i.length;t++)i[t].updateContents(n);return!0},r.prototype.enumObjectsInIndex=function(n,t){return t===void 0&&(t=!1),this.updateIndex(!0),this.RF.enumObjects(n,t)},r.prototype.enumObjectsForDrawing=function(n,t,i){return this.updateIndex(!0),this.RF.enumObjectsForDrawing(t,i)},r.prototype.setupDrawingStatus=function(t){return t.setupDefaultRenderState(),t.graphics.setBlendingMode(n.BlendingMode.Transparent),!0},r.prototype.pickByRay=function(t,i,r){for(var u,f,o,s,h=17976931348623157e292,e=0;e<this.count;e++)u=this.getAt(e),u&&u.checkObjectVisible()&&(f=new n.Vector3,u.intersectRay(this.renderContext,t,i,f)&&(o=n.Vector3.Distance(t,f),o<h&&(s=u,h=o,r.copyFrom(f))));return s},r.prototype.clampLine=function(){var n;return n},r.prototype.clampPolygon=function(){var n;return n},r}(n.Layer3);n.GeoObject3Layer=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(n,i){var r=t.call(this,n,i)||this;return r.Re=0,r}return __extends(i,t),i.prototype.updateContents=function(n){return this.isVisible?(t.prototype.updateContents.call(this,n),!0):!1},i.prototype.registerDataTask=function(n){var r,i,u;if(this.isVisible)for(this.updateIndex(),t.prototype.registerDataTask.call(this,n),r=t.prototype.enumObjectsInIndex.call(this,this.maxVisibleObjectCount),i=0;i<r.length;i++)u=r[i],u.registerDataTask(n)},i.prototype.drawContents=function(i){var r,f,u;return this.isVisible?(r=this.renderContext,r.camera._transformLocalWorld(),r.setupDefaultRenderState(),this.clearChunkRenderLists(),f=new n.RefValue(!1),u=t.prototype.enumObjectsForDrawing.call(this,r,this.maxVisibleObjectCount,f),this.drawObjects(r,i,u,this.highlightMaterial,this.alpha),this.updateObjectAnnoChunks(this.renderContext,i,u),this.commitChunkRenderLists(),!0):!1},i.prototype.drawVolumeBlendContents=function(){return this.isVisible?!0:!1},i.prototype.enumRenderMeshChunks=function(){for(var f=new n.RefValue(!1),r=t.prototype.enumObjectsForDrawing.call(this,this.renderContext,this.maxVisibleObjectCount,f),u=[],i=0;i<r.length;i++)n.ArrayHelper.AddRange(u,r[i].enumRenderMeshChunks());return u},i.prototype.recycle=function(n){var i,r;if(this.count<=0)return!1;for(this.Re>=this.count&&(this.Re=0),i=0,i=this.Re;i<this.count;i++)r=t.prototype.getAt.call(this,i),r&&r.recycle(n);return this.Re=i+1,!0},i.prototype.drawObjects=function(n,t,i,r,u){var o,s,e,f;if(u===void 0&&(u=1),o=i.length,!(o<=0))if(s=n._isHighlightPickedObject,u<1)for(e=0;e<o;e++)f=i[e],f&&(f.highlightMaterial=f.isPicked&&s?r:null,f.material&&f.material.alpha>=1&&(f.material.alpha=u),f.drawContents(t));else{for(e=0;e<o;e++)f=i[e],f&&!f._isTransparent()&&(f.highlightMaterial=f.isPicked&&s?r:null,f.drawContents(t));for(e=0;e<o;e++)f=i[e],f&&f._isTransparent()&&(f.highlightMaterial=f.isPicked&&s?r:null,f.drawContents(t))}},i.prototype.updateObjectAnnoChunks=function(n,t,i){var f=i.length,e,r,u;if(f>0){for(e=n.graphics.isWireFrameMode,n.graphics.isWireFrameMode=!1,r=0;r<f;r++)u=i[r],u&&(!u.anno||u.drawAnno());n.graphics.isWireFrameMode=e}},i.prototype.addImage=function(i,r,u){return t.prototype.addObject.call(this,new n.ImageGeoObject(this.renderContext,i,r,u))},i.prototype.addModel=function(i,r){n.TString.Substring(r,r.length-2,2)===".x"&&(r=n.TString.Replace(r,".x",".xz"));r=n.SystemHelper.ToAbsoluteUrl(r);var u=new n.ModelGeoObject(i,this.renderContext,r,1);return t.prototype.addObject.call(this,u)},i.prototype.addLine=function(i,r){r===void 0&&(r=1);var u=new n.LineGeoObject(this.renderContext,i);return u.width=r,t.prototype.addObject.call(this,u)},i.prototype.addLineAt=function(n,t,i){i===void 0&&(i=1);var r=this.renderContext.coordSystem,u=r.localToEarthArray(n,t);return this.addLine(u,i)},i.prototype.addPoly=function(i,r){return r===void 0&&(r=null),t.prototype.addObject.call(this,new n.PolyGeoObject(this.renderContext,i,r))},i.prototype.addPolyAt=function(i,r,u){return u===void 0&&(u=null),t.prototype.addObject.call(this,new n.PolyGeoObject(this.renderContext,r,u,i))},i.prototype.addAnno=function(i,r,u){u===void 0&&(u=null);u||(u=new n.Color(1,1,1,1));var f=t.prototype.addObject.call(this,new n.AnnoGeoObject(this.renderContext,i,r));return f&&(f.fontColor=u),f},i.prototype.addBox=function(t,i){var r=n.PrimitivesFactory.CreateBox(1);return n.MeshVertexData.Scale(r,i.toVector3()),this.addMeshAt(t,r)},i.prototype.addBall=function(t,i){var r=n.PrimitivesFactory.CreateSphere(1,32);return n.MeshVertexData.Scale(r,i.toVector3()),this.addMeshAt(t,r)},i.prototype.addCylinder=function(t,i,r,u){var f=n.PrimitivesFactory.CreateCylinder(i,r,u,32,1);return this.addMeshAt(t,f)},i.prototype.addPlane=function(t,i,r,u){u===void 0&&(u=8);var f=n.PrimitivesFactory.CreateGround(1,1,u);return n.MeshVertexData.Scale(f,new n.Size3(i,0,r).toVector3()),this.addMeshAt(t,f)},i.prototype.addMesh=function(i){return t.prototype.addObject.call(this,new n.GlobalMeshGeoObject(this.renderContext,i))},i.prototype.addMeshAt=function(i,r){return t.prototype.addObject.call(this,new n.MeshGeoObject(this.renderContext,i,r))},i.prototype.NX=function(n,t){for(var i,u=[],r=0;r<n.length;r++)i=n[r].clone(),i.y=i.y+t,u.push(i);return u},i.prototype.addPolyBox=function(n,t,i,r){if(!n||n.length<3)return null;var u=this.NX(n,t);return this.addPolyBox2(u,n,i,r)},i.prototype.addPolyBoxAt=function(n,t,i,r,u){if(!t||t.length<3)return null;var f=this.NX(t,i);return this.addPolyBox2At(n,f,t,r,u)},i.prototype.addPolyBox2=function(t,i,r,u){if(!t||t.length<3||!i||i.length<3)return null;var f=n.MeshVertexData.TransformToLocalCalc2(this.renderContext.coordSystem,t,i,function(t,i){return n.PrimitivesFactory.CreatePolyBox(t,i,r,u)});return this.addMesh(f)},i.prototype.addPolyBox2At=function(t,i,r,u,f){if(!i||i.length<3||!r||r.length<3)return null;var e=n.PrimitivesFactory.CreatePolyBox(i,r,u,f);return this.addMeshAt(t,e)},i.prototype.addWall=function(t,i,r,u){return!t||t.length<2||i<=0?null:this.addObject(new n.WallGeoObject(this.renderContext,t,i,r,u))},i.prototype.addWallAt=function(n,t,i,r,u){if(!t||t.length<2||i<=0)return null;var f=this.renderContext.coordSystem.localToEarthArray(n,t);return this.addWall(f,i,r,u)},i.prototype.addPipeline=function(i,r,u,f,e){var o,l;if(u===void 0&&(u=!0),f===void 0&&(f=null),e===void 0&&(e=null),!i||i.length<2)return null;if(typeof r=="number")o=n.Shape2.Circle(r);else if(r.width){var s=r,h=s.width*.5,c=s.height*.5;o=n.Shape2.Rectangle(new n.Rect(-h*.5,-c*.5,h,c))}else if(r.length)o=r;else return null;return l=new n.PipelineGeoObject(this.renderContext,i,o,u,f,e),t.prototype.addObject.call(this,l)},i.prototype.addPipelineAt=function(n,t,i,r,u,f){if(r===void 0&&(r=!0),u===void 0&&(u=null),f===void 0&&(f=null),!t||t.length<2)return null;var e=this.renderContext.coordSystem,o=e.localToEarthArray(n,t);return u&&(u=e.localToEarth(n,u)),f&&(f=e.localToEarth(n,f)),this.addPipeline(o,i,r,u,f)},i.prototype.addArrow=function(t,i,r,u,f){return!t||t.length<2?null:this.addObject(new n.ArrowGeoObject(this.renderContext,t,i,r,u,f))},i.prototype.addArrowAt=function(n,t,i,r,u,f){if(!t||t.length<2)return null;var e=this.renderContext.coordSystem.localToEarthArray(n,t);return this.addArrow(e,i,r,u,f)},i.prototype.prepareMeshDataInRange=function(i,r){for(var u,l,a,f,e,o,p=this.renderContext.camera.coordSystem.earthToWorld(i),c=[],s=0;s<this.count;s++)if(u=n.SystemHelper.CastObject(t.prototype.getAt.call(this,s)),u&&u.isReadyForDraw&&(l=u.worldBounds.center,a=n.Vector3.Distance(l,p),a<r)){var v=u.getVertexPositions(),w=u.worldMatrix,y=[],h=u.positionWorld;for(f=0;f<v.length;f++)e=n.Vector3.TransformCoordinates(v[f],w),y.push(new n.Vector3(h.x+e.x,h.y+e.y,h.z+e.z));o=new n.MeshVertexData;o.positions=y;o.indices=u.getIndices();c.push(o)}return c},i}(n.GeoObject3Layer);n.ShapeLayer=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function n(n,t){this.EJ=n;this.Eu=t}return Object.defineProperty(n.prototype,"isVisible",{get:function(){return this.Eu?this.Eu.isVisible:!1},set:function(n){this.Eu&&(this.Eu.isVisible=n)},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){this.EJ&&(this.EJ=null,this.Eu=null)},n}(),i;n.StencilHoleRef=t;i=function(i){function r(n){var t=i.call(this,n,"")||this;return t.Rs=[],t}return __extends(r,i),r.prototype.addHole=function(r,u,f){var e,s,h,o,c;if((f===void 0&&(f=null),!u&&!f)||(f&&(e=i.prototype.addMesh.call(this,new n.MeshVertexData(f))),s=u,s.length<=0))return null;for(e=i.prototype.addPoly.call(this,s,null),e.name=r,e.material.isCulling=!0,e.material.color.a=.1,h=[],o=0;o<u.length;o++)c=u[o].clone(),h.push(new n.Vector2(c.x,c.z));return this.Rs.push(h),new t(this,e)},r.prototype.getHoles=function(){throw new n.NotImplementedException;},r.prototype.hitOnHole=function(t,r){for(var f,e,u=0;u<this.Rs.length;u++)if(f=this.Rs[u],f&&n.Math2.Contains(f,new n.Vector2(t,r))&&(e=i.prototype.getAt.call(this,u),e&&e.isVisible))return!0;return!1},r.prototype.clearHoles=function(){n.ArrayHelper.Clear(this.Rs);this.clear()},r.prototype.drawGroundHole=function(n){var r;if(this.count>0){this.updateContents(n);this.registerDataTask(n);r=this.renderContext;r.camera._transformLocalWorld();r.setupDefaultRenderState();var u=this.renderContext.graphics,t=u.engine,f=t.getColorWrite(),e=t.getDepthWrite();t.setColorWrite(!1);t.setDepthWrite(!1);u.enableStencilBuffer(!0,!0);this.drawObjects(this.renderContext,n,i.prototype.enumObjects.call(this),this.highlightMaterial,1);u.enableStencilBuffer(!1);t.setColorWrite(f);t.setDepthWrite(e)}},r}(n.ShapeLayer);n.StencilHoleLayer=i}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(n){this.BL=[];this.HT=!1;this.GX=n}return t.prototype.getLayerCount=function(){return this.BL.length},t.prototype.addTerrainLayer=function(n){n&&(this.BL.push(n),this.HT=!0)},t.prototype.clearTerrainLayers=function(){n.ArrayHelper.Clear(this.BL);this.HT=!1},t.prototype.calculateHitPosition=function(t,i,r){if(!this.HT)return!1;var u=this.GX.camera.coordSystem.screenToWorldLine(new n.Vector2(t,i)),f=this.QX(u[0],u[1],r);return this.GX.camera.coordSystem.worldToEarthToRef(r,r),f},t.prototype.calculateHeight=function(t,i){var r=new n.RefValue,u=new n.RefValue;return this.calculateHeightAdvance(t,i,r,u),r.value},t.prototype.calculateHeightAdvance=function(t,i,r,u,f){var s,c;if(f===void 0&&(f=20),!this.HT)return!1;var e=new n.Vector3(t,1e4,i),o=new n.Vector3(t,-1e4,i),h=this.GX.camera.coordSystem;return(e=h.earthToWorld(e),o=h.earthToWorld(o),s=new n.Vector3,c=this.QX(e,o,s),u.value=20,r.value=0,c)?(r.value=this.GX.camera.coordSystem.worldToEarth(s).y,u.value=n.TerrainConst.MinDetailLevel,!0):!1},t.prototype.QX=function(t,i,r){var c,o,u,f,e,s,h;if(r.copyFrom(new n.Vector3),!this.HT)return!1;for(o=17976931348623157e292,u=0;u<this.BL.length;u++)f=this.BL[u],f&&f.isVisible&&(e=new n.Vector3,s=f.pickByRay(t,i,e),s&&(h=n.Vector3.Distance(t,e),h<o&&(c=s,o=h,r.copyFrom(e.clone()))));return!!c},t.prototype.Qc=function(t){var f,i,r;if(!t)return null;for(f=this.GX.camera.coordSystem,i=f.worldToEarthArray(t),r=0;r<i.length;r++){var u=i[r].clone(),e=new n.RefValue(0),o=new n.RefValue(0);this.calculateHeightAdvance(u.x,u.z,e,o)&&(u.y=e.value);i[r]=u.clone()}return f.earthToWorldArray(i)},t.prototype.clampLine=function(n){return this.HT?this.Qc(n):null},t.prototype.clampPolygon=function(t){var r,i;return this.HT?(r=[],t.length<2)?null:(i=this.Qc(t),n.Math3.PolygonToTriangles(i,null)):null},t.prototype.calculateApproximateHeightRange=function(t){var u=this.enumRenderChunks(t),r,i;if(u.length<=0)return n.Vector2.Zero();var f=Number.MAX_VALUE,e=-Number.MAX_VALUE,o=!1;for(r=0;r<u.length;r++)i=u[r],i._heightRange&&(i._heightRange.x<f&&(f=i._heightRange.x),i._heightRange.y>e&&(e=i._heightRange.y),o=!0);return o?new n.Vector2(f,e):new n.Vector2(0,0)},t.prototype.enumRenderChunks=function(n){var u=[],t,f,i,r;if(!this.HT)return u;for(t=0;t<this.BL.length;t++)for(f=this.BL[t].enumRenderMeshChunks(),i=0;i<f.length;i++)(r=f[i],!r._earthRange||n.intersects(r._earthRange))&&u.push(r);return u},t}();n.GroundLayer=t}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(){this.GP=0;this.Pu=[];this.NM=new n.Dictionary}return t.prototype.string2No=function(n,t){if(t===void 0&&(t=!0),!n)return-1;if(!this.NM.containsKey(n)){if(!t)return-1;this.NM.add(n,this.GP);this.Pu.push(n);this.GP=this.GP+1}return this.NM.getValue(n)},t.prototype.no2String=function(n){return n>=0&&n<this.Pu.length?this.Pu[n]:""},t}(),i;n.StringIntMapping=t;i=function(){function i(){this.urlMapping=new t;this.NJ=new n.IntHashSet}return i.prototype.onBadTasks=function(n){var t=this.urlMapping.string2No(n,!1);t>=0&&this.NJ.add(t)},i.prototype.isBadUrlNo=function(n){return this.NJ.contains(n)},i.prototype.addBadUrlNo=function(n){this.NJ.add(n)},i}();n.DataSurfaceBase=i}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(n,t,i,r,u){r===void 0&&(r="");u===void 0&&(u="");this.center=n;this.radius=t;this.subNames=i;this.name=r;this.uri=u}return t.prototype.getSubBaseUrl=function(t){if(this._subUris){var i=this._subUris[t],r=n.StringHelper.MergeFullUrl(this._baseUrl,i);return n.StringHelper.ExtractDirectoryOnly(r)}return this._baseUrl},t}();n.TileMeshIndexNodeInfo=t}(Drawsee||(Drawsee={})),function(n){var e=function(){function r(){}return r.FromPackageData=function(n){var u,i,t,f;if(n.length<1)return null;for(u=n[0],i=r.VX(u),t=1;t<n.length;t++)f=n[t],r.TM(i,f);return i},r.VX=function(t){var u=new n.MemoryBinaryReader(t),f=new i,o,e;for(u.readInt32(),f.name=n._MeshBinaryReaderHelper.ReadStringBlock(u),o=u.readInt32(),e=0;e<o;e++)f.subs.push(r.TO(u));return f},r.TO=function(n){if(!n)return null;var t=n.readInt32();return t===0?null:r.Tw(n)},r.Tw=function(i){var r=new t,u;return r.centerX=i.readDouble(),r.centerY=i.readDouble(),r.centerZ=i.readDouble(),r.radius=i.readDouble(),r.rangeList=n._MeshBinaryReaderHelper.ReadFloatArray(i),r.rangeDataList=n._MeshBinaryReaderHelper.ReadStringBlockArray(i),r.textureFileName=n._MeshBinaryReaderHelper.ReadStringBlock(i),u=i.readInt32(),r.vertexes=n._MeshBinaryReaderHelper.ReadCompressVector3FloatArray(i),u=i.readInt32(),r.textureCoords=n._MeshBinaryReaderHelper.ReadCompressVector2FloatArray(i),u=i.readInt32(),r.indices=n._MeshBinaryReaderHelper.ReadCompressIntArray(i),r},r.TM=function(t,i){var r=new n.MemoryBinaryReader(i),u,f;r.readInt32();u=n._MeshBinaryReaderHelper.ReadStringBlock(r);f=r.readBytesToEnd();t.textureNames.push(u);t.textureBytes.push(f)},r}(),t,i,u,r,f;n.DrawseeTileMeshLoadHelper=e;t=function(){function n(){}return n}();n.SubTileMeshTransferData=t;i=function(){function n(){this.subs=[];this.textureNames=[];this.textureBytes=[]}return n.prototype.getTransferObjects=function(){for(var n,i=[],t=0;t<this.subs.length;t++)n=this.subs[t],n.vertexes&&i.push(n.vertexes.buffer),n.normals&&i.push(n.normals.buffer),n.textureCoords&&i.push(n.textureCoords.buffer),n.indices&&i.push(n.indices.buffer);for(t=0;t<this.textureBytes.length;t++)this.textureBytes[t]&&i.push(this.textureBytes[t].buffer);return i},n.MarkCountInfo=function(n){for(var t,i=0;i<n.subs.length;i++)t=n.subs[i],t._vertCount=t.vertexes.length,t._indiceCount=t.indices.length},n}();n.TileMeshTransferData=i;u=function(){function n(){this.textureBytes=[];this.vertexesArray=[];this.normalsArray=[];this.textureCoordsArray=[];this.indicesArray=[]}return n.prototype.getTransferObjects=function(){for(var t=[],n=0;n<this.textureBytes.length;n++)this.textureBytes[n]&&t.push(this.textureBytes[n].buffer);for(n=0;n<this.normalsArray.length;n++)this.normalsArray[n]&&t.push(this.normalsArray[n].buffer);for(n=0;n<this.vertexesArray.length;n++)this.vertexesArray[n]&&t.push(this.vertexesArray[n].buffer);for(n=0;n<this.textureCoordsArray.length;n++)this.textureCoordsArray[n]&&t.push(this.textureCoordsArray[n].buffer);for(n=0;n<this.indicesArray.length;n++)this.indicesArray[n]&&t.push(this.indicesArray[n].buffer);return t},n.FromTransferData=function(t){var i=new n,u,r;for(i.textureBytes=t.textureBytes,u=0;u<t.subs.length;u++)r=t.subs[u],i.vertexesArray.push(r.vertexes),r.normals&&i.normalsArray.push(r.normals),i.textureCoordsArray.push(r.textureCoords),i.indicesArray.push(r.indices);return i},n}();n.TileMeshProcessData=u;r=function(){function n(){this.imageBitmaps=[];this.boundsArray=[]}return n.prototype.getTransferObjects=function(){for(var n=[],t=0;t<this.imageBitmaps.length;t++)n.push(this.imageBitmaps[t]);return this.triPoints&&n.push(this.triPoints.buffer),this.vertexBuffer&&n.push(this.vertexBuffer.buffer),this.indiceBuffer&&n.push(this.indiceBuffer.buffer),n},n.Dispose=function(n){for(var t=0;t<n.imageBitmaps.length;t++)n.imageBitmaps[t].close();n.imageBitmaps=null;n.vertexBuffer=null;n.indiceBuffer=null;n.triPoints=null;n.boundsArray=null},n}();n.TileMeshProcessResultData=r;f=function(){function t(){}return t.ProcessVertexBufferAndTriPoints=function(n){var i=new r;return n.isNeedTriPoints&&(i.triPoints=t.Vf(n.vertexesArray,n.indicesArray)),n.isNeedBounds&&(i.boundsArray=t.Vy(n.vertexesArray)),t.VT(n,i),i},t.VT=function(i,r){for(var c,f=[],e=[],o=0,u=0;u<i.vertexesArray.length;u++){var s=i.vertexesArray[u],l=i.normalsArray[u],a=i.textureCoordsArray[u],h=i.indicesArray[u],v=t.TD(s,l,a,!0);f.push(v);u>0&&n.TypeArrayHelper.AddIntValue(h,o);e.push(h);c=Math.floor(s.length/3);o+=c}r.vertexBuffer=n.TypeArrayHelper.JoinFloat32Arrays(f);r.indiceBuffer=n.TypeArrayHelper.JoinInt32Arrays(e)},t.TD=function(n,t,i,r){var s;r===void 0&&(r=!1);var h=Math.floor(n.length/3),u=new Float32Array(8*h),f=0,e=0,o=0;for(s=0;s<h;s++)u[f]=n[e],u[f+1]=n[e+1],u[f+2]=n[e+2],t?(u[f+3]=t[e],u[f+4]=t[e+1],u[f+5]=t[e+2]):r&&(u[f+3]=n[e],u[f+4]=n[e+1],u[f+5]=n[e+2]),u[f+6]=i[o],u[f+7]=i[o+1],f+=8,e+=3,o+=2;return u},t.Vf=function(t,i){for(var u,f,e,o=t.length,s=0,r=0;r<o;r++)s+=i[r].length;for(u=new Float32Array(s*3),f=0,r=0;r<o;r++)e=i[r],n.TypeArrayHelper.GetTrianglePointsDirect(t[r],e,u,f),f+=e.length*3;return u},t.Vy=function(t){for(var r=[],i=0;i<t.length;i++)r.push(n.Box.CalcRangeFromArray(new n.Vector3Array(t[i])));return r},t}();n.TileMeshProcessDataHelper=f}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(t){this._center=n.Vector3.Zero();this._radius=0;this._geoObject=t}return Object.defineProperty(t.prototype,"center",{get:function(){return this._center},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldCenter",{get:function(){return this.PY||(this.PY=this._geoObject.localToWorld(this._center)),this.PY},enumerable:!1,configurable:!0}),t}();n.TileNodeBase=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i,r,u,f,e){var o=t.call(this,r)||this,s;return o.fatherMesh=i,o.Sa=u._indiceCount,o.Ro=f,u.radius?(o._center=new n.Vector3(u.centerX,u.centerY,u.centerZ),o._radius=u.radius):(o._radius=i.radius,o._center.copyFrom(i.center)),s=i.node._info,o.TT=s&&s._bounds?s._bounds.clone():e?new n.Box(new n.Vector3(e.min.x,e.min.y,e.min.z),new n.Vector3(e.max.x,e.max.y,e.max.z)):new n.Box,o}return __extends(i,t),i.prototype.toChunk=function(){var i=this.PO,r,t;return i&&(i.texture=this.Ro,i._earthRange||(r=this._geoObject,t=n.VectorHelper.TransformBox(this.TT,function(n){return r.renderContext.coordSystem.localToEarthArray(r.position,n)}),i._earthRange=n.Rect.CreateFromPoint(new n.Vector2(t.min.x,t.min.z),new n.Vector2(t.max.x,t.max.z)),i._heightRange=new n.Vector2(t.min.y,t.max.y))),i},i.ToChunks=function(n){for(var i=[],t=0;t<n.length;t++)i.push(n[t].toChunk());return i},i.prototype.toMeshRenderChunk=function(t){return this.TG||(this.TG=new n.RenderMeshChunk(t.worldMatrix,this._center,this._radius,!1,null,this.Tp,this.TI,this.Sa)),this.TG},i.prototype.dispose=function(){this.Tp&&(this.Tp=null);this.Ro=null},i.CreateMergedBuffer=function(t,i,r,u){var o,s,h,c,e,f,l;if(r.length<=0||r[0].Tp||(o=i.vertexBuffer,s=i.indiceBuffer,!o||!s))return null;for(h=t.createElement(o,s,n.VertexPositionNormalTexture.VertexDeclaration,n.ElementType.Triangles),c=0,e=0;e<r.length;e++)f=r[e],f.Tp=h,f.TI=c,f.PO||(l=u.localToWorld(f._center),f.PO=new n.SimpleTextureMeshChunk(f.Tp,u.positionWorld,l,f._radius,u.worldMatrix,f.Ro,!1,!0,f.TI,f.Sa,null,null)),c+=f.Sa,f.PO.texture=f.Ro;return h},i}(n.TileNodeBase);n.TileDrawMesh=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(n,t,i){i===void 0&&(i=!0);this.minStartSize=n;this.scaleRatio=t;this.isUseMipmap=i}return t.PrepareInfo=function(i){var u,f,r=Math.min(1,n.Drawing3DSetting._GetCombinedLodRatio());return f=Math.floor(1024*r),r>=1?u=i?undefined:.5:(r=r>.5?1:.5,u=i?.8*r:.5*r),new t(f,u,!1)},t}(),i=function(){function t(n,t,i,r){this.name=n;this.Ha=t;this.DR=r;this.Vj(i)}return t.prototype.getTexture=function(){return this.Ro},t.prototype.dispose=function(){this.Ro&&(this.Ro.dispose(),this.Ro=null)},t.prototype.checkTextureReady=function(){return this.Ro&&this.Ro.isReady},t.prototype.Vj=function(t){this.Ro||(this.Ro=new n.ImageTexture(this.Ha,t,!1,this.DR))},t}(),r=function(r){function u(t,i,u,f,e,o){var s=r.call(this,i)||this;return s.node=t,s.cacheBytes=0,s.UE=!1,s.Lv=0,s.Jx="",s.QE="",s.RX="",s.Se=!1,s.OP=!1,s.Sf=!1,s._drawMeshes=[],s.Sq=!1,s.TS=new n.StringKeyDictionary,s.Uz=[],s.GX=i.renderContext,s.Ha=s.GX.graphics,s.RB=u,s._dataProvider=f,s.BH=e,s.Lv=s.RB.allocUrlNo(e),s.QE=n.StringHelper.ExtractFileSuffix(e),s.RX=n.StringHelper.ExtractFileNameWithoutSuffix(e),s.Jx=n.StringHelper.ExtractDirectoryOnly(e),s.Se=o,s}return __extends(u,r),u.prototype.initBasicInfo=function(n,t,i){this._center=n.clone();this._radius=t;this.UE=i},u.prototype.dispose=function(){this.To=!1;this.Sf=!1;this.Rv=null;this.Rk=null;this.Mw=null;this.UC=null;this.WA=null;this.VE();this.Vd();this.VY();this.OP=!0},u.prototype.stampTimeMark=function(){this.RB.accessMesh(this.Lv)},Object.defineProperty(u.prototype,"graphics",{get:function(){return this.Ha},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"isSubMesh",{get:function(){return this.UE},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"url",{get:function(){return this.BH},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"baseUrl",{get:function(){return this.Jx},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"fileSuffix",{get:function(){return this.QE},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"fileName",{get:function(){return this.RX},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"urlNo",{get:function(){return this.Lv},enumerable:!1,configurable:!0}),u.prototype.getTriIndex=function(){return this.Rv},u.prototype.getDrawMeshCount=function(){return this._drawMeshes.length},Object.defineProperty(u.prototype,"isDataLoaded",{get:function(){return this.Sf},enumerable:!1,configurable:!0}),u.prototype.loadData=function(){var t=this,i;if(!this.Sf&&!this.OP&&!this.OP&&(this.node.layer._isDrawseeTile||this.node._info)){if(!this.RX){this.Sf=!0;this.To=!0;return}i=this.BH;this.Rk||(this.Rk=new n.PromiseDelegate(function(){var r=t._dataProvider.dataLoadType;n.AsyncRenderContext.LoadData(r,i).then(function(n){if(!t.OP&&(t.Rk.onThen(),n))if(n.isBadUrl){t.QW=!0;t.RB.onBadTasks(i)}else t.Qp(n.data)})}));this.QW||this.Rk.tryInvoke()}},u.prototype.Qp=function(i){var r=this;i&&(this.Sf=!0,this._dataProvider.parseTileDataAsync(i,this.node._info).then(function(i){if(i){r.Mw=i;n.TileMeshTransferData.MarkCountInfo(i);var f=t.PrepareInfo(r.node.isLeaf),u=n.TileMeshProcessData.FromTransferData(i);u.name=r.fileName;u.minStartSize=f.minStartSize;u.scaleRatio=f.scaleRatio;u.isNeedTriPoints=r.VH();u.isNeedBounds=r.node.layer._isDrawseeTile;n.AsyncProcess.ProcessTileMesh(u).then(function(n){r.UC=n})}}))},Object.defineProperty(u.prototype,"isReadyForDraw",{get:function(){return this.To},enumerable:!1,configurable:!0}),u.prototype.prepareData=function(){var t=this;this.To||this.OP||this.UC&&(this.WA||(this.WA=n.AsyncRenderContext.PrepareData(this.UC,function(){t.OP||t.Qq()})),this.WA&&this.WA.tryInvoke())},u.prototype.Qq=function(){this.cacheBytes=this.UY(this.UC);this.UL(this.Mw,this.UC);this.WD(this.Mw,this.UC);this.To=!0;this.Mw=null;n.TileMeshProcessResultData.Dispose(this.UC);this.UC=null},u.prototype.UY=function(n){for(var i,t=0,r=0;r<n.imageBitmaps.length;r++)i=n.imageBitmaps[r],i&&(t+=i.width*i.height*4);return n.vertexBuffer&&(t+=n.vertexBuffer.length*4),n.indiceBuffer&&(t+=n.indiceBuffer.length*4),n.triPoints&&(t+=n.triPoints.length*4),this.node.layer._isDrawseeTile&&(t*=1.5),(Math.floor(t/1024)+1)*1024},u.prototype.VH=function(){return this.Se&&(this.node.level<=n.TileMeshIndexNode._MaxTopLevel||n.Drawing3DSetting.HighPrecisionHeight)},u.prototype.WD=function(t,i){this.OP||!t||t.subs.length<=0||(this.Uf(t,i),this.Ty(i),i.triPoints&&(this.Rv=new n.MeshTriangleIndex(new n.Vector3Array(i.triPoints))))},u.prototype.Uf=function(t,i){var f,u,r,e,o;if(!t||this._drawMeshes.length>0)return!1;for(this._drawMeshes=[],f="",u=0;u<t.subs.length;u++)r=t.subs[u],r.textureFileName?f=r.textureFileName:r.textureFileName=f,e=this.Tb(r.textureFileName),o=new n.TileDrawMesh(this,this._geoObject,r,e,i.boundsArray[u]),this._drawMeshes.push(o);return this.onAfterCreateDrawMeshes(),!0},u.prototype.onAfterCreateDrawMeshes=function(){},u.prototype.VE=function(){for(var i,t=0;t<this._drawMeshes.length;t++)i=this._drawMeshes[t],i.dispose();n.ArrayHelper.Clear(this._drawMeshes)},u.prototype.Ty=function(t){if(!this.Sq){var i=this._geoObject.renderContext.graphics;this.Up=n.TileDrawMesh.CreateMergedBuffer(i,t,this._drawMeshes,this._geoObject,!1);this.Up||this.VE();this.Sq=!0}},u.prototype.VY=function(){this.Up&&(this.Up.dispose(),this.Up=null)},u.prototype.createNew=function(n,t,i,r,f){return new u(n,t,i,this._dataProvider,r,f)},u.prototype.UL=function(n,t){var r;if(!this.OP)for(r=0;r<n.textureNames.length;r++){var f=this.RX+r,e=n.textureNames[r],o=t.imageBitmaps.length>r?t.imageBitmaps[r]:null,u=new i(e,this.Ha,o,f);u&&(this.TS.add(u.name,u),this.Uz.push(u))}},u.prototype.Tb=function(n){var t=this.TS.getValue(n);return t?t.getTexture():null},u.prototype.Vd=function(){var t,n,i;if(this.TS){for(t=this.Uz,n=0;n<t.length;n++)i=t[n],i&&i.dispose();this.TS.clear();this.Uz=[];this.TS=null}},u.prototype._getAllDrawMesh=function(){for(var t=[],n=0;n<this._drawMeshes.length;n++)t.push(this._drawMeshes[n]);return t},u.prototype._getNonSplitableDrawMesh=function(){return[]},u.prototype._getOneSubDrawMesh=function(){return[]},u.prototype.intersectsRay=function(t){var u,f,e,i,o,r,s;if(!this.Rv||!this.Rv.isBoundingBoxIntersects(t))return null;for(f=17976931348623157e292,e=this.node,i=0;i<e.subs.length;i++)o=e.subs[i].accessMesh(),o&&(r=o.intersectsRay(t),r&&(s=n.Vector3.Distance(t.origin,r),s<f&&(u=r,f=s)));return u?u:this.Ve(t)},u.prototype.Ve=function(n){return this.Rv?this.Rv.intersectsRay(n):null},u}(n.TileNodeBase);n.TileMesh=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(r){var u=t.call(this)||this,f;return u.name=r,f=i.VZ*16,u.Cw=new n.SizeBasedObjectCache(u),u.Cw.capacity=f,u}return __extends(i,t),Object.defineProperty(i,"VZ",{get:function(){return n.SystemHelper.ToInt(128*n.Drawing3DSetting._GetLodCacheRatio())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"count",{get:function(){return this.Cw.count},enumerable:!1,configurable:!0}),i.prototype.allocUrlNo=function(n){return this.urlMapping.string2No(n,!0)},i.prototype.urlFromNo=function(n){return this.urlMapping.no2String(n)},i.prototype.loadObject=function(){return null},i.prototype.releaseObject=function(n,t){t&&t.dispose()},i.prototype.accessMesh=function(n){return this.Cw.accessObject(n)},i.prototype.recycle=function(){return this.Cw.collectGabage(),!0},i.prototype.addToCache=function(n){this.Cw.addObject(n.urlNo,n)},i}(n.DataSurfaceBase);n.TileMeshSurface=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(n,r,u,f,e,o,s,h){var c=t.call(this,u)||this,l;return c.layer=n,c.index=r,c.father=s,c.root=h,c._isVisible=!0,c.WB=0,c.Se=!1,c.Vh=[],i.Vc++,c._uniqueId=i.Vc,c.RX=e,c.Jx=f,c.RB=n.surface,s||(c.root=c),l=i._ExtractLevel(c.RX),l<0&&(l=s?s.level+1:0),c.WB=l,c.Se=o,c.SA=!!s,c}return __extends(i,t),i.prototype._initRootInfo=function(n,t){this._center=n;this._radius=t;this.Vv()},i._ExtractLevel=function(t){var i=t.indexOf("_L"),r,u;return i>0?(r=t.indexOf("_",i+1),u=n.TString.Substring(t,i+2,r-i-2),n.NumberHelper.ToInt(u)):-1},Object.defineProperty(i.prototype,"baseUrl",{get:function(){return this.Jx},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"level",{get:function(){return this.WB},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isDataLoaded",{get:function(){var n=this.accessMesh();return n&&n.isDataLoaded},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isLeaf",{get:function(){return this.RH},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"meshUrlNo",{get:function(){return this.Si},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"subs",{get:function(){return this.Vh},enumerable:!1,configurable:!0}),i.prototype.Vv=function(){var n,t,i,u,r;if(!this.VD&&!this.SA){if(this.index._isIndexNodeNameSameAsFile)n=this.Jx+this.RX+this.index.getDataFileSurffix();else{if(t=this.RX,i=this.index.getRootNodeInfo(),!i||this.index._isLoadingRootInfo)return;i&&(t=i.name,this.RX=t);n=this.Jx+t+this.index.getDataFileSurffix()}n&&(u=this._geoObject.layer,r=u.createRootMesh(this,this._geoObject,this.RB,this.index,n,this.Se),r.initBasicInfo(this._center,this._radius,!1),this.VD=r)}},i.prototype.getRootMesh=function(){return this.VD},i.prototype.accessMesh=function(){if(this.VD)return this.VD;if(!this.Si){var n=this.UR();this.Si=this.RB.allocUrlNo(n)}return this.RB.accessMesh(this.Si)},i.prototype.UR=function(){return this.Jx+this.RX+this.index.getDataFileSurffix()},i.prototype.Vz=function(){for(var n=0;n<this.Vh.length;n++)this.Vh[n].dispose();this.Vh=[]},i.prototype.dispose=function(){this.Vz()},i.prototype.Vr=function(){if(this.RH||this._info&&this._info._isLoaded)return!1;var n=this._info,t=!this.SA;if(t?(n=this.index.getRootNodeInfo(),n&&!this.VD&&this.Vv()):n=this.index.getNodeInfo(this.RX),this._info=n,n)if(n._isLoaded)n.subNames.length===0&&(this.RH=!0);else return!0;else this.SA&&(this.RH=!0);return!1},i.prototype.Ui=function(n){var t;if(n&&n._isLoaded&&!(this.Vh.length>0)&&!this.RH)for(t=0;t<n.subNames.length;t++){var f=n.subNames[t],e=n.getSubBaseUrl(t),u=new i(this.layer,this.index,this._geoObject,e,f,this.Se,this,this.root),r=this.index.getNodeInfo(f);r&&(u._center.set(r.center.x,r.center.y,r.center.z),u._radius=r.radius);this.Vh.push(u)}},i.prototype.Sk=function(t,r,u,f,e){var s=1,h,l,c,o,a,v;return u>i._MaxTopLevel?s=1:(h=this.root.level,h===u&&(s*=4),u>h&&(l=Math.max(.1,Math.pow(.8,u-h)),s*=l)),c=n.Vector3.Distance(t,f),o=10,n.Drawing3DSetting.LodRatio<=1&&(a=Math.max(200,r),c>a*1.5&&(o*=.5)),s>1&&(o*=s),v=n.Drawing3DSetting._GetCombinedLodRatio()*this.layer.lodRatio,o=o*v,c<e*o},i._TopRatioFromSub=function(n,t,r){if(n>i._MaxTopLevel)return 1;var u=2.5;return(r||t)&&(u*=4),u},i._IsB3dmNeedSplit=function(t,i,r,u,f){var s;if(!f)return!0;var h=f.center,e=n.Vector3.Distance(t,h),o=1;n.Drawing3DSetting.LodRatio<=1&&(s=Math.max(200,i),e>s*1.5&&(o=.5));var c=n.Drawing3DSetting._GetCombinedLodRatio()*u,l=Math.max(f._geometricError*16,f.radius*3*r);return e<l*o*c},i.prototype.CT=function(n){var r=this.PC,u,f,t,e,o,s;return(r||(this.PC=this._geoObject.renderContext.camera,r=this.PC),this.level>this.index._currentLeafLevel&&(this.index._currentLeafLevel=this.level),u=this.Vr(),this.RH)?!1:this.layer.maxVisibleLevel&&this.WB>=this.layer.maxVisibleLevel?!1:(f=!0,this.father&&!this.father._isVisible?(f=!1,this._isVisible=!1):this._isVisible=this.RH?this.father?this.father._isVisible:!0:r.worldCamera.isSphereInFrustum(this.worldCenter,this.radius),!f)?!1:(e=n.lodParam.localEyePos,this.layer._isDrawseeTile?t=this.Sk(e,this.PC.eyeDistance,this.level,this._center,this._radius):(o=this._info&&this._info.subNames.length===1,s=i._TopRatioFromSub(this.level,o,u),t=i._IsB3dmNeedSplit(e,this.PC.eyeDistance,s,this.layer.lodRatio,this._info)),t&&(u?this._isVisible&&this.index.loadNodeInfo(this.Jx,this.RX,this.worldCenter):this.Ui(this._info)),t)},i.EnumAndCreateMeshesRecursive=function(n,t){var f=n.accessMesh(),e,r,u,o;if(f&&(t.push(f),n._isSplit))for(e=n.Vh,r=0;r<e.length;r++)u=e[r],o=u.accessMesh(),o||u.RJ(f),i.EnumAndCreateMeshesRecursive(u,t)},i.prototype.enumSubMeshes=function(){for(var u,t,i=[],r=this.Vh,n=0;n<r.length;n++)u=r[n],t=u.accessMesh(),t&&i.push(t);return i},i.prototype.RJ=function(n){var i=this.UR(),t=n.createNew(this,this._geoObject,this.RB,i,this.Se);t.initBasicInfo(this.center,this.radius,!0);this.RB.addToCache(t)},Object.defineProperty(i.prototype,"isIsAllLeafsReadyDirty",{get:function(){var n=!this.Qm&&this.TN;return this.Qm=this.TN,n},enumerable:!1,configurable:!0}),i.MarkStatusRecursive=function(t,i){this.Va(t,i);var r=new n.RefValue(!0);this.UT(t,r);t.TN=r.value},i.Va=function(n,t){var u,r,f;if(n._isSplit=n.CT(t),n._isSplit)for(u=n.Vh,r=0;r<u.length;r++)f=u[r],i.Va(f,t)},i.UT=function(n,t){var r=!0,s=n.accessMesh(),f=s&&s.isReadyForDraw,e=n.Vh,u,o,h;if(n._isSplit)if(e.length>0)for(u=0;u<e.length;u++)o=e[u],h=i.UT(o,t),!h&&o._isVisible&&(r=!1);else n._info&&n._info._isLoaded||(r=!1);else r=f;return n.UF=r,n._isSplit||!n._isVisible||f||(t.value=!1),f||r},i.prototype.enumDrawMeshesForRender=function(){var n=[];return this.layer._isLeafFirst?this.UU(n):this.US(n),n},i.prototype.UU=function(t){var i,r;if(this._isVisible&&(i=this.accessMesh(),i)){if(this._isSplit&&this.Vh.length>0)for(r=0;r<this.Vh.length;r++)this.Vh[r].UU(t);i.isReadyForDraw&&this._isVisible&&(!this.UF||!this._isSplit)?n.ArrayHelper.AddRange(t,i._getAllDrawMesh()):n.ArrayHelper.AddRange(t,i._getNonSplitableDrawMesh())}},i.prototype.US=function(t){var i,r,u,f;if(this._isVisible&&(i=this.accessMesh(),i))if(this._isSplit&&this.Vh.length>0&&this.UF){for(r=0;r<this.Vh.length;r++)u=this.Vh[r],f=u.accessMesh(),f&&u.US(t);n.ArrayHelper.AddRange(t,i._getNonSplitableDrawMesh())}else n.ArrayHelper.AddRange(t,i._getAllDrawMesh())},i._MaxTopLevel=17,i.Vc=0,i}(n.TileNodeBase);n.TileMeshIndexNode=t}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(t,i,r){this.layer=t;this._currentLeafLevel=0;this._nodeInfos=new n.StringKeyDictionary;this._renderContext=t.renderContext;this._camera=this._renderContext.camera;this._fileName=r;this._baseUrl=i}return t.prototype.getRootNode=function(){return this._rootNode},t.prototype.initRootInfo=function(t,i,r,u){this._geoObject=t;this._rootNode=new n.TileMeshIndexNode(this.layer,this,t,this._baseUrl,this._fileName,u,null,null);this._rootNode._initRootInfo(i,r)},Object.defineProperty(t.prototype,"dataLoadType",{get:function(){return this._dataLoadType},enumerable:!1,configurable:!0}),t.prototype.getDataFileSurffix=function(){return""},t.prototype.parseTileDataAsync=function(){return null},t.prototype.getRootNodeInfo=function(){return null},t.prototype.getNodeInfo=function(n){return this._nodeInfos.getValue(n)},t.prototype.loadNodeInfo=function(){},t.prototype.enumMeshes=function(){var t=this.Te,i,r;if(!t)return[];if(n.SystemTime._IsTimer1000)for(i=0;i<t.length;i++)r=t[i],r&&r.stampTimeMark();return t},t.prototype.update=function(t){this.Te=[];n.TileMeshIndexNode.MarkStatusRecursive(this._rootNode,t);n.TileMeshIndexNode.EnumAndCreateMeshesRecursive(this._rootNode,this.Te);this.commitIndexLoadTask()},t.prototype.commitIndexLoadTask=function(){},t.prototype.enumDrawMeshesForRender=function(){return this._rootNode.enumDrawMeshesForRender()},t}();n.TileMeshIndexBase=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i,r,u,f,e,o,s){var h=t.call(this,i.renderContext,u)||this;return h.VK=new n.Box,h.VW=[],h.SE=new n.AsyncRenderableParam,h.layer=i,h.BH=f,h.material=null,h.Se=e,o&&(h.VA=o.center,h.VO=s?s:o.radius,h.VK=o.clone()),h.Ua=r,h.Ua.initRootInfo(h,h.VA,h.VO,h.Se),h._frustumOnlyClip=!0,h}return __extends(i,t),Object.defineProperty(i.prototype,"localBounds",{get:function(){return this.VK},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isDataLoaded",{get:function(){var n=this.Uh();return n&&n.isDataLoaded},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isReadyForDraw",{get:function(){var n=this.Uh();return n&&n.isReadyForDraw},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"index",{get:function(){return this.Ua},enumerable:!1,configurable:!0}),i.prototype.Uh=function(){return this.Ua.getRootNode().getRootMesh()},i.prototype.enumMeshes=function(){return this.Ua.enumMeshes()},i.prototype.initBoundingClip=function(){t.prototype.initBoundingClip.call(this,this.localToWorld(this.VA),this.VO)},i.prototype.updateIndex=function(){this.Ua.update(this._prepareParam());this.VW=this.Ua.enumDrawMeshesForRender()},i.prototype.enumDrawMeshesForRender=function(){return this.VW},i.prototype.getAnnoPosition=function(){var i=this.localBounds,u=(i.max.y-i.min.y)*.4,r=new n.Vector3((i.min.x+i.max.x)*.5,u,(i.min.z+i.max.z)*.5);return r=t.prototype.localToEarth.call(this,r),r.clone()},i.prototype._prepareParam=function(){var r=n._TileMeshLodHelper.CalcTileLodWorldCenter(this.renderContext),i=this.SE.lodParam;return t.prototype.worldToLocalToRef.call(this,r,i.localEyePos),i.globalEyePos=r,i.objectCenter=this.worldBounds.center,this.SE},i.prototype.intersectRay=function(i,r,u,f){var e=this.Uh(),o;if(!e||(o=e.getTriIndex(),!o))return!1;var h=t.prototype.worldToLocal.call(this,r),c=t.prototype.worldToLocal.call(this,u),l=n.VectorHelper.CreateRay(h,c),s=e.intersectsRay(l);return s?(t.prototype.localToWorldToRef.call(this,s,f),!0):!1},i}(n.PointGeoObject);n.TileMeshGeoObject=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(){}return t.CalcTileLodWorldCenter=function(t){var i=n.Vector3.Lerp(t.camera.center,t.camera.eye,.4);return i.y=t.camera.center.y+t.camera.eyeDistance,t.coordSystem.earthToWorld(i)},t}(),i;n._TileMeshLodHelper=t;i=function(i){function r(t,r){var u=i.call(this,t,r)||this;return u.isUseLight=!1,u.RB=new n.TileMeshSurface(r,1e4),u.UB=u.renderContext.graphics.fixedMeshChunkRender.createList(),u.St=u.renderContext.graphics.fixedMeshChunkRender.createList(),u._sortObjectOnlyByDistance=!0,u}return __extends(r,i),Object.defineProperty(r.prototype,"surface",{get:function(){return this.RB},enumerable:!1,configurable:!0}),r.prototype._calcLodWorldCenter=function(){return t.CalcTileLodWorldCenter(this.renderContext)},r.prototype.recycle=function(n){return this.RB.recycle(n)},r.prototype.createRootMesh=function(t,i,r,u,f,e){return new n.TileMesh(t,i,r,u,f,e)},r.prototype.registerDataTask=function(t){var f,o,u,c,l,a,s,h,r,e;if(!(this.count<=0)){if(n.SystemTime._IsTimer100&&(this.Ts===undefined&&(this.Ts=this._isLeafFirst),this.Ts&&(this._isLeafFirst=n.AsyncWebStream._IsFastNet()?!1:!0),this.updateIndex()),!this.Te||n.SystemTime._IsTimer100){for(this.Te=[],f=this.Te,o=i.prototype.enumObjectsInIndex.call(this,this.maxVisibleObjectCount,!0),r=0;r<o.length;r++)u=o[r],u.updateIndex(t),u&&u.enumMeshes&&(c=u.enumMeshes(),n.ArrayHelper.AddRange(f,c));l=this.Tm(f.filter(function(n){return!n.isDataLoaded}));a=this.Tm(f.filter(function(n){return n.isDataLoaded&&!n.isReadyForDraw}));this.Sv=l;this.TB=a}for(s=this.Sv.filter(function(n){return!n.isDataLoaded}),r=0;r<s.length;r++)if(e=s[r],e.loadData(),!n.AsyncRenderContext.CanLoadData())break;for(h=this.TB.filter(function(n){return n.isDataLoaded}),r=0;r<h.length;r++)e=h[r],e.prepareData()}},r.prototype.Tm=function(n){return this._isDrawseeTile||!this._isLeafFirst?n:this.RO(n)},r.prototype.RO=function(t){var c,f,e,r,i,h;if(t=t.filter(function(n){return n.node._isVisible}),t.length<=0)return[];for(c=this._calcLodWorldCenter(),f=-Number.MAX_VALUE,r=0;r<t.length;r++)i=t[r],e=i.node.level,e>f&&(f=e),i._tmpSort=n.Vector3.DistanceSquared(i.node.worldCenter,c);t=t.sort(function(t,i){return n.g_compareTo(t._tmpSort,i._tmpSort)});var o=[],u=[],s=[],l=t[0].node.root.level;for(r=0;r<t.length;r++)i=t[r],h=i.node,h.level===l?o.push(i):h._isSplit?u.push(i):s.push(i);return o.length>0?o:s.length>0?s:(u.length>1&&(u=u.sort(function(t,i){return n.g_compareTo(t.node.level,i.node.level)})),u)},r.prototype.updateContents=function(n){return this.Rm(n)?(this.SX(n),!0):!1},r.prototype.SX=function(t){var u,i,r,f,e;for(this.UB&&this.UB.clear(),this.St&&this.St.clear(),u=this.enumObjectsInIndex(this.maxVisibleObjectCount,!0),i=[],r=0;r<u.length;r++)f=u[r],f.updateContents(t),e=f.enumDrawMeshesForRender(),n.ArrayHelper.AddRange(i,e);return this._isLeafFirst?this.Ql(i):this.Th(i),!0},r.prototype.Th=function(t){this.UB.addChunks(n.TileDrawMesh.ToChunks(t))},r.prototype.Ql=function(t){for(var i,u,r=[],e=[],f=0;f<t.length;f++)i=t[f],i.fatherMesh.node._isSplit?r.push(i):e.push(i);if(this.UB.addChunks(n.TileDrawMesh.ToChunks(e)),r.length>0){var o=[],s=r[0].fatherMesh.node,l=s.root.level,a=s.index._currentLeafLevel;for(u=0;u<r.length;u++){var i=r[u],h=i.toChunk(),c=i.fatherMesh.node.level,v=c>=l+2,y=c>=a-2;h.isWriteDepthBuffer=v||y;o.push(h)}this.St.addChunks(o)}},r.prototype.Rm=function(){var i,t,o,r;if(this.Sr){var u=1e3,f=void 0,e=void 0;if(f=this.UH(),this.renderContext.camera.isMoving)u=300;else for(i=this.enumObjectsInIndex(this.maxVisibleObjectCount,!0),t=0;t<i.length;t++)if(o=i[t],o.index.getRootNode().isIsAllLeafsReadyDirty){e=!0;break}return(r=n.SystemTime._FrameNow(),f||e||r-this.Sr>u)?(this.Sr=r,this.Sg(),!0):!1}this.Sr=n.SystemTime._FrameNow();this.Sg()},r.prototype.UH=function(){var n=this.renderContext.camera,t=n.eyeDistance*.05,i=5;return Math.abs(this.RS-n.center.x)>t||Math.abs(this.UA-n.center.z)>t||Math.abs(this.Tk-n.eyeDistance)>t||Math.abs(this.Sy-n.heading)>i||Math.abs(this.Oo-n.pitch)>i},r.prototype.Sg=function(){var n=this.renderContext.camera;this.RS=n.center.x;this.UA=n.center.z;this.Tk=n.eyeDistance;this.Sy=n.heading;this.Oo=n.pitch},r.prototype.drawContents=function(){return this.St.count>0?(this.Vi(this.St),this.Vi(this.UB)):this.Vi(this.UB),!0},r.prototype.Vi=function(t){if(!t)return!1;n._RenderStateHelper.Copy(this,t.setting);t.setting.overlayTexture=this.overlayTexture;t.setting.overlayTextureMatrix=this.overlayTextureMatrix;t.setting.isErrorCheck=!1;this.renderContext.camera._transformLocalWorld();this.renderContext.graphics.fixedMeshChunkRender.renderOneList(this.renderContext.camera.worldCamera,t)},r.prototype.drawVolumeBlendContents=function(){return this.isVisible},r.prototype.enumRenderMeshChunks=function(){var u,f,i,t,r;if(!this.UB)return[];for(u=[],f=this.UB.enumChunks(),i=0;i<f.length;i++)t=f[i],r=new n.RenderMeshChunk(this.UZ(t),t.clipCenter,t.clipRadius,!1,null,t.elmentBuffer,t.indexStart,t.indexCount),r._earthRange=t._earthRange,r._heightRange=t._heightRange,u.push(r);return u},r.prototype.UZ=function(t){var i=t.transformMatrix?t.transformMatrix:n.Matrix.Identity(),r=n.Matrix.Translation(t.basePoint.x,t.basePoint.y,t.basePoint.z);return i.multiply(r)},r}(n.GeoObject3Layer);n.TileLayerBase=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i,r,u){var f=t.call(this,i,r,u)||this;return f.layer=i,f.SV=!1,f.SS=!1,f._dataLoadType=n.AsyncDataLoadType.TileMesh,f._isIndexNodeNameSameAsFile=!0,f._isLoadingRootInfo=!1,f}return __extends(i,t),i.prototype.getRootNodeInfo=function(){return this.getNodeInfo(this._fileName)},i.prototype.getDataFileSurffix=function(){return".xz"},i.prototype.parseTileDataAsync=function(n){return new Promise(function(t){t(n.processedData)})},i.prototype.commitIndexLoadTask=function(){var t=this,i,r;this.SS||this.QW||(this.SV||(i=this._rootNode.getRootMesh(),i&&(i.loadData(),this.SV=this._rootNode.isDataLoaded)),this._rootNode._isSplit&&(this.TP||(r=this.Sm(this._baseUrl,this._fileName),this.TP=new n.PromiseDelegate(function(){n.AsyncRenderContext.LoadData(n.AsyncDataLoadType.ArrayBuffer,r,"",n.AsyncDataPriority.Common).then(function(n){t.TP.onThen();n&&(t.SS=!0,n.isBadUrl?(t.QW=!0,t.TP=null):t.Qr(n.data))})})),this.TP.tryInvoke()))},i.prototype.Qr=function(n){!n||n.length<=0||(this._nodeInfos=this.UD(n))},i.prototype.TA=function(n){var t=n.indexOf("_L");return t>0?n.substr(0,t):n},i.prototype.Sm=function(n,t){return n+this.TA(t)+"_index.json.xz"},i.prototype.UD=function(t){var u,i,r;t=n.SystemHelper.Uncompress(t);var o=n.EncodingHelper.GetUtf8String(t),f=JSON.parse(o),e=new n.StringKeyDictionary;for(u=0;u<f.length;u++)i=f[u],r=new n.TileMeshIndexNodeInfo(new n.Vector3(i.center.x,i.center.y,i.center.z),i.radius,i.subs),r._baseUrl=this._baseUrl,r._isLoaded=!0,r._geometricError=3,e.add(i.fileName,r);return e},i}(n.TileMeshIndexBase),i=function(n){function t(t,i,r,u,f,e){var o=n.call(this,t,i,r,u,f,e)||this;return o.node=t,o}return __extends(t,n),t.prototype.createNew=function(n,i,r,u,f){return new t(n,i,r,this._dataProvider,u,f)},t.prototype.onAfterCreateDrawMeshes=function(){var n=this.node.subs.length;this.PM=n>0?this._drawMeshes.length-n:0},t.prototype._getNonSplitableDrawMesh=function(){for(var t=[],n=0;n<this.PM;n++)t.push(this._drawMeshes[n]);return t},t.prototype._getOneSubDrawMesh=function(n){var t=[],i=this._drawMeshes[this.PM+n];return t.push(i),t},t}(n.TileMesh),r=function(r){function u(n,t,i,u){var f=r.call(this,n,t)||this;return f._isDrawseeTile=!0,f.SN(i,u,!0),f.earthViewer.addGroundLayer(f),f}return __extends(u,r),u.prototype.createRootMesh=function(n,t,r,u,f,e){return new i(n,t,r,u,f,e)},u.prototype.SP=function(n){return n+"/config.json.xz"},u.prototype.SN=function(t,i,r){var f=this,u;(r===void 0&&(r=!1),t)&&(u=this.SP(t),n.AsyncWebStream.ReadDirectUint8Array(u).then(function(n){f.NC(t,n,i.clone(),r)}))},u.prototype.Pd=function(t,i,r,u,f,e){var o=.6*e,s=new n.Box(new n.Vector3(f.x-o,f.y-o,f.z-o),new n.Vector3(f.x+o,f.y+o,f.z+o)),h=new n.TileMeshGeoObject(this,t,r,i,u,s,e);this.addObject(h)},u.prototype.NC=function(t,i,r,u){i=n.SystemHelper.Uncompress(i);var e=n.EncodingHelper.GetUtf8String(i),f=JSON.parse(e);f&&this.TQ(f,t,r,u);n.SystemHelper.FireEvent(this.onAfterLoad,this)},u.prototype.TQ=function(i,r,u,f){for(var o,a,c=i,s=0;s<c.groups.length;s++){var l=c.groups[s],h=l.infos[0],e=this.UK(l);h&&e&&h.fileName&&e.fileName&&(o=n.TString.Concat([r,h.fileName,"/",e.fileName,".xz"]),a=new t(this,n.StringHelper.ExtractDirectoryOnly(o),n.StringHelper.ExtractFileNameWithoutSuffix(o)),this.Pd(a,o,u,f,new n.Vector3(e.center.x,e.center.y,e.center.z),e.radius))}},u.prototype.UK=function(n){for(var t=0,i,t=0;t<n.infos.length-1;t++)if(i=n.infos[t],i.subs.length>1)break;return n.infos[t]},u}(n.TileLayerBase);n.DrawseeTileLayer=r}(Drawsee||(Drawsee={})),function(n){var t;(function(t){var r,f,e,o,s,h,c,l;(function(n){n[n.BYTE=5120]="BYTE";n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";n[n.SHORT=5122]="SHORT";n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";n[n.FLOAT=5126]="FLOAT"})(r||(r={})),function(n){n[n.FRAGMENT=35632]="FRAGMENT";n[n.VERTEX=35633]="VERTEX"}(f||(f={})),function(n){n[n.BYTE=5120]="BYTE";n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";n[n.SHORT=5122]="SHORT";n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";n[n.INT=5124]="INT";n[n.UNSIGNED_INT=5125]="UNSIGNED_INT";n[n.FLOAT=5126]="FLOAT";n[n.FLOAT_VEC2=35664]="FLOAT_VEC2";n[n.FLOAT_VEC3=35665]="FLOAT_VEC3";n[n.FLOAT_VEC4=35666]="FLOAT_VEC4";n[n.INT_VEC2=35667]="INT_VEC2";n[n.INT_VEC3=35668]="INT_VEC3";n[n.INT_VEC4=35669]="INT_VEC4";n[n.BOOL=35670]="BOOL";n[n.BOOL_VEC2=35671]="BOOL_VEC2";n[n.BOOL_VEC3=35672]="BOOL_VEC3";n[n.BOOL_VEC4=35673]="BOOL_VEC4";n[n.FLOAT_MAT2=35674]="FLOAT_MAT2";n[n.FLOAT_MAT3=35675]="FLOAT_MAT3";n[n.FLOAT_MAT4=35676]="FLOAT_MAT4";n[n.SAMPLER_2D=35678]="SAMPLER_2D"}(e||(e={})),function(n){n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE";n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT";n[n.REPEAT=10497]="REPEAT"}(o||(o={})),function(n){n[n.NEAREST=9728]="NEAREST";n[n.LINEAR=9728]="LINEAR";n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST";n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST";n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR";n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(s||(s={})),function(n){n[n.ALPHA=6406]="ALPHA";n[n.RGB=6407]="RGB";n[n.RGBA=6408]="RGBA";n[n.LUMINANCE=6409]="LUMINANCE";n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"}(h||(h={})),function(n){n[n.FRONT=1028]="FRONT";n[n.BACK=1029]="BACK";n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(c||(c={})),function(n){n[n.ZERO=0]="ZERO";n[n.ONE=1]="ONE";n[n.SRC_COLOR=768]="SRC_COLOR";n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR";n[n.DST_COLOR=774]="DST_COLOR";n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR";n[n.SRC_ALPHA=770]="SRC_ALPHA";n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA";n[n.DST_ALPHA=772]="DST_ALPHA";n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA";n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR";n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR";n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA";n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA";n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(l||(l={}));var u=function(){function t(){}return t.GetBufferFromBufferView=function(n,t,i,u,f){var i=t.byteOffset+i,o=n.loadedBufferViews[t.buffer],s,h,e;if(i+u>o.byteLength)throw new Error("Buffer access is out of range");s=o.buffer;h=o.byteOffset?o.byteOffset:0;i+=h;e=s.slice(i,i+u);switch(f){case r.BYTE:return new Int8Array(e);case r.UNSIGNED_BYTE:return new Uint8Array(e);case r.SHORT:return new Int16Array(e);case r.UNSIGNED_SHORT:return new Uint16Array(e);default:return new Float32Array(e)}},t.TL=function(t){if(t==="SCALAR")return 2;if(t==="VEC3")return 12;if(t==="VEC2")return 8;throw new n.Exception("wrong access type");},t.GetTypeArrayFromAccessor=function(n,i){var r=n.bufferViews[i.bufferView],u=i.byteStride?i.byteStride:this.TL(i.type),f=i.count*u;return t.GetBufferFromBufferView(n,r,i.byteOffset,f,i.componentType)},t.DecodeBufferToText=function(n){for(var i="",r=n.byteLength,t=0;t<r;++t)i+=String.fromCharCode(n[t]);return i},t}(),a=function(n,t){var i,r;for(i in n)r=n[i],t.buffers[i]=r,t.buffersCount++},i=function(n,t,i){var r,u;for(r in n)u=n[r],i[t][r]=u},v=function(){function n(){}return n.CreateRuntime=function(n,t,r){var u={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:t,rootUrl:r,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[]};return n.extensions&&i(n.extensions,"extensions",u),n.extensionsUsed&&i(n.extensionsUsed,"extensionsUsed",u),n.buffers&&a(n.buffers,u),n.bufferViews&&i(n.bufferViews,"bufferViews",u),n.accessors&&i(n.accessors,"accessors",u),n.meshes&&i(n.meshes,"meshes",u),n.lights&&i(n.lights,"lights",u),n.cameras&&i(n.cameras,"cameras",u),n.nodes&&i(n.nodes,"nodes",u),n.images&&i(n.images,"images",u),n.textures&&i(n.textures,"textures",u),u},n}(),y=function(){function t(){}return t.ToMeshTransferData=function(t,i,r){var f=v.CreateRuntime(i,null,""),u;f.loadedBufferViews.binary_glTF=r;u=new n.TileMeshTransferData;try{this.Mk(f,u);this.TJ(f,u);this.Ki(u)}catch(e){}return u},t.TJ=function(n,t){var f,s,i,o;t.textureNames=[];t.textureBytes=[];f=0;for(s in n.images)if(i=n.images[s],i){var c=i.extensions.KHR_binary_glTF.bufferView,e=n.bufferViews[c],h=u.GetBufferFromBufferView(n,e,0,e.byteLength,r.UNSIGNED_BYTE);h&&(o=new Uint8Array(e.byteLength),o.set(h),i.name?t.textureNames.push(i.name):t.textureNames.push(f.toString()),t.textureBytes.push(o),f++)}},t.Mk=function(t,i){var p,s,h,o,d,y,c,r;for(p in t.meshes)if(s=t.meshes[p],s)for(h=0;h<s.primitives.length;h++){var l=s.primitives[h],w=l.attributes,e=null,f=null,a=void 0,b=void 0,v=void 0,k=void 0;for(o in w)d=w[o],e=t.accessors[d],f=u.GetTypeArrayFromAccessor(t,e),o==="NORMAL"?k=f:o==="POSITION"?v=f:o.indexOf("TEXCOORD_")!==-1&&(b=f);if(e=t.accessors[l.indices],e)f=u.GetTypeArrayFromAccessor(t,e),a=f;else{for(y=[],c=0;c<v.length/3;c++)y.push(c);a=new Int32Array(y)}r=new n.SubTileMeshTransferData;r.indices=a;r.vertexes=v;r.normals=k;r.textureCoords=b;r.textureFileName=l.material;i.subs.push(r)}},t.Ki=function(n){var e=n.subs,t=n.textureNames,i,u,f,r,o;if(!(t.length<=0))for(i=0;i<e.length;i++){for(u=e[i],f=!1,r=0;r<t.length;r++)if(u.textureFileName===t[r]){f=!0;break}f||(o=Math.min(i,t.length-1),u.textureFileName=t[o])}},t}();t._Gltf10Helper=y})(t=n.Gltf10||(n.Gltf10={}))}(Drawsee||(Drawsee={})),function(n){var t;(function(t){function y(n){return Object.prototype.toString.call(n)==="[object Array]"}function p(t,i){return i=n.defaultValue(i,0),n.getStringFromTypedArray(t,i,Math.min(4,t.length))}function s(n){return i.shader(n,function(n){u(n)}),i.buffer(n,function(n){u(n)}),i.image(n,function(n){u(n);i.compressedImage(n,function(n){u(n)})}),u(n),n}function u(t){t.extras=n.defined(t.extras)?t.extras:{};t.extras._pipeline=n.defined(t.extras._pipeline)?t.extras._pipeline:{}}function i(){}function e(t,i){return n.defined(t.extensionsUsed)&&t.extensionsUsed.indexOf(i)>=0}function w(n){var r=p(n),i,t;if(r!=="glTF")throw new Error("File is not valid binary glTF");if(i=c(n,0,5),t=i[1],t!==1&&t!==2)throw new Error("Binary glTF version is not 1 or 2");return(n._version=t,t===1)?d(n,i):g(n,i)}function c(n,t,i){for(var f=new DataView(n.buffer),u=new Array(i),r=0;r<i;++r)u[r]=f.getUint32(n.byteOffset+t+r*h,!0);return u}function b(t,i){var r=t.extensionsRequired,u;n.defined(r)&&(u=r.indexOf(i),u>=0&&r.splice(u,1),r.length===0&&delete t.extensionsRequired)}function k(t,i){var r=t.extensionsUsed,u;n.defined(r)&&(u=r.indexOf(i),u>=0&&r.splice(u,1),b(t,i),r.length===0&&delete t.extensionsUsed)}function d(t,i){var c=i[2],e=i[3],l=i[4],h,r,f;if(l!==0)throw new Error("Binary glTF scene format is not JSON");var o=20,a=o+e,v=n.getStringFromTypedArray(t,o,e),u=JSON.parse(v);return s(u),h=t.subarray(a,c),r=u.buffers,n.defined(r)&&Object.keys(r).length>0&&(f=n.defaultValue(r.binary_glTF,r.KHR_binary_glTF),n.defined(f)&&(f.extras._pipeline.source=h)),k(u,"KHR_binary_glTF"),u}function g(t,i){for(var p=i[2],r=12,u,e,o,v,f,y;r<p;){var h=c(t,r,2),l=h[0],a=h[1];r+=8;o=t.subarray(r,r+l);r+=l;a===1313821514?(v=n.getStringFromTypedArray(o),u=JSON.parse(v),s(u)):a===5130562&&(e=o)}return n.defined(u)&&n.defined(e)&&(f=u.buffers,n.defined(f)&&f.length>0&&(y=f[0],y.extras._pipeline.source=e)),u}function nt(n,t,i,r,u){var v=n.x,y=n.y,p=n.z,ot=t.x,st=t.y,ht=t.z,w=v*v*ot*ot,b=y*y*st*st,k=p*p*ht*ht,ct=w+b+k,d=Math.sqrt(1/ct),h=n.scaleToRef(d,l),f,it,rt,lt,e,o,s,ut,ft,et,at,vt,yt,pt;if(ct<r)return isFinite(d)?(u.copyFrom(h),!0):!1;var g=i.x,nt=i.y,tt=i.z,c=a;c.x=h.x*g*2;c.y=h.y*nt*2;c.z=h.z*tt*2;f=(1-d)*n.length()/(.5*c.length());it=0;do f-=it,e=1/(1+f*g),o=1/(1+f*nt),s=1/(1+f*tt),ut=e*e,ft=o*o,et=s*s,at=ut*e,vt=ft*o,yt=et*s,rt=w*ut+b*ft+k*et-1,lt=w*at*g+b*vt*nt+k*yt*tt,pt=-2*lt,it=rt/pt;while(Math.abs(rt)>1e-12);return u.set(v*e,y*o,p*s),!0}function ut(n){return(n=+n,n===0||n!==n)?n:n>0?1:-1}function ft(t){var i=n.Vector3.Zero();return v(t,i),i}function v(t,i){var s=tt,f=it,h=rt,u,r;if(!nt(t,s,f,h,o))throw new n.Exception("wrong cartesian coord");u=o;r=u.multiply(f);r.normalize();var e=t.subtract(u),c=Math.atan2(r.y,r.x),l=Math.asin(r.z),a=ut(n.Vector3.Dot(e,t))*e.length();i.set(n.MathHelper.ToDegrees(c),a,n.MathHelper.ToDegrees(l))}function ot(t,i){var o=n.MathHelper.ToRadians(t.x),s=n.MathHelper.ToRadians(t.z),u=t.y,h,e,c;u=n.defaultValue(u,0);h=et;e=Math.cos(s);r.x=e*Math.cos(o);r.y=e*Math.sin(o);r.z=Math.sin(s);r.normalize();r.multiplyToRef(h,f);c=Math.sqrt(n.Vector3.Dot(r,f));f.scaleInPlace(1/c);r.scaleInPlace(u);i.copyFrom(f);i.addInPlace(r)}var st=function(){function t(){}return t.getSizeInBytes=function(n){switch(n){case t.BYTE:return Int8Array.BYTES_PER_ELEMENT;case t.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case t.SHORT:return Int16Array.BYTES_PER_ELEMENT;case t.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case t.INT:return Int32Array.BYTES_PER_ELEMENT;case t.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case t.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case t.DOUBLE:return Float64Array.BYTES_PER_ELEMENT}},t.fromTypedArray=function(n){return n instanceof Int8Array?t.BYTE:n instanceof Uint8Array?t.UNSIGNED_BYTE:n instanceof Int16Array?t.SHORT:n instanceof Uint16Array?t.UNSIGNED_SHORT:n instanceof Int32Array?t.INT:n instanceof Uint32Array?t.UNSIGNED_INT:n instanceof Float32Array?t.FLOAT:n instanceof Float64Array?t.DOUBLE:void 0},t.validate=function(i){return n.defined(i)&&(i===t.BYTE||i===t.UNSIGNED_BYTE||i===t.SHORT||i===t.UNSIGNED_SHORT||i===t.INT||i===t.UNSIGNED_INT||i===t.FLOAT||i===t.DOUBLE)},t.createTypedArray=function(n,i){switch(n){case t.BYTE:return new Int8Array(i);case t.UNSIGNED_BYTE:return new Uint8Array(i);case t.SHORT:return new Int16Array(i);case t.UNSIGNED_SHORT:return new Uint16Array(i);case t.INT:return new Int32Array(i);case t.UNSIGNED_INT:return new Uint32Array(i);case t.FLOAT:return new Float32Array(i);case t.DOUBLE:return new Float64Array(i)}},t.createArrayBufferView=function(i,r,u,f){u=n.defaultValue(u,0);f=n.defaultValue(f,(r.byteLength-u)/t.getSizeInBytes(i));switch(i){case t.BYTE:return new Int8Array(r,u,f);case t.UNSIGNED_BYTE:return new Uint8Array(r,u,f);case t.SHORT:return new Int16Array(r,u,f);case t.UNSIGNED_SHORT:return new Uint16Array(r,u,f);case t.INT:return new Int32Array(r,u,f);case t.UNSIGNED_INT:return new Uint32Array(r,u,f);case t.FLOAT:return new Float32Array(r,u,f);case t.DOUBLE:return new Float64Array(r,u,f)}},t.fromName=function(n){switch(n){case"BYTE":return t.BYTE;case"UNSIGNED_BYTE":return t.UNSIGNED_BYTE;case"SHORT":return t.SHORT;case"UNSIGNED_SHORT":return t.UNSIGNED_SHORT;case"INT":return t.INT;case"UNSIGNED_INT":return t.UNSIGNED_INT;case"FLOAT":return t.FLOAT;case"DOUBLE":return t.DOUBLE}},t.BYTE=n.WebGLConstants.BYTE,t.UNSIGNED_BYTE=n.WebGLConstants.UNSIGNED_BYTE,t.SHORT=n.WebGLConstants.SHORT,t.UNSIGNED_SHORT=n.WebGLConstants.UNSIGNED_SHORT,t.INT=n.WebGLConstants.INT,t.UNSIGNED_INT=n.WebGLConstants.UNSIGNED_INT,t.FLOAT=n.WebGLConstants.FLOAT,t.DOUBLE=n.WebGLConstants.DOUBLE,t}(),h,l,a,o;i.objectLegacy=function(t,i){var r,f,u;if(n.defined(t))for(r in t)if(t.hasOwnProperty(r)&&(f=t[r],u=i(f,r),n.defined(u)))return u};i.object=function(t,i){var f,r,e,u;if(n.defined(t))for(f=t.length,r=0;r<f;r++)if(e=t[r],u=i(e,r),n.defined(u))return u};i.minLevel=function(t,r,u){var f=t[r];return n.defined(f)&&!y(f)?i.objectLegacy(f,u):i.object(f,u)};i.accessor=function(n,t){return i.minLevel(n,"accessors",t)};i.accessorWithSemantic=function(t,r,u){var f={};return i.mesh(t,function(t){return i.meshPrimitive(t,function(t){var e=i.meshPrimitiveAttribute(t,function(t,i){if(i.indexOf(r)===0&&!n.defined(f[t])&&(f[t]=!0,e=u(t),n.defined(e)))return e});return n.defined(e)?e:i.meshPrimitiveTarget(t,function(t){return i.meshPrimitiveTargetAttribute(t,function(t,i){if(i.indexOf(r)===0&&!n.defined(f[t])&&(f[t]=!0,e=u(t),n.defined(e)))return e})})})})};i.accessorContainingVertexAttributeData=function(t,r){var u={};return i.mesh(t,function(t){return i.meshPrimitive(t,function(t){var f=i.meshPrimitiveAttribute(t,function(t){if(!n.defined(u[t])&&(u[t]=!0,f=r(t),n.defined(f)))return f});return n.defined(f)?f:i.meshPrimitiveTarget(t,function(t){return i.meshPrimitiveTargetAttribute(t,function(t){if(!n.defined(u[t])&&(u[t]=!0,f=r(t),n.defined(f)))return f})})})})};i.accessorContainingIndexData=function(t,r){var u={};return i.mesh(t,function(t){return i.meshPrimitive(t,function(t){var i=t.indices,f;if(n.defined(i)&&!n.defined(u[i])&&(u[i]=!0,f=r(i),n.defined(f)))return f})})};i.animation=function(n,t){return i.minLevel(n,"animations",t)};i.animationChannel=function(n,t){var r=n.channels;return i.object(r,t)};i.animationSampler=function(n,t){var r=n.samplers;return i.object(r,t)};i.buffer=function(n,t){return i.minLevel(n,"buffers",t)};i.bufferView=function(n,t){return i.minLevel(n,"bufferViews",t)};i.camera=function(n,t){return i.minLevel(n,"cameras",t)};i.image=function(n,t){return i.minLevel(n,"images",t)};i.compressedImage=function(t,i){var r,u,e,f;if(n.defined(t.extras)){r=t.extras.compressedImage3DTiles;for(u in r)if(r.hasOwnProperty(u)&&(e=r[u],f=i(e,u),n.defined(f)))return f}};i.material=function(n,t){return i.minLevel(n,"materials",t)};i.materialValue=function(t,i){var r=t.values,u,f;n.defined(t.extensions)&&n.defined(t.extensions.KHR_techniques_webgl)&&(r=t.extensions.KHR_techniques_webgl.values);for(u in r)if(r.hasOwnProperty(u)&&(f=i(r[u],u),n.defined(f)))return f};i.mesh=function(n,t){return i.minLevel(n,"meshes",t)};i.meshPrimitive=function(t,i){var u=t.primitives,e,r,o,f;if(n.defined(u))for(e=u.length,r=0;r<e;r++)if(o=u[r],f=i(o,r),n.defined(f))return f};i.meshPrimitiveAttribute=function(t,i){var u=t.attributes,r,f;for(r in u)if(u.hasOwnProperty(r)&&(f=i(u[r],r),n.defined(f)))return f};i.meshPrimitiveTarget=function(t,i){var u=t.targets,e,r,f;if(n.defined(u))for(e=u.length,r=0;r<e;++r)if(f=i(u[r],r),n.defined(f))return f};i.meshPrimitiveTargetAttribute=function(t,i){var r,f,u;for(r in t)if(t.hasOwnProperty(r)&&(f=t[r],u=i(f,r),n.defined(u)))return u};i.node=function(n,t){return i.minLevel(n,"nodes",t)};i.nodeInTree=function(t,r,u){var c=t.nodes,l,e,s,o,f,h;if(n.defined(c))for(l=r.length,e=0;e<l;e++)if(s=r[e],o=c[s],n.defined(o)&&((f=u(o,s),n.defined(f))||(h=o.children,n.defined(h)&&(f=i.nodeInTree(t,h,u),n.defined(f)))))return f};i.nodeInScene=function(t,r,u){var f=r.nodes;if(n.defined(f))return i.nodeInTree(t,f,u)};i.program=function(n,t){return e(n,"KHR_techniques_webgl")?i.object(n.extensions.KHR_techniques_webgl.programs,t):i.minLevel(n,"programs",t)};i.sampler=function(n,t){return i.minLevel(n,"samplers",t)};i.scene=function(n,t){return i.minLevel(n,"scenes",t)};i.shader=function(n,t){return e(n,"KHR_techniques_webgl")?i.object(n.extensions.KHR_techniques_webgl.shaders,t):i.minLevel(n,"shaders",t)};i.skin=function(n,t){return i.minLevel(n,"skins",t)};i.techniqueAttribute=function(t,i){var u=t.attributes,r,f;for(r in u)if(u.hasOwnProperty(r)&&(f=i(u[r],r),n.defined(f)))return f};i.techniqueUniform=function(t,i){var u=t.uniforms,r,f;for(r in u)if(u.hasOwnProperty(r)&&(f=i(u[r],r),n.defined(f)))return f};i.techniqueParameter=function(t,i){var u=t.parameters,r,f;for(r in u)if(u.hasOwnProperty(r)&&(f=i(u[r],r),n.defined(f)))return f};i.technique=function(n,t){return e(n,"KHR_techniques_webgl")?i.object(n.extensions.KHR_techniques_webgl.techniques,t):i.minLevel(n,"techniques",t)};i.texture=function(n,t){return i.minLevel(n,"textures",t)};h=4;t.parseGlb=w;l=new n.Vector3;a=new n.Vector3;var tt=new n.Vector3(1/6378137,1/6378137,1/6356752.3142451793),it=new n.Vector3(1/40680631590769,1/40680631590769,1/(6356752.3142451793*6356752.3142451793)),rt=.1;o=new n.Vector3;t._CartesianToCartographics=ft;t._CartesianToCartographicsToRef=v;var r=new n.Vector3,f=new n.Vector3,et=new n.Vector3(40680631590769,40680631590769,6356752.3142451793*6356752.3142451793);t._CartographicToCartesianToRef=ot})(t=n.ExtCes||(n.ExtCes={}))}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(){}return t.Sp=function(t){var r=4,i=0,p=n.defaultValue(i,0),a,w,u,e,f,o,v,b,k,g,nt,y,d,c;i=p;var h=t.buffer,l=t,s=new DataView(h);if(i+=r,a=s.getUint32(i,!0),a!==1)throw new Error("Only Batched 3D Model version 1 is supported.  Version "+a+" is not.");if(i+=r,w=s.getUint32(i,!0),i+=r,u=s.getUint32(i,!0),i+=r,e=s.getUint32(i,!0),i+=r,f=s.getUint32(i,!0),i+=r,o=s.getUint32(i,!0),i+=r,f>=570425344?(i-=r*2,v=u,f=e,o=0,u=0,e=0):o>=570425344&&(i-=r,v=f,f=u,o=e,u=0,e=0),u===0?b={BATCH_LENGTH:n.defaultValue(v,0)}:(k=n.getStringFromTypedArray(l,i,u),b=JSON.parse(k),i+=u),g=new Uint8Array(h,i,e),i+=e,f>0&&(d=n.getStringFromTypedArray(l,i,f),nt=JSON.parse(d),i+=f,o>0&&(y=new Uint8Array(h,i,o),y=new Uint8Array(y),i+=o)),c=p+w-i,c===0)throw new Error("glTF byte length must be greater than 0.");return i%4==0?new Uint8Array(h,i,c):new Uint8Array(l.subarray(i,i+c))},t.ParseAsync=function(t,i){var r=this;return new Promise(function(u){var f=r.Sp(t),e=n.ExtCes.parseGlb(f);r.Sc(e,f._version).then(function(n){r.Tl(n,i);u(n)})})},t.Sc=function(n,i){var r;return n&&(r=n.buffers.length?n.buffers[0].extras._pipeline.source:n.buffers.binary_glTF.extras._pipeline.source,r)?i===1?t.TY(n,n.buffers.binary_glTF.extras._pipeline.source):t.SR(n,n.buffers[0].extras._pipeline.source):new Promise(function(n){n(null)})},t.Tl=function(n,t){if(t&&t._tilesetInfo){var i=t._tilesetInfo;this.RV(n,i.isAxisZUp);i.isNeedTransformToLocal?this.OQ(n,i.cartographicCenter,t._cartesianCenter):t._cartesianCenter&&this.TH(n,t._cartesianCenter,t.radius)}},t.OQ=function(t,i,r){var s,h,e,u;if(r)for(s=n.Vector3.Zero(),h=t.subs,e=0;e<h.length;e++){var l=h[e],f=l.vertexes,c=n.Vector3.Zero(),o=n.Vector3.Zero();for(u=0;u<f.length;u+=3)c.set(r.x+f[u],r.y+f[u+2],r.z+f[u+1]),n.ExtCes._CartesianToCartographicsToRef(c,s),n.EarthMath3.EarthToLocalToRef(i,s,o),f[u]=o.x,f[u+1]=o.y,f[u+2]=o.z}},t.RV=function(n,t){for(var r,u=n.subs,i=0;i<u.length;i++)r=u[i],this.Ta(r.vertexes,t),this.Ta(r.normals,t)},t.Ta=function(n,t){var r,i;if(n)if(t)for(i=0;i<n.length;i+=3)r=n[i+2],n[i+2]=n[i+1],n[i+1]=r;else for(i=0;i<n.length;i+=3)n[i+2]=-n[i+2]},t.TH=function(t,i,r){var e,u,f,o,s;if(i&&!(t.subs.length<=0)&&(e=!1,f=this.TK(t),f)&&(o=n.Vector3.Distance(f,i),o>r*1.01?e=!0:(s=Math.max(Math.max(Math.abs(f.x),Math.abs(f.y)),Math.abs(f.z)),s<=r&&(u=this.Tr(t),o=n.Vector3.Distance(u,i),o>r*.01&&(e=!0))),e)){u||(u=this.Tr(t));var h=i.x-u.x,c=i.y-u.y,l=i.z-u.z;this.Sd(t,h,c,l)}},t.Sd=function(n,t,i,r){for(var s,f,u,o=n.subs,e=0;e<o.length;e++)for(s=o[e],f=s.vertexes,u=0;u<f.length;u+=3)f[u]+=t,f[u+1]+=i,f[u+2]+=r},t.TK=function(t){for(var r,f=t.subs,u=0;u<f.length;u++){var o=f[u],i=o.vertexes,e=Math.floor(i.length/3);if(!(e<=0))return r=Math.floor(e/2)*3,new n.Vector3(i[r],i[r+1],i[r+2])}return null},t.Tr=function(t){for(var a,r,i,l=t.subs,u=0,f=0,s=f=u=17976931348623157e292,e=0,o=0,h=o=e=-17976931348623157e292,c=0;c<l.length;c++)for(a=l[c],r=a.vertexes,i=0;i<r.length;i+=3){var v=r[i],y=r[i+1],p=r[i+2];s=Math.min(s,v);f=Math.min(f,y);u=Math.min(u,p);h=Math.max(h,v);o=Math.max(o,y);e=Math.max(e,p)}return new n.Vector3((s+h)*.5,(f+o)*.5,(u+e)*.5)},t.TY=function(t,i){return new Promise(function(r){if(i){var u=n.Gltf10._Gltf10Helper.ToMeshTransferData(r,t,i);r(u)}else r(null)})},t.SR=function(i,r){var u=this;return new Promise(function(f){var a,s,v,e,o;if(r){var p=i.meshes,c=[],h=[],l=0;for(e=0;e<p.length;e++)(o=p[e],o.primitives.length<=0)||(a=o.primitives[0],a.extensions&&a.extensions.KHR_draco_mesh_compression?h.push(o):c.push(o),l++);if(s=new n.TileMeshTransferData,s.textureNames=[],s.textureBytes=[],v=i.images,v)for(e=0;e<v.length;e++){var w=i.images[e].bufferView,y=i.bufferViews[w],b=r.slice(y.byteOffset,y.byteOffset+y.byteLength);s.textureNames.push(e.toString());s.textureBytes.push(b)}for(e=0;e<c.length;e++)o=c[e],u.Tj(s,i,r,o);if(h.length<=0)t.Ti(f,s,l);else for(e=0;e<h.length;e++)o=h[e],u.TX(s,i,r,o,function(){t.Ti(f,s,l)})}else f(null)})},t.Ti=function(n,t,i){t.subs.length===i&&n(t)},t.Tj=function(t,i,r,u){var s,h,c,e;if(u.primitives.length<=0)return null;var o=u.primitives[0],f=o.indices,l=this.Sh(i,r,f);f=o.attributes.POSITION;s=new Float32Array(this.SM(i,r,f,12));f=o.attributes.NORMAL;f!==undefined&&(h=new Float32Array(this.SM(i,r,f,12)));f=o.attributes.TEXCOORD_0;f!==undefined&&(c=new Float32Array(this.SM(i,r,f,8)));e=new n.SubTileMeshTransferData;e.indices=l;e.vertexes=s;e.normals=h;e.textureCoords=c;e.textureFileName="0";t.subs.push(e)},t.Sh=function(n,t,i){var r=n.accessors[i],u=this.Oz(r.componentType),f=this.SM(n,t,i,u),e=this.Tt(r.componentType,f);return new Int32Array(e)},t.Oz=function(n){switch(n){case 5120:return 1;case 5121:return 1;case 5122:return 2;case 5123:return 2;case 5125:return 4;case 5126:return 4}},t.Tt=function(n,t){switch(n){case 5120:return new Int8Array(t);case 5121:return new Uint8Array(t);case 5122:return new Int16Array(t);case 5123:return new Uint16Array(t);case 5125:return new Uint32Array(t);case 5126:return new Float32Array(t)}},t.SM=function(n,t,i,r){var u=n.accessors[i],f=n.bufferViews[u.bufferView],o=f.byteOffset?f.byteOffset:0,s,c,h,e;if(f.byteStride===undefined||f.byteStride===r)return s=u.byteOffset?u.byteOffset:0,o+=s,c=o+u.count*r,t.slice(o,c).buffer;var y=f.byteStride,p=t,s=u.byteOffset?u.byteOffset:0,l=o,a=0,v=new Uint8Array(u.count*r);for(h=0;h<u.count;h++){for(e=0;e<r;e++)v[a+e]=p[l+s+e];l+=y;a+=r}return v.buffer},t.QZ=function(){return t.Lq||(t.Lq=BABYLON.DracoCompression.Default),t.Lq},t._InitDracoWorker=function(){t.QZ()},t.TX=function(i,r,u,f,e){var l=f.primitives[0],a,h=l.extensions.KHR_draco_mesh_compression;if(!h)return null;var s=r.bufferViews[h.bufferView],v=r.buffers[s.buffer].extras._pipeline.source,c=0;if(s.byteOffset&&(c=s.byteOffset),v){a=v.slice(c,c+s.byteLength);var p=t.QZ(),w=h,y={},o=function(n,t){var i=w.attributes[n];i!=undefined&&(y[t]=i)};o("POSITION",BABYLON.VertexBuffer.PositionKind);o("NORMAL",BABYLON.VertexBuffer.NormalKind);o("TANGENT",BABYLON.VertexBuffer.TangentKind);o("TEXCOORD_0",BABYLON.VertexBuffer.UVKind);o("TEXCOORD_1",BABYLON.VertexBuffer.UV2Kind);o("JOINTS_0",BABYLON.VertexBuffer.MatricesIndicesKind);o("WEIGHTS_0",BABYLON.VertexBuffer.MatricesWeightsKind);o("COLOR_0",BABYLON.VertexBuffer.ColorKind);p.decodeMeshAsync(a,y).then(function(t){if(t){var r=new n.SubTileMeshTransferData;r.indices=new Int32Array(t.indices);r.vertexes=new Float32Array(t.positions);r.textureCoords=new Float32Array(t.uvs);r.textureFileName=l.material.toString();i.subs.push(r);e&&e()}})}},t}();n._B3dmData=t}(Drawsee||(Drawsee={})),function(n){var t=function(){function n(){}return n}(),i;n._TilesetInfo=t;i=function(){function i(){}return i.ExtractTilesetInfo=function(i){var r=new t,u;return r.isAxisZUp=i.asset.gltfUpAxis==="Z",i.root.transform?(u=i.root.transform,r.cartesianCenter=new n.Vector3(u[12],u[13],u[14]),r.isNeedTransformToLocal=!1):(r.isNeedTransformToLocal=!0,r.cartesianCenter=this.Sn(i.root)),r.cartographicCenter=n.ExtCes._CartesianToCartographics(r.cartesianCenter),r},i.ExtractContentUri=function(n){return n.content?n.content.uri?n.content.uri:n.content.url:""},i.Sn=function(t){if(t&&t.boundingVolume){var i=t.boundingVolume.box?t.boundingVolume.box:t.boundingVolume.sphere;if(i)return new n.Vector3(i[0],i[1],i[2])}return n.Vector3.Zero()},i.ExtractNodeName=function(t){return n.StringHelper.ExtractFileNameWithoutSuffix(this.ExtractContentUri(t))},i.ExtractBoundingInfo=function(t,i){var l,h=this.Sn(t),u,f,e,o=t.boundingVolume.box,c,r,a,s;if(o)u=o[3],f=o[11],e=o[7];else if(c=t.boundingVolume.sphere,c)u=f=e=c[3];else throw new n.Exception("unsupport tileset boundingVolume type");return i.isNeedTransformToLocal?r=n.EarthMath3.EarthToLocal(i.cartographicCenter,n.ExtCes._CartesianToCartographics(h)):(r=h,a=r.z,r.z=r.y,r.y=a),l=new n.Box(new n.Vector3(r.x-u,r.y-f,r.z-e),new n.Vector3(r.x+u,r.y+f,r.z+e)),s=t.geometricError,s===null&&(s=Infinity),{bounds:l,geometricError:s,cartesianCenter:h}},i}();n._TilesetParseHelper=i}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(t,i){this.downLevel=i;this.baseUrl=n.StringHelper.ExtractDirectoryOnly(t);this.fileName=n.StringHelper.ExtractFileNameWithoutSuffix(t)}return t}(),i=function(){function i(i,r,u,f,e){this.index=i;this.baseUrl=r;this.rootFileName=u;this.worldCenter=f;this.onLoadReady=e;this.MG=new n.StringKeyDictionary;this.Rw=new n.StringKeyDictionary;this.UG=0;this.TU=[];this.Ry(new t(r+u,0))}return i.prototype.TZ=function(n){return n.indexOf("_L")>=0&&n.indexOf("Tile_")>=0},i.prototype.Qx=function(n){return n.indexOf("Tile_")>=0},i.prototype.Rc=function(n){return this.MG.getValue(n)},i.prototype.Ry=function(n){var t=n.fileName;this.Rw.containsKey(t)||this.Rw.add(t,n)},i.prototype.load=function(){for(var t=this,r=this.Rw.keys,u=function(i){var e=r[i],u;if(!e||(u=f.Rw.getValue(e),!u))return"continue";u.loadIndexDelegate?u.isBadIndexUrl||u.loadIndexDelegate.tryInvoke():u.loadIndexDelegate=new n.PromiseDelegate(function(){var i=u.baseUrl+u.fileName+".json",r=t.index.layer._isLeafFirst?n.AsyncDataPriority.System:n.AsyncDataPriority.Common;n.AsyncRenderContext.LoadData(n.AsyncDataLoadType.ArrayBuffer,i,"",r).then(function(n){u.loadIndexDelegate.onThen();n&&(n.isBadUrl?u.isBadIndexUrl=!0:(t.Rw.remove(e),t.Td(n.url,n.data,u)))})})},f=this,i=0;i<r.length;i++)u(i)},i.prototype.getRootNodeName=function(){return this.Pc},i.prototype.Td=function(i,r,u){var s,l,a,e,c,h,f;if(r&&r.length>0){r=n.SystemHelper.Uncompress(r);var v=n.EncodingHelper.GetUtf8String(r),y=JSON.parse(v),o=y.root;if(o.children){for(this.UG++,e=this.TC(i,o,this.index.tilesetInfo),!this.Pc&&e.length>0&&(this.Pc=e[0].name,this.UJ=!this.Qx(this.Pc)),f=0;f<e.length;f++)c=e[f],this.MG.add(c.name,c);for(h=[],h=this.UJ?this.Sb(e,u):this.Tu(e),f=0;f<h.length;f++)this.Ry(new t(h[f],u.downLevel+1));if(this.Rw.count===0&&(this.UG>1?this.Su():this.Rf(),this.onLoadReady))this.onLoadReady(this)}else o.content&&(s=n._TilesetParseHelper.ExtractContentUri(o),s&&s.indexOf(".json")>=0&&(l=n.StringHelper.ExtractDirectoryOnly(i),a=n.StringHelper.MergeFullUrl(l,s),this.Ry(new t(a,u.downLevel))));this.load()}},i.prototype.TC=function(t,i,r){var u=[],f=n.StringHelper.ExtractDirectoryOnly(t);return this.Tg(f,i,null,0,u,r),u},i.prototype.Tg=function(t,i,r,u,f,e){var c=n.StringHelper.MergeFullUrl(t,n._TilesetParseHelper.ExtractContentUri(i)),v,l,h,a,y;c=n.StringHelper.ExtractDirectoryOnly(c);var s=n._TilesetParseHelper.ExtractBoundingInfo(i,e),p=s.bounds.center,w=s.bounds.radius,b=n._TilesetParseHelper.ExtractNodeName(i),o=new n.TileMeshIndexNodeInfo(p,w,[],b,n._TilesetParseHelper.ExtractContentUri(i));if(o._geometricError=s.geometricError,o._bounds=s.bounds,o._cartesianCenter=s.cartesianCenter,o._tilesetInfo=e,f.push(o),v=[],l=[],i.children)for(h=0;h<i.children.length;h++)(a=i.children[h],y=n._TilesetParseHelper.ExtractNodeName(a),y)&&(v.push(y),l.push(n._TilesetParseHelper.ExtractContentUri(a)),this.Tg(c,a,o.name,h,f,e));o.subNames=v;o._subUris=l;o._baseUrl=c;o._subUris=l;r&&(o._fatherNodeName=r,o._subIndexInFather=u)},i.prototype.SU=function(n){for(var i,r=[],t=0;t<n.length;t++)i=n[t],i.indexOf(".json")>=0&&r.push(i);return r},i.prototype.Tu=function(t){for(var i,u,r,s,f,e=[],o=0;o<t.length;o++)if(i=t[o],u=i.subNames,u.length===1&&i._geometricError>i.radius)f=n.StringHelper.MergeFullUrl(i._baseUrl,i._subUris[0]),e.push(f);else for(r=0;r<u.length;r++)s=u[r],s.indexOf("Tile_")>=0&&s.indexOf("_L")<0&&(f=n.StringHelper.MergeFullUrl(i._baseUrl,i._subUris[r]),e.push(f));return this.SU(e)},i.prototype.Sb=function(t,i){for(var r,e,u,o,c,s=[],h=!1,f=0;f<t.length;f++)if((r=t[f],!(r.subNames.length<=0))&&!(r._geometricError<r.radius*1.5))for(e=r.subNames,u=0;u<e.length;u++)o=e[u],this.Qx(o)&&(h=!0),this.TZ(o)||(c=n.StringHelper.MergeFullUrl(r._baseUrl,r._subUris[u]),s.push(c));return i.downLevel>=3&&!h?[]:this.SU(s)},i.prototype.enumResult=function(){return this.TU},i.prototype.Su=function(){var n=this.Rc(this.Pc),t,i,u,r;for(n._isLoaded=!0,this.TU=[],this.TU.push(n),t=[],this.SW(this.Pc,t,!0),n.subNames=[],n._subUris=[],i=0;i<t.length;i++)u=t[i],r=this.Rc(u),this.TU.push(r),n.subNames.push(r.name),n._subUris.push(r.uri)},i.prototype.Rf=function(){var n=this.MG.values,t,i;if(n.length===1)n[0]._isLoaded=!0;else for(t=0;t<n.length;t++)i=n[t],i.subNames.length>0&&(i._isLoaded=!0);this.TU=n},i.prototype.SW=function(n,t,i){var r=this.Rc(n),u;if(r.subNames.length>0)for(u=0;u<r.subNames.length;u++)this.SW(r.subNames[u],t,!1);else i||t.push(r.name)},i}();n._B3dmIndexNodeLoader=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i,r,u,f,e){var o=t.call(this,i,r,f)||this;return o.layer=i,o.tilesetInfo=e,o.TW=new n.StringKeyDictionary,o._dataLoadType=n.AsyncDataLoadType.ArrayBuffer,o._isIndexNodeNameSameAsFile=!1,u?(o.Ry(r,u,null),o._isLoadingRootInfo=!0):o._isLoadingRootInfo=!1,o}return __extends(i,t),i.prototype.getDataFileSurffix=function(){return".b3dm"},i.prototype.parseTileDataAsync=function(t,i){return n._B3dmData.ParseAsync(t,i)},i.prototype.getRootNodeInfo=function(){var n=this.getNodeInfo(this.Pc);return n?n:this._predefineRootInfo},i.prototype.loadNodeInfo=function(n,t,i){var r=this.getNodeInfo(t);!r||r.subNames.length>0||r._isLoaded||this.Ry(n,t,i)},i.prototype.Ry=function(t,i,r){var f=this,u;this.TW.containsKey(i)||(u=new n._B3dmIndexNodeLoader(this,t,i,r,function(n){f.JY(n)}),this.TW.add(i,u),u.load())},i.prototype.commitIndexLoadTask=function(){var i,u,f,r,t;if(!(this.TW.count<=0))if(i=this.TW.values,i.length>4){for(u=this._renderContext.camera,f=u.worldCenter,t=0;t<i.length;t++)r=i[t],r._sqaureDis=r.worldCenter?n.Vector3.DistanceSquared(r.worldCenter,f):0;for(i=i.sort(function(t,i){return n.g_compareTo(t._sqaureDis,i._sqaureDis)}),t=0;t<i.length;t++)i[t].load()}else for(t=0;t<i.length;t++)i[t].load()},i.prototype.JY=function(n){var i,t;this.Pc||(this.Pc=n.getRootNodeName());this.TW.remove(n.rootFileName);var r=[],u=this._geoObject._prepareParam().lodParam.localEyePos,e=this._geoObject.renderContext.camera.eyeDistance,f=n.enumResult();for(i=0;i<f.length;i++)t=f[i],this._nodeInfos.add(t.name,t),t._isLoaded&&this.QY(u,e,t)&&r.push(t);this.Ss(u,r);this._isLoadingRootInfo=!1},i.prototype.QY=function(t,i,r){var o=this._camera.coordSystem.localToEarth(this._geoObject.position,r.center),u,f,e;return this._camera.worldCamera.isSphereInFrustum(o,r.radius)?(u=n.TileMeshIndexNode._ExtractLevel(r.name),u>=n.TileMeshIndexNode._MaxTopLevel)?!1:this.layer.maxVisibleLevel&&u>=this.layer.maxVisibleLevel?!1:(f=r&&r.subNames.length===1,e=n.TileMeshIndexNode._TopRatioFromSub(u,f,!r._isLoaded),n.TileMeshIndexNode._IsB3dmNeedSplit(t,i,e,this.layer.lodRatio,r)):!1},i.prototype.Ss=function(t,i){var r,f,e,o,s;if(!(i.length<=0)){var h=this._renderContext.coordSystem,c=this._geoObject.position,l=this._geoObject.renderContext.camera.eyeDistance;for(r=0;r<i.length;r++){var u=i[r],a=u._baseUrl,v=h.localToEarth(c,u.center);for(f=0;f<u.subNames.length;f++)(e=u.subNames[f],o=this.getNodeInfo(e),!o||this.QY(t,l,o))&&(s=n.TileMeshIndexNode._ExtractLevel(e),s<=n.TileMeshIndexNode._MaxTopLevel&&this.loadNodeInfo(a,e,v))}this.commitIndexLoadTask()}},i}(n.TileMeshIndexBase);n._B3dmTileMeshIndex=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(t,i,r,u,f){if(this.layer=t,r){this.Qe=n._TilesetParseHelper.ExtractTilesetInfo(r);var e=this.Tz(f);this.TR(r.root,i,e,u)}}return t.prototype.Tz=function(t){var i=n.Vector3.Zero();if(this.layer.earthViewer.isEarthCoord&&(i=this.Qe.cartographicCenter.clone()),t){var r=this.layer.earthViewer.renderContext.coordSystem,u=r.meterToEarth(t.x),f=r.meterToEarth(t.z);i.x+=u;i.y+=t.y;i.z+=f}return i},t.prototype.TR=function(n,t,i,r){var e,o,u,f;if(n)if(n.children){for(e=n.children.length,o=e>16,u=0;u<e;u++)f=n.children[u],f.content?this.Ow(f,t,i,r):this.TR(f,t,i,r);o&&(this.layer._isLeafFirst=!1)}else this.Ow(n,t,i,r)},t.prototype.Ow=function(t,i,r,u){var l;if(t.content){var f=n._TilesetParseHelper.ExtractBoundingInfo(t,this.Qe),a=n._TilesetParseHelper.ExtractContentUri(t),e=this.Sx(i,a);if(e){var s=e.subBaseUrl,h=n.StringHelper.ExtractFileNameWithoutSuffix(e.dataFileFullUrl),c=new n._B3dmTileMeshIndex(this.layer,s,e.indexFileName,h,this.Qe),o=new n.TileMeshIndexNodeInfo(f.bounds.center,f.bounds.radius,[],h,"");o._geometricError=f.geometricError;o._cartesianCenter=f.cartesianCenter;o._tilesetInfo=this.Qe;c._predefineRootInfo=o;l=new n.TileMeshGeoObject(this.layer,c,r,s,u,f.bounds);this.layer.addObject(l)}}},t.prototype.Sx=function(t,i){var r,u,f;if(i)if(f=n.StringHelper.ExtractDirectoryOnly(n.StringHelper.MergeFullUrl(t,i)),i.toLowerCase().indexOf(".json")>0)u=n.StringHelper.ExtractFileNameWithoutSuffix(i),r=n.StringHelper.MergeFullUrl(t,i);else if(i.toLowerCase().indexOf(".b3dm")>0)u="",r=n.StringHelper.MergeFullUrl(t,i);else return null;return{subBaseUrl:f,dataFileFullUrl:r,indexFileName:u}},t}(),i=function(i){function r(n,t,r,u){var f=i.call(this,n,t)||this;return f.ST=[],f._isLeafFirst=!0,f.SZ=u,f.Tc(r,!0),n.addGroundLayer(f),f}return __extends(r,i),r.prototype.Tc=function(n,t){t===void 0&&(t=!1);this.Tv=t;!n||(this.ST.push(n),this.SQ())},r.prototype.SQ=function(){var r=this,t,i;this.ST.length===0?n.SystemHelper.FireEvent(this.onAfterLoad,this):(t=this.ST[0],this.ST.splice(0,1),t=n.SystemHelper.ToAbsoluteUrl(t),i=n.StringHelper.ExtractDirectoryOnly(t),n.AsyncWebStream.ReadDirectUint8Array(t).then(function(n){r.Sj(i,n)}))},r.prototype.Sj=function(i,r){var f;r=n.SystemHelper.Uncompress(r);var e=n.EncodingHelper.GetUtf8String(r),u=JSON.parse(e),o=u.root;u&&(o.transform?new t(this,i,u,this.Tv,this.SZ):(f=this.Qz(i,u.root),f.length<=0?(new t(this,i,u,this.Tv,this.SZ),this._isLeafFirst=!1):n.ArrayHelper.AddRange(this.ST,f)));this.SQ()},r.prototype.Qz=function(t,i){var f=[],r,e,u,o;if(i.children)for(r=0;r<i.children.length;r++)e=i.children[r],u=n._TilesetParseHelper.ExtractContentUri(e),u&&u.toLowerCase().indexOf("tileset.json")>=0&&(o=n.StringHelper.MergeFullUrl(t,u),f.push(o));return f},r}(n.TileLayerBase);n.B3dmTileLayer=i}(Drawsee||(Drawsee={})),function(n){var i=function(){function t(t,i,r,u){this.indexStart=t;this.indexCount=i;this.material=r;this.bounds=u;this.textureLod=0;this.radius=u.radius;this.boundingSphere=n.VectorHelper.CreateBoundingSphere(u.center,u.radius)}return t.prototype.toChunk=function(t,i,r,u){var f,c,l,s;u||(f=this.PO);f||(c=t.worldBounds.center,l=t.worldBounds.radius,f=new n.SimpleTextureMeshChunk(i,t.positionWorld,c,l,t.worldMatrix,null,!1,!0,this.indexStart,this.indexCount,null,r,t.layer.ambientLightBrightness),this.PO=f);var o=this.material,h=this.textureLod,e=o.diffuseColor.clone();return(o.isUseTexture&&e.a===0&&(h=Math.min(2,h)),s=o.getLodTexture(h),(!s||!s.internalTexture)&&o.isUseTexture&&(e.r>=1&&e.g>=1&&e.b>=1&&e.a>=1||e.a<=0))?null:(f.basePoint=t.positionWorld,f.transformMatrix=t.worldMatrix,f.isTransparent=o.isTransparent,f.texture=s,f.diffuseColor=e,f.highlightColor=r,f)},t}(),t;n.FixedSubMesh=i;t=function(){function t(t,i,r,u,f){this.lod=i;this.triCount=0;this.lod=i;this.triCount=r.triangles.length;r.bounds&&(this.bounds=r.bounds.clone());this.Qy=t.createElement(n.VertexPositionNormalTexture.prepareVertexBufferData(r.vertexes,r.normals,r.textureCoords),r.triangles.data,n.VertexPositionNormalTexture.VertexDeclaration,n.ElementType.Triangles);this.Ru=u;f&&(this.RC=n.TypeArrayHelper.GetTrianglePoints(r.vertexes,r.triangles),this.Rv=new n.MeshTriangleIndex(this.RC),this.Rv)}return t.prototype.dispose=function(){this.Qy&&(this.Qy.dispose(),this.Qy=null);this.Ru=null;this.RC=null},Object.defineProperty(t.prototype,"triBuffer",{get:function(){return this.Qy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subMeshes",{get:function(){return this.Ru},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"meshPoints",{get:function(){return this.RC},enumerable:!1,configurable:!0}),t.prototype.initTextureLod=function(n){for(var i=this.subMeshes,t=0;t<i.length;t++)i[t].textureLod=n},t.prototype.updateTextureLod=function(n,t,i){var u=this.subMeshes,r,f;if(t>0)for(r=0;r<u.length;r++)u[r].textureLod=t;else for(r=0;r<u.length;r++)f=u[r],f.textureLod=this.QV(t,n,f.boundingSphere.center,f.radius,i)},t.prototype.QV=function(t,i,r,u,f){if(t>1)return t;u*=f;var e=n.Vector3.Distance(i,r);return e<u*4?0:e<u*8?1:t+1},t.prototype.loadMaterial=function(n){for(var t,u,r=this.subMeshes,i=0;i<r.length;i++)t=r[i],t&&t.material&&(u=Math.max(t.textureLod,n),t.material.loadTexture(u))},t.prototype.prepareSubMeshChunk=function(n,t,i,r){var u,o,f,e,s;if(r===void 0&&(r=0),u=[],o=this.subMeshes.length,o<=0)return u;for(f=0;f<o;f++)(e=this.subMeshes[f],e.material)&&(r&&e.radius<r||(s=e.toChunk(n,this.Qy,i,t),s&&u.push(s)));return u},t.prototype.enumRenderChunks=function(t,i,r){for(var u,s,o=[],h=this.subMeshes.length,f=0;f<h;f++)if(u=this.subMeshes[f],u){var e=u.material,c=u.textureLod,l=e.getLodTexture(c);e.diffuseColor.clone();s=new n.RenderMeshChunk(t,i,r,e.isTransparent,l,this.triBuffer,u.indexStart,u.indexCount);o.push(s)}return o},t.prototype.intersects=function(n,t){if((t.value=!1,!this.RC||!this.Rv)||!this.Rv.isBoundingBoxIntersects(n))return null;var i=this.Rv.intersectsRay(n);return i?(t.value=!0,i):null},t.prototype.clampLine=function(t,i,r){return(r===void 0&&(r=null),!this.Rv)?null:t.equals(i)?null:(r||(r=new n.Vector3(0,1,0)),this.Rv.clampLine(t,i,r,1e-5))},t.prototype.clampPolgyon=function(n){return this.Rv?this.Rv.clampPolygon(n):null},t}();n.FixedMesh=t}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(n){this.materialName="";this.indexStart=0;this.indexCount=0;n&&(n.diffuseColor&&(this.diffuseColor=n.diffuseColor.clone()),this.materialName=n.materialName,this.indexStart=n.startTriIndex*3,this.indexCount=n.triCount*3,n.bounds&&(this.bounds=n.bounds.clone()))}return t.prototype.getBounds=function(){return this.bounds?this.bounds:(this.bounds=new n.Box,this.bounds)},t.prototype.toSubMeshData=function(t){var i=new n.SubMeshData(t,"",0,0);return this.diffuseColor&&(i.diffuseColor=this.diffuseColor.clone()),i.materialName=this.materialName,i.startTriIndex=this.indexStart/3,i.triCount=this.indexCount/3,this.bounds&&(i.bounds=this.bounds.clone()),i},t}(),i,r;n.SubFixedMeshData=t;i=function(){function i(){this.name=""}return i.prototype.toMeshData=function(){var t=new n.MeshData("");return t.name=this.name,t.vertexes=new n.CloneList(this.vertexes.toElementArray()),this.normals&&(t.normals=new n.CloneList(this.normals.toElementArray())),t.textureCoords=new n.CloneList(this.textureCoords.toElementArray()),t.triangles=new n.CloneList(this.triangles.toElementArray()),t.subs=new n.CloneList(i.ToSubMeshDatas(this.subDatas,t)),t},i.FromMeshData=function(t){var r=new i;return r.name=t.name,r.vertexes=new n.Vector3Array(n.TypeArrayHelper.Vector3ToFloat(t.vertexes.toArray())),t.normals&&(r.normals=new n.Vector3Array(n.TypeArrayHelper.Vector3ToFloat(t.normals.toArray()))),r.textureCoords=new n.Vector2Array(n.TypeArrayHelper.Vector2ToFloat(t.textureCoords.toArray())),r.triangles=new n.Triangle3Array(n.Triangle3.ToIndexArray(t.triangles.toArray())),r.materials=n.ArrayHelper.CloneArray(t.materials),r.subDatas=i.FromSubMesheDatas(t.subs.toArray()),t.bounds&&(r.bounds=t.bounds.clone()),r},i.FromMeshDataArray=function(n){for(var u,r=[],t=0;t<n.length;t++)u=n[t],r.push(i.FromMeshData(u));return r},i.FromSubMesheDatas=function(n){for(var u,r=[],i=0;i<n.length;i++)u=n[i],r.push(new t(u));return r},i.ToSubMeshDatas=function(n,t){for(var u,r=[],i=0;i<n.length;i++)u=n[i],r.push(u.toSubMeshData(t));return r},i.prototype.scaleMesh=function(){return!0},i}();n.FixedMeshData=i;r=function(){function r(){}return r.LoadDsx4Data=function(n,t){return r.QT(n,t,!0)},r.LoadDsx3Data=function(n,t){return r.QT(n,t,!1,!0)},r.QT=function(t,i,u,f){var e,s,h;if((u===void 0&&(u=!0),f===void 0&&(f=!1),i.value=[],!t)||(e=r.LoadOneDsxMesh(t,!1,u,!1),!e))return null;var l=t.readInt32(),c=t.readInt32(),o=Math.floor(c/12);return o>0?(s=t.readFloats(o*3),e.normals=new n.Vector3Array(s)):e=r.RN(e),r.RK(t,e,i,u,!0),h=f?!u:u,h&&r.SB(e.normals.data),e},r.RN=function(n){if(!n||n.normals&&n.normals.length>0)return n;var t=n.toMeshData();return t.calculateNormal(),i.FromMeshData(t)},r.LoadDsx2Data=function(n,t,i){if(i===void 0&&(i=!0),t.value=[],!n)return null;var u=r.LoadOneDsxMesh(n,i,!0,!0);return u?(r.RK(n,u,t,!0,!0),u.normals||(u=r.RN(u)),u):null},r.Rg=function(n){for(var i=n.length,t=0;t<i;t=t+3)n[t+2]=-n[t+2]},r.SB=function(n){for(var i=n.length,t=0;t<i;t=t+3)n[t+2]=-n[t+2]},r.Ri=function(n){for(var i,r=n.length,t=0;t<r;t=t+3)i=n[t+2],n[t+2]=n[t+1],n[t+1]=i},r.LoadOneDsxMesh=function(u,f,e,o){var s,c,v,l,a,h;return(f===void 0&&(f=!0),e===void 0&&(e=!0),o===void 0&&(o=!0),!u)?null:(s=new i,u.readInt32(),c=u.readInt32(),v=n._MeshBinaryReaderHelper.ReadStringBlock(u),c=u.readInt32(),l=n._MeshBinaryReaderHelper.ReadVector3FloatArray(u),e&&r.Rg(l),s.vertexes=new n.Vector3Array(l),c=u.readInt32(),s.triangles=n._MeshBinaryReaderHelper.ReadTriangle3Array(u),c=u.readInt32(),s.textureCoords=n._MeshBinaryReaderHelper.ReadVector2Array(u),a=[],h=new t,h.materialName=v,h.indexStart=0,h.indexCount=s.triangles.length,a.push(h),s.subDatas=a,s)},r.RL=function(t){var i=t.min,r=t.max;return new n.Box(new n.Vector3(i.x,i.y,-r.z),new n.Vector3(r.x,r.y,-i.z))},r.RK=function(i,u,f,e){var c,l,a,h,v,o,s;if((e===void 0&&(e=!0),f.value=[],!i)||!u)return null;for(c=[],l=i.readInt32(),o=0;o<l;o++)s=new t,s.materialName=n._MeshBinaryReaderHelper.ReadStringBlock(i),s.indexStart=i.readInt32()*3,s.indexCount=i.readInt32()*3,c.push(s);for(u.subDatas=c,a=i.readInt32(),o=0;o<a;o++)h=new n.MeshMaterialDefine,h.name=n._MeshBinaryReaderHelper.ReadStringBlock(i),h.textureFile=n._MeshBinaryReaderHelper.ReadStringBlock(i),v=n._MeshBinaryReaderHelper.ReadColor(i),h.diffuseColor=n._MeshBinaryReaderHelper.ReadColor(i),h.emissiveColor=n._MeshBinaryReaderHelper.ReadColor(i),h.specularColor=n._MeshBinaryReaderHelper.ReadColor(i),h.power=i.readSingle(),f.value.push(h);for(i.isEof()||(u.bounds=r.PF(i)),u.bounds||(u.bounds=n.VectorHelper.CalcBoundingBoxIndexed(u.vertexes,u.triangles.data,0,u.triangles.length)),e&&(u.bounds=this.RL(u.bounds)),o=0;o<l;o++)s=u.subDatas[o],s.bounds=n.VectorHelper.CalcBoundingBoxIndexed(u.vertexes,u.triangles.data,s.indexStart,s.indexCount);return u},r.PF=function(t){try{return new n.Box(new n.Vector3(t.readSingle(),t.readSingle(),t.readSingle()),new n.Vector3(t.readSingle(),t.readSingle(),t.readSingle()))}catch(i){return null}},r}();n._FixedMeshDataReader=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i,r,u,f,e,o){var s=t.call(this,u,r)||this;return s.objectType=n.ModelObjectType.None,s.Lv=0,s.RU=new n.Box,s.Pr=!1,s.lod=0,s.RB=i,s.isPickable=o,s.Lv=i.allcUrlNo(f,e,o),s._frustumOnlyClip=!1,s}return __extends(i,t),i.prototype.initPredefineModelBoundingBox=function(i,r,u,f,e,o){this.RU=new n.Box(new n.Vector3(i,r,-u),new n.Vector3(f,e,-o));this.Pr=!0;t.prototype.initFirstForDraw.call(this);t.prototype.updateWorldBoundsFromLocal.call(this)},i.prototype.initLodPackNos=function(n){this.RB.initLodPackNos(this.Lv,n)},Object.defineProperty(i.prototype,"localBounds",{get:function(){return this.Pr?this.RU:new n.Box},enumerable:!1,configurable:!0}),i.prototype.PU=function(i){var u=i.lodParam.globalEyePos,r;return this.SE||(this.SE=new n.AsyncRenderableParam,this.SE.lodParam=n.AsyncRenderableParam_LodParams.CreatePoint(this.lod,n.Vector3.Zero(),i.lodParam.globalEyePos)),r=this.SE.lodParam,r.lod=this.lod,t.prototype.worldToLocalToRef.call(this,u,r.localEyePos),r.objectCenter=this.worldBounds.center,this.SE},i.prototype.SF=function(){var u=this.renderContext.camera.worldEye,f=this.worldBounds.center,i=this.worldBounds.radius,e=n.Vector3.Distance(u,f)-i*.5,t=i*2*this.lodDistanceRatio,r=this.localBounds,o=r.max.y-r.min.y;t=Math.sqrt(t*Math.max(t*.05,o*2));this.lod=this.Rx(e,t)},i.prototype.Rx=function(t,i){var r=this.lodDistanceRatio*this.layer.lodRatio*n.Drawing3DSetting._GetCombinedLodRatio();return this.OM=.05*this._displayInfo.distance/r,i*=r,t<i?0:t<i*3?1:t<i*6?2:3},i.prototype.loadData=function(t){var i,r,u;this.SF();i=this.RB.accessMesh(this.Lv,this.lod);i&&(this.lod<=1?(r=this.worldToLocal(this.renderContext.camera.worldEye),u=this.lodDistanceRatio*this.layer.lodRatio*n.Drawing3DSetting._GetCombinedLodRatio(),i.updateTextureLod(r,this.lod,u)):i.initTextureLod(this.lod));t=this.PU(t);i&&this.lod===i.lod?i.loadMaterial(this.lod):this.RB.loadMesh(this.Lv,this.lod,t.lodParam.globalEyePos,t.lodParam.objectCenter)},Object.defineProperty(i.prototype,"isReadyForDraw",{get:function(){return this.RB.isMeshReadyForDraw(this.Lv)},enumerable:!1,configurable:!0}),i.prototype.getLodMeshes=function(n){var t=this.RB.accessMesh(this.Lv,n),i;return t&&t.triBuffer?(i=[],i.push(t),i):[]},i.prototype.enumChunksForDraw=function(t){var u=[],i,r,f;if(!this.isReadyForDraw||(i=this.getLodMeshes(this.lod),i.length<=0))return u;for(r=0;r<i.length;r++)f=i[r],n.ArrayHelper.AddRange(u,f.prepareSubMeshChunk(this,!1,t,this.OM));return u},i.prototype.intersectRayAdvance=function(i,r,u,f,e){var o;if((e.value=!1,!this.isPickable)||(o=this.RB.accessMesh(this.Lv,this.lod),!o||!o.triBuffer))return!1;var h=t.prototype.worldToLocal.call(this,r),c=t.prototype.worldToLocal.call(this,u),s=o.intersects(n.VectorHelper.CreateRay(h,c),e);return s&&e.value?(t.prototype.localToWorldToRef.call(this,s,f),!0):!1},i.prototype.clampLine=function(i,r){var u,o;if(!this.isPickable||(u=this.RB.accessMesh(this.Lv,this.lod),!u||!u.triBuffer))return null;var s=this.renderContext.camera.coordSystem,f=this.Qd(u,s.worldToEarth(i)),e=this.Qd(u,s.worldToEarth(r));return!f||!e?null:(t.prototype.worldToLocalToRef.call(this,f,f),t.prototype.worldToLocalToRef.call(this,e,e),o=u.clampLine(f,e,null),o)?t.prototype.localToWorldPoints.call(this,n.ArrayHelper.CloneArray(o)):null},i.prototype.Qd=function(i,r){var s=this.renderContext.camera.coordSystem,u=s.earthToWorld(new n.Vector3(r.x,r.y-1e4,r.z)),f=s.earthToWorld(new n.Vector3(r.x,r.y+1e4,r.z)),e,o;return(t.prototype.worldToLocalToRef.call(this,u,u),t.prototype.worldToLocalToRef.call(this,f,f),e=new n.RefValue(!1),o=i.intersects(n.VectorHelper.CreateRay(u,f),e),o&&e.value)?t.prototype.localToWorld.call(this,o):null},i.prototype.clampPolygon=function(i){var r,f,u;return this.isPickable?(r=this.RB.accessMesh(this.Lv,this.lod),!r||!r.triBuffer)?null:(f=t.prototype.worldToLocalPoints.call(this,i),u=r.clampPolgyon(f),u)?t.prototype.localToWorldPoints.call(this,n.ArrayHelper.CloneArray(u)):null:null},i}(n.PointGeoObject);n.FixedModelGeoObject=t}(Drawsee||(Drawsee={})),function(n){var i=function(){function t(t,i,r,u,f,e){r===void 0&&(r=!0);u===void 0&&(u=0);f===void 0&&(f=!1);e===void 0&&(e=n.ModelObjectType.None);this.position=new n.Vector3;this.isAutoMatchGround=!1;this.groundHeight=0;this.objectType=0;this.isPickable=!1;this.baseUrl=t;this.position=i.clone();this.isAutoMatchGround=r;this.groundHeight=u;this.isPickable=f;this.objectType=e}return t}(),t;n.ModelObjectGroupDefine=i;t=function(){function t(){this.useBounds=!1;this.llx=0;this.lly=0;this.llz=0;this.urx=0;this.ury=0;this.urz=0;this.objectType=0;this.isPickable=!1;this.legendUrl="";this.file="";this.packNos=new Int32Array(4);this.llx=this.lly=this.llz=this.urx=this.ury=this.urz=0;this.useBounds=!1;this.objectType=n.ModelObjectType.None}return t}();n.ModelObjectDefine=t;var r=function(){function n(){this.name="";this.file="";this.facecolor="";this.power="";this.specularcolor="";this.emissivecolor="";this.texparam1="";this.texparam2=""}return n}(),u=function(){function n(){}return n}(),f=function(){function n(){this.materials=[];this.objects=[]}return n}(),e=function(){function t(){}return t.ExtractConfig=function(i){var r=new f,e=n._XzFileReader.FromXZData(i),o,u;return e&&(o=n.EncodingHelper.DecodingGb2String(e.modelData),u=JSON.parse(o),r.materials=t.RW(u),r.objects=t.RZ(u)),r},t.RW=function(n){for(var t,f,o,i,e=[],u=0;u<n.materials.length;u++)t=n.materials[u],t&&(f=t.name,o=t.file,!f||(i=new r,i.name=f,i.file=o,i.facecolor=t.facecolor,i.specularcolor=t.specularcolor,i.emissivecolor=t.emissivecolor,i.power=t.power,i.texparam1=t.texparam1,i.texparam2=t.texparam2,e.push(i)));return e},t.RZ=function(n){for(var t,f,i,e=[],r=0;r<n.objects.length;r++)t=n.objects[r],t&&(f=t.file,!f||(i=new u,i.file=f,t.pack&&(i.pack=t.pack),i.bounds=t.bounds,e.push(i)));return e},t}(),o=function(){function i(){}return i.Parse=function(n,t,r,u){r.value=[];u.value=[];var f=e.ExtractConfig(t);u.value=i.RW(n,f);r.value=i.RZ(n,f)},i.RW=function(t,r){for(var u,f,o=[],e=0;e<r.materials.length;e++)u=r.materials[e],u&&!!u.name&&(f=new n.MeshMaterialDefine,f.name=u.name,f.textureFile=u.file,f.diffuseColor=i.PZ(u.facecolor),f.specularColor=i.PZ(u.specularcolor),f.emissiveColor=i.PZ(u.emissivecolor),f.power=n.NumberHelper.ToDouble(u.power),f.blockTextureInfos[1]=i.Qn(u.texparam1),f.blockTextureInfos[2]=i.Qn(u.texparam2),o.push(f));return o},i.Qn=function(t){var u,i,r;return t?(u=[44],i=n.TString.Split(t,u),i&&i.length>=4)?(r=new n.BlockTextureInfo,r.textureFile=i[0],r.xIndex=n.NumberHelper.ToInt(i[1]),r.yIndex=n.NumberHelper.ToInt(i[2]),r.xCount=n.NumberHelper.ToInt(i[3]),r.yCount=n.NumberHelper.ToInt(i[4]),r):null:null},i.PZ=function(t){var u=n.Color.White,r,i;return t?(r=[44],i=n.StringHelper.ParseFloat(t,r,4),new n.Color(i[0],i[1],i[2],i[3])):u},i.RZ=function(i,r){for(var f,c,u,s=[],h=[44],o=0;o<r.objects.length;o++)if(f=r.objects[o],f&&!!f.file){if(c=i+"/model/"+f.file,u=new t,u.legendUrl=c,u.file=f.file,f.bounds!==""){var e=n.StringHelper.ParseDouble(f.bounds,h,6),l=e[0],a=e[1],v=e[2],y=e[3],p=e[4],w=e[5];u.llx=l;u.lly=a;u.llz=w;u.urx=y;u.ury=p;u.urz=v;u.useBounds=!0}!f.pack||(u.packNos=n.StringHelper.ParseInt(f.pack,h,4));s.push(u)}return s},i}(),s=function(){function t(n){this.EJ=n}return t.prototype.Pj=function(n){return n+"config.json.xz"},t.prototype.addLoadingTask=function(t){var r=this,i;return t?(i=this.Pj(t.baseUrl),n.AsyncRenderContext.LoadData(n.AsyncDataLoadType.ArrayBuffer,i,"",n.AsyncDataPriority.System).then(function(n){n&&r.NC(i,t,n.data)}),!0):!1},t.prototype.NC=function(t,i,r){var u,f,e,s;if(i&&r&&r.length>0){for(u=new n.RefValue([]),f=new n.RefValue([]),o.Parse(i.baseUrl,r,u,f),e=0;e<u.value.length;e++)s=u.value[e],s.objectType=i.objectType,s.isPickable=i.isPickable;this.EJ._addOneGroup(i.baseUrl,u.value,f.value,i.position,i.isAutoMatchGround,i.groundHeight);n.ArrayHelper.Clear(u.value);n.ArrayHelper.Clear(f.value)}},t}();n.FixedModelGroupLoader=s}(Drawsee||(Drawsee={})),function(n){var i=function(){function n(n){this.diffuseColor=n;this.isTransparent=!1;this.isUseTexture=!1;this.isTransparent=!1;this.isUseTexture=!1}return n.prototype.getLodTexture=function(){return null},n.prototype.loadTexture=function(){},n}(),t;n.FixedModelColorMaterial=i;t=function(){function t(t,i,r){var f,o,u,e;if(this.isTransparent=!1,this.isUseTexture=!1,this.Lv=0,this.RB=t,this.Qh=i.name,f=n.TString.Trim(n.TString.Replace(i.textureFile,".xz","")),this.Jx=r,this.RX=f,o=n.StringHelper.ExtractFileNameWithoutSuffix(f),this.RX&&o)for(this.isUseTexture=!0,this.BH=r+i.textureFile,this.Lv=t.allocUrlNo(this.BH),u=0;u<i.blockTextureInfos.length;u++)e=i.blockTextureInfos[u],e&&this.RB.getBlockTextureManager(u).setTextureBlockInfo(this.Lv,this.Jx,e);else this.isUseTexture=!1,this.Lv=-1;this.Rj(i)}return t.prototype.Rj=function(n){this.diffuseColor=this.Nq(n.diffuseColor);var t=!1;n.isTransparent()&&this.diffuseColor.a<.9&&(t=!0);this.isTransparent=t},t.prototype.getLodTexture=function(n){return this.Lv<0?null:this.RB.accessTexture(this.Lv,n)},t.prototype.loadTexture=function(n){this.Lv>=0&&this.RB.loadTexture(n,this.Lv,this.Jx,this.RX)},t.prototype.Nq=function(t){var i=t,r=Math.floor(i.r*255),u=Math.floor(i.g*255),f=Math.floor(i.b*255),e=Math.floor(i.a*255),o=248;return r<255&&(r=r&o),u<255&&(u=u&o),f<255&&(f=f&o),e<255&&(e=e&o),n.Color.FromIntRgba(r,u,f,e)},t}();n.FixedModelMaterial=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(t,i){this.graphics=t;this.lod=i;this.Mm=new n.IntKeyDictionary;this.Rh=new n.StringKeyDictionary;this.Qb=new n.StringKeyDictionary;this.SD=new n.StringHashSet}return t.prototype.setTextureBlockInfo=function(n,t,i){if(i){this.Mm.add(n,i);var r=i.textureFile;this.SD.add(r);this.Qb.add(r,t+this.lod.toString()+"/"+i.textureFile)}},t.prototype.isBlockTexture=function(n){return this.Mm.containsKey(n)},t.prototype.SO=function(t){var i=this.Rh.getValue(t),r;return i||this.Qb.containsKey(t)&&(r=this.Qb.getValue(t),i=n.WriteableBitmap.CreateFromUrl(r,null),this.Rh.add(t,i)),i},t.prototype.createSubBlockTexture=function(t){var i,r,u;return this.Mm.containsKey(t)?(i=this.Mm.getValue(t),!i)?null:(r=this.SO(i.textureFile),!r||!r.isReady())?null:(u=n.SystemHelper.ToInt(r.pixelWidth/i.xCount),this.graphics.createTextureFromBitmapRect(r,new n.Rect(i.xIndex*u,i.yIndex*u,u,u),!1)):null},t}(),i,r;n.BlockTextureManager=t;i=function(){function t(t,i,r){var u,f,e;for(this.SH=new n.StringKeyDictionary,u=0;u<r.length;u++)f=r[u],e=f.name,!e||this.SH.containsKey(e)||this.SH.add(f.name,new n.FixedModelMaterial(t,f,i))}return t.prototype.getMaterial=function(n){return this.SH.getValue(n)},t}();r=function(r){function u(n){var i=r.call(this)||this;return i.QM=[],i.graphics=n,i.Rl=new Array(3),i.Rl[0]=i.RG(0,1,1),i.Rl[1]=i.RG(1,2,4),i.Rl[2]=i.RG(2,4,8),i.Os=new Array(3),i.Os[0]=new t(i.graphics,0),i.Os[1]=new t(i.graphics,1),i.Os[2]=new t(i.graphics,2),i}return __extends(u,r),Object.defineProperty(u,"BaseCap",{get:function(){return n.SystemHelper.ToInt(800*n.Drawing3DSetting._GetLodCacheRatio())},enumerable:!1,configurable:!0}),u.prototype.RG=function(t,i,r){var f=new n.ObjectCache(null,1);return f.capacity=u.BaseCap*i,f.enableTimeOutClear(1e4*r),f},u.prototype.allocUrlNo=function(n){return this.urlMapping.string2No(n,!0)},u.prototype.createColorMaterial=function(t){return t?new n.FixedModelColorMaterial(t.clone()):null},u.prototype.addMaterialSet=function(n,t){return this.QM.push(new i(this,n,t)),this.QM.length-1},u.prototype.getMaterial=function(n,t){var i=this.QM[n];return i.getMaterial(t)},u.prototype.getBlockTextureManager=function(n){return this.Os[n]},u.prototype.accessTexture=function(t,i){var r,u;if(i=Math.max(i,n.Drawing3DSetting.MaxTextureDetailLod),i<0||i>=3)return null;for(r=i;r<3;r++)if(u=this.Rl[r].accessObject(t,!1),u&&u.internalTexture)return u;return null},u.prototype.recycle=function(){for(var n=0;n<3;n++)this.Rl[n].collectGabage();return!0},u.prototype.loadTexture=function(t,i,r,u){if(t>=0&&t<3&&(t=Math.max(t,n.Drawing3DSetting.MaxTextureDetailLod),t<=2)){var f=this.accessTexture(i,t);f&&t===f.lod||this.RY(t,i,r,u)}},u.prototype.RY=function(n,t,i,r){var f=this.Rl[n],o,e,s,u;f.contains(t)||this.isBadUrlNo(t)||(o=this.urlMapping.no2String(t),!o||(e=this.Os[n],e.isBlockTexture(t)?(u=e.createSubBlockTexture(t),u&&(u.lod=n,f.addObject(t,u))):(s=i+n.toString()+"/"+r,u=this.graphics.createTextureFromUrl(s,!1),u.lod=n,f.addObject(t,u))))},u.BaseTimeout=1e4,u.Rq=3,u.Nd=800,u}(n.DataSurfaceBase);n.FixedModelMaterialSurface=r}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(t,i,r,u){this.SC=0;this.Ok=new n.Dictionary;this.Ny=new n.Dictionary;this.Pw=new n.Dictionary;this.RB=t;this.SC=i;this.Rz(r,u)}return t.prototype.Rz=function(t,r){this.cache=new n.ObjectCache(null,1);this.cache.capacity=i.BaseCap*t;this.cache.enableTimeOutClear(1e4*r)},t.prototype.initPackNoMapping=function(t,i){this.Ok.add(t,i);var u=this.RB.urlMapping.no2String(t),r=n.StringHelper.ExtractFileNameWithoutSuffix(u)+"_lod_"+n.NumberHelper.ToString(this.SC);this.Pw.add(r,t);this.Ny.add(t,r)},t.prototype.KG=function(t){if(!this.Ok.containsKey(t))return"";var i=this.Ok.getValue(t);return i>0?"meshpack"+n.NumberHelper.ToString(i)+".xz":""},t.prototype.PA=function(t,i){return t+n.NumberHelper.ToString(this.SC)+"/"+i},t.prototype.QN=function(t){return n.TString.Replace(t,"/"+n.NumberHelper.ToString(this.SC)+"/","/")},t.prototype.loadMesh=function(t){var u=this,r,i;if(!this.cache.contains(t)&&!this.RB.isBadUrlNo(t)&&(r=this.RB.urlMapping.no2String(t),!!r)){var o=n.StringHelper.ExtractDirectoryOnly(r),f=this.KG(t),e=void 0;e=f?f:n.StringHelper.ExtractFileName(r);i=this.PA(o,e);n.AsyncRenderContext.IsLoading(i)||n.AsyncRenderContext.LoadData(n.AsyncDataLoadType.ArrayBuffer,i).then(function(n){if(n)if(n.isBadUrl)u.RB.onBadTasks(i);else n.data&&u.Qp(i,i,n.data)})}},t.prototype.RM=function(n,t){var r=i.CreateOneMesh(this.RB.materialSurface,this.RB.graphics,this.SC,t,this.RB.getMaterialSetNo(n),this.RB.getIsPickable(n));this.cache.addObject(n,r)},t.prototype.Qp=function(t,i,r){var f,h,s,o,u,e;if(r&&r.length>0)if(f=n._XzFileReader.FromXZData(r),f.imageNames.length<=0)h=new n.RefValue([]),u=n._XzMeshHelper.ExtractOneMeshData(f.meshName,f.modelData,1,h),i=this.QN(i),e=this.RB.urlMapping.string2No(i,!1),this.RM(e,u);else for(s=n._XzMeshHelper.ExtractMeshArrayFromXzData(f,1),o=0;o<s.length;o++)u=s[o],this.Pw.containsKey(u.name)&&(e=this.Pw.getValue(u.name),this.cache.contains(e)||this.RM(e,u))},t.prototype.collectGabage=function(){this.cache.collectGabage()},t}(),i=function(i){function r(r,u){var f=i.call(this)||this;return f.Qa=new n.IntKeyDictionary,f.RR=new n.IntKeyDictionary,f.graphics=r,f.materialSurface=u,f.NN=new Array(4),f.NN[0]=new t(f,0,2,2),f.NN[1]=new t(f,1,4,4),f.NN[2]=new t(f,2,8,8),f.NN[3]=new t(f,3,8,16),f}return __extends(r,i),Object.defineProperty(r,"BaseCap",{get:function(){return n.SystemHelper.ToInt(128*n.Drawing3DSetting._GetLodCacheRatio())},enumerable:!1,configurable:!0}),r.prototype.initLodPackNos=function(n,t){for(var i=0;i<4;i++)t[i]>0&&this.NN[i].initPackNoMapping(n,t[i])},r.prototype.allcUrlNo=function(n,t,i){var r=this.urlMapping.string2No(n,!0);return this.Qa.add(r,t),this.RR.add(r,i),r},r.prototype.getMaterialSetNo=function(n){return this.Qa.containsKey(n)?this.Qa.getValue(n):0},r.prototype.getIsPickable=function(n){return this.RR.containsKey(n)&&this.RR.getValue(n)},r.prototype.isMeshReadyForDraw=function(n){for(var t=3;t>=0;t=t-1)if(this.NN[t].cache.contains(n))return!0;return!1},r.prototype.accessMesh=function(n,t){var i,r;for(t!==3&&this.NN[3].cache.accessObject(n),i=t;i<4;i++)if(r=this.NN[i].cache.accessObject(n),r)return r;return null},r.prototype.loadMesh=function(n,t,i,r){var u=this.accessMesh(n,t);u&&t===u.lod||(t===3||this.NN[3].cache.contains(n)?this.NN[t].loadMesh(n,i,r):this.NN[3].loadMesh(n,i,r))},r.prototype.recycle=function(){for(var n=0;n<4;n++)this.NN[n].collectGabage();return!0},r.CreateOneMesh=function(t,i,u,f,e,o){var l,a,h,y;if(f.vertexes.length<=0)return null;for(l=[],a=f.subDatas,h=0;h<a.length;h++){var s=a[h],p=s.getBounds(),v=s.materialName,c=void 0;c=!v&&s.diffuseColor?new n.FixedModelColorMaterial(s.diffuseColor.clone()):t.getMaterial(e,v);c||(c=new n.FixedModelColorMaterial(r.Rr));y=new n.FixedSubMesh(s.indexStart,s.indexCount,c,p);l.push(y)}return new n.FixedMesh(i,u,f,l,o)},r.Rr=new n.Color(1,1,1,.5),r.Od=1,r.Rq=4,r.Nd=128,r.Rt=1e4,r}(n.DataSurfaceBase);n.FixedModelSurface=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i,r){var u=t.call(this,i,r)||this,f;return u.ambientLightBrightness=n.Drawing3DSetting.AmbientLightBrightness,u.Qs=new n.FixedModelGroupLoader(u),f=u.renderContext,u.SI=new n.FixedModelMaterialSurface(f.graphics),u.Rd=new n.FixedModelSurface(f.graphics,u.SI),u.Ha=u.renderContext.graphics,u.Rp=u.Ha.fixedMeshChunkRender.createList(),u}return __extends(i,t),i.prototype._addOneGroup=function(n,t,i,r,u,f){var e=n+"texz/",o=this.SI.addMaterialSet(e,i);this.Nf(t,o,r,u,f)},i.prototype.Nf=function(i,r,u,f,e){var l=i.length,h,o,a,s,c;if(l>0)for(h=0;h<l;h++)o=i[h],o&&(a=n.ModelObjectType.Terrain===o.objectType,s=new n.FixedModelGeoObject(this.Rd,u,this.renderContext,o.legendUrl,r,o.isPickable),s.layer=this,c=n.StringHelper.ExtractFileNameWithoutSuffix(o.file),s.name=c,s.tag=c,s.isClampToGround=f,s.groundHeight=e,s.objectType=o.objectType,a&&(s.lodDistanceRatio=Math.max(3,s.lodDistanceRatio)),o.useBounds&&s.initPredefineModelBoundingBox(o.llx,o.lly,o.llz,o.urx,o.ury,o.urz),s.initLodPackNos(o.packNos),t.prototype.addObject.call(this,s))},i.prototype.addModelGroup=function(t,r,u,f,e,o){u===void 0&&(u=!0);f===void 0&&(f=0);e===void 0&&(e=!1);o===void 0&&(o=n.ModelObjectType.None);t=i._VerifyXzBaseUrl(t);t=n.SystemHelper.ToAbsoluteUrl(t);this.Qs.addLoadingTask(new n.ModelObjectGroupDefine(t,r,u,f,e,o))},i._VerifyXzBaseUrl=function(n){var t="/xz/";return n.indexOf(t)<0?n+t:n},i.prototype.registerDataTask=function(i){var u,r,f;if(n.SystemTime._IsTimer100)if(i.lodParam.globalEyePos=n._TileMeshLodHelper.CalcTileLodWorldCenter(this.renderContext),this.updateIndex(),this.isVisible)for(u=t.prototype.enumObjectsInIndex.call(this,this.maxVisibleObjectCount,!0),r=0;r<u.length;r++)f=u[r],f.loadData(i);else this.Qt()},i.prototype.recycle=function(n){return this.Rd.recycle(n),this.SI.recycle(n),!0},i.prototype.updateContents=function(i){t.prototype.updateContents.call(this,i);var r=new n.RefValue(!1),u=t.prototype.enumObjectsForDrawing.call(this,this.renderContext,this.maxVisibleObjectCount,r);return this.QD(this.renderContext,i,u),!0},i.prototype.drawContents=function(i){var r,u,f;return this.isVisible?(t.prototype.drawContents.call(this,i),t.prototype.setupDrawingStatus.call(this,this.renderContext),r=new n.RefValue(!1),u=t.prototype.enumObjectsForDrawing.call(this,this.renderContext,this.maxVisibleObjectCount,r),u.length<=0&&this.Qt(),f=this.renderContext.camera.worldCamera,this.renderContext.camera._transformLocalWorld(),this.renderContext.graphics.fixedMeshChunkRender.renderOneList(f,this.Rp),!0):!1},i.prototype.Qt=function(){this.Rp.clear()},i.prototype.QD=function(t,i,r){var u,f;r.length<=0||(this.Rp.clear(),u=this.Rp.setting,u.lightDirection=t.lightDirection,u.customChunkMaterial=this.customChunkMaterial,n._RenderStateHelper.Copy(this,u),f=this.QU(r,this.highlightMaterial.color),this.Rp.addChunks(f))},i.prototype.QU=function(t,i){for(var u,f=[],s=t.length,h=this.renderContext._isHighlightPickedObject,r=0;r<s;r++){var e=t[r],c=e.isPicked,o=null;c&&h&&(o=i);u=e.enumChunksForDraw(o);u.length>0&&n.ArrayHelper.AddRange(f,u)}return f},i.prototype.drawVolumeBlendContents=function(){return!0},i.prototype.enumRenderMeshChunks=function(){for(var f=new n.RefValue(!1),r=t.prototype.enumObjectsForDrawing.call(this,this.renderContext,this.maxVisibleObjectCount,f),u=[],i=0;i<r.length;i++)n.ArrayHelper.AddRange(u,r[i].enumRenderMeshChunks());return u},i.prototype.pickByRay=function(i,r,u){for(var f,e,o,s,h,c=17976931348623157e292,l=!1,a=0;a<this.count;a++)f=n.SystemHelper.CastObject(t.prototype.getAt.call(this,a)),f&&f.checkObjectVisible()&&(e=new n.Vector3,o=new n.RefValue(!1),f.intersectRayAdvance(this.renderContext,i,r,e,o)&&(s=n.Vector3.Distance(i,e),o.value&&!l?(l=!0,h=f,c=s,u.copyFrom(e)):o.value===l&&s<c&&(h=f,c=s,u.copyFrom(e))));return h},i.prototype.clampLine=function(i,r){for(var f,e,u=0;u<this.count;u++)if(f=n.SystemHelper.CastObject(t.prototype.getAt.call(this,u)),f&&f.checkObjectVisible()&&(e=f.clampLine(i,r),e))return e;return null},i.prototype.clampPolygon=function(i){for(var r,u,e=[],f=0;f<this.count;f++)r=n.SystemHelper.CastObject(t.prototype.getAt.call(this,f)),r&&r.checkObjectVisible()&&(u=r.clampPolygon(i),u&&u.length>0&&n.ArrayHelper.AddRange(e,u));return e},i}(n.GeoObject3Layer);n.ModelLayer=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var r=function(){function t(){}return t.prototype.compare=function(t,i){return n.g_compareTo(t._distanceToEye,i._distanceToEye)},t}(),t=function(){function t(t,i,r){r===void 0&&(r=new n.Vector2);this.horizontalAlignment=n.HorizontalAlignment.Center;this.verticalAlignment=n.VerticalAlignment.Top;this.pixelOffset=new n.Vector2;this.isSizable=!1;this.baseSizeDistance=200;this._distanceToEye=17976931348623157e292;this.PD=0;this.PN=0;this.QH=0;this.Pi=0;this.OC=!0;this.On=!0;this.Pz=!0;this.geoObject=t;this.div=i;this.OD=new n.FrameworkElement(i);this.OD.isHitTestVisible=!1;this._setCullingVisible(!1);this.pixelOffset=r.clone();this.QH=this.OD.width;this.Pi=this.OD.height}return Object.defineProperty(t.prototype,"isVisible",{get:function(){return this.OC&&this.On},set:function(n){this.OC=n;this.NZ()},enumerable:!1,configurable:!0}),t.prototype.NZ=function(){this.OD.visibility=n.WindowsHelper.BoolToVisibility(this.OC&&this.On)},t.prototype._setCullingVisible=function(n){this.On=n;this.NZ()},Object.defineProperty(t.prototype,"isTransparent",{get:function(){return this.OD.opacity<.99},set:function(n){this.OD.opacity=n?.1:1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uIBounds",{get:function(){return this.OD.bounds},enumerable:!1,configurable:!0}),t.prototype._updateUILocation=function(t){var i=n.SystemHelper.ToInt(t.x+this.pixelOffset.x),r=n.SystemHelper.ToInt(t.y+this.pixelOffset.y);(i!==this.PD||r!==this.PN)&&(this.OD.setLeftTop(i,r),this.PD=i,this.PN=r)},t.prototype._updateSize=function(){var n,t;if(this.isSizable&&this.QH>0&&this.Pi>0){if(this.Pz){this.Pz=!1;return}n=this.baseSizeDistance;this._distanceToEye<n?(t=n/this._distanceToEye,this.OD.width=this.QH*t,this.OD.height=this.Pi*t):(this.OD.width=this.QH,this.OD.height=this.Pi)}},t.prototype._checkObjectVisibleByDistance=function(){return this.geoObject.isReadyForDraw?this.maxVisibleDistance?(!this.minVisibleDistance||this.minVisibleDistance&&this._distanceToEye>=this.minVisibleDistance)&&(!this.maxVisibleDistance||this.maxVisibleDistance&&this._distanceToEye<=this.maxVisibleDistance):!0:!1},t}(),i;n.DivObject=t;i=function(i){function u(n,t){var r=i.call(this,n,t)||this;return r.NG=[],r.Pm=0,r.PC=r.renderContext.camera,r}return __extends(u,i),Object.defineProperty(u.prototype,"count",{get:function(){return this.NG.length},enumerable:!1,configurable:!0}),u.prototype.addObject=function(i,r,u){var e,f;return u===void 0&&(u=n.Vector2.Zero()),e=i instanceof n.Vector3?this.QL(i):i,f=new t(e,r,u),this.NG.push(f),f},u.prototype.getAt=function(n){return n>=0&&n<this.NG.length?this.NG[n]:null},u.prototype.clear=function(){this.NG=[]},u.prototype.drawContents=function(){var i,t,r;if(this.Pm===0&&(this.Pm=n.SystemTime._FrameNow()),n.SystemTime._FrameNow()-this.Pm>200)for(i=0;i<this.NG.length;i++)t=this.NG[i],t.isTransparent=!1,t.geoObject&&t.geoObject.checkObjectVisible()?t._setCullingVisible(!0):t._setCullingVisible(!1);return r=this.QI(),this.Ox(r),this.Pk(r),!0},u.prototype.onSetVisible=function(){for(var t=this.isVisible,n=0;n<this.NG.length;n++)this.NG[n].isVisible=t},u.prototype.QL=function(t){var i=this.NQ,r;return i||(this.NQ=new n.ShapeLayer(this.earthViewer,this.name+"_attachObjectLayer"),i=this.NQ,i.isObjectAlwaysVisible=!0),r=i.addBox(t,new n.Size3(1)),r.material.color=n.Color.Transparent,r},u.prototype.Ol=function(){for(var t,u,f=this.PC.worldEye,r=[],i=0;i<this.NG.length;i++)t=this.NG[i],t.isVisible&&(u=n.Vector3.Distance(f,t.geoObject.worldBounds.center),t._distanceToEye=u,r.push(t));return r.sort(function(t,i){return n.g_compareTo(t._distanceToEye,i._distanceToEye)})},u.prototype.QI=function(){for(var n,i=[],r=this.Ol(),t=0;t<r.length;t++)n=r[t],n._checkObjectVisibleByDistance()?(i.push(n),n._updateSize()):n._setCullingVisible(!1);return i},u.prototype.Pk=function(t){var o,i,u,f,e;if(t.length>0)for(o=this.PC.worldEye,i=n.ArrayHelper.CloneArray(t),n.ArrayHelper.Sort(i,new r),u=[],u.push(i[0].uIBounds),f=1;f<i.length;f++)e=i[f],this.Qf(u,e)?e.isTransparent=!0:u.push(e.uIBounds)},u.prototype.Qf=function(t,i){var r=i.uIBounds,u,f;for(r.width>0&&r.height>0&&r.inflateInPlace(-2,-2),u=0;u<t.length;u++)if(f=t[u],n.Math2.RectIntersects(f,r))return!0;return!1},u.prototype.Ox=function(n){for(var i,r=this.PC.coordSystem,t=0;t<n.length;t++)i=n[t],this.Of(r,i)},u.prototype.Of=function(n,t){var i=this.Qi(n,t);t._updateUILocation(i)},u.prototype.Qi=function(t,i){var u=i.geoObject.localToEarth(i.geoObject.localBounds.center),f=i.geoObject.localBounds.size.y*1.5,e=i.uIBounds.width,o=i.uIBounds.height,s,r;switch(i.verticalAlignment){case n.VerticalAlignment.Top:u.y=u.y+f*.5;break;case n.VerticalAlignment.Bottom:u.y=u.y-f*.5}s=t.earthToWorld(u);r=t.worldToScreen(s);switch(i.verticalAlignment){case n.VerticalAlignment.Top:r.y=r.y-o;break;case n.VerticalAlignment.Center:r.y=r.y-o*.5}switch(i.horizontalAlignment){case n.HorizontalAlignment.Center:r.x=r.x-e*.5;break;case n.HorizontalAlignment.Left:r.x=r.x-e}return r.clone()},u}(n.Layer3);n.DivLayer=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){function f(){return navigator.userAgent.indexOf("Firefox")!=-1}function e(){return navigator.userAgent.indexOf("Chrome")>-1}var i=function(){function t(){}return t.Uncompress=function(t){if(!t)return"";var i=new Uint8Array(t),r=n.SystemHelper.IsCompressedData(i);return r?n.SystemHelper.Uncompress(i):t},t.IsCompressedData=function(t){return n.SystemHelper.IsCompressedData(new Uint8Array(t))},t.LoadBabylonGzFile=function(n,i,u,o){var s=function(t){var i=BABYLON.SceneLoader.GetPluginForExtension(".babylon");i&&i.load(u,t,n,null)&&(u.loadingPluginName=i.name,o())};e()||f()?r.LoadGzFile(n+i,s,null):t.Na(n,i,u,o)},t.Na=function(n,t,i,r){var u=t.lastIndexOf(".gz");u>0&&(t=t.substring(0,u));BABYLON.SceneLoader.Append(n,t,i,function(){r()})},t}(),r,t,u;n.BabylonFileHelper=i;r=function(){function t(){}return t.LoadGzFile=function(t,r){var f,s;if(r&&t&&(f=t.lastIndexOf("."),s=t.substring(f,t.length).toLowerCase(),s==".gz")){var y=t.substring(0,f),u=0,h=0,c=0,l=[],p=function(t,f){var o,s,e,a,v,y;h++;c+=t.byteLength;var p=f.lastIndexOf("_"),w=f.lastIndexOf("."),b=n.NumberHelper.ToInt(f.substring(p+1,w));if(l[b]=t,h===u){for(o=new Int8Array(c),s=0,e=0;e<u;e++)a=l[e],o.set(new Int8Array(a),s),s+=a.byteLength;v=i.Uncompress(o.buffer);y=n.EncodingHelper.GetUtf8String(v,v.length);r(y)}},w=function(t){var f,o,e,s;t&&t.byteLength<16?(f=new Uint8Array(t),o=n.EncodingHelper.GetUtf8String(f,f.length),u=n.NumberHelper.ToInt(o),v(u)):t&&(e=i.Uncompress(t),s=n.EncodingHelper.GetUtf8String(e,e.length),r(s))},e=0,o=0,a=2,v=function(t){if(!(e>=t)){o++;var i=y+"_"+e.toString()+".gz";n.AsyncRenderContext.LoadData(n.AsyncDataLoadType.ArrayBuffer,n.SystemHelper.ToAbsoluteUrl(i),"",n.AsyncDataPriority.System).then(function(n){o--;n&&!n.isBadUrl&&n.data&&p(n.data,n.url);for(var i=0;i<a;i++){if(o>=a)break;v(t)}});e++}};n.AsyncRenderContext.LoadData(n.AsyncDataLoadType.ArrayBuffer,n.SystemHelper.ToAbsoluteUrl(t),"",n.AsyncDataPriority.System).then(function(n){n&&!n.isBadUrl&&n.data&&w(n.data)})}},t}();t=function(n){function t(t,i){var r=n.call(this)||this;return r.EJ=t,r.Oh=i,r.Oh.getBoundingInfo(),r}return __extends(t,n),Object.defineProperty(t.prototype,"layerName",{get:function(){return this.EJ.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.Oh.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this.Oh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.EJ.localToEarth(this.Oh.position)},set:function(n){var t=this.EJ.earthToLocal(n);this.Oh.position.x=t.x;this.Oh.position.y=t.y;this.Oh.position.z=t.z},enumerable:!1,configurable:!0}),t}(n.PickableObject);n.BabylonGeoObject=t;u=function(i){function r(t,r,u){u===void 0&&(u=!0);var f=i.call(this,t,r)||this;return f.Pf=n.Vector3.Zero(),f.Ot=!1,f.Og=n.Matrix.Identity(),f._stencilWriteId=-1,f._stencilClipId=-1,f.name=r,f.MP=u,f.LK=f.renderContext.graphics.engine,f.Ie=t.camera.coordSystem,f.QQ(),f}return __extends(r,i),Object.defineProperty(r.prototype,"scene",{get:function(){return this.Mu},enumerable:!1,configurable:!0}),r.prototype.QQ=function(){if(this.Mu=new BABYLON.Scene(this.LK),this.Mu._isCreateFromDrawsee=!0,this.Mu.activeCamera=new BABYLON.ArcRotateCamera("default camera",Math.PI/2,Math.PI/2,1,new BABYLON.Vector3(0,0,0),this.Mu),this.Mu.activeDeviceCamera=this.renderContext.camera.worldCamera,this.MP)var n=new BABYLON.HemisphericLight("lightDefault",new BABYLON.Vector3(.5,1,-.5),this.Mu)},r.prototype.clear=function(){this.clearPickedObjects();this.Mu&&(this.Mu.dispose(),this.Mu=null);this.QQ()},Object.defineProperty(r.prototype,"position",{get:function(){return this.Pf.clone()},set:function(n){n&&(this.Pf=n.clone());this.Ot=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"transform",{get:function(){return this.Pp},set:function(n){n&&(this.Pp=n.clone())},enumerable:!1,configurable:!0}),r.prototype.QJ=function(){if(!this.maxVisibleDistance)return!0;var t=this.renderContext.camera.eye;return this.maxVisibleDistance>=n.Vector3.Distance(t,this.Pf)},r.prototype.hasAnimation=function(){return this.QJ()?this.isAnimation?!0:this.Mu.animatables.length>0:!1},r.prototype.Pe=function(){var i=this.renderContext,f=i.camera.worldCenter,h=this.Pf,e=i.camera.coordSystem.earthToWorld(h),o,s,u,r,t;o=this.renderContext.camera.coordSystem.calcRotationMatrix(h);s=n.Matrix.Translation(e.x-f.x,e.y-f.y,e.z-f.z);u=o.multiply(s);this.Pp&&(u=this.Pp.multiply(u));this.Mu._custumWorldMatrix=u;this.Mu._custumWorldMatrix.invertToRef(this.Og);r=i.camera.worldEye.clone();r.subtractInPlace(i.camera.worldCenter);r=n.Vector3.TransformCoordinates(r,this.Og);this.Mu._forcedViewPosition=r;t=i.camera.worldCamera.clipPlane;t&&(t=t.clone(),t.d-=this.Pf.y);this.Mu.clipPlane=t;this.Mu._dsRotateMatrix=o;this.Mu._dsTransMatrix=s;this.Mu._dsMatrixIdentity=n.Matrix.Identity();this.renderContext.camera._transformLocalWorld()},r.prototype._customSetupForDrawContents=function(){this.Pe();this.Mu.updateTransformMatrix(!0)},r.prototype.drawContents=function(){return(this.Pt(),!this.QJ())?!1:(this.Pe(),this.Mu.updateTransformMatrix(!0),this.Mu.render(),!0)},r.prototype.localToEarth=function(t){var i=n.Vector3.Zero();return this.localToEarthToRef(t,i),i},r.prototype.localToEarthToRef=function(n,t){this.Ie.localToEarthToRef(this.Pf,n,t)},r.prototype.earthToLocal=function(t){var i=n.Vector3.Zero();return this.earthToLocalToRef(t,i),i},r.prototype.earthToLocalToRef=function(n,t){this.Ie.earthToLocalToRef(this.Pf,n,t)},r.prototype.addModel=function(i,r){var u=this;return i&&!this.Ot&&(this.position=i),new Promise(function(f){var e=u.Mu,o=n.StringHelper.ExtractDirectoryOnly(r),s=n.StringHelper.ExtractFileName(r);BABYLON.SceneLoader.ImportMesh("",o,s,e,function(n){var r=new t(u,n[0]);r.position=i;f(r)},null,function(){f(null)})})},r.prototype.pickByRay=function(i,r,u){var s,c,l,f;if(!this.Mu)return null;this.clearPickedObjects();var h=this.renderContext.camera.worldCenter,e=i.subtract(h),o=r.subtract(h);return this.Og&&(e=n.Vector3.TransformCoordinates(e,this.Og),o=n.Vector3.TransformCoordinates(o,this.Og)),s=o.subtract(e),s.normalize(),c=new n.Ray(e,s),f=this.Mu.pickWithRay(c,null),f.hit&&(this.NR=f.pickedMesh,this.QG(!0),l=new t(this,f.pickedMesh),u&&u.copyFrom(this.localToEarth(f.pickedPoint))),l},r.prototype.QG=function(n){this.NR&&(this.NR.renderOutline=n,n&&(this.NR.outlineColor=new BABYLON.Color3(1,1,0),this.NR.outlineWidth=Math.max(.02,this.NR.getBoundingInfo().diagonalLength*.02)))},r.prototype.clearPickedObjects=function(){this.QG(!1);this.NR=null},r.prototype.Pt=function(){var n=this.LK;this._stencilWriteId>0?(n.setStencilFunction(BABYLON.Engine.ALWAYS),n.setStencilOperationPass(BABYLON.Engine.REPLACE),n.setStencilOperationFail(BABYLON.Engine.KEEP),n.setStencilOperationDepthFail(BABYLON.Engine.KEEP),n.setStencilMask(255),n.setStencilBuffer(!0),n.setStencilFunctionReference(this._stencilWriteId)):this._stencilClipId>0&&(n.setStencilFunction(BABYLON.Engine.EQUAL),n.setStencilOperationPass(BABYLON.Engine.REPLACE),n.setStencilOperationFail(BABYLON.Engine.KEEP),n.setStencilOperationDepthFail(BABYLON.Engine.KEEP),n.setStencilMask(255),n.setStencilBuffer(!0),n.setStencilFunctionReference(this._stencilClipId))},r}(n.Layer3);n.BabylonLayer=u}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var r=function(){function n(){}return n.AddOneCastLayer=function(n,i,r){var u,f;u=new t("",n);f=new t("",n,!1);u.setLayer(r);f.setLayer(r);i.getShadowMap().renderList.push(u);i.getShadowMap().renderList.push(f)},n}(),t,i;n._ShadowHelper=r;t=function(t){function i(n,i,r){var u,f,e;return r===void 0&&(r=!0),u=t.call(this,n,i)||this,u.PB=!0,u.My=!0,u.PB=r,f={segments:32,diameter:1},e=BABYLON.VertexData.CreateSphere(f),e.applyToMesh(u,!1),u}return __extends(i,t),i.prototype.PX=function(){if(this.My){this.My=!1;var n=new BABYLON.StandardMaterial("mesh",this.getScene()),t=this.getEngine();n.diffuseTexture=new BABYLON.BaseTexture(this.getScene());n.diffuseTexture._texture=t.emptyTexture;this.material=n}},i.prototype.getBoundingInfo=function(){var n,i,u,r,f;return this.EJ?(n=500,i=this.EJ.renderContext.camera.center,this.PL?(u=n,(Math.abs(this.PL.x-i.x)>u||Math.abs(this.PL.z-i.z)>u)&&(this.PL=i.clone())):this.PL=i.clone(),r=this.PL.clone(),f=new BABYLON.BoundingInfo(new BABYLON.Vector3(r.x-n,-10,r.z-n),new BABYLON.Vector3(r.x+n,10,r.z+n)),this.setBoundingInfo(f),f):t.prototype.getBoundingInfo.call(this)},i.prototype._processRendering=function(t,i,r,u,f,e,o){var a,c,v,b,h,s,y;if(!o){if(this.EJ){this.PX();var l=this.material,k=new n.AsyncRenderableParam,w=this.EJ.enumRenderMeshChunks(),p=this.EJ.renderContext.graphics;for(p.isCulling=!1,a=[],c=[],h=0;h<w.length;h++)s=w[h],s.isTransparent?s.texture&&s.texture.internalTexture&&c.push(s):a.push(s);if(v=this.EJ.renderContext.camera.worldCenter,b=n.Matrix.Translation(-v.x,-v.y,-v.z),this.PB)for(l.diffuseTexture.hasAlpha=!1,h=0;h<a.length;h++)s=a[h],e&&(y=s.world,e(!1,y)),p.drawElements(s.elmentBuffer,s.indexStart,s.indexCount);else if(c.length>0)for(l.diffuseTexture.hasAlpha=!0,h=0;h<c.length;h++)s=c[h],e&&(y=s.world,e(!1,y)),l.diffuseTexture._texture=s.texture.internalTexture,i&&(i.setTexture("diffuseSampler",l.diffuseTexture),i.setMatrix("diffuseMatrix",BABYLON.Matrix.Identity())),p.drawElements(s.elmentBuffer,s.indexStart,s.indexCount)}return null}},i.prototype.setLayer=function(n){this.EJ=n},i}(BABYLON.Mesh);i=function(){function n(){}return n.CreateGroup=function(n,t,i){for(var r=n._customScene.getEngine(),u=0;u<t.length;u++)this.Ln(r,t[u],i);n.onBeforeRender.add(function(){r.cacheStencilState();r.setStencilFunction(BABYLON.Engine.EQUAL);r.setStencilOperationPass(BABYLON.Engine.REPLACE);r.setStencilOperationFail(BABYLON.Engine.KEEP);r.setStencilOperationDepthFail(BABYLON.Engine.KEEP);r.setStencilMask(255);r.setStencilBuffer(!0);r.setStencilFunctionReference(i)});n.onAfterRender.add(function(){r.restoreStencilState()})},n.Ln=function(n,t,i){t.onBeforeRender.add(function(){n.cacheStencilState();n.setStencilFunction(BABYLON.Engine.ALWAYS);n.setStencilOperationPass(BABYLON.Engine.REPLACE);n.setStencilOperationFail(BABYLON.Engine.KEEP);n.setStencilOperationDepthFail(BABYLON.Engine.KEEP);n.setStencilMask(255);n.setStencilBuffer(!0);n.setStencilFunctionReference(i)});t.onAfterRender.add(function(){n.restoreStencilState()})},n}();n._PostProcessHelper=i}(Drawsee||(Drawsee={})),function(n){var u=function(){function n(){}return n._IsLeafMatchLevel=function(n){return n>=this.MinDetailLevel},n._IsDetailLevel=function(n){return n>this.MinDetailLevel},n._IsZeroHighLevel=function(n){return n<=this.Al},n.RootLevel=0,n.MinDetailLevel=12,n.MaxDetailLevel=17,n.Al=4,n}(),t,i,r;n.TerrainConst=u;t=function(){function t(t,i){this.Ei=0;this.Dy=0;this.Ei=t;this.Dy=i;this.BCQ=n.ArrayHelper.CreateDataArray2(t,i)}return Object.defineProperty(t.prototype,"width",{get:function(){return this.Ei},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.Dy},enumerable:!1,configurable:!0}),t.prototype.getItem=function(n,t){return this.BCQ[n][t]},t.prototype.setItem=function(n,t,i){this.BCQ[n][t]=i},t.prototype.calcValueRange=function(n,t){var r,u,i;for(n.value=340282347e30,t.value=-340282347e30,r=0;r<this.Ei;r++)for(u=0;u<this.Dy;u++)i=this.BCQ[r][u],i<n.value&&(n.value=i),i>t.value&&(t.value=i)},t}();n.ValueGrid=t;i=function(){function i(i,r,u,f){this.Hw=new n.Vector2;this.BBQ=0;this.BBy=new t(u,f);this.BBQ=r;this.Hw=i.clone()}return Object.defineProperty(i.prototype,"valueGrid",{get:function(){return this.BBy},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bounds",{get:function(){return new n.Rect(this.Hw.x,this.Hw.y,this.BBy.width*this.BBQ,this.BBy.height*this.BBQ)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"step",{get:function(){return this.BBQ},enumerable:!1,configurable:!0}),i}();n.DemGridSurface=i;r=function(){function t(n){n?this.Gz=new Float32Array(n):(this.Gz=new Float32Array(4225),this.fill(t.NULL_VALUE))}return t.prototype.fill=function(n){var i,t;if(this.Gz.fill!==undefined)this.Gz.fill(n);else for(i=this.Gz.length,t=0;t<i;t++)this.Gz[t]=n},Object.defineProperty(t.prototype,"data",{get:function(){return this.Gz},enumerable:!1,configurable:!0}),t.prototype.clone=function(){var n=new t;return n.Gz=new Float32Array(this.Gz.buffer.slice(0)),n},t.prototype.getAt=function(n,t){return this.Gz[n*65+t]},t.prototype.setAt=function(n,t,i){this.Gz[n*65+t]=i},t.CreateDenseHeightArray=function(i,r){var a,f,v,u,y,e,c;if(!i)return null;for(a=new t,a.setAt(0,0,i.getAt(0,0)),a.setAt(0,64,i.getAt(0,64)),a.setAt(64,0,i.getAt(64,0)),a.setAt(64,64,i.getAt(64,64)),f=64,r=Math.max(1,r),v=i.Gz,u=a.Gz;f>r;){for(y=n.SystemHelper.ToInt(f/2),e=0;e<64;e=e+f)for(c=0;c<64;c=c+f){var o=c+y,l=e,s=l*65+o,h=v[s];u[s]=h!==t.NULL_VALUE?h:(u[l*65+c]+u[l*65+c+f])*.5;l=e+f;s=l*65+o;h=v[s];u[s]=h!==t.NULL_VALUE?h:(u[l*65+c]+u[l*65+c+f])*.5;l=e+y;o=c;s=l*65+o;h=v[s];u[s]=h!==t.NULL_VALUE?h:(u[e*65+o]+u[(e+f)*65+o])*.5;o=c+f;s=l*65+o;h=v[s];u[s]=h!==t.NULL_VALUE?h:(u[e*65+o]+u[(e+f)*65+o])*.5;l=e+y;o=c+y;s=l*65+o;h=v[s];u[s]=h!==t.NULL_VALUE?h:(u[e*65+o]+u[(e+f)*65+o])*.5}f=n.SystemHelper.ToInt(f/2)}return a},t.NULL_VALUE=-32767,t}();n.HeightGrid=r}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(){}return t.CalcPatchOriginPointToRef=function(t,i,r,u,f){var o,e;i<8?f.setAll(0):(o=void 0,o=i<10?4:i<16?10:8,e=n._EarthTilingTransform.XyToRect(i,r,u),t.earthToWorldToRef(new n.Vector3(e.x,0,e.y),f))},t.CalcPatchOriginPoint=function(i,r,u,f){var e=n.Vector3.Zero();return t.CalcPatchOriginPointToRef(i,r,u,f,e),e},t}();n.TerrainMath=t}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(t,i,r){this.BBY=new n.Vector3;this.BBY=t.clone();this.BBL=i;this.BCE=n.SystemHelper.ToInt(r.length/3);this.Rv=new n.MeshTriangleIndex(r)}return t.prototype.toLocalCoord=function(t){return new n.Vector3(t.x-this.BBY.x,t.y-this.BBY.y,t.z-this.BBY.z)},t.prototype.toGlobalCoord=function(t){return new n.Vector3(t.x+this.BBY.x,t.y+this.BBY.y,t.z+this.BBY.z)},t.prototype.toLocalCoordV=function(t){return new n.Vector3(t.x-this.BBY.x,t.y-this.BBY.y,t.z-this.BBY.z)},t.prototype.toGlobalCoordV=function(t){return new n.Vector3(t.x+this.BBY.x,t.y+this.BBY.y,t.z+this.BBY.z)},t.prototype.getTrianglePointsWorld=function(){for(var t,i=[],r=this.Rv.triPoints,u=this.BBY,n=0;n<r.length;n++)t=r.getAt(n),t.addInPlace(u),i.push(t);return i},t.prototype.BBN=function(){return this.BCE},t.prototype.BBt=function(n,t,i,r){var u=n*3,f=this.BBL;f.getToRef(u,t);f.getToRef(u+1,i);f.getToRef(u+2,r)},t.prototype.BCP=function(n,t,i,r){var u=n*3,f=this.Rv.triPoints;f.getToRef(u,t);f.getToRef(u+1,i);f.getToRef(u+2,r)},t.prototype.BAN=function(n,t,i,r){var u=n*3,f=this.Rv.triPoints,e=this.BBY;f.getToRef(u,t);f.getToRef(u+1,i);f.getToRef(u+2,r);t.addInPlace(e);i.addInPlace(e);r.addInPlace(e)},t.prototype.calculateHeight=function(t,i,r){var u=t.camera.coordSystem,e=u.earthToWorld(new n.Vector3(i,1e5,r)),o=u.earthToWorld(new n.Vector3(i,-10,r)),f=new n.Vector3;return this.isIntersect(e,o,f)?u.worldToEarth(f).y:0},t.prototype.isIntersect=function(t,i,r){var f=this.toLocalCoord(t),s=this.toLocalCoord(i),h=f,e=s.subtract(f),o,u;return(e.normalize(),o=new n.Ray(h,e),u=this.Rv.intersectsRay(o),u)?(r.copyFrom(u),r.copyFrom(this.toGlobalCoord(r)),!0):!1},t.prototype.BCV=function(t,i){var r=new n.Vector3(0,0,0),f=this.toLocalCoord(t),e=this.toLocalCoord(i),u;return r=this.toLocalCoord(r),u=n.Plane.FromPoints(f,e,r),this.Rv.selectTriNosByPlane(u)},t.prototype.isPlaneIntersect=function(n,t){return this.BCV(n,t).length>0},t.prototype.clipOneSegment=function(t,i,r,u){var o,s,h;if(u.value=[],o=this.BCV(i,r),o.length<0)return!1;var c=n.Plane.FromPoints(i,r,n.Vector3.Zero()),e=[],l=n.Vector3.Zero(),a=n.Vector3.Zero(),v=n.Vector3.Zero(),f=n.Vector3.Zero();for(s=0;s<o.length;s++)this.BAN(o[s],l,a,v),h=new n.RefValue(0),n.VectorHelper.IntersectSegmentPlane(l,a,c,f,h)&&n.VectorHelper.IsBetween(i,r,f)&&e.push(new n.Vector3(f.x,f.y,f.z)),n.VectorHelper.IntersectSegmentPlane(l,v,c,f,h)&&n.VectorHelper.IsBetween(i,r,f)&&e.push(new n.Vector3(f.x,f.y,f.z)),n.VectorHelper.IntersectSegmentPlane(a,v,c,f,h)&&n.VectorHelper.IsBetween(i,r,f)&&e.push(new n.Vector3(f.x,f.y,f.z));return n.ArrayHelper.AddRange(u.value,e),e.length>0},t.prototype.BCZ=function(t,i,r,u){var e;u.value=[];var c=i.length,l=n.Vector3.Zero(),a=n.Vector3.Zero(),v=n.Vector3.Zero();for(this.BCP(t,l,a,v),r.value=0,e=0;e<c;e++){var h=!1,o=void 0,s=void 0;e===c-1?(o=i[c-1],s=i[0]):(o=i[e],s=i[e+1]);var y=n.Plane.FromPoints(o,s,n.Vector3.Zero()),f=new n.Vector3,p=new n.RefValue(0);n.VectorHelper.IntersectSegmentPlane(l,a,y,f,p)&&n.VectorHelper.IsBetween(o,s,f)&&(h=!0,u.value.push(new n.Vector3(f.x,f.y,f.z)));n.VectorHelper.IntersectSegmentPlane(l,v,y,f,p)&&n.VectorHelper.IsBetween(o,s,f)&&(h=!0,u.value.push(new n.Vector3(f.x,f.y,f.z)));n.VectorHelper.IntersectSegmentPlane(a,v,y,f,p)&&n.VectorHelper.IsBetween(o,s,f)&&(h=!0,u.value.push(new n.Vector3(f.x,f.y,f.z)));h&&(r.value=r.value+1)}return u.value.length>0},t.prototype.BAK=function(t,i,r,u,f,e){var v,b,l,s,o,k,d,h;e.value=[];try{var c=[],y=t.worldToEarth(i),p=t.worldToEarth(r),w=t.worldToEarth(u);for(c.push(new n.Vector2(y.x,y.z)),c.push(new n.Vector2(p.x,p.z)),c.push(new n.Vector2(w.x,w.z)),v=n.PolygonMath.ClipPolygon(c,f),b=v.length,l=0;l<b;l++)if(s=v[l],o=[],s){for(k=n.Plane.FromPoints(i,r,u),d=s.length,h=0;h<d;h++){var g=s[h].x,nt=s[h].y,tt=t.earthToWorld(new n.Vector3(g,-1e4,nt)),it=t.earthToWorld(new n.Vector3(g,1e4,nt)),a=new n.Vector3,rt=new n.RefValue(0);n.VectorHelper.IntersectSegmentPlane(tt,it,k,a,rt)&&o.push(new n.Vector3(a.x,a.y,a.z))}o.length>0&&o.push(o[0]);e.value.push(o)}return e.value.length>0}catch(ut){}},t.prototype.clampPolygon=function(t,i,r){var u,s,c,f,e,o,h,y,p;if(r.value=[],!t)return!1;for(u=[],s=0;s<i.length;s++)c=t.worldToEarth(i[s]),u.push(new n.Vector2(c.x,c.z));var w=n.Vector2.Zero(),b=n.Vector2.Zero(),k=n.Vector2.Zero(),l=n.Vector3.Zero(),a=n.Vector3.Zero(),v=n.Vector3.Zero(),g=this.BBN();for(f=0;f<g;f++){this.BBt(f,w,b,k);e=0;n.Math2.Contains(u,w)&&e++;n.Math2.Contains(u,b)&&e++;n.Math2.Contains(u,k)&&e++;var nt=new n.RefValue(0),tt=new n.RefValue(null),d=this.BCZ(f,i,nt,tt);if(this.BAN(f,l,a,v),e!==0||d)if(3!==e||d){for(o=new n.RefValue(null),this.BAK(t,l,a,v,u,o),h=0;h<o.value.length;h++)y=o.value[h],y&&(p=n.Math3.PolygonToTriangles(y,null),p&&n.ArrayHelper.AddRange(r.value,p));o.value=null}else r.value.push(l.clone()),r.value.push(a.clone()),r.value.push(v.clone())}return!0},t}();n.TerrainPatchCalc=t}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(t,i,r,u,f,e,o,s,h){this.level=i;this.xIndex=r;this.zIndex=u;this.Db=0;this.Bt=new n.Box;this.BBw=new n.Vector3;this.BBY=new n.Vector3;this.OP=!1;this.RB=t;this.GX=t.renderContext;this.BCd=this.GX.camera.coordSystem;this.BCE=e.length;this.BAD=s;this.BBf=h;this.BBS(this.GX,f,e,o,h)}return t.prototype.BBS=function(i,r,u,f){var c=this.BCd,s,h;this.BBY=n.TerrainMath.CalcPatchOriginPoint(c,this.level,this.xIndex,this.zIndex);var o=n.TerrainPatchFactory._GetSharedEarthVsByLevel(this.level).clone(),e=n._EarthTilingTransform.XyToRect(this.level,this.xIndex,this.zIndex),l=e.width/64,a=e.height/64;t.BCW(this,r,o,e.x,e.y,l,a);t.BCR(this.BBY,r);this.BBT(i,r,u,f);s=t.BAI(r,u,f);h=t.BAR(o,u,f);this.Ar=new n.TerrainPatchCalc(this.BBY,h,s)},t.prototype.dispose=function(){this.Qy&&(this.Qy.dispose(),this.Qy=null);this.BAt=null;this.BBV=null;this.OP=!0},Object.defineProperty(t.prototype,"math",{get:function(){return this.Ar},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bounds",{get:function(){return this.Bt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"handle",{get:function(){return this.OO||(this.OO=new n.QuadtreeHandle(this.level,this.xIndex,this.zIndex)),this.OO},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this.Db},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"triangleCount",{get:function(){return this.BCE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"heights",{get:function(){return this.BAD},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"heightsDetail",{get:function(){return this.BBJ||(this.BBJ=n.HeightGrid.CreateDenseHeightArray(this.BAD,1)),this.BBJ},enumerable:!1,configurable:!0}),t.prototype.getTrianglePointsWorld=function(){return this.Ar.getTrianglePointsWorld()},t.BCW=function(i,r,u,f,e,o,s){for(var c=17976931348623157e292,p=c,w=c,a=-c,b=a,k=a,g=Number.MAX_VALUE,nt=-Number.MAX_VALUE,it=r.length,l=n.Vector3.Zero(),v=n.Vector2.Zero(),h=n.Vector3.Zero(),tt=i.GX.projection,d=0;d<it;d++){r.getPositionToRef(d,l);var rt=l.x,y=l.y,ut=l.z;g>y&&(g=y);nt<y&&(nt=y);v.x=f+rt*o;v.y=e+ut*s;u.setAt(d,v);tt?t.BCm(tt,v.x,y,v.y,h):n.EarthMath3.EarthToWorldDoubleRef(v.x,y,v.y,h);l.x=h.x;l.y=h.y;l.z=h.z;c>h.x&&(c=h.x);p>h.y&&(p=h.y);w>h.z&&(w=h.z);a<h.x&&(a=h.x);b<h.y&&(b=h.y);k<h.z&&(k=h.z);r.setPosition(d,l)}i.BBw.x=(c+a)/2;i.BBw.y=(p+b)/2;i.BBw.z=(w+k)/2;i.Db=n.Math3.Distance(c,p,w,a,b,k)*.5;i.Bt=new n.Box(new n.Vector3(c,p,w),new n.Vector3(a,b,k));i._minHeight=g;i._maxHeight=nt},t.BCm=function(t,i,r,u,f){var e=t.project(new n.Vector2(i,u));f.x=e.x;f.y=n.Drawing3DSetting.TerrainZeroBaseHeight;f.z=e.y},t.BCR=function(t,i){var f,u,r;if(i)for(f=i.length,u=n.Vector3.Zero(),r=0;r<f;r++)i.getPositionToRef(r,u),u.subtractInPlace(t),i.setPosition(r,u)},t.BAI=function(t,i,r){for(var h=Math.min(i.length,r),e=n.Vector3Array.Create(3*h),u=n.Vector3.Zero(),f=0,s=i.data,o=0,c=0;c<h;c++)t.getPositionToRef(s[o],u),e.setAt(f,u),f++,t.getPositionToRef(s[o+1],u),e.setAt(f,u),f++,t.getPositionToRef(s[o+2],u),e.setAt(f,u),f++,o+=3;return e},t.BAR=function(t,i,r){for(var h=Math.min(i.length,r),e=n.Vector2Array.Create(3*h),u=n.Vector2.Zero(),f=0,s=i.data,o=0,c=0;c<h;c++)t.getToRef(s[o],u),e.setAt(f,u),f++,t.getToRef(s[o+1],u),e.setAt(f,u),f++,t.getToRef(s[o+2],u),e.setAt(f,u),f++,o+=3;return e},t.prototype.BBT=function(t,i,r,u){var f=this.RB.allocBuffer(this.level,i.data,r.data);f&&(this.Qy=f,this.BBV=new n.TerrainChunk(f,this.level,this.BBY,this.BBw,this.radius*1.2,null,!1,0,u*3),this.BAt=new n.TerrainChunk(f,this.level,this.BBY,this.BBw,this.radius*1.2,null,!1,0,f.internalBuffer.indexCount))},t.prototype.BBA=function(){this.BCF||this.BBf||this.level>=n.TerrainConst.MinDetailLevel||(this.BCF=n.TerrainPatchFactory.CreateTriangleWithZeroHeight(this.RB,this.level,this.xIndex,this.zIndex),this.BCF._releaseNonRenderResouce())},t.prototype._releaseNonRenderResouce=function(){this.Ar=null;this.BAD=null;this.BBJ=null},t.prototype.toRenderChunk=function(n,t,i,r){var f,e,u;if(!this.OP)return!this.BBV||!this.BAt?void 0:(f=this.GX.graphics.terrainChunkRender,f.setting.isUseTexture||(n=null),r&&(this.BBA(),this.BCF))?this.BCF.toRenderChunk(n,t,i,!1):(e=!this.BBf&&f.setting.alpha>=1&&!i,u=e?this.BAt:this.BBV,u.texture=n,u.overlayTextures=t?t.textures:null,u.isTransparent=i,u)},t.prototype.toMeshRenderChunk=function(){var r,t,i;return this.TG||(r=n.Matrix.Identity(),t=this.BBY,r=n.Matrix.Translation(t.x,t.y,t.z),i=this.BAt,this.TG=new n.RenderMeshChunk(r,this.BBw,this.Db,!1,null,i.elmentBuffer,i.indexStart,i.indexCount)),this.TG},t.prototype.createSubPatch=function(t,i,r){var u,f;if(t<this.level||!this.heightsDetail)return null;var s=new n.HeightGrid,o=1<<t-this.level,e=n.SystemHelper.ToInt(64/o),l=n.SystemHelper.ToInt(e/2),y=i%o,p=o-1-r%o,w=y*e,b=p*e,k=this.heightsDetail;for(u=0;u<=e;u++)for(f=0;f<=e;f++){var h=b+u,c=w+f,a=u*o,v=f*o;this.BAD.getAt(c,h)!==-32767?s.setAt(v,a,this.BAD.getAt(c,h)):(u===0||f===0||u===e||f===e||u===l&&f===l)&&s.setAt(v,a,k.getAt(c,h))}return n.TerrainPatchFactory.CreatePatchFromHeights(this.RB,s,t,i,r,!1)},t.PATCH_SIZE=64,t.HEIGHT_NULL=-32767,t.HEIGHT_MATRIX_SIZE=65,t}();n.TerrainPatch=t}(Drawsee||(Drawsee={})),function(n){var r=function(){function t(n,t){this.heights=n;this.minSplitDis=t;this.BCG=[];this.BCI=[];this.BCC();this.BBn()}return t.prototype.BBB=function(){var t,i;for(this.BCo=n.ArrayHelper.CreateDataArray2(66,66),t=0;t<66;t++)for(i=0;i<66;i++)this.BCo[t][i]=-1},t.prototype.BCC=function(){this.BBB();this.BBE(0,0,64,64,0,64);this.BBE(64,64,0,0,64,0)},t.prototype.BBE=function(t,i,r,u,f,e){if(Math.abs(r-t)<=this.minSplitDis&&Math.abs(i-u)<=this.minSplitDis)this.BBK(t,i,r,u,f,e);else{var o=n.SystemHelper.ToInt((t+r)/2),s=n.SystemHelper.ToInt((i+u)/2),h=n.SystemHelper.ToInt(this.heights.getAt(o,s));h!==-32767?(this.BBE(f,e,t,i,o,s),this.BBE(r,u,f,e,o,s)):this.BBK(t,i,r,u,f,e)}},t.prototype.BCn=function(t,i){var r=this.BCo[t][i];return r<0&&(this.BCI.push(new n.Vector2(t,i)),r=this.BCI.length-1,this.BCo[t][i]=r),r},t.prototype.BBK=function(t,i,r,u,f,e){var o=new n.Triangle3;o.v0=this.BCn(t,i);o.v1=this.BCn(r,u);o.v2=this.BCn(f,e);this.BCG.push(o)},t.BCJ=function(t,i,r){var f,u;if(t&&t.length>0){var e=[],o=[],s=[],h=[],c=t.length;for(f=0;f<c;f++)u=t[f],u.x===0&&e.push(new n.Vector3(0,u.y,f)),u.x===64&&o.push(new n.Vector3(64,u.y,f)),u.y===0&&h.push(new n.Vector3(u.x,0,f)),u.y===64&&s.push(new n.Vector3(u.x,64,f));e.sort(function(t,i){return n.g_compareTo(t.y,i.y)});o.sort(function(t,i){return n.g_compareTo(t.y,i.y)});h.sort(function(t,i){return n.g_compareTo(t.x,i.x)});s.sort(function(t,i){return n.g_compareTo(t.x,i.x)});this.BAl(e,o,s,h,i,r)}},t.BAl=function(n,t,i,r,u,f){this.BBc(n,!0,u,f);this.BBc(t,!1,u,f);this.BBc(r,!1,u,f);this.BBc(i,!0,u,f)},t.BBc=function(t,i,r,u){for(var h,e=r.length,f=0;f<t.length;f++)h=t[f],r.push(new n.Vector2(h.x,h.y));for(f=0;f<t.length-1;f++){var c=t[f],l=t[f+1],o=new n.Triangle3,s=new n.Triangle3;o.v0=c.z;s.v0=c.z;i?(o.v1=e+1,o.v2=e,s.v1=l.z,s.v2=e+1):(o.v1=e,o.v2=e+1,s.v1=e+1,s.v2=l.z);u.push(o);u.push(s);e+=1}},Object.defineProperty(t.prototype,"vertsCount",{get:function(){return this.TF},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skirtVertsCount",{get:function(){return this.BCI.length-this.TF},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"triangles",{get:function(){return this.BCL},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vertexFloatStide",{get:function(){return this.WU.data.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"triangleIntStide",{get:function(){return this.BCL.data.length},enumerable:!1,configurable:!0}),t.prototype.BBn=function(){this.TF=this.BCI.length;this.BAj=this.BCG.length;t.BCJ(this.BCI,this.BCI,this.BCG);this.BCL=new n.Triangle3Array(n.Triangle3.ToIndexArray(this.BCG));this.WU=n.Vertex3Array.Create(this.BCI.length);this.YQ()},t.prototype.YQ=function(){for(var i,u=this.WU,e=this.BCI,f=.015625,o=u.length,t=new n.Vertex3,r=0;r<o;r++)i=e[r],t.x=i.x,t.z=i.y,t.u=i.x*f,t.v=1-i.y*f,u.setAt(r,t)},Object.defineProperty(t.prototype,"mainTriangleCount",{get:function(){return this.BAj},enumerable:!1,configurable:!0}),t.prototype.prepareVertexArray=function(t,i){for(var h,u,f=this.WU.clone(),o=17976931348623157e292,s=-17976931348623157e292,e=n.Vector3.Zero(),r=0;r<this.TF;r++)f.getPositionToRef(r,e),u=i.getAt(e.x,e.z),f.setHeight(r,u),u<o&&(o=u),u>s&&(s=u);if(h=this.BCD(t,o,s),h>0)for(r=this.TF;r<f.length;r++)f.getPositionToRef(r,e),u=i.getAt(e.x,e.z),f.setHeight(r,u-h);return f},t.prototype.BCD=function(t,i,r){var u,f;return u=n.TerrainConst._IsZeroHighLevel(t+2)?r+2e3:(r-i)/4,f=n._TerrainPatchLevelConst.GetPatchRadius(t)*.02,Math.max(u,f)},t}(),t,i;n._HeightArrayToTriangle=r;t=function(){function n(n,t,i,r){this.level=n;this.xIndex=t;this.zIndex=i;this.data=r}return n}();n.PatchHeightsData=t;i=function(){function i(){}return i.ExtractPatchHeightsData=function(i){var o=[],r=new n.MemoryBinaryReader(i),y=r.readInt32(),h=r.readInt32(),u,f;try{for(u=0;u<h;u++)if(f=r.readInt32(),f>0){var s=r.readBytes(f),e=new n.MemoryBinaryReader(s),c=20-e.readInt32(),l=e.readInt32(),a=e.readInt32(),v=new t(c,l,a,s);o.push(v)}}catch(p){}return o},i.ZE=function(t){var i=new n.MemoryBinaryReader(t),r=20-i.readInt32(),u=i.readInt32(),f=i.readInt32(),e=i.readInt16s(4225),o=new n.HeightGrid(e);return{heights:o,level:r,xIndex:u,zIndex:f}},i._GetSharedEarthVsByLevel=function(t){var u,r,f;return t<0||t>20?null:(u=i.BAh(t),r=i.BCO[u],r||(f=i.BBH(t),r=n.Vector2Array.Create(f.vertsCount),i.BCO[u]=r),r)},i.BBH=function(n){if(n<0||n>20)return null;var u=i.BAh(n),t=i.BAd[u];return t||(t=new r(i.BCU,u),i.BAd[u]=t),t},i.BAh=function(){return 4},i.CreatePatchFromHeights=function(t,r,u,f,e,o){var s;if(o===void 0&&(o=!1),s=i.BBH(u),!s)return null;var c=i.BAh(u),h=n.HeightGrid.CreateDenseHeightArray(r,c),l=s.prepareVertexArray(u,h,o);return new n.TerrainPatch(t,u,f,e,l,s.triangles,s.mainTriangleCount,h,o)},i.CreateFromBytes=function(n,t,r){var u=i.ZE(t);return i.CreatePatchFromHeights(n,u.heights,r.level,r.x,r.y,!1)},i._Init=function(){this.BBg();for(var n=0;n<=20;n++)this.BBH(n)},i.BBg=function(){var t=i.BCU,r;t||(i.BCU=new n.HeightGrid,t=i.BCU);r=n.Drawing3DSetting.TerrainZeroBaseHeight;t.getAt(0,0)!==r&&t.fill(r)},i.CreateTriangleWithZeroHeight=function(t,r,u,f){this.BBg();var e=this.BBH(r),o=e.prepareVertexArray(r,i.BCU,!0);return new n.TerrainPatch(t,r,u,f,o,e.triangles,e.mainTriangleCount,i.BCU,!0)},i.BCO=[],i.BAd=[],i}();n.TerrainPatchFactory=i;i._Init()}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(n){function t(t){var i=n.call(this)||this;return t.patch&&(i.node=t,i.bounds=t.patch.bounds),i}return __extends(t,n),t.ToNodes=function(n){for(var i,r=[],t=0;t<n.length;t++)i=n[t],i.node&&r.push(i.node);return r},t}(n.TObject),i=function(){function t(){}return t.prototype.compare=function(t,i){return n.g_compareTo(t.dis,i.dis)},t}(),r=function(){function n(n,t){this.dis=n;this.id=t}return n}(),u=function(){function u(n,t){this.layer=n;this.index=t;this.nearPointDisWorld=0;this.GX=n.renderContext;this.nearPointDisWorld=.1}return u.prototype.updatePatchIndex=function(){for(var e,r,o=this.layer.getLeafNodesForCalc(),u=[],s=!0,i,f=0;f<o.length;f++)e=o[f],e.patch&&(r=new t(e),u.push(r),s?(i=r.bounds,s=!1):i=n.Box.Union(i,r.bounds));u.length>0&&(this.AH=n.DynOctreeIndex.CreateForBuild(i.min,i.max,32,2),this.AH.add(u))},u.prototype.calculateHitPosition=function(t,i,r){var u=this.GX.camera.coordSystem.screenToWorldLine(new n.Vector2(t,i)),f=u[0],e=u[1],o=new n.RefValue(0),s=this.Ai(n.TerrainConst.RootLevel,f,e,u[0],u[1],r,o);return this.GX.camera.coordSystem.worldToEarthToRef(r,r),s},u.prototype.Ya=function(n,t){for(var u,i=t,r=0;r<n.length;r++)u=n[r],u.level>i&&(i=u.level);return i},u.prototype.Ai=function(t,i,r,u,f,e,o){var h,v,l,s,c,y;if(o.value=n.TerrainConst.RootLevel,h=this.AV(i,r,!1),h.length<=0&&(h=this.AV(i,r,!0)),h.length<=0)return!1;var p=17976931348623157e292,a=!1,w=this.Ya(h,t);if(this.AK&&this.AK.level>=w&&h.indexOf(this.AK)>=0&&(s=this.AK.patch,s&&(c=new n.Vector3,s.level>=t&&s.math.isIntersect(u,f,c)&&(e.copyFrom(c),a=!0,o.value=s.level))),!a)for(this.AK=null,v=0;v<h.length;v++)l=h[v],l&&l.level<20&&(s=l.patch,s&&(c=new n.Vector3,s.level>=t&&s.math.isIntersect(u,f,c)&&(y=n.Vector3.Distance(i,c),y<p&&(e.copyFrom(c),a=!0,p=y,o.value=s.level,this.AK=l))));return a},u.prototype.AV=function(i,r){var f,u,e,o;return this.AH?(f=i,u=r.subtract(i),u.normalize(),e=new n.Ray(f,u),o=this.AH.select(new n.DynOctreeRaySelector(e)),t.ToNodes(o)):[]},u.prototype.calculateHeight=function(t,i){var r=new n.RefValue,u=new n.RefValue;return this.calculateHeightAdvance(t,i,r,u),r.value},u.prototype.calculateHeightAdvance=function(t,i,r,u,f,e){var o,s;return f===void 0&&(f=n.TerrainConst.RootLevel),r.value=0,o=new n.Vector3,this.BAL(f,t,i,o,u,e)?(s=this.GX.camera.coordSystem,o=s.worldToEarth(o),r.value=o.y,!0):!1},u.prototype.BAL=function(t,i,r,u,f,e){var s=new n.Vector3(i,-1e4,r),h=new n.Vector3(i,1e4,r),l=this.GX.camera.coordSystem,o,c;return(s=l.earthToWorld(s),h=l.earthToWorld(h),o=this.BAr(i,r,e),o&&(c=new n.Vector3,o.patch.math.isIntersect(s,h,c)))?(u.copyFrom(c),f.value=o.level,!0):(f.value=n.TerrainConst.RootLevel,!1)},u.prototype.BAr=function(t,i,r){for(var u,e=this.layer.getLeafNodesForCalc(r),o=new n.Vector2(t,i),f=0;f<e.length;f++)if(u=e[f],u.patch&&u.earthRange.contains(o))return u;return null},u.prototype.clampLine=function(t,i){var f=[],r,o,e,u;if(!t||t.length<2||(r=n.VectorHelper.FilterDuplicatedVector3(t,this.nearPointDisWorld,!1),!r))return null;if(o=this.BAA(r),e=this.BAe(o,i),e.length<=0)return f;for(u=0;u<r.length-1;u++){var s=r[u],h=r[u+1],c=this.RI(s,h,e,i);n.ArrayHelper.AddRange(f,c)}return n.VectorHelper.FilterDuplicatedVector3(f,this.nearPointDisWorld,!1)},u.prototype.ZT=function(t,i,r){var f=this.GX.camera.coordSystem,u=f.worldToEarth(t),e=new n.RefValue(0);return this.BAL(n.TerrainConst.RootLevel,u.x,u.z,i,e,r)},u.prototype.RI=function(t,u,f,e){var h=[],s=new n.Vector3,c=new n.Vector3,p,w,b,l,nt,d,o;if(this.ZT(t,s,e)&&this.ZT(u,c,e)){var k=this.GX.camera.coordSystem,a=k.worldToEarth(s),v=k.worldToEarth(c),g=new n.Rect(Math.min(a.x,v.x),Math.min(a.z,v.z),Math.abs(a.x-v.x),Math.abs(a.z-v.z)),y=[];for(o=0;o<f.length;o++)p=f[o],p&&(w=p.patch,w&&n.Math2.RectIntersects(g,p.earthRange)&&(b=new n.RefValue(null),w.math.clipOneSegment(this.GX,s,c,b)&&n.ArrayHelper.AddRange(y,b.value)));for(l=[],nt=n.Vector3.Distance(s,c),o=0;o<y.length;o++)d=n.Vector3.Distance(s,y[o]),l.push(new r(d,o));for(n.ArrayHelper.Sort(l,new i),h.push(s),o=0;o<l.length;o++)h.push(y[l[o].id]);return h.push(c),h}return h},u.prototype.clampPolygon=function(t,i){var r=[],u,e,o,s,f,l,h;if(!t||t.length<3)return null;var a=n.VectorHelper.FilterDuplicatedVector3(t,this.nearPointDisWorld,!1),v=this.BAA(a),c=this.BAe(v,i);for(n.ArrayHelper.Clear(r),u=0;u<c.length;u++)e=c[u],e&&(o=e.patch,o&&(s=new n.RefValue(null),o.math.clampPolygon(this.GX.camera.coordSystem,t,s),n.ArrayHelper.AddRange(r,s.value)));return r.length<=0&&(f=n.ArrayHelper.CloneArray(t),f.push(f[0]),l=this.clampLine(f,i),h=n.Math3.PolygonToTriangles(l,null),h&&(r=n.ArrayHelper.CloneArray(h))),n.Math3._MakeTriangleNormalUp(r)},u.prototype.BAA=function(t){for(var r,e=this.GX.camera.coordSystem.worldToEarthArray(t),u=[],f=e,i=0;i<f.length;i++)r=f[i],u.push(new n.Vector2(r.x,r.z));return n.Rect.CalcRange(u)},u.prototype.BAe=function(t,i){for(var r,f=this.layer.getLeafNodesForCalc(i),e=[],u=0;u<f.length;u++)r=f[u],r.patch&&n.Math2.RectIntersects(r.earthRange,t)&&e.push(r);return e},u.prototype.calculateApproximateHeightRange=function(t,i,r){var o=this.BAe(t,r),u,f,e,s;if(o.length>0){for(u=Number.MAX_VALUE,f=-Number.MAX_VALUE,e=0;e<o.length;e++)s=o[e],u=Math.min(u,s.patch._minHeight),f=Math.max(f,s.patch._maxHeight);return new n.Vector2(u,f)}return n.Vector2.Zero()},u.prototype.enumRenderChunks=function(n,t){for(var f,r=[],u=this.BAe(n,t),i=0;i<u.length;i++)f=u[i],r.push(f.patch.toMeshRenderChunk());return r},u}();n.TerrainPatchIndexCalc=u}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(){}return t._Init=function(){for(var r,i=0;i<=20;i++)r=n._EarthTilingTransform.XyToRect(i,0,0),t.AY[i]=n.EarthMath2.Distance(r.left,0,r.right,0)*.5,t.AZ[i]=r.width*.5},t.GetFirstLevelLessRadius=function(n){for(var r=20,u=t.AY,i=0;i<=20;i++)if(u[i]<n){r=i;break}return r},t.GetPatchEarthRadius=function(n){return t.AZ[n]},t.GetPatchRadius=function(n){return t.AY[n]},t.AY=[],t.AZ=[],t}(),i;n._TerrainPatchLevelConst=t;t._Init();i=function(){function i(t,i,r){this.layer=t;this.CV=[];this.FW=[];this._leafLevel=n.TerrainConst.RootLevel;this.Af=new n.Vector3;this.Yq=0;this.PY=new n.Vector3;this.Yh=new n.Vector3;this.ZB=new n.Rect;this.YN=n.Drawing3DSetting.TerrainZeroBaseHeight;this.GX=t.renderContext;this.PC=this.GX.camera;this.Vs=i;this.Yv(i,r);this.YK()}return i.prototype.enumNodes=function(){return this.CV.concat(this.FW)},i.prototype.Yv=function(t,i){var r,u;for(this.CV=[],r=0;r<2;r++)u=new n.TerrainIndexNode(this),u._setParams(null,n.TerrainConst.RootLevel,r,0,t,i),this.CV.push(u)},i.prototype.Xr=function(){for(var t=this.CV,n=0;n<t.length;n++)t[n]._initOnAlloc()},i.prototype.YK=function(){var t,r;for(this.Yi=[],t=0;t<i.ZK;t++)r=new n.TerrainIndexNode(this),this.Yi.push(r)},i.prototype.allocSubNode=function(){var t=this.FW.length,n;return t<this.Yi.length?(n=this.Yi[t],this.FW.push(n),n._initOnAlloc(),n):null},i.prototype.YY=function(){this.Xr();this.FW.length=0},i.prototype.updateIndex=function(n){return(this.Ac(),this.GG(this.GX,n))?!0:!1},i.prototype.GG=function(i){var r,e,u;if(n.SystemTime._IsTimer1000&&this.Yq<=4&&(r=!0),!r){var f=t.GetPatchRadius(this._leafLevel)*.25,o=i.camera.coordSystem.earthToMeter(f),s=!(Math.abs(this.Af.x-this.PY.x)<f&&Math.abs(this.Af.y-this.PY.y)<o&&Math.abs(this.Af.z-this.PY.z)<f);(s||this.FW.length<=0)&&(r=!0)}if(r){for(this.Ak(),this.MV=this.GX.camera.worldCamera,this._leafLevel=n.TerrainConst.RootLevel,this.Af=this.PY.clone(),this.YY(),e=this.CV,u=0;u<e.length;u++)this.Yb(e[u]);return i.terrainLeafLevel=this._leafLevel,this.FW.length>0&&this.Yq++,!0}return!1},i.prototype.Ac=function(){var i=this.PC,t=n.Vector3.Lerp(i.center,i.eye,.3),e=i.eyeDistance,f,r,u;t.y=e;f=this.PC.coordSystem;r=this.GX.projection;r&&(u=r.unproject(new n.Vector2(t.x,t.z)),t.x=u.x,t.z=u.y);this.Yh=t;this.PY=f.earthToWorld(t)},i.prototype.Ak=function(){var e=this.PC,i=this.Yh,u=e.eyeDistance,o=this.PC.coordSystem,r;this.Wi=this.PC.worldCamera.aspectRatio;var f=Math.cos(n.MathHelper.ToRadians(i.z)),s=this.GX.graphics.getLodViewRatio(),h=u*s*.35/f/n.Drawing3DSetting.LodRatio;this.ZP=t.GetFirstLevelLessRadius(h);this.YN=this.AF(i.x,i.z);this.Ad=i.x;this.AL=i.z;r=o.meterToEarth(Math.max(1e3,u))*f*8;this.layer.earthViewer._hasTerrainProvider&&(r=Math.max(1,r));this.ZB.set(i.x-r,i.z-r,2*r,2*r)},i.prototype.AF=function(t,i){var u=this.GX.terrainCalculator,e=this.layer.earthViewer,r,f;return!e._hasTerrainProvider||!u?n.Drawing3DSetting.TerrainZeroBaseHeight:(r=new n.RefValue(0),f=new n.RefValue(0),u.calculateHeightAdvance(t,i,r,f,0))?r.value:this.YN},i.prototype._getPatchCenterHeight=function(t,i,r){var u=t.handle.level;if(u<n.TerrainConst.MinDetailLevel)return this.YN;if(u>n.TerrainConst.MinDetailLevel&&t.father)return t.father._centerHeight;var f=new n.RefValue(0),o=new n.RefValue(0),e=this.GX.terrainCalculator;return e&&e.calculateHeightAdvance(i,r,f,o,0)?f.value:this.YN},i.prototype.Yb=function(t){var f,e,i,r,u;if((t.level>this._leafLevel&&(this._leafLevel=t.level),f=t.radius,t.level>n.TerrainConst.MinDetailLevel&&(f*=1.5),t._isVisible=this.MV.isSphereInFrustum(t.worldCenter,t.radius),!(t.level>=this.Vs.maxTerrainLevel)&&!(t.level>this.ZP))&&(!this.GX.isEarthCoord||!(Math.abs(this.GX.camera.center.z)>80)||!(t.level<=2))){if(this.Zu(t))for(e=this.ZB.left<-180||this.ZB.right>180,i=0;i<2;i++)for(r=0;r<2;r++){var o=t.level+1,s=t.xIndex*2+r,h=t.zIndex*2+i,c=n._EarthTilingTransform.XyToRect(o,s,h);(e||this.ZB.intersects(c))&&(u=this.allocSubNode(),u._setParams(t,o,s,h),t.addSub(u),this.Yb(u))}t._isLeaf=t.enumSubs().length===0}},i.prototype.Av=function(n,t){var u,i,f,r;return(t===void 0&&(t=1),u=n.earthRange.width*t,i=Math.abs(n.earthCenter.x-this.Ad),i=Math.min(i,360-i),f=Math.abs(n.earthCenter.y-this.AL),r=this.Wi,r>1?f*=r:i/=r,i>u||f>u)?!1:!0},i.prototype.Zu=function(n){var i=this.ZP,t=Math.max(0,i-n.level);if(t===0){if(!this.Av(n,3))return!1}else if(t>=6){if(!this.Av(n,1.5))return!1}else if(!this.Av(n,2))return!1;return!0},i.ZK=2048,i}();n.TerrainIndex=i}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(t,i,r,u,f,e){i===void 0&&(i=0);r===void 0&&(r=0);u===void 0&&(u=0);f===void 0&&(f=null);e===void 0&&(e=null);this.index=t;this.level=i;this.xIndex=r;this.zIndex=u;this.texture=f;this.overlayTextures=e;this.Vh=[];this.OO=new n.QuadtreeHandle;this.To=!1;this.earthCenter=n.Vector2.Zero();this.earthRange=new n.Rect;this.worldCenter=n.Vector3.Zero();this._isNeedToLoad=!0;this._isNeedToPrepare=!0}return t.prototype._initOnAlloc=function(){this.Vh=[];this.father=null;this._isVisible=!1;this._isLeaf=!0;this.Xc=null;this.texture=null;this.overlayTextures=null;this._centerHeight=undefined;this.To=!1},t.prototype._setParams=function(t,i,r,u,f,e){this.father=t;t&&(f||(f=t.Vs),e||(e=t.AM));this.Vs=f;this.AM=e;this.level=i;this.xIndex=r;this.zIndex=u;this.OO=new n.QuadtreeHandle(i,r,u);var o=this.earthRange,h=n._EarthTilingTransform.XyToRectToRef(this.level,this.xIndex,this.zIndex,o),s=this.earthCenter;this._centerHeight=this.index._getPatchCenterHeight(this,s.x,s.y);s.set(o.left+o.width*.5,o.top+o.height*.5);n.EarthMath3.EarthToWorldDoubleRef(s.x,this._centerHeight,s.y,this.worldCenter);this.radius=n.EarthMath2.Distance(o.left,o.top,o.right,o.bottom)*.5;this.Ay=this.AM._isOverlayAnnoEnabled()},t.prototype.addSub=function(n){this.Vh.push(n)},t.prototype.enumSubs=function(){return this.Vh},Object.defineProperty(t.prototype,"handle",{get:function(){return this.OO},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isReadyForDraw",{get:function(){return this.To},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"patch",{get:function(){return this.Xc},enumerable:!1,configurable:!0}),t.prototype.loadData=function(){if(this.texture||(this.texture=this.AM.loadTexture(this.OO,!this.BAC)),this.texture){var n=this.OO;this.Xc||this.Vs.loadPatch(n)}this.AQ();this.BAC=!0},t.prototype.prepareData=function(){var t,n;this.texture&&(t=this.OO,this.Xc||(this.Xc=this.Vs.accessPatch(t)),this.Xc&&(n=this.texture,n&&!n.isReady&&n.prepareTexture(),this.BAF()))},t.prototype.bindingDrawingData=function(){this.texture||(this.texture=this.AM.accessTexture(this.OO));var n=this.texture&&this.texture.isReady;n&&!this.Xc&&(this.Xc=this.Vs.accessPatch(this.OO));this.To=n&&!!this.Xc;this.To&&(this.BAC=!1);this._isNeedToLoad=!this.texture||!this.Xc;this._isNeedToPrepare=!this.To;this.An()},t.prototype.AQ=function(){this.Ay&&(this.overlayTextures?this.overlayTextures.load():this.overlayTextures=this.AM.loadOverlayTexture(this.OO))},t.prototype.BAF=function(){if(this.Ay){var n=this.overlayTextures;n&&n.prepareTexture()}},t.prototype.An=function(){if(this.Ay){this.overlayTextures||(this.overlayTextures=this.AM.accessOverlayTexture(this.OO));var n=this.overlayTextures;n&&n.bindForRender();this._isNeedToLoad=this._isNeedToLoad||!n||n.isNeedLoad;this._isNeedToPrepare=this._isNeedToPrepare||!n||!n.isReady}},t.IsNodesReadyForDraw=function(n){if(n.length<=0)return!1;for(var t=0;t<n.length;t++)if(!n[t].To)return!1;return!0},t.prototype.toRenderChunk=function(n,t){var r=n||t?null:this.overlayTextures,i=this.patch.toRenderChunk(this.texture,r,!1,n);return i&&(i.isNoDepth=n,i.isToClearDepth=t,i._tempNode=this),i},t.prototype.checkAllSubsReadyForDraw=function(){return t.IsNodesReadyForDraw(this.Vh)},t.prototype.checkVisibleSubsReadyForDraw=function(){var t=this.Vh,n,i;if(t.length<=0)return!1;for(n=0;n<t.length;n++)if(i=t[n],!i.To&&i._isVisible)return!1;return!0},t}();n.TerrainIndexNode=t}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(t,i){this.renderContext=t;this.Yy=n.TerrainConst.MinDetailLevel;this.BCN=i;this.BAo()}return t.prototype.dispose=function(){this.At()},t.prototype.At=function(){this.BAu.clear();this.BCe.clear()},t.prototype.collectGabage=function(){this.BAu.collectGabage();this.BCe.collectGabage()},Object.defineProperty(t.prototype,"maxTerrainLevel",{get:function(){return this.Yy},set:function(n){this.Yy=Math.min(20,Math.max(0,n))},enumerable:!1,configurable:!0}),t.prototype.accessPatch=function(n){var t=this.BAJ(n.level);return t.accessObject(n,!1)},t.prototype.loadPatch=function(t){var u=this,f=this.accessPatch(t),r,i;if(!f){if(r=t.level,i=this.BCN,!i||n.TerrainConst._IsZeroHighLevel(r))this.Zb(t);else{if(!i.isReady)return;if(r>i.maxLevel){this.BAX(i.maxLevel,t);return}if(i.isAvailable(t)){i.isLoading(t)||i.loadPatchAsync(this,t).then(function(n){if(n){var i=u.BAJ(t.level);i.addObject(t,n)}});return}}this.Zb(t)}},t.prototype.Zb=function(t){var i=n.TerrainPatchFactory.CreateTriangleWithZeroHeight(this,t.level,t.x,t.y),r;i&&(r=this.BAJ(t.level),r.addObject(t,i))},t.prototype.BAX=function(n,t){var e;if(this.BCe.contains(t))return!1;var i=t.level,r=t.x,u=t.y,f=this.BCc(n,i,r,u);return f?(e=f.createSubPatch(i,r,u),this.BCe.addObject(t,e),!0):!1},t.prototype.BCc=function(t,i,r,u){var f=i<=t+4?t:i-1;var e=n.MathHelper.IntPowOfTwo(i-f),o=n.SystemHelper.ToInt(r/e),s=n.SystemHelper.ToInt(u/e),h=new n.QuadtreeHandle(f,o,s);return this.accessPatch(h)},t.prototype.BAo=function(){this.BAu=new n.ObjectCache(null,0);this.BAu.capacity=1024;this.BAu.disEnableTimeOutClear();this.BCe=new n.ObjectCache(null,0);this.BCe.capacity=1024;this.BCe.disEnableTimeOutClear()},t.prototype.BAJ=function(t){return n.TerrainConst._IsDetailLevel(t)?this.BCe:this.BAu},t.prototype.allocBuffer=function(t,i,r){var u=this.renderContext.graphics;return u.createElement(i,r,n.VertexPositionNormalTexture.VertexDeclaration)},t}();n.TerrainSurface=t}(Drawsee||(Drawsee={})),function(n){var t=function(){function n(n,t){this.handle=n;this.NV=[];this.BAT=[];this.BBI=[];t&&t.length>0&&(this.BAT=t,this.NV=new Array(t.length))}return Object.defineProperty(n.prototype,"textures",{get:function(){return this.BBI.length<=0?null:this.BBI},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isReady",{get:function(){return this.HT},enumerable:!1,configurable:!0}),n.prototype.BAG=function(){var i,r,n,t;if(!this.HT){for(this.BBI=[],i=!0,r=this.NV,n=0;n<r.length;n++)t=r[n],t&&t.isReady?this.BBI.push(t):i=!1;this.HT=i}},Object.defineProperty(n.prototype,"isNeedLoad",{get:function(){for(var t=this.NV,n=0;n<t.length;n++)if(!t[n])return!0;return!1},enumerable:!1,configurable:!0}),n.prototype.load=function(){for(var t=this.NV,n=0;n<t.length;n++)t[n]||(t[n]=this.BAT[n].loadTexture(this.handle))},n.prototype.prepareTexture=function(){for(var n,i=this.NV,t=0;t<i.length;t++)n=i[t],n&&!n.isReady&&n.prepareTexture()},n.prototype.bindForRender=function(){for(var t=this.NV,n=0;n<t.length;n++)t[n]||(t[n]=this.BAT[n].accessTexture(this.handle));this.BAG()},n.MaxCount=4,n}(),i;n.AsyncTextureCollection=t;i=function(){function i(t){var i=this;this.BCA=[];this.RA=t;this.GX=t.renderContext;this.BCp=new n.ObjectCache(null,0);this.BCp.capacity=1024;t.imageProviders.onAdd.add(function(n){i.Ag(n)});t.imageProviders.onRemove.add(function(n){i.BBv(n)})}return i.prototype.dispose=function(){this.BCH=n.SystemHelper.FreeDispose(this.BCH);this.BBC()},i.prototype.collectGabage=function(){var n,t;for(this.BCH.collectGabage(),this.BCp.collectGabage(),n=0;n<this.BCA.length;n++)t=this.BCA[n],t&&t.collectGabage()},i.prototype.open=function(t){return this.BCH=n.SystemHelper.FreeDispose(this.BCH),this.BCH=new n.CachedImageTileReader(this.GX.graphics,t),!0},i.prototype._isOverlayAnnoEnabled=function(){return this.BCA.length>0},i.prototype.Ag=function(t){if(t){var i=new n.CachedImageTileReader(this.GX.graphics,t);this.BCA.push(i)}},i.prototype.BBv=function(t){var i,r;if(t){for(i=0;i<this.BCA.length;i++)if(r=this.BCA[i],r.provider===t){this.BCA.splice(i,1);n.SystemHelper.FreeDispose(r);break}this.BCp.clear()}},i.prototype.BBC=function(){for(var i,t=0;t<this.BCA.length;t++)i=this.BCA[t],n.SystemHelper.FreeDispose(i);this.BCA=[]},i.prototype.accessTexture=function(n){return this.BCH.accessTexture(n)},i.prototype.loadTexture=function(n){var t=this.accessTexture(n),i;if(t)return t;this.BCH.loadTexture(n,i)},i.prototype.accessOverlayTexture=function(n){return this.BCp.accessObject(n)},i.prototype.loadOverlayTexture=function(n){var i,r;return this.BCA.length<=0?null:(i=this.accessOverlayTexture(n),i||(r=this.BCT(n),r.length>0&&(i=new t(n,r),i.load(),this.BCp.addObject(n,i))),i)},i.prototype.BCT=function(i){for(var r,u=[],e=n._EarthTilingTransform.XyToExtent(i.level,i.x,i.y),f=0;f<this.BCA.length;f++)if(r=this.BCA[f],r&&r.provider.isReady&&r.provider.isTileAvailableByExtent(i.level,e)&&(u.push(r),u.length>=t.MaxCount))break;return u},i}();n.TextureSurface=i}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i,r,u){var f=t.call(this,i,"")||this;return f.BAm=!1,f.Xd=!1,f.BAU=[],f.Am=[],f.BAB=[],f.BAs=!0,f.Ap=[],f.Vs=r,f.AM=u,f.BAk=new n.TerrainIndex(f,r,u),f.BAf=new n.TerrainPatchIndexCalc(f,f.BAk),f}return __extends(i,t),i.prototype.recycle=function(){return this.AM.collectGabage(),this.Vs.collectGabage(),!0},Object.defineProperty(i.prototype,"terrainCalculator",{get:function(){return this.BAf},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isRootNodesDrawn",{get:function(){return this.BAm},enumerable:!1,configurable:!0}),i.prototype.isRendering=function(){return this.Xd},i.prototype.BAi=function(n){var t=this.BAk.updateIndex(n);t&&(this.AN(),this.updateContents(n),this.BAf.updatePatchIndex())},i.prototype.AN=function(){var f=this,r=this.BAk,e,t,i,u;for(this.Aa=Math.max(0,r._leafLevel-3),this.BAq=Math.min(10,Math.max(0,r._leafLevel-8)),this.BAH=Math.max(0,this.BAq-3),e=this.renderContext.camera.worldEye,t=r.enumNodes(),i=0;i<t.length;i++)u=t[i],u._tempDis=n.Vector3.DistanceSquared(u.worldCenter,e);t.sort(function(t,i){return t.level===i.level?n.g_compareTo(t._tempDis,i._tempDis):n.g_compareTo(t.level,i.level)});this.BAU=t;this.Am=t.filter(function(n){return n.level===f.BAH});this.BAB=t.filter(function(n){return n.level===f.BAq});this.Ap=[]},i.prototype.registerDataTask=function(n){var i,r,u,t;for(this.BAs=!this.earthViewer._hasTerrainProvider,this.BAi(n),i=this.BAU,i=this.BAs?this.BAP(i):this.BAa(i),r=i.filter(function(n){return n._isNeedToLoad}),t=0;t<r.length;t++)r[t].loadData();for(u=i.filter(function(n){return n._isNeedToPrepare}),t=0;t<u.length;t++)u[t].prepareData()},i.prototype.Az=function(){var t=[];return n.TerrainIndexNode.IsNodesReadyForDraw(this.BAB)?t=this.BAB:n.TerrainIndexNode.IsNodesReadyForDraw(this.Am)&&(t=this.Am),t},i.prototype.BAa=function(n){for(var t,o=this.Aa,s=this.BAq,i=[],u=[],f=[],e=[],r=0;r<n.length;r++)t=n[r],t.level<=s?i.push(t):t.level<=o?t._isVisible?i.push(t):u.push(t):t._isVisible?f.push(t):e.push(t);return i.concat(f).concat(u).concat(e)},i.prototype.BAO=function(){var r=[],t=this.Az(),u,f,n,i,e,o;if(t.length<=0)return r;for(u=[],n=0;n<t.length;n++)this.BAc(t[n],!0,u);for(f=t.concat(u),n=0;n<f.length;n++)(i=f[n],i.isReadyForDraw)&&(e=i.level<=this.BAq,o=i.toRenderChunk(e,!1),r.push(o));return r},i.prototype.BAc=function(n,t,i){var f=n.checkVisibleSubsReadyForDraw(),u,r;if(t?i.push(n):!f&&n.isReadyForDraw&&i.push(n),f||n.level<this.Aa)for(u=n.enumSubs(),r=0;r<u.length;r++)this.BAc(u[r],!1,i)},i.prototype.BAP=function(n){for(var t,r=this.Aa,s=this.BAq,u=[],f=[],e=[],o=[],i=0;i<n.length;i++)t=n[i],t.level<=s?u.push(t):t._isVisible&&(t.level===r?e.push(t):t._isLeaf?f.push(t):t.level>r&&o.push(t));return u.concat(e).concat(f).concat(o)},i.prototype.WH=function(){for(var n,i=this.BAQ(),r=[],t=0;t<i.length;t++)if(n=i[t],n.isReadyForDraw){var u=n.level<=this.BAq,f=!n._isLeaf,e=n.toRenderChunk(u,f);r.push(e)}return r},i.prototype.BAQ=function(){var i=this.Az(),t,n;if(i.length<=0)return[];var e=this.BAq,o=this.Aa,s=this.BAk._leafLevel,r=this.BAU,u=[],f=[];for(t=0;t<r.length;t++)(n=r[t],n.level<e)||(n._isLeaf&&n.isReadyForDraw?f.push(n):n.level===o&&this.BAE(n,s,u));return i.concat(u).concat(f)},i.prototype.BAE=function(n,t,i){var u,r;if(n.level===t-1){n.isReadyForDraw&&!n.checkVisibleSubsReadyForDraw()&&i.push(n);return}if(n.checkVisibleSubsReadyForDraw())for(u=n.enumSubs(),r=0;r<u.length;r++)this.BAE(u[r],t,i);else n._isVisible&&n.isReadyForDraw&&i.push(n)},i.prototype._checkRootNodesReady=function(){if(this.BAg)return!0;this.BAS?n.SystemTime.Now()-this.BAS>100&&(this.BAg=!0):this.Az().length>0&&(this.BAS=n.SystemTime.Now())},i.prototype.updateContents=function(){for(var n,i=this.BAU,t=0;t<i.length;t++)i[t].bindingDrawingData();return this.BAm=!1,n=[],n=this.BAs?this.WH():this.BAO(),n.length>0&&(this.renderContext.graphics.terrainChunkRender.addTerrainChunks(n),this.Ap=this.BAp(n),this.BAm=!0,this.Xd=!0),!0},i.prototype.drawContents=function(){var n=this.renderContext;return n.camera._transformLocalWorld(),n.graphics.terrainChunkRender.setting.lightDirection=n.lightDirection,n.graphics.terrainChunkRender.render(n.camera.worldCamera),!0},i.prototype.getLeafNodesForCalc=function(){return this.Ap},i.prototype.BAp=function(n){for(var t,i,u=[],r=0;r<n.length;r++)t=n[r],i=t._tempNode,i&&i.isReadyForDraw&&!t.isNoDepth&&!t.isToClearDepth&&u.push(i);return u},i}(n.Layer3);n.TerrainLayer=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(t){this.onReady=new n.Observable;this.Ao=new n.HashSet;this.BBr=new n.StringKeyDictionary;this.BER=new n.StringHashSet;this.BAy=n.StringHelper.RegulatePath(t)}return t.prototype.BCg=function(){this.BBr.clear()},Object.defineProperty(t.prototype,"isReady",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxLevel",{get:function(){return n.TerrainConst.MinDetailLevel},enumerable:!1,configurable:!0}),t.prototype.isAvailable=function(t){return t.level>n.TerrainConst.MinDetailLevel?!1:!0},t.prototype.isLoading=function(n){var t=this.BDg(n);return this.Ao.contains(t)},t.prototype.loadPatchAsync=function(n,t){var i=this;return new Promise(function(r){var f,u;i.XP(t)?(f=i.BEI(n,t),r(f)):(u=i.BDg(t),i.Ao.add(u),i.BCf(n,t).then(function(n){r(n);i.Ao.remove(u)}))})},t.prototype.BCf=function(t,i){var r=this;return new Promise(function(u){var o,f,e,s;if(r.BBr.containsKey(i.hashKey())){o=r.BEI(t,i);u(o);return}if(f=r.BDg(i),e=r.BCb(f.level,f.x,f.y),r.BER.contains(e)){u(null);return}n.AsyncRenderContext.IsLoading(e)||(s=void 0,n.AsyncRenderContext.LoadData(n.AsyncDataLoadType.ArrayBuffer,e,s).then(function(n){var o=null;n&&(n.isBadUrl?r.BDA(e,i.level):n.data&&(r.BBU(f,n.data),o=r.BEI(t,i)));u(o)}))})},t.prototype.XP=function(n){return this.BBr.containsKey(n.hashKey())},t.prototype.BBU=function(t,i){var e,u,r,f;for(this.BBr.count>128&&this.BBr.clear(),e=n.TerrainPatchFactory.ExtractPatchHeightsData(i),u=0;u<e.length;u++)r=e[u],f=new n.QuadtreeHandle(r.level,r.xIndex,r.zIndex),f=this.BBu(f),this.BBr.add(f.hashKey(),r.data)},t.prototype.BEI=function(t,i){var r=i.hashKey(),u=this.BBr.getValue(r);return(this.BBr.remove(r),u)?n.TerrainPatchFactory.CreateFromBytes(t,u,i):null},t.prototype.BDK=function(t){var i=t.level,u=t.x,r=t.y;return r=(1<<i)-r-1,i=i-1,new n.QuadtreeHandle(i,u,r)},t.prototype.BBu=function(t){var i=t.level,u=t.x,r=t.y;return i=i+1,r=(1<<i)-r-1,new n.QuadtreeHandle(i,u,r)},t.prototype.BDg=function(t){t=this.BDK(t);var i=n.SystemHelper.ToInt(t.x/2),r=n.SystemHelper.ToInt(t.y/2);return new n.QuadtreeHandle(t.level,i,r)},t.prototype.BCb=function(t,i,r){var u=n.SystemHelper.ToInt(i/32),f=n.SystemHelper.ToInt(r/32),e=r*32+i;return this.BAy+(20-t)+"_"+u+"_"+f+"/"+e+".xz"},t.prototype.BDA=function(n){this.BER.add(n)},t}(),i;n.DrawseeTerrainProvider=t;i=function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t}(t);n.TerrainProvider=i}(Drawsee||(Drawsee={})),function(n){function t(n){return n>>1^-(n&1)}function f(i,r,u){for(var h=i.length,e=0,o=0,s=0,f=0;f<h;++f)e+=t(i[f]),o+=t(r[f]),i[f]=e,r[f]=o,n.defined(u)&&(s+=t(u[f]),u[f]=s)}function o(n,t,i,r){return n>=e?new Uint32Array(t,i,r):new Uint16Array(t,i,r)}var e=65536,i=function(){function n(n,t){this.verts=n;this.triangles=t;this.triangleCount=t.length}return n}(),r,u;n.TerrainPatchTriangleData=i;r=function(){function n(n,t,i,r,u,f){this.indices=n;this.xs=t;this.zs=i;this.heights=r;this.minHeight=u;this.maxHeight=f}return n}();u=function(){function t(){}return t.CreatePatchData=function(t,r){var u=0,tt=3,st=tt+1,w=Float64Array.BYTES_PER_ELEMENT*tt,ht=Float64Array.BYTES_PER_ELEMENT*st,ct=Uint16Array.BYTES_PER_ELEMENT*3,b=3,c=Uint16Array.BYTES_PER_ELEMENT,it=c*b,e=new DataView(t),wt=new n.Vector3(e.getFloat64(u,!0),e.getFloat64(u+8,!0),e.getFloat64(u+16,!0)),rt,ut,ft,lt,at,s,l,k,h,d,et,a,g,v,y,nt,p,ot;u+=w;rt=e.getFloat32(u,!0);u+=Float32Array.BYTES_PER_ELEMENT;ut=e.getFloat32(u,!0);u+=Float32Array.BYTES_PER_ELEMENT;ft=e.getFloat64(u+w,!0);lt=n.VectorHelper.CreateBoundingSphere(new n.Vector3(e.getFloat64(u,!0),e.getFloat64(u+8,!0),e.getFloat64(u+16,!0)),ft);u+=ht;at=new n.Vector3(e.getFloat64(u,!0),e.getFloat64(u+8,!0),e.getFloat64(u+16,!0));u+=w;s=e.getUint32(u,!0);u+=Uint32Array.BYTES_PER_ELEMENT;l=new Uint16Array(t,u,s*3);u+=s*ct;s>65536&&(c=Uint32Array.BYTES_PER_ELEMENT,it=c*b);var vt=l.subarray(0,s),yt=l.subarray(s,2*s),pt=l.subarray(s*2,3*s);for(f(vt,yt,pt),u%c!=0&&(u+=c-u%c),k=e.getUint32(u,!0),u+=Uint32Array.BYTES_PER_ELEMENT,h=o(s,t,u,k*b),u+=k*it,d=0,et=h.length,a=0;a<et;++a)g=h[a],h[a]=d-g,g===0&&++d;return v=this.BBG(h,l,rt,ut),y=this.BAw(v),r&&this.YJ(v,h,r),nt=[],p=this.AP(v,nt),p&&p.length>0&&(ot=n.TypeArrayHelper.JoinFloat32Arrays([y.data,p.data]),y=new n.Vertex3Array(ot),h=n.TypeArrayHelper.JoinInt32Arrays([h,n.Triangle3.ToIndexArray(nt)])),new i(y,new n.Triangle3Array(h))},t.BBG=function(n,t,i,u){for(var e=t.length/3,o=t.subarray(0,e),s=t.subarray(e,2*e),h=t.subarray(2*e,3*e),c=1/32767,l=64*c,a=(u-i)*c,f=0;f<e;f++)o[f]=Math.floor(o[f]*l+.001),s[f]=Math.floor(s[f]*l+.001),h[f]=h[f]*a+i;return new r(n,o,s,h,i,u)},t.BAw=function(t){for(var f=t.xs,e=t.zs,h=t.heights,o=f.length,s=n.Vertex3Array.Create(o),u=s.data,r=0,i=0;i<o;i++)u[r]=f[i],u[r+1]=h[i],u[r+2]=e[i],u[r+6]=f[i]/64,u[r+7]=1-e[i]/64,r+=8;return s},t.YG=function(t){function u(n){for(var i=[],t=0;t<n.length;t++)i.push(n[t].y);return i}for(var l=t.xs,a=t.zs,v=l.length,f=[],e=[],o=[],s=[],i=0;i<v;i++){var h=l[i],c=a[i],r=new n.Vector3(h,i,c);h===0&&f.push(r);h===64&&e.push(r);c===64&&s.push(r);c===0&&o.push(r)}return f.sort(function(t,i){return-n.g_compareTo(t.z,i.z)}),e.sort(function(t,i){return n.g_compareTo(t.z,i.z)}),s.sort(function(t,i){return-n.g_compareTo(t.x,i.x)}),o.sort(function(t,i){return n.g_compareTo(t.x,i.x)}),{westIndices:u(f),eastIndices:u(e),southIndices:u(o),northIndices:u(s)}},t.AP=function(t,i){var o=this.YG(t),r=[],u;this.BBc(t,o.westIndices,r,i);this.BBc(t,o.eastIndices,r,i);this.BBc(t,o.northIndices,r,i);this.BBc(t,o.southIndices,r,i);var s=r.length,h=n.Vertex3Array.Create(s),e=h.data,f=0;for(u=0;u<s;u++)e[f]=r[u].x,e[f+1]=r[u].y,e[f+2]=r[u].z,e[f+6]=r[u].x/64,e[f+7]=1-r[u].z/64,f+=8;return h},t.BBc=function(t,i,r,u){for(var e,y=t.xs,p=t.zs,w=t.heights,b=Math.max(50,(t.maxHeight-t.minHeight)*.25),h=t.xs.length,c=r.length,l=i.length,f=0;f<l;f++)e=i[f],r.push(new n.Vector3(y[e],w[e]-b,p[e]));for(f=0;f<l-1;f++){var a=i[f],k=i[f+1],d=h+c+f,v=h+c+1+f,o=new n.Triangle3,s=new n.Triangle3;o.v0=a;s.v0=a;o.v1=d;o.v2=v;s.v1=v;s.v2=k;u.push(o);u.push(s)}},t.YJ=function(n,t,i){for(var u=n.xs,f=n.zs,e=n.heights,r=0;r<u.length;r++)i.setAt(u[r],f[r],e[r]);this.BBj(n,t)||this.BCi(n,t,i)},t.BBj=function(){return!1},t.BCi=function(t,i,r){var h=this.BCM,c=this.BBq,l,f,e,o,u,s;for(h.fill(n.HeightGrid.NULL_VALUE),c.fill(n.HeightGrid.NULL_VALUE),l=Math.floor(i.length/3),u=0;u<l;u++)this.BAM(t,r,h,c,i,u);for(f=0;f<=64;f++)for(e=0;e<=64;e++)this.BBl(t,r,i,this.BCM,f,e);for(o=r.data,u=0;u<o.length;u++)s=o[u],s<0&&s!==n.HeightGrid.NULL_VALUE&&(o[u]=-s)},t.BAM=function(t,i,r,u,f,e){for(var o,tt,h,c=t.xs,l=t.zs,a=e*3,d=f[a],g=f[a+1],nt=f[a+2],v=c[d],y=c[g],p=c[nt],w=l[d],b=l[g],k=l[nt],it=Math.min(v,Math.min(y,p)),rt=Math.max(v,Math.max(y,p)),ut=Math.min(w,Math.min(b,k)),ft=Math.max(w,Math.max(b,k)),s=it;s<=rt;s++)for(o=ut;o<=ft;o++)(tt=i.getAt(s,o),tt>=0)||(h=n.Math2.SquareDistance(s,o,v,w)+n.Math2.SquareDistance(s,o,y,b)+n.Math2.SquareDistance(s,o,p,k),r.getAt(s,o)<0?(r.setAt(s,o,e),u.setAt(s,o,h)):h<u.getAt(s,o)&&(r.setAt(s,o,e),u.setAt(s,o,h)))},t.BBl=function(t,i,r,u,f,e){var k=i.getAt(f,e),o;if(!(k>=0)&&(o=u.getAt(f,e),!(o<0))){var s=o*3,h=r[s],c=r[s+1],l=r[s+2],a=t.xs,v=t.zs,y=t.heights,d=y[h],g=y[c],nt=y[l],tt=a[h],it=a[c],rt=a[l],ut=v[h],ft=v[c],et=v[l],p=1/n.Math2.SquareDistance(f,e,tt,ut),w=1/n.Math2.SquareDistance(f,e,it,ft),b=1/n.Math2.SquareDistance(f,e,rt,et),ot=(d*p+g*w+nt*b)/(p+w+b);i.setAt(f,e,ot)}},t.BCM=new n.HeightGrid,t.BBq=new n.HeightGrid,t}();n.QuantizedMeshTerrainData=u}(Drawsee||(Drawsee={})),function(n){var i=function(){function i(i){var r=this;this.onReady=new n.Observable;this.BBd=new n.HashSet;this.Ou=new t(i,function(){r.onReady.notifyObservers(r)})}return Object.defineProperty(i.prototype,"extent",{get:function(){return this.Ou.info.extent},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isReady",{get:function(){return this.Ou.info.ready},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxLevel",{get:function(){return this.Ou.info.maximumLevel},enumerable:!1,configurable:!0}),i.prototype.isAvailable=function(n){return this.Ou.info.getTileDataAvailable(n)},i.prototype.isLoading=function(n){return this.BBd.contains(n)},i.prototype.loadPatchAsync=function(t,i){var r=this;return new Promise(function(u){r.BBd.add(i);r.Ou.requestTileData(i).then(function(f){var e=null;e=f?new n.TerrainPatch(t,i.level,i.x,i.y,f.verts,f.triangles,f.triangleCount,f.heightGrid,!1):n.TerrainPatchFactory.CreateTriangleWithZeroHeight(t,i.level,i.x,i.y);u(e);r.BBd.remove(i)})})},i}(),t;n.CesiumTerrainProvider=i;t=function(){function t(t,i){this.Dm=new n._TileSourceInfo(t,undefined,function(){i&&i()})}return Object.defineProperty(t.prototype,"info",{get:function(){return this.Dm},enumerable:!1,configurable:!0}),t.prototype.requestTileData=function(t){var i=this;return new Promise(function(r){if(!i.Dm.ready){r(null);return}var u=i.Dm.prepareLayersToUse(t),f=i.prepareTileResource(t,u);n.AsyncWebStream.ReadDirectUint8Array(f.url).then(function(u){var o=u.buffer,f=null,e;if(n.defined(i.Dm.heightmapStructure))throw new n.DeveloperError("not support heightmap format terrain data");else t.level===i.Dm.maximumLevel&&(e=new n.HeightGrid),f=n.QuantizedMeshTerrainData.CreatePatchData(o,e);f&&(f.heightGrid=e);r(f)})})},t.prototype.prepareTileResource=function(t,i){var r,s;if(!n.defined(i),r=i.tileUrlTemplates,r.length===0)return undefined;var f=t.level,e=t.x,o=t.y,u;this.Dm.scheme&&this.Dm.scheme!=="tms"?u=o:(s=this.Dm.tilingScheme.yCountOfLevel(f),u=s-o-1);var h=r[(e+u+f)%r.length],c=i.resource;return c.getDerivedResource({url:h,templateValues:{version:i.version,z:f,x:e,y:u}})},t}()}(Drawsee||(Drawsee={})),function(n){var r=function(){function n(n,t){this.bounds=n;this.levelToMatch=t}return n}(),t=function(){function t(){}return t.InterpolatePoints=function(t,i){for(var e,o,s=i/4,r=[],u=0;u<t.length-1;u++){var f=t[u],h=t[u+1],c=n.Vector3.Distance(f,h);if(c>s){var l=Math.floor(c/s)+1,a=1/l,v=h.subtract(f);for(e=0;e<l;e++)o=f.clone(),o.addInPlace(v.scale(e*a)),r.push(o)}else r.push(f)}return r.push(t[t.length-1]),r},t.CalculateBounds=function(t){var i=n.VectorHelper.CalcBoundingBox(t),u=i.radius,f=Math.min(this._Leaflevel,n._TerrainPatchLevelConst.GetFirstLevelLessRadius(u*.5));return new r(i,f)},t._Leaflevel=n.TerrainConst.MinDetailLevel+3,t}(),u=function(){function n(n,t){this.renderContext=n;this.worldPoints=t;this.Zj=new i(n,t,0,null)}return n.prototype.prepareGroundHeight=function(){return this.Zj.prepareGroundHeight()},n.prototype.getWorldClampPoints=function(){return this.Zj.getWorldClampPoints()},n.prototype.dispose=function(){this.Zj&&(this.Zj.dispose(),this.Zj=null)},n}(),i;n.GroundLine=u;i=function(){function i(t,i,r,u){this.renderContext=t;this.worldPoints=i;this.subLevel=r;this.rootNode=u;this.Xg=n.TerrainConst.RootLevel;this.ZZ=n.Vector3.Zero();this.ZF=n.Vector3.Zero();this.ZJ=!0;this.As=!1;this.Wc=n.TerrainConst.RootLevel;this.Aw=1;this.ZH()}return i.prototype.ZH=function(){var e=t.CalculateBounds(this.worldPoints),h,l,o,a,v,r,y;if(this.Db=e.bounds.radius,this.ZM=this.Db*this.Db,this.Zo=this.ZM*i.Yk,this.Xg=e.levelToMatch,this.XI=e.bounds.center,this.renderContext.camera.coordSystem.worldToEarthToRef(this.XI,this.ZZ),this.ZF.copyFrom(this.XI),!(this.Xg>=t._Leaflevel)&&!(this.subLevel>=4)){this.FW=[];var c=e.bounds.radius/4,s=t.InterpolatePoints(this.worldPoints,c),f=[],u=[];for(u.push(s[0]),h=u[0],l=this.rootNode?this.rootNode:this,r=1;r<s.length;r++)o=s[r],u.push(o),a=n.Vector3.Distance(h,o),a>c&&(f.push(u),u=[],u.push(o.clone()),h=u[0]);if(u.length>1)if(f.length>0)for(v=f[f.length-1],r=1;r<u.length;r++)v.push(u[r]);else f.push(u);for(r=0;r<f.length;r++)y=new i(this.renderContext,f[r],this.subLevel+1,l),this.FW.push(y)}},i.prototype.dispose=function(){this.rootNode=null;this.worldPoints=[];this.renderContext=null;this.XO()},i.prototype.XO=function(){var t=this.FW,n;if(t)for(n=0;n<t.length;n++)t[n].dispose();this.FW=null},i.prototype.XA=function(n){this.Zr=n;this.YP=!0;this.ZA=!0},i.prototype.AT=function(){var r,t,i,e;if(this.ZA){var u=this.renderContext,f=this.ZF,o=u.camera.worldEye;if(this.Zd=!1,this.OC=u.camera.worldCamera.isSphereInFrustum(f,this.Db),r=n.Vector3.DistanceSquared(f,o),this.AG=r,t=this.FW,this.OC&&t&&r<this.Zo)for(this.Zd=!0,i=0;i<t.length;i++)e=t[i],e.AT()}else this.OC=!0,this.Zd=!1},i.prototype.Au=function(){var r=!1,i=this.FW,n,t;if(i)for(n=0;n<i.length;n++)t=i[n],t.Au(),(t.As||t.ZJ)&&(r=!0);this.As=r},i.prototype.prepareGroundHeight=function(){if(!this.Ab())return!1;this.AT();var n=this.Yw();return n&&this.Au(),n},i.prototype.getWorldClampPoints=function(){return this.Zr},i.prototype.Ab=function(){if(!this.ZJ&&!this.As)return!1;if(!this.ZA)return!0;var t=this.renderContext,i=this.ZF,r=t.camera.worldEye,u=n.Vector3.DistanceSquared(i,r);return u<this.ZM*16*this.Aw},i.prototype.Yw=function(){var u,n,r,t,i;if(!this.OC||!this.ZJ&&!this.As)return!1;if(u=this.AG,n=!1,this.ZA?this.ZJ&&!this.VU&&(r=void 0,r=this.FW?this.subLevel===0?4:16:64,u<this.ZM*r*this.Aw&&(n||(n=this.Ax()))):n||(n=this.Ax()),t=this.FW,t&&this.As&&this.Zd)for(i=0;i<t.length;i++)n||(n=t[i].Yw());return this.XZ(),n},i.prototype.Aq=function(){var t,i;this.Zz=!0;t=this.renderContext.camera.worldEye;this.Ah||(this.Ah=n.Vector3.Zero());this.Ah.copyFrom(t);i=this.renderContext.camera.eyeDistance;this.Zv=i*.001;this.Zv*=this.Zv},i.prototype.AC=function(){this.Zz=!1},i.prototype.Ax=function(){var i,t;if(!this.renderContext._earthTerrainCalculator||this.renderContext.terrainLeafLevel<=this.Wc&&this.ZA||this.Zz&&(n.SystemTime._IsTimer5k?this.AC():n.SystemTime._IsTimer1000&&n.Vector3.DistanceSquared(this.Ah,this.renderContext.camera.worldEye)>this.Zv&&this.AC(),this.Zz))return!1;var s=this.worldPoints,u=this.renderContext._earthTerrainCalculator,f=!1,e=new n.RefValue(0),r=new n.RefValue(0),o=this.ZZ;return u.calculateHeightAdvance(o.x,o.z,e,r,this.Wc)&&(r.value>this.Wc?(this.ZZ.y=e.value,this.renderContext.camera.coordSystem.earthToWorldToRef(this.ZZ,this.ZF),i=u.clampLine(s,0),i&&i.length>1&&(this.Wc=Math.max(r.value,this.Wc),this.XA(i),f=!0),this.AC()):this.Aq()),this.ZJ=this.Wc<this.Xg,this.ZJ&&(t=Math.max(0,this.Xg-this.Wc),t=n.MathHelper.IntPowOfTwo(t),t*=t,this.Aw=t),f},i.prototype.XZ=function(){var f=this.FW,i,e,t,r,o,s,u,h;if(f&&(i=new n.RefValue(!1),e=this.Ae(i),e||i.value)){if(e){for(t=[],r=0;r<f.length;r++)for(o=f[r],o.YP=!1,s=o.Zr,u=0;u<s.length;u++)t.push(s[u]);h=this.rootNode?this.rootNode.Db*1e-5:1;t=n.VectorHelper.FilterDuplicatedVector3(t,h);t&&t.length>1&&(this.VU=!0,this.XA(t))}i.value&&this.XO()}},i.prototype.Ae=function(n){var r=this.FW,u,f,i,t;if(!r)return!1;for(n.value=!0,u=!1,f=!0,i=0;i<r.length;i++)t=r[i],t.YP&&(u=!0),t.Zr||(f=!1),(t.ZJ||t.FW)&&(n.value=!1);return u&&f},i.Zt=3,i.Yk=i.Zt*i.Zt,i}()}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(t,i,r){this.Yl=new n.Vector3;this.Aj=-1;this.YU=[];this.AX=n.Matrix.Identity();this.GX=t;this.AE=i;this.AI=r;this.AJ=n.Rect.CalcRange(n.VectorHelper.ToVector2Array(i))}return t.prototype.dispose=function(){this.AU()},t.prototype.registerDataTask=function(){this.ZI();this._clampHeightRange||this.AA()},t.prototype.onUpdateDefineSpatialData=function(){this.AU();this.ZI()},t.prototype.getAnnoPosition=function(){return this.Yl},t.prototype.AA=function(){var i=this.GX,r;if(i.isEarthCoord){if(this.Aj>=n.TerrainConst.MinDetailLevel||this.Aj>=i.terrainLeafLevel)return}else if(this.Aj>=0)return;if(this.AJ){var t=this.AJ.center,u=new n.RefValue,f=new n.RefValue;i.terrainCalculator.calculateHeightAdvance(t.x,t.y,u,f)&&(r=u.value,this.Aj=f.value,this.Yl=new n.Vector3(t.x,r,t.y),this._onElevatinUpdate&&this._onElevatinUpdate(r))}},t.prototype.ZI=function(){var i,r,u,f;if(this.Oh)return!0;var n=this.GX,e=n.camera.coordSystem,t=this._clampHeightRange;if(!t&&(n._earthTerrainCalculator&&(n.terrainLeafLevel<6||!n._earthTerrainCalculator)||(t=n.terrainCalculator.calculateApproximateHeightRange(this.AJ),!this.ZS(t))))return!1;if(this.VF=this.AE[0].clone(),this.XM=e.earthToWorld(this.VF),this.Oh=this.AS(this.AE,t,this.XM,!1),i=this.AI,i&&i.length>0)for(r=0;r<i.length;r++)u=i[r],f=this.AS(u,t,this.XM,!0),this.YU.push(f);return!0},t.prototype.ZS=function(n){var t=n.y-n.x;return t<=0||this.GX.isEarthCoord&&n.y<t*.5?!1:!0},t.prototype.AS=function(t,i,r,u){var f;if(!t||t.length<=0)return null;var o=this.GX,c=o.camera.coordSystem,s=(i.y-i.x)*.1,e=n.ArrayHelper.CloneArray(t,!0),h=n.ArrayHelper.CloneArray(t,!0);for(f=0;f<e.length;f++)e[f].y=i.y+s,h[f].y=i.x-s;var l=n.PrimitivesFactory._CreateShadowVolumnPolyBox(e,h,u).positions,a=c.earthToWorldArray(l),v=n.VectorHelper.ToLocalVector3Array(a,r),y=n.MeshVertexData.Create(v);return new n.RenderMesh(o.graphics,y)},t.prototype.AU=function(){var n,t;for(this.Oh&&(this.Oh.dispose(),this.Oh=null),n=0;n<this.YU.length;n++)t=this.YU[n],t&&t.dispose();this.YU=[]},t.prototype.drawContents=function(n){return this.Oh?(this.AO(n),this.Zg(n),!0):!1},t.prototype.Wx=function(n){var u,t,r,e;if(this.Oh){u=this._material;t=this.GX;this.AB(t.camera.worldCenter,this.XM);var i=t.graphics,f=i.engine,o=f.getDepthWrite();if(n)for(u.bindWorldOnly(t.camera.worldCamera,this.AX),this.Oh.render(i,t.camera.worldCamera,null),r=0;r<this.YU.length;r++)e=this.YU[r],e&&e.render(i,t.camera.worldCamera,null);else f.setDepthWrite(!1),this.Oh.render(i,t.camera.worldCamera,u,this.AX.clone());f.setDepthWrite(o)}},t.prototype.AB=function(t,i){n.Matrix.TranslationToRef(i.x-t.x,i.y-t.y,i.z-t.z,this.AX)},t.prototype.AO=function(){var n=this.GX;n.graphics.engine.unbindAllTextures();n.graphics.enableVolumeBlendSrcPassOne(!0);this.Wx(!0);n.graphics.enableVolumeBlendSrcPassTwo(!0);this.Wx(!0);n.graphics.enableVolumeBlendSrcPassOne(!1)},t.prototype.Zg=function(){var n=this.GX;n.graphics.enableVolumeBlendTarget(!0);this._isFastClamp?this.Wx(!1):this.Ze(this._material);n.graphics.enableVolumeBlendTarget(!1)},t.prototype.Ze=function(t){var i,u,f;if(this.AJ&&(i=this.GX,u=i.terrainCalculator.enumRenderChunks(this.AJ),!(u.length<=0))){var s=i.camera.worldCamera,o=s.center,r=i.graphics,h=r.engine,c=r.getNearObjectMode(),l=r.engine.getDepthWrite();for(r.setNearObjectMode(!0),h.setDepthWrite(!1),f=0;f<u.length;f++){var e=u[f],a=n.Matrix.Translation(-o.x,-o.y,-o.z),v=e.world.multiply(a);t.bindForRender(s,v);i.graphics.drawInternalElements(e.elmentBuffer.internalBuffer,e.indexStart,e.indexCount)}r.setNearObjectMode(c);h.setDepthWrite(l)}},t}();n._GroundPoly=t}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(t){this._isHighlightPickedObject=!0;this.BDc=!1;this.BFC=0;this.isEarthCoord=!1;this.terrainLeafLevel=0;this.Ha=t;this.backgroundColor=n.Color.Black;this.isEarthCoord=!0}return Object.defineProperty(t.prototype,"graphics",{get:function(){return this.Ha},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"coordSystem",{get:function(){return this.camera.coordSystem},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lightDirection",{get:function(){return this.BGU||(this.BGU=n.Drawing3DSetting.LightDirection),this.BGU},set:function(n){this.BGU=n.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projection",{get:function(){return this.BEy},enumerable:!1,configurable:!0}),t.prototype.setProjection=function(n){this.BEy=n},Object.defineProperty(t.prototype,"terrainCalculator",{get:function(){return this.BCx},enumerable:!1,configurable:!0}),t.prototype._setTerrainCalculator=function(n){this.BCx=n},Object.defineProperty(t.prototype,"_earthTerrainCalculator",{get:function(){return this.BGI},enumerable:!1,configurable:!0}),t.prototype._setEarthTerrainCalculator=function(n){this.BGI=n},t.prototype.beginFrame=function(){this.Ha.beginFrame();this.Ha.clear(this.backgroundColor,!0,!0,!0);this.camera._transformWorld();this.graphics.fontChunkRender.reset();this.graphics.fontChunkRender.getGlobalList().clear()},t.prototype.endFrame=function(){this.BEx();this.Ha.endFrame()},t.prototype.setupDefaultRenderState=function(){var t=this.graphics;t.isCulling=!0;t.engine.setDepthBuffer(!0);t.engine.setDepthWrite(!0);t.engine.setColorWrite(!0);t.setNearObjectMode(!1);t.setBlendingMode(n.BlendingMode.Opaque)},t.prototype.BEx=function(){this.graphics.fontChunkRender.renderOneList(this.camera.worldCamera,this.graphics.fontChunkRender.getGlobalList())},t.prototype.setForceNotDraw=function(t){this.BDc=!0;this.BFC=n.SystemTime._FrameNow()+t},t.prototype.getForceNotDraw=function(){if(!this.BDc)return!1;var t=n.SystemTime._FrameNow();return t>this.BFC&&(this.BDc=!1),this.BDc},t.prototype.clearForceNotDraw=function(){this.BDc=!1},t}();n.RenderContext3=t}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t,u,i,r,f,e;(function(n){n[n.None=0]="None";n[n.Pan=1]="Pan";n[n.TrackPoint=10]="TrackPoint";n[n.TrackLine=20]="TrackLine";n[n.TrackPoly=30]="TrackPoly";n[n.MeasureLength=120]="MeasureLength";n[n.MeasureArea=130]="MeasureArea"})(t=n.EarthToolType||(n.EarthToolType={}));u=function(){function i(){}return i.FromMapToolType=function(i){if(i<=n.MapToolType.TrackLine){if(i===n.MapToolType.TrackPoint)return t.TrackPoint;if(i===n.MapToolType.TrackLine)return t.TrackLine}return i===n.MapToolType.TrackPoly?t.TrackPoly:i===n.MapToolType.MeasureLength?t.MeasureLength:i===n.MapToolType.MeasureArea?t.MeasureArea:t.None},i}();n.EarthToolTypeHelper=u;i=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.isNeedRedraw=!1,t}return __extends(t,n),t}(n.EventArgs);n.EarthViewerRenderEvent=i;r=function(n){function t(t,i,r,u,f){var e=n.call(this)||this;return e.geoType=t,e.points=i,e.linePoints=r,e.areaPoints=u,e.callerInfo=f,e}return __extends(t,n),t}(n.EventArgs);n.EarthViewerTrackEventArgs=r;f=function(){function t(n,t,i){i===void 0&&(i=null);this.BAv=n;this.BDb=t;this.BDr=i}return t.prototype.setTerrainLayer=function(n){this.BDr=n},t.prototype.BES=function(){var n=[];return this.customTerrainCalculator&&n.push(this.customTerrainCalculator),this.BDb.getLayerCount()>0&&n.push(this.BDb),this.BAv.renderContext.isEarthCoord&&this.BDr&&n.push(this.BDr.terrainCalculator),n},t.prototype.calculateHitPosition=function(n,t,i){for(var u=this.BES(),r=0;r<u.length;r++)if(u[r].calculateHitPosition(n,t,i))return!0;return!1},t.prototype.calculateHeight=function(t,i){var r=new n.RefValue,u=new n.RefValue;return this.calculateHeightAdvance(t,i,r,u),r.value},t.prototype.calculateHeightAdvance=function(n,t,i,r,u,f){var o,e;for(u===void 0&&(u=0),o=this.BES(),e=0;e<o.length;e++)if(o[e].calculateHeightAdvance(n,t,i,r,u,f))return!0;return!1},t.prototype.clampLine=function(t,i){for(var r,f=this.BES(),u=0;u<f.length;u++)if(r=f[u].clampLine(t,i),r&&r.length>0)return r;return n.ArrayHelper.CloneArray(t)},t.prototype.clampPolygon=function(t,i){for(var r,f=this.BES(),u=0;u<f.length;u++)if(r=f[u].clampPolygon(t,i),r&&r.length>0)return r;return n.Math3.PolygonToTriangles(t,null)},t.prototype.calculateApproximateHeightRange=function(t,i,r){for(var f,e=this.BES(),u=0;u<e.length;u++)if(f=e[u].calculateApproximateHeightRange(t,i,r),!n.Math2.NearEqual(f,n.Vector2.Zero()))return f;return n.Vector2.Zero()},t.prototype.enumRenderChunks=function(t,i){for(var e,u=[],f=this.BES(),r=0;r<f.length;r++)e=f[r].enumRenderChunks(t,i),n.ArrayHelper.AddRange(u,e);return u},t}();e=function(u){function e(r,f){f===void 0&&(f=null);var e=u.call(this,r,f)||this;return e.onBeforeRender=new n.Observable,e.onAfterRender=new n.Observable,e.onMouseLeftButtonDoubleClick=new n.Observable,e.onMouseRightButtonDoubleClick=new n.Observable,e.onEnterObject=new n.Observable,e.onLeaveObject=new n.Observable,e.onClickObject=new n.Observable,e.onUnclickObject=new n.Observable,e.onTrackFinish=new n.Observable,e.isActive=!0,e.isTerrainVisible=!0,e.terrainZIndex=0,e.isNorthPointerVisible=!0,e.isStatusBarVisible=!0,e.BDS=new n.Rect,e.BDT=2,e.BDo=!1,e.AW="",e.BCh=new n.Vector3,e.BDY=[],e.ID=new n._MessageQueue,e.BEQ=!1,e.BEi=!1,e.BDQ=!0,e.isAxisVisible=!0,e.isRotationCenterVisible=!0,e.axisArrowRatio=.02,e.isAxisYZReverse=!1,e.BBX=new n.Color(.5,.5,.5,1),e.BDw=100,e.BEB=!0,e.BCY=t.Pan,e.Yy=n.TerrainConst.MaxDetailLevel,e.AD=new n.NameObjectList,e.BEL=[],e.BDx=new n.HashSet,e.BCv=[],e.isEnableMouseOverPick=!1,e.Se=!0,e.BAb=new n.Vector3,e.BDE=new n.Vector2,e.BEm=!1,e.BCk=new i,e.initializeComponent(),e.cursor=n.Cursor.Hand,e.BDj(),e.ID.attachUI(e,e.htmlUI),n._EarthViewerThreadingManager.Register(e),e}return __extends(e,u),e.prototype.initializeComponent=function(){var u=this,i=new n.Grid(null,this),t,r;i.name="gridMain";i.horizontalAlignment=n.HorizontalAlignment.Stretch;i.verticalAlignment=n.VerticalAlignment.Stretch;this.BDp=i;t=new n.Canvas(null,this.BDp);t.name="drawingSurface";t.horizontalAlignment=n.HorizontalAlignment.Stretch;t.verticalAlignment=n.VerticalAlignment.Stretch;this.BEe=t;this.BEe.onMouseLeftButtonDown.add(function(n){u.BDJ(n)});r=new n.Canvas(null,this.BDp);r.name="canvasScreen";r.margin=new n.Thickness(0,0,0,0);this.BEM=r;this.BDp.updateLayout()},e.prototype._isInitSuccess=function(){return this.BEi},e.prototype.BDj=function(){this.Ha=new n.Graphics3(this.BEe);this.BDF();this.BAY();this.BDM();this.BEO=new n.Map;this.BDz=new n.GeoMapRender(this.BEO);this.BEi=!0},e.prototype.BDF=function(){this.GX=new n.RenderContext3(this.Ha);this.BBW=new n._EarthViewerRender(this);this.BDG=new n._EarthViewerScreenManager(this);this.BBs=new n.EarthCentricCamera(this);this.BDZ=new n.NonEarthCentricCamera(this);this.BAZ(this.BBs)},e.prototype.BAZ=function(n){this.BCs=n;this.GX.camera=this.BCs;this.BEY&&this.BEY.setDefaultOper(this.BCs)},e.prototype.BAY=function(){this.BEP=new n.StencilHoleLayer(this);this.GX.stencilHoleManager=this.BEP;this.BAV=new n.Layer3Collection(this);this.BCS=new n.GroundLayer(this.GX);this.BCx=new f(this,this.BCS,null)},e.prototype.dispose=function(){this.BAV.clear();this.BDr&&(this.BDr.dispose(),this.BDr=null)},Object.defineProperty(e.prototype,"layoutRoot",{get:function(){return this.BDp},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isTerrainMouseHeightReady",{get:function(){return this.BEQ},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderContext",{get:function(){return this.GX},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"camera",{get:function(){return this.BCs},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"graphics",{get:function(){return this.Ha},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layers",{get:function(){return this.BAV},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"terrainCalculator",{get:function(){return this.BCx},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_isTerrainReady",{get:function(){return this.BDr&&this.BDr.isRendering()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_hasTerrainProvider",{get:function(){return!!this.BCN},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_canCalcTerrainHeight",{get:function(){return!!this.BCN||this.BCS.getLayerCount()>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxTerrainLevel",{get:function(){return this.Yy},set:function(n){this.Yy=n;this.Vs&&(this.Vs.maxTerrainLevel=Math.min(17,n))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"terrainRenderSetting",{get:function(){return this.renderContext.graphics.terrainChunkRender.setting},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEarthCoord",{get:function(){return this.renderContext.isEarthCoord},set:function(t){var i=this.renderContext.isEarthCoord;t!==i&&(t?(this.GX.isEarthCoord=!0,this.BAZ(this.BBs),this.renderContext.camera.setView(new n.Vector3(116,2e7,39),0,-90)):(this.GX.isEarthCoord=!1,this.BAZ(this.BDZ),this.renderContext.camera.setView(new n.Vector3(0,this.axisLength*4,0),45,-45)))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_isAllowUseCache",{get:function(){return n.AsyncWebStream.IsAllowUseCache},set:function(t){n.AsyncWebStream.IsAllowUseCache=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this.renderContext.backgroundColor},set:function(n){this.renderContext.backgroundColor=n},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clientRect",{get:function(){return this.BDS.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isNeedRedraw",{get:function(){return this.BDQ},enumerable:!1,configurable:!0}),e.prototype.AR=function(){this.BDQ=!0},e.prototype.BEK=function(){this.BDQ=!1},Object.defineProperty(e.prototype,"axisColor",{get:function(){return this.BBX},set:function(n){this.BBX=n;this.BBW.resetAxis()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"axisLength",{get:function(){return this.BDw},set:function(n){this.BDw=Math.max(1,n);this.BBW.resetAxis()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalScene",{get:function(){return this.BDR||(this.BDR=new n.BabylonLayer(this,"_globalSceneLayer",!0)),this.BDR.scene},enumerable:!1,configurable:!0}),e.prototype.open=function(t,i){var r=this;return t===void 0&&(t=null),i===void 0&&(i=null),this.BBx(),t||(t=n.SystemHelper.GetLocalHostIp().indexOf("drawsee.com")>=0?new n.TianDiTuImageProvider:new n.BingImageProvider),this.BCN=i,i&&i.onReady.add(function(t){if(t.extent&&r.camera.eye.y>1e7){var i=t.extent.center,u=Math.max(1e4,t.extent.width/n.EarthMath2.LongitudePerMeter(i.y)*.1);r.camera.setView(new n.Vector3(i.x,u,i.y),0,-45);r.redraw()}}),new Promise(function(n){r.BDu=function(){n(r)};r.BAW(i)&&(r.AM.open(t),r.BCK())})},e.prototype.BAW=function(t){return this.GX?(this.BDr&&(this.BDr.dispose(),this.BDr=null),this.Vs&&this.Vs.dispose(),this.AM&&this.AM.dispose(),this.Vs=new n.TerrainSurface(this.GX,t),this.Vs.maxTerrainLevel=this.Yy,this.AM=new n.TextureSurface(this),this.BDr=new n.TerrainLayer(this,this.Vs,this.AM),this.BCx.setTerrainLayer(this.BDr),!0):!1},e.prototype.BBx=function(){this.BCN=null},e.prototype.BCK=function(){this.BEB&&(this.BEB=!1,this.camera.setView(new n.Vector3(116,2e7,40),0,-90))},Object.defineProperty(e.prototype,"imageProviders",{get:function(){return this.AD},enumerable:!1,configurable:!0}),e.prototype._fireMouseLeftButtonDoubleClickedEvent=function(t){n.SystemHelper.FireEvent(this.onMouseLeftButtonDoubleClick,new n.MouseButtonEventArgs(t))},e.prototype._fireMouseRightButtonDoubleClickedEvent=function(t){n.SystemHelper.FireEvent(this.onMouseRightButtonDoubleClick,new n.MouseButtonEventArgs(t))},e.prototype._fireEnterObjectEvent=function(t,i){t&&n.SystemHelper.FireEvent(this.onEnterObject,new n.GeoObject3PickEventArgs(t,i,this.BDE))},e.prototype._fireLeaveObjectEvent=function(t,i){t&&n.SystemHelper.FireEvent(this.onLeaveObject,new n.GeoObject3PickEventArgs(t,i,this.BDE))},e.prototype._fireClickObjectEvent=function(t){t&&n.SystemHelper.FireEvent(this.onClickObject,t)},e.prototype._fireUnclickObjectEvent=function(t){t&&n.SystemHelper.FireEvent(this.onUnclickObject,t)},e.prototype._fireLastClickObjectEvent=function(){for(var n=0;n<this.BEL.length;n++)this._fireUnclickObjectEvent(this.BEL[n]);this.BEL=[];this.BEW&&this.BEW.geoObject&&this._fireClickObjectEvent(this.BEW);this.BEW=null},e.prototype._fireTrackerFinishEvent=function(i,u,f,e,o){var h=this.BCY;if(!(h===t.MeasureLength||h===t.MeasureArea)&&this.onTrackFinish){var s=this.renderContext.camera.coordSystem,c=s.worldToEarthArray(u),l=s.worldToEarthArray(f),a=s.worldToEarthArray(e);n.SystemHelper.FireEvent(this.onTrackFinish,new r(i,c,l,a,o))}this.setCurrentTool(t.Pan,null)},Object.defineProperty(e.prototype,"isHighlightPickedObject",{get:function(){return this.GX._isHighlightPickedObject},set:function(n){this.GX._isHighlightPickedObject=n},enumerable:!1,configurable:!0}),e.prototype.enumPickedObjects=function(){return n.ArrayHelper.CloneArray(this.BDx)},e.prototype.setPickedObject=function(n){var r,i,t;if(this.clearPickedObjects(),n instanceof Array)for(r=n,i=0;i<r.length;i++)t=r[i],t.isPicked=!0,this.BDx.add(t);n&&(t=n,t.isPicked=!0,this.BDx.add(t));this.BEg();this.redraw()},e.prototype.addPickedObject=function(n){this.BCr(n);this.BEg();this.redraw()},e.prototype.clearPickedObjects=function(){var n,t;if(this.BDx.count>0){n=this.BDx.getEnumerator();try{while(n.moveNext())t=n.current,t&&(t.isPicked=!1)}finally{n.dispose()}this.BDx.clear();this.BEg();this.redraw()}},e.prototype.BEg=function(){this.BCv=this.BDx.enumValues()},e.prototype.BCr=function(n){n&&(this.BDx.contains(n)?(n.isPicked=!1,this.BDx.remove(n)):(n.isPicked=!0,this.BDx.add(n)))},Object.defineProperty(e.prototype,"isPickable",{get:function(){return this.Se},set:function(n){this.Se=n},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mousePosition",{get:function(){return this.BAb.clone()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mouseScreenPosition",{get:function(){return this.BDE.clone()},enumerable:!1,configurable:!0}),e.prototype.BBb=function(t,i,r){r===void 0&&(r=!1);var u=this.renderContext.camera.coordSystem.screenToWorldLine(t),f=n.SystemHelper.CastObject(this.BAV.selectOne(u[0],u[1],i));return f&&r&&this.isEarthCoord&&this.BCx&&!this.BEG(i)?null:f},e.prototype._pickOneObjectAdvance=function(t,i,r){var s,h,c,f;if(!this.Se)return null;var l=new n.Vector3,u=n.SystemHelper.CastObject(this.BBb(t,l,!0)),o=this.renderContext.camera.coordSystem.worldToEarth(l),e=[];if(this.BDx.count>0)for(s=this.BCv,f=0;f<s.length;f++)h=s[f],h!==u&&e.push(h);if(this.setPickedObject(u),this.BEW=null,c=i&&(e.length>0||u&&this.BDx.contains(u)),c&&(this.BEW=new n.GeoObject3PickEventArgs(u,o,this.BDE),this.BEL=[],e.length>0))for(f=0;f<e.length;f++)this.BEL.push(new n.GeoObject3PickEventArgs(e[f],o,this.BDE));return r&&(this.isEnableMouseOverPick?(e.length>0&&(this._fireLeaveObjectEvent(e[0],o),this.BCt=null),u&&(this.BCt||this._fireEnterObjectEvent(u,o),this.BCt=u)):c&&this._fireLastClickObjectEvent()),this.BEW},e.prototype.BEG=function(n){var i=this.GX.camera.coordSystem.worldToEarth(n),t=this.mousePosition;return i.y-t.y>.1||this.renderContext.graphics.terrainChunkRender.setting.alpha!==1||this.GX.stencilHoleManager.hitOnHole(t.x,t.z)},e.prototype.pick=function(t,i,r){r===void 0&&(r=null);var f=new n.Vector2(t,i),u=n.Vector3.Zero(),e=this.BBb(f,u,!0);return r&&r.copyFrom(this.renderContext.camera.coordSystem.worldToEarth(u)),e},e.prototype.BBF=function(){return this.isEarthCoord&&this.renderContext.camera.eye.y>2e5},e.prototype.BDv=function(n){this.BCk.isNeedRedraw=!1;this.BEA(n);n&&(this.camera._transformLocalWorld(),this.graphics._processRenderTexture(),this.drawContents());this.BBD(n);this.BCk.isNeedRedraw&&this.redraw();this.Zp();this.BCl()},e.prototype.drawContents=function(){if(!this.GX.getForceNotDraw()&&this.BEc()){this.GX.beginFrame();this.BEa();this.GX.endFrame();var t=this.renderContext.camera,n=t.isMoving;this.BDG.drawOperPanel(this.BDS);this.BAV.hasAnimation()&&(n=!0);n?this.AR():this.BEK()}},e.prototype.BEa=function(){var t,i;this.isTerrainVisible&&this.BDr&&!this.BDr._checkRootNodesReady()||(this.BBW.init(this.Ha.getViewportRect(),this.isEarthCoord),t=new n.AsyncRenderableParam,this.BBW.drawAxis(),this.BEP.drawGroundHole(t),this.BDR&&(this.BDR.position=this.camera.center,i=this.renderContext.coordSystem.earthToLocal(this.camera.center,this.camera.eye),this.BDR.scene._forcedViewPosition=i),this.BBF()?(this.renderContext.graphics.terrainChunkRender.setting.isUseAtmosphere=this.renderContext.camera.eye.y>5e5,this.BDr&&this.BDr.isRootNodesDrawn&&this.BBW.drawAtmosphereRing(),this.BEH(t)):(this.renderContext.graphics.terrainChunkRender.setting.isUseAtmosphere=!1,this.BBW.drawSkyBall(),this.BEH(t)),this.BBW.drawTrackerResultEntity(this.BDY),this.BBW.drawMeasureResult(this.AW,this.BCh))},e.prototype.BET=function(t){var i;if(this.isTerrainVisible&&this.BDr){var r=new n.RefValue(0),u=new n.RefValue(0),f=new n.Color;this.BBW.calcFogParam(r,u,f);i=this.renderContext.graphics.terrainChunkRender.setting;i.isFogEnabled=!0;i.fogColor=f.clone();i.fogStart=r.value;i.fogEnd=u.value;this.renderContext.setupDefaultRenderState();this.BDr.drawContents(t)}},e.prototype.BEH=function(n){this.BAV.drawLayers(n,!0);this.BET(n);this.terrainZIndex<0&&this.graphics.clear(null,!1,!0,!1);this.BAV.drawLayers(n,!1)},e.prototype.BCX=function(){return new n.Rect(0,0,this.BEe.width,this.BEe.height)},e.prototype.BEc=function(){var u=n.SystemHelper.ToInt(this.BDS.width),f=n.SystemHelper.ToInt(this.BDS.height),i=this.BCX(),t=n.SystemHelper.ToInt(i.width),r=n.SystemHelper.ToInt(i.height);return t<=0||t<=0?!1:(t>0&&r>0&&(t!==u||r!==f)&&(this.BDS=i.clone()),!0)},e.prototype.redraw=function(){this.AR()},e.prototype.BDM=function(){this.BEY=new n._EarthViewerMainOper(this);this.BEY.setDefaultOper(this.BCs);this.BEV=new n.TerrainTracker(this);this.BEV.setTerrainCalculator(this.terrainCalculator)},e.prototype.BBm=function(t,i,r,u){r===void 0&&(r=null);u===void 0&&(u=!1);this.BDo=u&&t;i!==0&&(this.BDT=i);t&&this.BEV?(this.BEV.enableTracker(t,r),this.BEV.spaType=this.BDT,this.cursor=n.Cursor.Arrow,this.BEY.sonOper=this.BEV):(this.BEV.enableTracker(!1,null),this.BCy(),this.BEY.sonOper=null)},e.prototype.Zx=function(n){this.BCh=n.clone()},e.prototype.addTrackerResultObject=function(n,t){t===void 0&&(t="");this.BDY.push(n);this.BDo&&(this.AW=t,this.Zx(this.BAb))},e.prototype.BEX=function(){n.ArrayHelper.Clear(this.BDY);this.AW="";this.BEV&&this.BEV.setIsAreaDataDirty(!1)},e.prototype.BBk=function(t){var i,f,r,u;this.BDo&&(i=n.ArrayHelper.CloneArray(t.geometry.points),f=this.GX.camera.coordSystem,3===this.BDT?(r=n.ArrayHelper.CloneArray(i),r.length>0&&(this.AW=n.StringHelper.FormatAreaString(n.EarthMath3.Area(r),!0),this.Zx(this.BAb))):2===this.BDT&&(u=n.ArrayHelper.CloneArray(i),this.AW=n.StringHelper.FormatLengthString(n.EarthMath3.Length(u),!0),this.Zx(this.BAb)))},e.prototype._isHitOnCompass=function(n){return this.BDG.isHitOnCompass(this.isEarthCoord,this.BDS,n)},e.prototype.setCurrentTool=function(n,i){i===void 0&&(i=null);switch(n){case t.None:case t.Pan:this.BBm(!1,0);break;case t.TrackPoint:this.BBm(!0,1,i,!1);break;case t.TrackLine:this.BBm(!0,2,i,!1);break;case t.TrackPoly:this.BBm(!0,3,i,!1);break;case t.TrackLine:this.BBm(!0,2,i,!1);break;case t.MeasureLength:this.BBm(!0,2,i,!0);break;case t.MeasureArea:this.BBm(!0,3,i,!0)}this.BCY=n},e.prototype._isCurrentTool=function(n){return this.BCY===n},e.prototype.clearTrackerResult=function(){this.BEX()},e.prototype.BCl=function(){var t=n._EarthViewerLayoutHelper.GetMouseCoordString(this,this.BAb),i=n._EarthViewerLayoutHelper.GetEyePosString(this.renderContext,this.isEarthCoord);this.BDG.drawStausBar(t,i)},e.prototype.getTopMostUI=function(){return this.BEe},e.prototype._getScreenCanvas=function(){return this.BEM},e.prototype._getDrawingCanvas=function(){return this.BEe},e.prototype.BCy=function(){this.cursor=this.Se?n.Cursor.Arrow:n.Cursor.Hand},e.prototype.BDJ=function(){u.prototype.focus.call(this)},Object.defineProperty(e.prototype,"hasMouseButtonDown",{get:function(){return this.ID.hasButtonDown},enumerable:!1,configurable:!0}),e.prototype.setCustomTerrainCalculator=function(n){this.BCx.customTerrainCalculator=n},e.prototype.addGroundLayer=function(n){return this.BCS.addTerrainLayer(n),!0},e.prototype.clearGroundLayers=function(){this.BCS.clearTerrainLayers()},e.prototype.BEF=function(){if(!this.ID)return!1;var t=!1,n;do{if(n=this.ID.getNextMessage(),!n)break;this.BDn(n);t=this.BEY.handleMessage(n)}while(!n.isKeyDown);return t},e.prototype.BDn=function(t){var r=!1,u,i,f;t.mouseMsg===n.OperMouseMsgType.MouseMove?t.point.equals(this.BDE)||t.hasButtonDown||(r=!0,this.BDE=t.point.clone()):t.mouseMsg===n.OperMouseMsgType.LeftButtonDown&&(r=!0,this.BDE=t.point.clone());r&&(u=this.terrainCalculator,i=new n.Vector3,u&&u.calculateHitPosition(this.BDE.x,this.BDE.y,i)?(this.BAb=i,this.BEQ=!0):this.isEarthCoord?this.BEQ=!1:(f=this.GX.camera.coordSystem.screenToWorldLine(this.BDE),this.BDZ.calcSurfaceHitPoint(f[0],f[1],n.Drawing3DSetting.TerrainZeroBaseHeight,i),this.BAb=this.GX.camera.coordSystem.worldToEarth(i),this.BEQ=!1))},e.CaptureScreenshot=function(t){var i=n.WindowsHelper.CreateImage(),r=t._getDrawingCanvas().htmlCanvas;return i.src=r.toDataURL(),i},e.prototype.BEl=function(){if(this.BDu){var n=this.BDu;this.BDu=null;n()}},e.prototype.Zp=function(){!this.BEm&&this._isTerrainReady&&(this.BEl(),this.BEm=!0)},e.prototype.BEA=function(t){t&&this.onBeforeRender&&n.SystemHelper.FireEvent(this.onBeforeRender,this.BCk)},e.prototype.BBD=function(t){t&&this.onAfterRender&&n.SystemHelper.FireEvent(this.onAfterRender,this.BCk)},e.prototype.BDl=function(t,i){var r,u,f;if(!t.isTimeOut()&&(r=new n.AsyncRenderableParam,r.timer=t,!n.SystemTime._IsTimer1000||(this.BDr&&this.BDr.recycle(r),this.BAV.recycle(r),!t.isTimeOut()))){if(u=this.BDr&&n.SystemTime._IsTimer100,u&&this.BDr.registerDataTask(r),f=!u||this.BDV(),f&&this.BAV.registerDataTask(r),n.AsyncRenderContext.CommitLoadTasks(t),i&&n.SystemTime._IsTimer100&&(this.BDr&&(this.renderContext.graphics.terrainChunkRender.clear(),this.BDr.updateContents(r)),f&&this.BAV.updateContents(r)),t.isTimeOut()){if(this.BBo())return;if(!n.SystemTime._IsTimer200)return}n.AsyncRenderContext.CommitPrepareTasks(t)}},e.prototype.BDV=function(){return this.BDr&&this.BDr.isRootNodesDrawn},e.prototype.BBo=function(){return this.width<=0||this.height<=0},e.prototype._oneStep=function(){var t,i,u,r;this.isActive&&(n.Drawing3DSetting._Init(),n._B3dmData._InitDracoWorker(),this.GX._setTerrainCalculator(this.terrainCalculator),this.BDr&&this.GX._setEarthTerrainCalculator(this.BDr.terrainCalculator),this.Ha.updateGlobalVars(),t=e._ProcessTimeMax,this.camera.isPanStarted&&(t*=.5),this.BEF()&&this.redraw(),this.camera._updateCamera(),i=(this.isNeedRedraw||n.SystemTime._IsTimer200)&&!this.BBo(),this.BDv(i),u=new n.ProcessTimer(t*.5),r=new n.ProcessTimer(t*.5),this.BDl(u,i),n.AsyncProcess._CommitTasks(r,i),this.graphics._prepareDrawingData(r))},e._FogColor=new n.Color(.7,.8,.9,1),e._IsDevMode=!1,e._ProcessTimeMax=15,e}(n.UserControl);n.EarthViewer=e}(Drawsee||(Drawsee={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(n){function t(t){var i=n.call(this)||this;return i._earthViewer=t,i}return __extends(t,n),t}(n.OperationBase),i,r;n.EarthViewerOperationBase=t;i=function(t){function i(i){var r=t.call(this,i)||this;return r.BDI=0,r.BEJ=!1,r.BDh=!1,r.BCu=!1,r.BCz=!1,r.BDi=new n.Vector3,r.BEk=new n.Vector3,r.BDC=new n.Vector2,r.BBR=new n.Vector2,r.BGe=new n.Vector2,r.BFp=[],r.BFD=[],r.BDW=[],r.BFx=[],r.BAz=[],r.BCx=null,r.BEJ=!1,r.BDI=2,r.BDh=!1,r.BCz=!1,r.BCu=!1,r}return __extends(i,t),Object.defineProperty(i.prototype,"spaType",{get:function(){return this.BDI},set:function(n){this.BDI=n},enumerable:!1,configurable:!0}),i.prototype.onLeftButtonDown=function(t){if(!this.BDh||!this.BCx)return!1;if(this.BEJ=!1,this.BDC=t.point.clone(),this.BDi=this.BDW.length>1?this.BDW[this.BDW.length-1]:this.BEz(),this.BDh){if(this.BDI===0||1===this.BDI)return this.clearPointArrays(),this.BEJ=!0,!1;if(this.BCz){this.BFD.length<=0&&this.BDW.length>0&&this.BFD.push(this.BDW[0]);for(var i=1;i<this.BDW.length;i++)this.BFD.push(this.BDW[i]);n.ArrayHelper.Clear(this.BDW)}else this.clearPointArrays(),this.BCz=!0,this.Zl()}return this.BEk=this.BDi.clone(),this.BFp.push(this.BDi),!1},i.prototype.onLeftButtonDblClk=function(t){return this.BDh?this.BCx?this.BCz?(this.BDC=t.point.clone(),3===this.BDI?(this.BAz=n.SystemHelper.NewList(this.BCx.clampPolygon(this.BFp,0)),this.BCu=!0,this.BFN()):2===this.BDI&&(this.BFD=n.SystemHelper.NewList(this.BCx.clampLine(this.BFp,0))),this.BCz=!1,this.BEJ=!0,this._earthViewer._fireTrackerFinishEvent(this.BDI,this.BFp,this.BFD,this.BAz,this.BBO),!1):(1===this.BDI&&(this.clearPointArrays(),this.BFp.push(this.BEz()),this._earthViewer._fireTrackerFinishEvent(this.BDI,this.BFp,this.BFD,this.BAz,this.BBO)),!1):!1:!1},i.prototype.onMouseMove=function(t){var f,i,e,r,o,u;return this.BDh?this.BDh&&this._earthViewer.hasMouseButtonDown?!1:this.BCx?this.BCz?(this.BDC=t.point.clone(),this.BBR.x===t.point.x&&this.BBR.y===t.point.y)?!1:(this.BDi=this.BEz(),3===this.BDI&&this.BFp.length>0?(f=this.BCx,i=[],i.push(this.BEk),i.push(this.BDi),this.BDW=n.SystemHelper.NewList(f.clampLine(i,0)),e=this.BCx,r=[],r.push(this.BDi),r.push(this.BFp[0]),this.BFx=n.SystemHelper.NewList(e.clampLine(r,0)),this.BFP(!0)):2===this.BDI?(o=this.BCx,u=[],u.push(this.BEk),u.push(this.BDi),this.BDW=n.SystemHelper.NewList(o.clampLine(u,0)),this.BFP(!1)):1===this.BDI&&(n.ArrayHelper.Clear(this.BDW),this.clearPointArrays()),this.BBR=t.point.clone(),this._earthViewer.redraw(),!0):!1:!1:!1},i.prototype.onRightButtonDown=function(){return this.BDh?this.BCx?this.BCz?this.BFp.length<=0?!1:(n.ArrayHelper.Clear(this.BDW),n.ArrayHelper.Clear(this.BFD),this.BFp.length>1?(this.BFp.splice(this.BFp.length-1,1),this.BEk=this.BFp[this.BFp.length-1],this.BFD=n.SystemHelper.NewList(this.BCx.clampLine(this.BFp))):(n.ArrayHelper.Clear(this.BFp),this.BCz=!1),!0):!1:!1:!1},i.prototype.enableTracker=function(n,t){t===void 0&&(t=null);this.BBO=t;this.BDh=n;this.BEJ=!1;this.BCz=!1;this.clearPointArrays()},i.prototype.setTerrainCalculator=function(n){this.BCx=n},i.prototype.getCircleParam=function(n,t){return n.set(0,0,0),t.value=0,!0},i.prototype.BGh=function(){return n.ArrayHelper.CloneArray(this.BFp)},i.prototype.BGg=function(){var t=n.ArrayHelper.CloneArray(this.BFD);return n.ArrayHelper.AddRange(t,this.BDW),this.BDI===3&&n.ArrayHelper.AddRange(t,this.BFx),t},i.prototype.BFe=function(){return n.ArrayHelper.CloneArray(this.BAz)},i.prototype.clearPointArrays=function(){n.ArrayHelper.Clear(this.BFp);n.ArrayHelper.Clear(this.BFD);n.ArrayHelper.Clear(this.BDW);n.ArrayHelper.Clear(this.BFx);n.ArrayHelper.Clear(this.BAz)},i.prototype.isEnabled=function(){return this.BDh},i.prototype.isTrackFinish=function(){return this.BEJ},i.prototype.isTrackStarted=function(){return this.BCz},i.prototype.isAreaDataDirty=function(){return this.BCu},i.prototype.setIsAreaDataDirty=function(n){this.BCu=n},i.prototype.BEz=function(){var n=this._earthViewer.mousePosition;return this._earthViewer.renderContext.camera.coordSystem.earthToWorld(n)},i.prototype.Zl=function(){this._earthViewer.clearTrackerResult()},i.prototype.BFN=function(){var u=this.BFe(),i,t,r,f;u.length>=3&&(i=this._earthViewer.camera.coordSystem.worldToEarthArray(u),t=new n.PolyGeoObject(this._earthViewer.renderContext,this._earthViewer.camera.coordSystem.worldToEarthArray(this.BGh())),t.material.isUseLight=!1,t.material.color=new n.Color(1,1,0,.5),t.isClampToGround=!0,this._earthViewer.clearTrackerResult(),r=0,r=this._earthViewer.isEarthCoord?n.EarthMath3.Area(i):n.Math3.Area(i),f=n.StringHelper.FormatAreaString(r,!0),this._earthViewer.addTrackerResultObject(t,f))},i.prototype.BFP=function(t){var e=this.BGg(),i,r,u,f;e.length>=2&&(i=n.ArrayHelper.CloneArray(this._earthViewer.camera.coordSystem.worldToEarthArray(e)),i.length>=2&&(t&&i.length>2&&i.push(i[0]),r=new n.LineGeoObject(this._earthViewer.renderContext,i),r.material.color=new n.Color(1,0,0,.8),this._earthViewer.clearTrackerResult(),u="",f=0,f=this._earthViewer.isEarthCoord?n.EarthMath3.Length(i):n.Math3.Length(i),t||(u=n.StringHelper.FormatLengthString(f,!0)),this._earthViewer.addTrackerResultObject(r,u)))},i}(t);n.TerrainTracker=i;r=function(t){function i(n){return t.call(this,n)||this}return __extends(i,t),i.prototype.setDefaultOper=function(n){this.BEs=n},i.prototype.handleMessage=function(n){var i=t.prototype.handleMessage.call(this,n);return!i&&this.BEs?this.BEs.handleMessage(n):i},i.prototype.onMouseMove=function(n){return this._earthViewer.isEnableMouseOverPick&&this.BBz(n,!0),t.prototype.onMouseMove.call(this,n)},i.prototype.BBz=function(n,t){return this._earthViewer._pickOneObjectAdvance(n.point,!0,t)},i.prototype.onLeftButtonDown=function(i){if(this._earthViewer._isHitOnCompass(i.point)){var r=this._earthViewer.renderContext.camera,u=r.center;return r.setView(new n.Vector3(u.x,r.eyeDistance,u.z),0,r.pitch),this._earthViewer.redraw(),!0}return this.BDd=this.BBz(i,!1),t.prototype.onLeftButtonDown.call(this,i)},i.prototype.onLeftButtonUp=function(){return this.BDd&&(this._earthViewer._fireLastClickObjectEvent(),this.BDd=null),!1},i.prototype.onLeftButtonDblClk=function(n){var i=t.prototype.onLeftButtonDblClk.call(this,n);return this._earthViewer._fireMouseLeftButtonDoubleClickedEvent(n.point),i},i.prototype.onRightButtonDblClk=function(n){var i=t.prototype.onRightButtonDblClk.call(this,n);return this._earthViewer._fireMouseRightButtonDoubleClickedEvent(n.point),i},i.prototype.onKeyDown=function(n){return this.BEn(n)||t.prototype.onKeyDown.call(this,n)},i.prototype.BEn=function(t){var u=this._earthViewer.renderContext,i=t.keyCode,r;switch(i){case n._Key.D:if(t.isModifierKeyDown(n.ModifierKeys.Shift))return n.EarthViewer._IsDevMode=!n.EarthViewer._IsDevMode,n.EarthViewer._IsDevMode?(r=!0,r&&this.BFv()):n._g_hideDevMessage(),this._earthViewer.redraw(),!0;break;case n._Key.E:break;default:if(n.EarthViewer._IsDevMode&&this.BGG(i))return!0}return!1},i.prototype.BFv=function(){var i;if(n.EarthViewer._IsDevMode){var t=this._earthViewer,f=t.camera.center,r=t.camera.heading,e=t.camera.pitch;r>180&&(r=-(360-r));i=t.isEarthCoord?9:2;var u=t.mousePosition,o="mouse:\r\n("+u.x.toFixed(i)+", "+u.y.toFixed(2)+", "+u.z.toFixed(i)+")\r\n",s="camera:\r\n("+f.x.toFixed(i)+","+t.camera.eyeDistance.toFixed(2)+","+f.z.toFixed(i)+"),"+r.toFixed(1)+","+e.toFixed(1)+","+t.camera.baseCenterHeight.toFixed(1);n._g_showDevMessage(o+s)}},i.prototype.BGG=function(t){var r=!1,u=this._earthViewer.renderContext,f,i;return t===n._Key.W?(f=u.graphics.isWireFrameMode,u.graphics.isWireFrameMode=!f,r=!0):t===n._Key.C?this.BFv():t===n._Key.L&&(i=this._earthViewer,i.setCurrentTool(n.EarthToolType.TrackLine),i.onTrackFinish.addOnce(function(t){var r=t.linePoints,u,f;r&&r.length>0&&(u=i.isEarthCoord?9:2,f="points:\r\n"+n.StringHelper.FormatVector3Array(t.points,u,2),i.clearTrackerResult(),i.setCurrentTool(n.EarthToolType.None),n._g_showDevMessage(f))}),r=!0),r},i}(t);n._EarthViewerMainOper=r}(Drawsee||(Drawsee={})),function(n){var r=function(){function t(t){this.RA=t;this.GX=t.renderContext;this.BGY=new n.BasicMaterial(this.GX);this.BGY.isCulling=!1;this.BGY.isUseLight=!1;this.BGY.isFogEnabled=!0;this.BGY.color=new n.Color(.1,.15,.5,1);this.BGC=new i(this.GX)}return t.prototype.init=function(t,i){var r=0,u=0;i?(r=Math.max(Math.abs(this.GX.camera.eyeDistance)/100,1),u=Math.max(1e4,r*n.Drawing3DSetting.DepthBufferNearFarRatio)):(r=Math.max(.2,this.GX.camera.eyeDistance*.01),u=r*n.Drawing3DSetting.DepthBufferNearFarRatio);this.GX.camera.initViewport(t,n.MathHelper.ToRadians(40),r,u)},t.prototype.BBP=function(){return this.GX.isEarthCoord?Math.max(this.GX.camera.eye.y,3e3):Math.max(this.GX.camera.eyeDistance,1e3)},t.prototype.BFL=function(){var t=new n.RefValue(0),i=new n.RefValue(0),r=new n.Color;this.calcFogParam(t,i,r);this.BGY.setFogParam(t.value,i.value,n.EarthViewer._FogColor)},t.prototype.calcFogParam=function(t,i,r){var u=this.GX.camera.coordSystem;t.value=this.BBP();i.value=Math.max(5e4,t.value*50);r.copyFrom(n.EarthViewer._FogColor);t.value=t.value;i.value=i.value},t.prototype.drawAtmosphereRing=function(){if(this.GX.isEarthCoord&&!this.GX.graphics.isWireFrameMode){var t=this.GX,i=t.camera,r=t.graphics;i._transformWorld();t.setupDefaultRenderState();r.setBlendingMode(n.BlendingMode.Transparent);r.skyAtmosphereRender.render(i.worldCamera)}},t.prototype.drawSkyBall=function(){var n=this.GX,t=this.RA.isSkyVisible,r=n.isEarthCoord,u=t||r&&t===undefined,f,i;u&&(n.graphics.isWireFrameMode||(n.setupDefaultRenderState(),this.BFL(),f=this.GX.camera.coordSystem,i=this.BBP()*50,this.BGC.drawSkyBall(this.BGY,i,this.GX.isEarthCoord),n.setupDefaultRenderState()))},t.prototype.drawTrackerResultEntity=function(t){var i,e,f,r,u;if(t.length>0){for(i=this.GX,i.camera._transformLocalWorld(),i.setupDefaultRenderState(),i.graphics.setBlendingMode(n.BlendingMode.HalfTransparent),i.graphics.setNearObjectMode(!0),e=new n.ProcessTimer(10),f=new n.AsyncRenderableParam,r=0;r<t.length;r++)u=t[r],u.initFirstForDraw(),u.registerDataTask(f),u.drawContents(f);i.camera._transformLocalWorld();i.setupDefaultRenderState();i.graphics.setNearObjectMode(!1)}},t.prototype.drawMeasureResult=function(t,i){if(!!t){var r=this.GX.camera.worldCenter,u=this.GX.camera.coordSystem.earthToWorld(i);this.GX.graphics.fontChunkRender.getGlobalList().addTextChunk(u.subtract(r),t,n.Color.Yellow,0,0,!0)}},t.prototype.drawGroundHole=function(n,t){t.count>0&&(t.updateContents(n),t.registerDataTask(n),t.drawContents(n))},t.prototype.BFi=function(){var f;if(!this.BDO){var t=[],i=this.RA.axisLength,r=i*this.RA.axisArrowRatio,u=.71700000762939453,e=new n.Color(1,1,1,.4);n.ArrayHelper.Clear(t);t.push(new n.Vector3(0,0,0));t.push(new n.Vector3(i,0,0));t.push(new n.Vector3(i-u*r,0,u*r));t.push(new n.Vector3(i,0,0));t.push(new n.Vector3(i,0,0));t.push(new n.Vector3(i-u*r,0,-u*r));t.push(new n.Vector3(0,0,0));t.push(new n.Vector3(0,i,0));t.push(new n.Vector3(u*r,i-u*r,0));t.push(new n.Vector3(0,i,0));t.push(new n.Vector3(0,i,0));t.push(new n.Vector3(-u*r,i-u*r,0));t.push(new n.Vector3(0,0,0));t.push(new n.Vector3(0,0,i));t.push(new n.Vector3(u*r,0,i-u*r));t.push(new n.Vector3(0,0,i));t.push(new n.Vector3(0,0,i));t.push(new n.Vector3(-u*r,0,i-u*r));f=this.GX.camera.coordSystem.earthToWorldArray(t);this.BDO=new n.LineRenderMesh(this.GX,n.Vector3.Zero(),f,!0);n.ArrayHelper.Clear(t);t.push(new n.Vector3(-r,0,0));t.push(new n.Vector3(r,0,0));t.push(new n.Vector3(0,0,-r));t.push(new n.Vector3(0,0,r));f=this.GX.camera.coordSystem.earthToWorldArray(t);this.BEd=new n.LineRenderMesh(this.GX,n.Vector3.Zero(),f,!0)}},t.prototype.resetAxis=function(){this.BDO=null;this.BEd=null},t.prototype.drawAxis=function(){var t,c,i;if(!this.GX.isEarthCoord&&this.RA.isAxisVisible&&(this.BFi(),this.BDO)){this.GX.camera._transformWorld();this.BDO.draw(this.GX.graphics,this.GX.camera.worldCamera,this.RA.axisColor);this.RA.isRotationCenterVisible&&(t=this.GX.camera.worldCenter,c=n.Matrix.Translation(t.x,t.y,t.z),this.BEd.draw(this.GX.graphics,this.GX.camera.worldCamera,this.RA.axisColor,!0,c));this.GX.camera._transformLocalWorld();var r=this.RA.axisLength,u=0,f=this.RA.axisColor,e=this.GX.camera.center,o=this.GX.camera.coordSystem,s=void 0,h=void 0;this.RA.isAxisYZReverse?(s="z",h="y"):(s="y",h="z");i=this.GX.graphics.fontChunkRender.getGlobalList();i.addTextChunk(o.earthToWorld(new n.Vector3(r,0,0).subtract(e)),"x",f,0,u);i.addTextChunk(o.earthToWorld(new n.Vector3(0,r,0).subtract(e)),s,f,0,u);i.addTextChunk(o.earthToWorld(new n.Vector3(0,0,r).subtract(e)),h,f,0,u)}},t.prototype.BFX=function(n){n.texture=null;n.isVertexColorEnabled=!0},t.prototype.BFu=function(n){n.texture=null;n.isVertexColorEnabled=!1},t.SKY_HEIGHT=5e5,t}(),t,i;n._EarthViewerRender=r;t=function(){function t(){}return t.GetMouseCoordString=function(t,i){var s=t.isTerrainMouseHeightReady,r,f,o;if(t.isEarthCoord){if(!s)return"";var a=n.MathHelper.DegreeFromDegree(i.x),v=Math.abs(n.MathHelper.MinuteFromDegree(i.x)),y=Math.abs(n.MathHelper.FloatSecondFromDegree(i.x)),p=n.MathHelper.DegreeFromDegree(i.z),w=Math.abs(n.MathHelper.MinuteFromDegree(i.z)),b=Math.abs(n.MathHelper.FloatSecondFromDegree(i.z));n.EarthViewer._IsDevMode?(r="东经 "+i.x.toFixed(9)+" 北纬 "+i.z.toFixed(9),i.y>.5&&t._canCalcTerrainHeight&&(r+="  海拔 "+i.y.toFixed(2)+" 米")):(r="东经 "+a+"."+n.TString.FormatNumber(v,2)+"'"+n.TString.FormatNumber(y,2,3)+'"   北纬 '+p+"."+n.TString.FormatNumber(w,2)+"'"+n.TString.FormatNumber(b,2,3)+'"',i.y>.5&&t._canCalcTerrainHeight&&(r+="  海拔 "+i.y.toFixed(1)+" 米",i.y))}else{var h=i.x,c=i.y,e=i.z;t.isAxisYZReverse&&(c=i.z,e=i.y);r=s?"X: "+h.toFixed(3)+" 米 Y: "+c.toFixed(3)+" 米 Z: "+e.toFixed(3)+" 米":"X: "+h.toFixed(3)+" 米 Z: "+e.toFixed(3)+" 米"}if(n.EarthViewer._IsDevMode){var l=t.camera.center,u=t.camera.heading,k=t.camera.pitch;u>180&&(u=-(360-u));f=void 0;f=t.isEarthCoord?6:1;o=void 0;o="(  x: "+l.x.toFixed(f)+" dis: "+t.camera.eyeDistance.toFixed(1)+" z: "+l.z.toFixed(f)+" heading: "+u.toFixed(1)+" pitch: "+k.toFixed(1)+" height: "+t.camera.baseCenterHeight.toFixed(1)+" )";r+="  "+o}return r},t.GetEyePosString=function(n,t){if(t){var i=n.camera.eye.y/1e3;return i<10?"视点海拔: "+i.toFixed(3)+" 千米 ":"视点海拔: "+i.toFixed(1)+" 千米 "}return"视点高度: "+n.camera.eye.y.toFixed(1)+" 米"},t}();n._EarthViewerLayoutHelper=t;i=function(){function t(t){this.GX=t;this.BFw=this.BFg(this.GX.graphics,n.PrimitivesFactory.CreateSphere(2,32));this.BGP=this.BFg(this.GX.graphics,n.PrimitivesFactory.CreateBox(1))}return t.prototype.BFg=function(t,i){var r=n.MeshVertexData.ToVertexPositionNormalTexture(i);return t.createElement(r,i.indices,n.VertexPositionNormalTexture.VertexDeclaration,n.ElementType.Triangles)},t.prototype.BEo=function(n,t,i,r){t&&(i._lightDirection=n.lightDirection,i.bindForRender(n.camera.worldCamera,r),n.graphics.drawElements(t,-1,-1))},t.prototype.drawBox=function(t,i,r,u){var f=n.Matrix.Scaling(i,r,u);this.BEo(this.GX,this.BGP,t,f)},t.prototype.drawBall=function(t,i){var r=n.Matrix.Scaling(i,i,i);this.BEo(this.GX,this.BFw,t,r)},t.prototype.drawBallAdvance=function(t,i,r,u,f){var e=n.Matrix.Scaling(f,f,f).multiply(n.Matrix.Translation(i,r,u));this.BEo(this.GX,this.BFw,t,e)},t.prototype.drawSkyBall=function(t,i,r){var c=this.GX.camera.coordSystem,f=this.GX.camera.eye,e=c.earthToWorld(new n.Vector3(f.x,-i*.85,f.z)),o=this.GX.camera.worldEye,u=new n.Vector3(e.x-o.x,e.y-o.y,e.z-o.z),s=this.GX.camera.heading,h=n.Matrix.Identity();h=r?n.Matrix.Scaling(i*1.5,i*2,i).multiply(n.Matrix.RotationZ(n.MathHelper.ToRadians(s))).multiply(n.Matrix.RotationX(n.MathHelper.ToRadians(f.z))).multiply(n.Matrix.RotationY(n.MathHelper.ToRadians(-f.x))).multiply(n.Matrix.Translation(u.x,u.y,u.z)):n.Matrix.Scaling(i*1.5,i*2,i).multiply(n.Matrix.RotationX(n.MathHelper.ToRadians(88))).multiply(n.Matrix.RotationY(n.MathHelper.ToRadians(-s))).multiply(n.Matrix.Translation(u.x,u.y,-u.z));this.GX.camera._transformLocalWorld();this.BEo(this.GX,this.BFw,t,h)},t}()}(Drawsee||(Drawsee={})),function(n){var t=function(){function t(t){this.BFt=n.Color.FromIntRgba(196,196,196,255);this.BGF=n.Color.FromIntRgba(255,255,255,128);this.BDD=n.Color.FromIntRgba(0,0,0,128);this.BCa=new n.SolidColorBrush(this.BGF);this.BDB=new n.SolidColorBrush(this.BDD);this.BDk=new n.Pen2(this.BGF,1);this.BGV=new n.Pen2(this.BDD,1);this.BEp=30;this.BEN=8;this.RA=t;this.BFf=new n.SolidColorBrush(n.Color.FromIntRgba(0,0,0,100))}return t.prototype.BFh=function(){this.BCB||(this.BCB=new n.CanvasGraphics(this.RA._getScreenCanvas().htmlCanvas))},t.prototype.BEC=function(n,t){var i=this.RA.camera.heading;return this.BFQ===n&&this.BGK===t&&i===this.BEb?!1:(this.BFQ=n,this.BGK=t,this.BEb=i,!0)},t.prototype.drawStausBar=function(t,i){var r,e;if(this.BEC(t,i)){if(this.BFh(),r=this.BCB,r.clear(),this.RA.isStatusBarVisible&&!this.RA.renderContext.getForceNotDraw()){var o=this.RA._getDrawingCanvas().htmlCanvas,u=o.clientWidth,s=o.clientHeight,f=18,h=s-f,c=new n.Rect(0,s-f,u,f);r.drawRectangle(c,null,this.BFf);e=14;!!t&&u>600&&r.drawTextAdvance(t,new n.Vector2(10,h+e),0,this.BFt);r.drawTextAdvance(i,new n.Vector2(u-150,h+e),0,this.BFt)}this.RA.isNorthPointerVisible&&this.BEE()}},t.prototype.BEE=function(){var f=this.RA._getDrawingCanvas().htmlCanvas,s=f.clientWidth,l=f.clientHeight,e=this.BEp*.3,h=s-this.BEN-this.BEp*.5,c=this.BEN+this.BEp*.5,i=-this.BEp*.5,o=i+this.BEp*.7,r=this.BCB.getContext(),u,t;r.save();r.translate(h,c);r.rotate(this.RA.camera.heading*Math.PI/180);u=this.BCB;t=[];t.push(new n.Vector2(0,i));t.push(new n.Vector2(0,o));t.push(new n.Vector2(-e,i+this.BEp));u.drawPolygon(t,this.BDk,this.BCa);n.ArrayHelper.Clear(t);t.push(new n.Vector2(0,i));t.push(new n.Vector2(0,o));t.push(new n.Vector2(e,i+this.BEp));u.drawPolygon(t,this.BGV,this.BDB);r.restore()},t.prototype.drawOperPanel=function(){},t.prototype.isHitOnCompass=function(t,i,r){var u=this.BEp+this.BEN,f=new n.Rect(i.right-u,i.top,u,u);return f.contains(r)},t}();n._EarthViewerScreenManager=t}(Drawsee||(Drawsee={})),function(n){function i(n){var t=window;t.requestAnimationFrame?t.requestAnimationFrame(n):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(n):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(n):t.oRequestAnimationFrame?t.oRequestAnimationFrame(n):window.setTimeout(n,16)}var t=function(){function t(){}return t.Start=function(){t.BGi()},t.Register=function(i){n._SPP.V();n.AsyncWebStream._InitLoadWorker();n.AsyncProcess._InitProcessWorker();n.AsyncRenderContext._SetActive();t.BGb.push(i)},t.BGi=function(){i(function(){var i,r;for(n.SystemTime._UpdateFrameMs(),i=0;i<t.BGb.length;i++)r=t.BGb[i],r._oneStep();n._SizeBasedObjectCacheManager.CollectGabage();t.BGi()})},t.BGb=[],t}();n._EarthViewerThreadingManager=t;t.Start()}(Drawsee||(Drawsee={})),function(n){var f=function(){function n(){}return n}(),e=function(){function n(){}return n.prototype.compare=function(n,t){return n.weight>t.weight?-1:n.weight<t.weight?1:0},n}(),o=function(){function n(n,t){var r,i,u;for(this.nosMapping=new Int32Array(n+1),r=0;r<this.nosMapping.length;r++)this.nosMapping[r]=-1;i=t.getEnumerator();try{while(i.moveNext())u=i.current,u<=n&&(this.nosMapping[u]=u)}finally{i&&i.dispose()}}return n}(),s=function(){function i(){}return i.GroupLodTriNos=function(t,r){var e,h,c,f,a,u;for(r===void 0&&(r=128),e=new Array(4),f=0;f<4;f++)e[f]=new n.IntHashSet;if(t.vertexes.count<=0)return e;var o=t.triangles.count,l=Math.max(r,Math.min(r*4,o/4)),v=Math.max(l,Math.min(r*8,o/2)),s=0;for(s=o<r?3:o<l?2:o<v?1:0,h=i.Pa(t),c=h.length,f=s;f<4;f++)if(0===f)for(u=0;u<c;u++)e[f].add(u);else for(a=i.Pl(c,f-s),u=0;u<a;u++)e[f].add(h[u].id);for(u=3;u>0;u=u-1)e[u-1].count<=0&&e[u-1].unionWith(e[u]);return e},i.CalcLodTriNos=function(n,t){for(var f=[],r=i.Pa(n),e=r.length,u=0;u<Math.min(t,r.length);u++)f.push(r[u].id);return f},i.GetLodMesh=function(n){for(var e,o=i.GroupLodTriNos(n,128),u=[],f=o,r=0;r<f.length;r++)e=f[r],u.push(t.CreateMeshFromSubSetNos(n,e,!0));return u},i.GetLodMeshTriNos=function(t,r){var u=i.GroupLodTriNos(t,128);return n.ArrayHelper.CloneArray(u[r])},i.Pl=function(n,t){return Math.min(21845,n/i.Ls(t))},i.Ls=function(n){switch(n){case 0:return 1;case 1:return 2;case 2:return 4;case 3:return 10;default:return 1}},i.Py=function(t,i){var r=t.vertexes.getAt(i.v0),u=t.vertexes.getAt(i.v1),f=t.vertexes.getAt(i.v2),o=n.Math3.Distance(r.x,r.y,r.z,u.x,u.y,u.z),s=n.Math3.Distance(r.x,r.y,r.z,f.x,f.y,f.z),h=n.Math3.Distance(u.x,u.y,u.z,f.x,f.y,f.z),e=.5*(o+s+h),c=Math.sqrt(e*(e-o)*(e-s)*(e-h)),l=Math.max(Math.max(o,s),h),a=Math.max(Math.max(r.y,u.y),f.y)-Math.min(Math.min(r.y,u.y),f.y);return c*Math.max(l*.1,a*2)},i.Pa=function(t){for(var u,s,o=[],h=t.triangles.count,r=0;r<h;r++)u=new f,u.id=r,s=t.triangles.getAt(r),u.weight=i.Py(t,s),o.push(u);return n.ArrayHelper.Sort(o,new e),o},i}(),i,t,r,u;n._MeshLodGrouppingHelper=s;i=function(){function i(){}return i.SplitMesh=function(t){var h=[],f,o,l,c,e,s,u,r;if(t.vertexes.count<65535&&t.triangles.count<65535)h.push(t);else{for(f=void 0,o=[],u=0;u<t.subs.count;u++)if(r=t.subs.getAt(u),r.triCount<=21845)o.push(r);else for(l=r.triCount/21845+1,c=r.triCount/l*1,e=0;e<r.triCount;e=e+c)s=new n.SubMeshData(f,"",0,0),s.materialName=r.materialName,s.startTriIndex=e+r.startTriIndex,s.triCount=Math.min(c,r.triCount-e),o.push(s);for(u=0;u<o.length;u++)r=o[u],(!f||f.triangles.count+r.triCount>21845)&&(f=new n.MeshData(t.name),h.push(f)),i.Pg(t,f,r)}return h},i.Pg=function(n,i,r){for(var f=[],u=0;u<r.triCount;u++)f.push(r.startTriIndex+u);t.AppendOneSubMesh(n,i,r.materialName,f,!0)},i}();n._MeshSplitHelper=i;t=function(){function t(){}return t.CreateMeshFromSubSetNos=function(i,r,u){var l,h,e,f;for(u===void 0&&(u=!0),l=new o(i.triangles.count,r),h=new n.MeshData(i.name),e=0;e<i.subs.count;e++){var s=i.subs.getAt(e),c=[],a=s.startTriIndex+s.triCount;for(f=s.startTriIndex;f<a;f++)l.nosMapping[f]>=0&&c.push(f);c.length>0&&t.AppendOneSubMesh(i,h,s.materialName,c,u)}return h},t.AppendOneSubMesh=function(t,i,u,f,e){var h,c,s,o;if(f.length>0)if(h=new n.SubMeshData(i,"",0,0),h.materialName=u,h.startTriIndex=i.triangles.count,h.triCount=f.length,i.subs.add(h),e)for(c=new r(t,i),s=0;s<f.length;s++)o=t.triangles.getAt(f[s]),o.v0=c.getOneMappingIndex(o.v0),o.v1=c.getOneMappingIndex(o.v1),o.v2=c.getOneMappingIndex(o.v2),i.triangles.add(o);else for(s=0;s<f.length;s++)o=t.triangles.getAt(f[s]),i.triangles.add(o)},t.SortByMaterial=function(i){var s,f,e,o,h,r,c,u;if(i.subs.count<=1)return i;for(s=new n.MeshData(i.name),f=new n.Dictionary,r=0;r<i.subs.count;r++)for(e=i.subs.getAt(r),u=f.getValue(e.materialName),u||(u=[],f.add(e.materialName,u)),o=0;o<e.triCount;o++)u.push(e.startTriIndex+o);for(h=f.keys,r=0;r<h.length;r++)c=h[r],u=f.getValue(c),t.AppendOneSubMesh(i,s,c,u,!0);return s},t.MergeMeshes=function(i){var f,o,r,u,e,s;if(i.length<=0)return null;if(i.length===1)return i[0];for(f="",r=0;r<i.length;r++)if(u=i[r],!!u.name){f=u.name;break}for(f||(f="mesh"),o=new n.MeshData(f),r=0;r<i.length;r++)for(u=i[r],e=0;e<u.subs.count;e++)s=u.subs.getAt(e),t.AppendOneSubMesh(u,o,s.materialName,s.enumTriNos(),!0);return t.SortByMaterial(o)},t}();n._MeshCreateHelper=t;r=function(){function n(n,t){this.Or=n;this.Pq=t;this.QO=new Int32Array(n.vertexes.count);for(var i=0;i<this.QO.length;i++)this.QO[i]=-1}return n.prototype.getOneMappingIndex=function(n){if(this.QO.length<=0)return-1;var t=this.QO[n];return t>=0?t:(this.Pq.vertexes.add(this.Or.vertexes.getAt(n)),this.Or.normals.count>n&&this.Pq.normals.add(this.Or.normals.getAt(n)),this.Or.textureCoords.count>n&&this.Pq.textureCoords.add(this.Or.textureCoords.getAt(n)),t=this.Pq.vertexes.count-1,this.QO[n]=t,t)},n}();u=function(){function t(){}return t.ReadColor=function(t){var i=t.readSingle(),r=t.readSingle(),u=t.readSingle(),f=t.readSingle();return new n.Color(i,r,u,f)},t.ReadStringBlock=function(t){var i=t.readInt32(),r=t.readBytes(i);return n.EncodingHelper.GetUtf8String(r)},t.ReadStringBlockArray=function(n){var r=n.readInt32(),u,i;if(r===0)return null;for(u=new Array(r),i=0;i<r;i++)u[i]=t.ReadStringBlock(n);return u},t.ReadInt32Array=function(n){var t=n.readInt32();return t===0?null:n.readInt32s(t)},t.ReadFloatArray=function(n){var i=n.readInt32(),r,t;if(i===0)return null;for(r=new Float32Array(i),t=0;t<i;t++)r[t]=n.readSingle();return r},t.ReadVector3Array=function(i){return new n.Vector3Array(t.ReadVector3FloatArray(i))},t.ReadVector3FloatArray=function(n){var t=n.readInt32(),i=Math.floor(t/12);return n.readFloats(i*3)},t.ReadVector2Array=function(i){return new n.Vector2Array(t.ReadVector2FloatArray(i))},t.ReadVector2FloatArray=function(n){var t=n.readInt32(),i=Math.floor(t/8);return n.readFloats(i*2)},t.ReadTriangle3Array=function(i){return new n.Triangle3Array(t.ReadTriangle3IntArray(i))},t.ReadTriangle3IntArray=function(n){var t=n.readInt32(),i=Math.floor(t/12);return n.readInt32s(i*3)},t.ReadCompressIntArray=function(n){var i=t.ReadInt32Array(n),u,r;if(!i)return null;for(u=i.length,r=1;r<u;r++)i[r]+=i[r-1];return i},t.ReadCompressTriangle3Array=function(i){return new n.Triangle3Array(t.ReadCompressIntArray(i))},t.ReadCompressFloatArray=function(n){var r=n.readInt32(),i;if(r===0)return null;var f=n.readSingle(),e=n.readSingle(),o=t.ReadCompressIntArray(n),u=new Float32Array(r);for(i=0;i<r;i++)u[i]=o[i]*e+f;return u},t.ReadCompressVector3FloatArray=function(n){var f=n.readInt32(),i;if(f===0)return null;var o=t.ReadCompressFloatArray(n),s=t.ReadCompressFloatArray(n),h=t.ReadCompressFloatArray(n),e=3,u=new Float32Array(f*e),r=0;for(i=0;i<f;i++)u[r]=o[i],u[r+1]=s[i],u[r+2]=h[i],r=r+e;return u},t.ReadCompressVector2FloatArray=function(n){var u=n.readInt32(),i;if(u===0)return null;var o=t.ReadCompressFloatArray(n),s=t.ReadCompressFloatArray(n),e=2,f=new Float32Array(u*e),r=0;for(i=0;i<u;i++)f[r]=o[i],f[r+1]=s[i],r=r+e;return f},t}();n._MeshBinaryReaderHelper=u}(Drawsee||(Drawsee={})),function(n){var t=function(){function n(){}return n.VerifyLod=function(n){return n>=4&&(n=3),n<0&&(n=0),n},n}();n._LodCommonHelper=t}(Drawsee||(Drawsee={}));BABYLON.Effect.ShadersStore.dsBasicVertexShader="#include<__decl__dsWorldMatrix>\n#include<__decl__dsCamera>\n#include<__decl__dsLight>\n#include<__decl__dsColorTexture>\n#include<__decl__dsFog>\n#include<__decl__dsClipPlane>\n#include<dsFogFunction>\nuniform vec4 uvParams;\nattribute vec3 Position;\nattribute vec3 Normal;\nattribute vec2 TextureCoords;\nvoid main(void) {\n#include<dsFogVertex>\n#include<dsClipPlaneVertex>\nvTextureCoords = vec2((TextureCoords.x + uvParams.x)*uvParams.z , (TextureCoords.y + uvParams.y)*uvParams.w);\nvNormal = Normal;\ngl_Position = ViewProjection * World * vec4(Position, 1.0);\n}";BABYLON.Effect.ShadersStore.dsBasicPixelShader="#include<__decl__dsWorldMatrix>\n#include<__decl__dsCamera>\n#include<__decl__dsLight>\n#include<__decl__dsColorTexture>\n#include<__decl__dsFog>\n#include<__decl__dsClipPlane>\n#include<dsFogFunction>\n#include<dsLightFunction>\nuniform vec2 uvOffset;\nvoid main(void) {\n#include<dsClipPlaneFragment>\nif (Alpha < 0.01)\ndiscard;\nhighp vec4 baseColor;\nhighp vec4 finalColor;\nif (IsTextureEnabled)\n{\nbaseColor = texture2D(TextureSampler, vTextureCoords);\nif (baseColor.a < 0.35)\ndiscard;\nbaseColor.xyz *= baseColor.a;\n}\nelse\nbaseColor = Color;\nif (Alpha < 1.0)\nfinalColor = baseColor * Alpha;\nelse\n{\nfloat lightRatio = CalcLightRatio(vNormal, LightDirection, AmbientLightBrightness);\nfinalColor = vec4(baseColor.xyz * lightRatio, baseColor.a);\n// fog be the last\nif(IsFogEnabled)\nfinalColor = CalcFogColor(finalColor, vDistanceToCamera, FogStart, FogEnd);\n}\ngl_FragColor = finalColor;\n}";BABYLON.Effect.ShadersStore.dsBasicVertexColorVertexShader="#include<__decl__dsWorldMatrix>\n#include<__decl__dsClipPlane>\nuniform float Alpha;\nuniform vec4 Color;\nvarying vec4 vColor;\nattribute vec3 Position;\nattribute vec4 VertexColor;\nvoid main(void) {\n#include<dsClipPlaneVertex>\nvColor = VertexColor;\ngl_Position = ViewProjection * World * vec4(Position, 1.0);\n}";BABYLON.Effect.ShadersStore.dsBasicVertexColorPixelShader="#include<__decl__dsWorldMatrix>\n#include<__decl__dsClipPlane>\nuniform float Alpha;\nuniform vec4 Color;\nvarying vec4 vColor;\nattribute vec3 Position;\nattribute vec4 VertexColor;\nvoid main(void) {\n#include<dsClipPlaneFragment>\nvec4 baseColor = vColor;\nvec4 finalColor;\nif (Alpha < 1.0)\nfinalColor = baseColor * Alpha;\nelse\nfinalColor = baseColor;\ngl_FragColor = vec4(finalColor.xyz * finalColor.w, 1.0);\n}";BABYLON.Effect.ShadersStore.dsColorVertexShader="#include<__decl__dsWorldMatrix>\n#include<__decl__dsClipPlane>\nattribute vec3 Position;\nvoid main(void) {\n#include<dsClipPlaneVertex>\ngl_Position = ViewProjection * World * vec4(Position, 1.0);\n}";BABYLON.Effect.ShadersStore.dsColorPixelShader="#include<__decl__dsWorldMatrix>\n#include<__decl__dsClipPlane>\nuniform vec4 Color;\nvoid main(void) {\n#include<dsClipPlaneFragment>\ngl_FragColor = Color;\n}";BABYLON.Effect.ShadersStore.dsFontVertexShader="#include<__decl__dsPortrait>\n#include<__decl__dsClipPlane>\nuniform float FontSize;\nvarying vec4 vColor;\nattribute vec3 Position;\nattribute vec4 Color;\nattribute vec3 PosParams;\nattribute vec3 UvParams;\nattribute vec2 PixelOffset;\nvoid main(void) {\n#include<dsClipPlaneVertex>\nvec3 viewPos = (View * vec4(Position, 1.0)).xyz;\nvec2 offset = PosParams.xy;\nfloat positionIndex = PosParams.z;\nvec2 uvOrg = UvParams.xy;\nfloat uvSize = UvParams.z;\n// use a ratio according to eye distance to keep font same size\nfloat distanceToCameraRatio= length(CameraPos - Position) * ScaleRatio;\nvec3 cornerPos = (vec3(offset.x + positionIndex, offset.y, 0.) * FontSize + vec3(PixelOffset.x, PixelOffset.y, 0)) * distanceToCameraRatio;\nif(IsReversed)\ncornerPos.y*=-1.;\nviewPos += cornerPos;\n// final position\ngl_Position = Projection * vec4(viewPos, 1.0);\nvColor = Color;\nvec2 uv = uvOrg + vec2(offset.x, 1.0 - offset.y) * uvSize;\nvUv = clamp(vec2(uv.x, uv.y),0.0,1.0);\n}";BABYLON.Effect.ShadersStore.dsFontPixelShader="#include<__decl__dsPortrait>\n#include<__decl__dsClipPlane>\nuniform float FontSize;\nvarying vec4 vColor;\nvoid main(void) {\n#include<dsClipPlaneFragment>\nvec4 baseColor = texture2D(TextureSampler, vUv);\nif (IsUseAlphaTest) {\nif (baseColor.a < 0.95)\ndiscard;\n}\nbaseColor *= vColor;\ngl_FragColor = baseColor;\n}";BABYLON.Effect.ShadersStore.dsPortraitVertexShader="#include<__decl__dsPortrait>\n#include<__decl__dsClipPlane>\nattribute vec3 Position;\nattribute vec2 UvParams;\nattribute vec2 ImageSize;\nuniform vec2 ImageOffset;\nuniform bool IsUseRotation;\nuniform mat4 RotationMatrix;\nvoid main(void) {\n#include<dsClipPlaneVertex>\nvec3 viewPos = (View * vec4(Position, 1.0)).xyz;\nvec2 offset;\nif (IsUseRotation)\n{\n// rotate at center\nvec2 val = vec2(UvParams.x-0.5, UvParams.y-0.5);\nval = (RotationMatrix * vec4(val,0., 1.0)).xy;\noffset = vec2(val.x + 0.5, val.y + 0.5);\n}\nelse\noffset = UvParams.xy;\nfloat distanceToCameraRatio = length(CameraPos - Position) * ScaleRatio;\nvec3 cornerPos = (vec3(offset.x * ImageSize.x, offset.y* ImageSize.y, 0.) + vec3(ImageOffset, 0.)) * distanceToCameraRatio;\nif(IsReversed)\ncornerPos.y*=-1.;\nviewPos += cornerPos;\ngl_Position = Projection * vec4(viewPos, 1.0);\nvUv = vec2(UvParams.x, 1.0 - UvParams.y);\n}";BABYLON.Effect.ShadersStore.dsPortraitPixelShader="#include<__decl__dsPortrait>\n#include<__decl__dsClipPlane>\nvarying vec4 vColor;\nvoid main(void) {\n#include<dsClipPlaneFragment>\nvec4 baseColor = texture2D(TextureSampler, vUv);\nif (IsUseAlphaTest) {\nif (baseColor.a < 0.95)\ndiscard;\n}\ngl_FragColor = baseColor;\n}";BABYLON.Effect.ShadersStore.dsSimpleTextureMeshVertexShader="#include<__decl__dsWorldMatrix>\n#include<__decl__dsCamera>\n#include<__decl__dsLight>\n#include<__decl__dsColorTexture>\n#include<__decl__dsFog>\n#include<__decl__dsClipPlane>\nuniform bool IsColorOnly;\nuniform bool IsUseHighlight;\nuniform vec4 HighlightColor;\nuniform bool IsReceiveShadow;\n// shadow\nuniform sampler2D shadowSampler_0;\nvarying vec4 vPositionFromLight_0;\nvarying float vDepthMetric_0;\nuniform mat4 lightMatrix_0;\nuniform vec4 shadowsInfo_0;\nuniform vec2 depthValues_0;\n// overlay\nuniform bool IsUseOverlayTexture;\nuniform sampler2D OverlayTexture;\nuniform mat4 OverlayTextureMatrix;\nvarying vec2 vOverlayTextureCoords;\n// coord error check\nuniform bool IsErrorCheck;\nvarying float vIsError;\nattribute vec3 Position;\nattribute vec3 Normal;\nattribute vec2 TextureCoords;\nvoid main(void) {\n#include<dsFogVertex>\n#include<dsClipPlaneVertex>\nvTextureCoords = TextureCoords;\nvNormal = Normal;\ngl_Position = ViewProjection * World * vec4(Position, 1.0);\nvIsError = 0.0;\nif(IsErrorCheck){\nif( Position.x - Normal.x !=0. || Position.y - Normal.y !=0.||Position.z - Normal.z !=0.)\nvIsError = 1.0;\n}\nif (IsReceiveShadow)\n{\n// shadow\n//vec4 worldPos = World * vec4(Position, 1.0);\nvec4 worldPos = vec4(Position, 1.0);\nvPositionFromLight_0 = lightMatrix_0 *worldPos;\nvDepthMetric_0 = ((vPositionFromLight_0.z + depthValues_0.x) / (depthValues_0.y));\n}\nif(IsUseOverlayTexture){\nvOverlayTextureCoords = (OverlayTextureMatrix* vec4(Position, 1.0)).xz;\nvOverlayTextureCoords.y = 1.0 - vOverlayTextureCoords.y;\n}\n}";BABYLON.Effect.ShadersStore.dsSimpleTextureMeshPixelShader="#include<__decl__dsWorldMatrix>\n#include<__decl__dsCamera>\n#include<__decl__dsLight>\n#include<__decl__dsColorTexture>\n#include<__decl__dsFog>\n#include<__decl__dsClipPlane>\nuniform bool IsColorOnly;\nuniform bool IsUseHighlight;\nuniform vec4 HighlightColor;\nuniform vec4 vDiffuseColor;\nuniform float vIntensity;\n// shadow\nuniform bool IsReceiveShadow;\nuniform sampler2D shadowSampler_0;\nvarying vec4 vPositionFromLight_0;\nvarying float vDepthMetric_0;\nuniform mat4 lightMatrix_0;\nuniform vec4 shadowsInfo_0;\nuniform vec2 depthValues_0;\n// overlay\nuniform bool IsUseOverlayTexture;\nuniform sampler2D OverlayTexture;\nuniform mat4 OverlayTextureMatrix;\nvarying vec2 vOverlayTextureCoords;\n// coord error check\nuniform bool IsErrorCheck;\nvarying float vIsError;\n#include<dsLightFunction>\nvoid main(void) {\n#include<dsClipPlaneFragment>\nif(vIsError>0.0)\ndiscard;\nvec4 baseColor ;\nif(IsColorOnly) {\nbaseColor = Color;\n}\nelse {\nbaseColor = texture2D(TextureSampler, vTextureCoords);\n}\nif (IsUseAlphaTest) {\nif (baseColor.a < 0.95)\ndiscard;\n}\n// combine the high light color\nif(IsUseHighlight) {\nfloat alpha = baseColor.a;\nbaseColor = baseColor * 0.5 + HighlightColor * 0.6;\nbaseColor *= alpha;\n}\nvec4 finalColor;\nif (Alpha < 1.0)\nfinalColor = baseColor * Alpha;\nelse\n{\nfloat ambient = AmbientLightBrightness;\nif(IsColorOnly) {\nambient = ambient * 0.7;\n}\nfloat lightRatio = CalcLightRatio(vNormal, LightDirection, ambient);\nfinalColor = vec4(baseColor.xyz * lightRatio, baseColor.a);\n}\nfinalColor = finalColor * vDiffuseColor;\nfinalColor = vec4(finalColor.xyz * vIntensity, finalColor.w);\nif(IsUseOverlayTexture){\nvec2 uv = vOverlayTextureCoords;\nif(uv.x>=0. && uv.x<=1. && uv.y>=0. && uv.y<=1.){\nvec4 overlayColor = texture2D(OverlayTexture, uv);\nfinalColor = vec4(finalColor.xyz*(1.0-overlayColor.a)+overlayColor.xyz*overlayColor.a, finalColor.a);\n}\n}\nif (IsReceiveShadow)\n{\nfloat shadow = computeShadowWithESM(vPositionFromLight_0, vDepthMetric_0, shadowSampler_0, shadowsInfo_0.x, shadowsInfo_0.z, shadowsInfo_0.w);\ngl_FragColor = vec4(finalColor.xyz*shadow, 1.);\n}\nelse\ngl_FragColor = finalColor;\n}";BABYLON.Effect.ShadersStore.dsTerrainVertexShader="#include<__decl__dsWorldMatrix>\n#include<__decl__dsCamera>\n#include<__decl__dsLight>\n#include<__decl__dsColorTexture>\n#include<__decl__dsFog>\n#include<__decl__dsClipPlane>\n// overlay\nuniform float OverlayTextureCount;\nuniform sampler2D OverlayTexture0;\nuniform sampler2D OverlayTexture1;\nuniform sampler2D OverlayTexture2;\nuniform sampler2D OverlayTexture3;\nuniform vec3 CameraPosWorld;\nuniform bool IsUseAtmosphere;\nvarying vec3 vPositionAtmosphere;\nattribute vec3 Position;\nattribute vec3 Normal;\nattribute vec2 TextureCoords;\nvoid main(void) {\n#include<dsFogVertex>\n#include<dsClipPlaneVertex>\nvTextureCoords = TextureCoords;\nvNormal = Normal;\nif(IsUseAtmosphere){\nvPositionAtmosphere = Position;\n}\ngl_Position = ViewProjection * World * vec4(Position, 1.0);\n}";BABYLON.Effect.ShadersStore.dsTerrainPixelShader="#include<__decl__dsWorldMatrix>\n#include<__decl__dsCamera>\n#include<__decl__dsLight>\n#include<__decl__dsColorTexture>\n#include<__decl__dsFog>\n#include<__decl__dsClipPlane>\n// overlay\nuniform float OverlayTextureCount;\nuniform sampler2D OverlayTexture0;\nuniform sampler2D OverlayTexture1;\nuniform sampler2D OverlayTexture2;\nuniform sampler2D OverlayTexture3;\nuniform vec3 CameraPosWorld;\nuniform bool IsUseAtmosphere;\nvarying vec3 vPositionAtmosphere;\nconst float atmosphereDistRatio = 1.0 / (20000.0*1000.0);\n#include<dsFogFunction>\nvoid main(void) {\n#include<dsClipPlaneFragment>\nvec4 baseColor = texture2D(TextureSampler, vTextureCoords);\nvec4 finalColor;\nif (Alpha < 1.0)\nfinalColor = baseColor * Alpha;\nelse\n{\nfinalColor = baseColor;\n}\n// overlay textures, currently support 4\nvec4 overlayColor;\nif(OverlayTextureCount>0.){\noverlayColor = texture2D(OverlayTexture0, vTextureCoords);\nfinalColor = vec4(finalColor.xyz*(1.0-overlayColor.a)+overlayColor.xyz*overlayColor.a, finalColor.a);\n}\nif(OverlayTextureCount>1.){\noverlayColor = texture2D(OverlayTexture1, vTextureCoords);\nfinalColor = vec4(finalColor.xyz*(1.0-overlayColor.a)+overlayColor.xyz*overlayColor.a, finalColor.a);\n}\nif(OverlayTextureCount>2.){\noverlayColor = texture2D(OverlayTexture2, vTextureCoords);\nfinalColor = vec4(finalColor.xyz*(1.0-overlayColor.a)+overlayColor.xyz*overlayColor.a, finalColor.a);\n}\nif(OverlayTextureCount>3.){\noverlayColor = texture2D(OverlayTexture3, vTextureCoords);\nfinalColor = vec4(finalColor.xyz*(1.0-overlayColor.a)+overlayColor.xyz*overlayColor.a, finalColor.a);\n}\nif(IsUseAtmosphere){\nvec3 toCamera = CameraPosWorld - vPositionAtmosphere;\nfloat distance=length(toCamera);\nvec3 toCameraNormalized = normalize(toCamera);\nfloat cosRatio = 1.0 - abs(dot(normalize(vPositionAtmosphere), toCameraNormalized)/length(toCameraNormalized));\ncosRatio = clamp(pow(cosRatio, 4.0), 0.0, 1.0);\nfloat ratio = cosRatio*0.75 + (distance * atmosphereDistRatio)*0.25;\nfloat alpha = clamp(ratio,0.0,0.6);\nfinalColor = vec4(finalColor.xyz*(1.0-alpha) + vec3(0.5,0.5,0.65)*alpha,finalColor.a);\n}\nelse{\n// fog at the last at low atitude\nif(IsFogEnabled){\nfinalColor = CalcFogColor(finalColor, vDistanceToCamera, FogStart, FogEnd);\n}\n}\ngl_FragColor = finalColor;\n}";BABYLON.Effect.ShadersStore.dsViewshedBlendVertexShader="#include<__decl__dsWorldMatrix>\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nuniform mat4 watchViewProjection;\nvarying vec4 vWatchPosition;\nvarying vec4 vWatchWorldPosition;\nuniform sampler2D depthSampler;\n#include<dsViewshedFunction>\nvarying vec4 vDepthColor;\nvoid main(void) {\nvec4 posWatch = watchViewProjection * World * vec4(position, 1.0);\nvWatchWorldPosition = World * vec4(position, 1.0);\nvec2 watchUv = 0.5 * (posWatch.xy/posWatch.w) + vec2(0.5);\ngl_Position = ViewProjection * World * vec4(position, 1.0);\nvWatchPosition = posWatch;\n}";BABYLON.Effect.ShadersStore.dsViewshedBlendPixelShader="#include<__decl__dsWorldMatrix>\nvarying vec4 vWatchPosition;\nvarying vec4 vWatchWorldPosition;\nuniform sampler2D depthSampler;\nuniform float maxDistance;\nuniform vec3 eyePos;\n#include<dsViewshedFunction>\nvarying vec4 vDepthColor;\nvoid main(void) {\nfloat depth = getDepth(vWatchPosition);\nif(length(vWatchWorldPosition.xyz - eyePos)>maxDistance)\ndiscard;\nvec4 finalColor;\nvec2 watchUv = 0.5 * (vWatchPosition.xy/vWatchPosition.w) + vec2(0.5);\nvec4 depthColor = texture2D(depthSampler, watchUv);\nfloat watchDepth = unpack(depthColor);\nif(depth>=watchDepth)\nfinalColor = vec4(1.0,0.,0.,0.5);\nelse\nfinalColor = vec4(0.,1.,0.,0.5);\nif(depth>1. || watchUv.x<0. || watchUv.x>1. || watchUv.y<0. || watchUv.y>1.)\ndiscard;\ngl_FragColor = finalColor;\n}";BABYLON.Effect.ShadersStore.dsViewshedDepthVertexShader="#include<__decl__dsWorldMatrix>\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nvarying vec4 vWatchPosition;\nvoid main(void) {\ngl_Position = ViewProjection * World * vec4(position, 1.0);\nvWatchPosition = gl_Position;\n}";BABYLON.Effect.ShadersStore.dsViewshedDepthPixelShader="#include<__decl__dsWorldMatrix>\nvarying vec4 vWatchPosition;\n#include<dsViewshedFunction>\nvoid main(void) {\nfloat depth = clamp(getDepth(vWatchPosition)* 1.00001,0., 1.);\nvec4 color = pack(depth);\ngl_FragColor = color;\n}";BABYLON.Effect.ShadersStore.dsWaterVertexShader="#include<__decl__dsWorldMatrix>\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n// Output\nvarying vec2 vNormalUV;\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n// Water uniforms\nuniform mat4 worldReflectionViewProjection;\nuniform vec2 windDirection;\nuniform float waveLength;\nuniform float time;\nuniform float windForce;\nuniform float windBaseDistance;\n// Water varyings\nvarying vec3 vRefractionMapTexCoord;\nvarying vec3 vReflectionMapTexCoord;\nvoid main(void) {\nvec4 worldPos = World * vec4(position, 1.0);\nvPositionW = vec3(worldPos);\n// simplified version for texture coords\nvNormalUV = vec2(uv/waveLength + (windBaseDistance + time* windForce) * windDirection);\n// Vertex color\nvec3 p = position;\nworldPos = ViewProjection * World * vec4(p, 1.0);\ngl_Position = worldPos;\n// Water\nvRefractionMapTexCoord.x = 0.5 * (worldPos.w + worldPos.x);\nvRefractionMapTexCoord.y = 0.5 * (worldPos.w + worldPos.y);\nvRefractionMapTexCoord.z = worldPos.w;\nworldPos = worldReflectionViewProjection * vec4(position, 1.0);\nvReflectionMapTexCoord.x = 0.5 * (worldPos.w + worldPos.x);\nvReflectionMapTexCoord.y = 0.5 * (worldPos.w + worldPos.y);\nvReflectionMapTexCoord.z = worldPos.w;\n}";BABYLON.Effect.ShadersStore.dsWaterPixelShader="#include<__decl__dsWorldMatrix>\n// Samplers\nuniform sampler2D reflectionSampler;\nuniform sampler2D refractionSampler;\nuniform sampler2D normalSampler;\n// Water uniforms\nuniform bool isUseRefraction; // current if refractionSampler is null, will wrongly bind reflectionSampler, so use this tag.\nuniform vec3 vEyePosition;\nuniform float alpha;\nuniform float windForce;\nuniform vec3 upVector;\nuniform float bumpHeight;\nuniform float time;\nuniform vec4 waterColor;\nuniform float blendRatio;\n// Water varyings\nvarying vec3 vPositionW;\nvarying vec2 vNormalUV;\nvarying vec3 vRefractionMapTexCoord;\nvarying vec3 vReflectionMapTexCoord;\nvoid main(void) {\n// Base color\nvec4 baseColor = texture2D(normalSampler, vNormalUV);\nvec4 noiseColor = baseColor;\nfloat blendRatio = clamp(waterColor.a, 0., 1.);\n// Bump\nvec2 perturbation = bumpHeight * (baseColor.rg - 0.5) * clamp(windForce,0., 5.);\n// Water\nvec2 projectedReflectionTexCoords = clamp(vec2(\nvReflectionMapTexCoord.x / vReflectionMapTexCoord.z + perturbation.x * 0.3,\nvReflectionMapTexCoord.y / vReflectionMapTexCoord.z + perturbation.y\n), 0.0, 1.0);\nvec4 reflectiveColor = texture2D(reflectionSampler, projectedReflectionTexCoords);\nvec2 projectedRefractionTexCoords = clamp(vRefractionMapTexCoord.xy / vRefractionMapTexCoord.z + perturbation * 0.5, 0.0, 1.0);\nvec4 refractiveColor;\n// fresnelTerm\nfloat fresnelTerm;\nvec3 viewDirectionW = normalize(vEyePosition - vPositionW);\n// if blendRatio is high, we allow water color more dull when use fraction\nfloat fresnelTermLimit = clamp(0.65 + blendRatio * 0.3, 0., 0.9);\nfresnelTerm = clamp(abs(pow(dot(viewDirectionW, upVector), 3.0)), 0.05, fresnelTermLimit);\nfloat inversefresnelTerm = 1.0 - fresnelTerm;\nreflectiveColor = inversefresnelTerm * blendRatio * waterColor + (1.0 - blendRatio * inversefresnelTerm) * reflectiveColor;\n// refraction\nif(isUseRefraction)\nrefractiveColor = texture2D(refractionSampler, projectedRefractionTexCoords);\nelse\nrefractiveColor = vec4(0., 0., 0., 0.);\n// refraction become dull faster\nfloat refractBlendRatio = pow(blendRatio,0.5);\nrefractiveColor = refractBlendRatio * waterColor + (1.0 - refractBlendRatio) * refractiveColor;\n// Composition\nvec4 combinedColor = refractiveColor * fresnelTerm + reflectiveColor * inversefresnelTerm;\n// tranparent is affect by fresnelTerm\nfloat alphaUse = max(alpha, fresnelTerm);\nvec4 color = vec4(clamp(combinedColor.rgb*alphaUse, 0.0, 1.0), alphaUse);\n// when not use fraction, we use the bump noise to enhance the color contrast\nif(blendRatio >0.0 ){\n// here use power to make the merge impact more gentlely\nfloat windRatio;\nif(!isUseRefraction)\nwindRatio = windForce * 0.5;\nelse\nwindRatio = windForce * 0.2;\nfloat mixRatio = clamp(windRatio * blendRatio,0., 0.9);\nfloat noiseRatio = 1.0 - clamp( mixRatio * noiseColor.r, 0.0, 0.5);\nvec3 enhanceColor = waterColor.rgb * noiseRatio;\ncolor = vec4(color.rgb * (1.0 - mixRatio) + enhanceColor.rgb * mixRatio, alphaUse);\n}\ngl_FragColor = color;\n}";BABYLON.Effect.ShadersStore.dsWidePolylineVertexShader="uniform mat4 world;\nuniform mat4 viewProjection;\nuniform mat4 projection;\nuniform vec3 cameraPos;\nuniform float aspect;\n// basic\nuniform float width;\nuniform vec4 color;\n// edge clip\nuniform bool clipLeft;\nuniform bool clipRight;\n// outline\nuniform float outlineWidth;\nuniform vec4 outlineColor;\n// tapper\nuniform float tapperPower;\n// glow\nuniform float glowRadius;\nuniform vec4 glowColor;\n// dash\nuniform float dashLength;\nuniform float dashOffset;\nuniform float dashRatio;\nuniform vec4 dashGapColor;\n// trail\nuniform float trailLength;\nuniform float trailStart;\nuniform float trailSpeed;\nuniform float trailCount;\nuniform vec4 trailColor;\nuniform float time;\nattribute vec3 position;\nattribute vec3 previous;\nattribute vec3 next;\nattribute float direction;\nattribute float lengths;\nvarying float vWidth;\nvarying float vWidthRatio;\nvarying float vLengthRatio;\nvoid main() {\n//float distanceToCameraRatio = 0.01; // length(cameraPos - position) * 0.002;\nfloat distanceToCameraRatio = 1000. / (1024. * projection[0][0]);\ndistanceToCameraRatio = length(cameraPos - position) * 0.002;\nvec2 aspectVec = vec2(aspect, 1.0);\nmat4 worldViewProjection = viewProjection * world;\nvec4 previousProjected = worldViewProjection * vec4(previous, 1.0);\nvec4 currentProjected = worldViewProjection * vec4(position, 1.0);\nvec4 nextProjected = worldViewProjection * vec4(next, 1.0);\n//get 2D screen space with W divide and aspect correction\nvec2 currentScreen = currentProjected.xy / currentProjected.w * aspectVec;\nvec2 previousScreen = previousProjected.xy / previousProjected.w * aspectVec;\nvec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;\nfloat widthAndGlow = width + glowRadius*2.0;\nfloat len = widthAndGlow;\n//starting point uses (next - current)\nvec2 dir = vec2(0.0);\nif (currentScreen == previousScreen) {\ndir = normalize(nextScreen - currentScreen);\n}\n//ending point uses (current - previous)\nelse if (currentScreen == nextScreen) {\ndir = normalize(currentScreen - previousScreen);\n}\n//somewhere in middle, needs a join\nelse {\n//get directions from (C - B) and (B - A)\nvec2 dirA = normalize((currentScreen - previousScreen));\nvec2 dirB = normalize((nextScreen - currentScreen));\n//now compute the miter join normal and lengths\nvec2 tangent = normalize(dirA + dirB);\nvec2 perp = vec2(-dirA.y, dirA.x);\nvec2 miter = vec2(-tangent.y, tangent.x);\ndir = tangent;\n// use 0.5 to control the max len, avoid near plane clip, sharp angle etc. lyh 20191028\nlen = widthAndGlow / max(0.5, dot(miter, perp));\n}\nvec2 normal = vec2(-dir.y, dir.x);\nnormal *= len / 2.0;\nnormal.x /= aspect;\n// tapper\nfloat tapper = 1.0;\n// head and tail both tapper\nif(tapperPower>0.)\ntapper = pow( 1.0 - abs(0.5 - lengths)*2.0, tapperPower);\nvec4 offset = vec4(normal * direction * distanceToCameraRatio * tapper, 0.0, 0.0);\ngl_Position = currentProjected + offset; // only add x,y field\nvWidth = widthAndGlow;\n// widthAndGlow ratio, along line direction, center is 0, left<0, right>0\nvWidthRatio = -widthAndGlow * direction / widthAndGlow;\nvLengthRatio = lengths;\n}";BABYLON.Effect.ShadersStore.dsWidePolylinePixelShader="// basic\nuniform float width;\nuniform vec4 color;\n// edge clip\nuniform bool clipLeft;\nuniform bool clipRight;\n// outline\nuniform float outlineWidth;\nuniform vec4 outlineColor;\n// tapper\nuniform float tapperPower;\n// glow\nuniform float glowRadius;\nuniform vec4 glowColor;\n// dash\nuniform float dashLength;\nuniform float dashOffset;\nuniform float dashRatio;\nuniform vec4 dashGapColor;\n// trail\nuniform float trailLength;\nuniform float trailStart;\nuniform float trailSpeed;\nuniform float trailCount;\nuniform vec4 trailColor;\nuniform float time;\nvarying float vWidthRatio;\nvarying float vLengthRatio;\nvoid main(void) {\nif (clipLeft && vWidthRatio < 0. || clipRight && vWidthRatio > 0.)\ndiscard;\nvec4 finalColor = color;\nfloat widthRatio = abs(vWidthRatio);\nfloat widthAndGlow = width + glowRadius*2.0;\nfloat lineWidthRatio = width / widthAndGlow;\nfloat outlineRatio = (width - 2.0 * outlineWidth) / widthAndGlow;\n// outline\nif (outlineWidth > 0.)\n{\nif (widthRatio > outlineRatio)\nfinalColor = outlineColor;\nelse\n{\n// mix the middle color for antialias\nfloat range = outlineWidth/ widthAndGlow;\nfloat low = outlineRatio -range;\nif (widthRatio > low )\n{\nfloat ratio = (widthRatio - low)/range;\nfinalColor = mix(color, outlineColor, ratio);\n}\n}\n}\nif (glowRadius>0.)\n{\nif (widthRatio > lineWidthRatio)\n{\nfloat glowAlpha = 1.0 - (widthRatio - lineWidthRatio)/(1.0 - lineWidthRatio);\nfinalColor = glowColor* pow(glowAlpha,0.5);\n}\nelse\n{\n// mix the middle color for antialias\nfloat range = 1.0 / widthAndGlow;\nfloat low = lineWidthRatio - range;\nif (widthRatio > low)\n{\nfloat ratio = (widthRatio - low) / range;\nfinalColor = mix(color, glowColor, ratio);\n}\n}\n}\n// trail\nif (trailLength>0. && widthRatio<outlineRatio)\n{\nfloat repeat = trailCount;\nfloat curStart = trailStart+(time * 0.1 * trailSpeed*repeat);\ncurStart = curStart - floor(curStart);\nfloat lenRatioUse = mod(vLengthRatio*repeat, 1.0);\nfloat trailLengthUse = trailLength *repeat;\nfloat testLen;\nif (lenRatioUse > curStart)\ntestLen = lenRatioUse - curStart;\nelse\ntestLen = lenRatioUse + 1.0 - curStart;\nif (testLen < trailLengthUse)\n{\nfloat mixRatio = testLen / trailLength;\nmixRatio = pow(mixRatio,0.5);\nfinalColor = mix(finalColor, trailColor, mixRatio);\n}\n}\n// dash\nif (dashLength>0.) {\nfloat dashAlphaRatio = ceil(mod(vLengthRatio + dashOffset, dashLength) - (dashLength * dashRatio)) * step(vLengthRatio, 1.0);\nif(dashAlphaRatio>0.)\nfinalColor.a *= dashAlphaRatio;\nelse{\nfinalColor = dashGapColor;\n}\n}\ngl_FragColor = finalColor;\n}";BABYLON.Effect.ShadersStore.dsSkyAtmosphereVertexShader="uniform mat4 viewProjection;\nuniform float cameraHeight;\nuniform vec3 eyePosition;\nconst float innerRadius = 6378137.0;\nconst float outerRadius = 6378137.0 * 1.025;\nconst float pi = 3.141592653589793;\nconst float Kr = 0.0025;\nconst float Kr4PI = Kr * 4.0 * pi;\nconst float Km = 0.0015;\nconst float Km4PI = Km * 4.0 * pi;\nconst float ESun = 15.0;\nconst float KmESun = Km * ESun;\nconst float KrESun = Kr * ESun;\nconst vec3 InvWavelength = vec3(\n5.60204474633241,  // Red = 1.0 / Math.pow(0.650, 4.0)\n9.473284437923038, // Green = 1.0 / Math.pow(0.570, 4.0)\n19.643802610477206); // Blue = 1.0 / Math.pow(0.475, 4.0)\nconst float rayleighScaleDepth = 0.25;\nconst int nSamples = 2;\nconst float fSamples = 2.0;\nvarying vec3 vRayleighColor;\nvarying vec3 vMieColor;\nvarying vec3 vToCamera;\nattribute vec4 position;\nfloat scale(float cosAngle)\n{\nfloat x = 1.0 - cosAngle;\nreturn rayleighScaleDepth  * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\nvoid main(void)\n{\n// Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\nvec3 positionV3 = position.xyz;\nvec3 ray = positionV3 - eyePosition;\nfloat far = length(ray);\nray /= far;\nfloat atmosphereScale = 1.0 / (outerRadius - innerRadius);\n// Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\nfloat B = 2.0 * dot(eyePosition, ray);\nfloat C = cameraHeight * cameraHeight - outerRadius * outerRadius;\nfloat det = max(0.0, B*B - 4.0 * C);\nfloat near = 0.5 * (-B - sqrt(det));\n// Calculate the ray's starting position, then calculate its scattering offset\nvec3 start = eyePosition + ray * near;\nfar -= near;\nfloat startAngle = dot(ray, start) / outerRadius;\nfloat startDepth = exp(-1.0 / rayleighScaleDepth );\nfloat startOffset = startDepth*scale(startAngle);\n// Initialize the scattering loop variables\nfloat sampleLength = far / fSamples;\nfloat scaledLength = sampleLength * atmosphereScale;\nvec3 sampleRay = ray * sampleLength;\nvec3 samplePoint = start + sampleRay * 0.5;\n// Now loop through the sample rays\nvec3 frontColor = vec3(0.0, 0.0, 0.0);\nvec3 lightDir = eyePosition;\nlightDir = normalize(lightDir);\nfor(int i=0; i<nSamples; i++)\n{\nfloat height = length(samplePoint);\nfloat depth = exp((atmosphereScale / rayleighScaleDepth ) * (innerRadius - height));\nfloat fLightAngle = dot(lightDir, samplePoint) / height;\nfloat fCameraAngle = dot(ray, samplePoint) / height;\nfloat fScatter = (startOffset + depth*(scale(fLightAngle) - scale(fCameraAngle)));\nvec3 attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\nfrontColor += attenuate * (depth * scaledLength);\nsamplePoint += sampleRay;\n}\n// Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\nvMieColor = frontColor * KmESun;\nvRayleighColor = frontColor * (InvWavelength * KrESun);\nvToCamera = eyePosition - positionV3;\ngl_Position = viewProjection * position;\n}";BABYLON.Effect.ShadersStore.dsSkyAtmospherePixelShader="#include<__decl__dsWorldMatrix>\nuniform float cameraHeight;\nuniform vec3 eyePosition;\nconst float innerRadius = 6378137.0;\nconst float outerRadius = 6378137.0 * 1.025;\nconst float g = -0.95;\nconst float g2 = g * g;\nvarying vec3 vRayleighColor;\nvarying vec3 vMieColor;\nvarying vec3 vToCamera;\nvoid main (void)\n{\nfloat cosAngle = dot(normalize(eyePosition), normalize(vToCamera)) / length(vToCamera);\nfloat rayleighPhase = 0.75 * (1.0 + cosAngle * cosAngle);\nfloat miePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + cosAngle * cosAngle) / pow(1.0 + g2 - 2.0 * g * cosAngle, 1.5);\nvec3 rgb = rayleighPhase * vRayleighColor + miePhase * vMieColor;\n// hdr\nconst float exposure = 2.0;\nrgb = vec3(1.0) - exp(-exposure * rgb);\nfloat atmosphereAlpha = clamp((outerRadius - cameraHeight) / (outerRadius - innerRadius), 0.0, 1.0);\ngl_FragColor = vec4(rgb, mix(rgb.b, 1.0, atmosphereAlpha));\n}";BABYLON.Effect.ShadersStore.skyVertexShader="precision highp float;\n// Attributes\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n// Uniforms\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n// Output\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\nvoid main(void) {\ngl_Position = viewProjection * world * vec4(position, 1.0);\nvec4 worldPos = world * vec4(position, 1.0);\nvPositionW = vec3(worldPos);\n// Clip plane\n#include<clipPlaneVertex>\n// Fog\n#include<fogVertex>\n// Vertex color\n#ifdef VERTEXCOLOR\nvColor = color;\n#endif\n// Point size\n#ifdef POINTSIZE\ngl_PointSize = pointSize;\n#endif\n}";BABYLON.Effect.ShadersStore.skyPixelShader="precision highp float;\n// Input\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\n// Sky\nuniform vec3 cameraPosition;\nuniform float luminance;\nuniform float turbidity;\nuniform float rayleigh;\nuniform float mieCoefficient;\nuniform float mieDirectionalG;\nuniform vec3 sunPosition;\n// Fog\n#include<fogFragmentDeclaration>\n// Constants\nconst float e = 2.71828182845904523536028747135266249775724709369995957;\nconst float pi = 3.141592653589793238462643383279502884197169;\nconst float n = 1.0003;\nconst float N = 2.545E25;\nconst float pn = 0.035;\nconst vec3 lambda = vec3(680E-9, 550E-9, 450E-9);\nconst vec3 K = vec3(0.686, 0.678, 0.666);\nconst float v = 4.0;\nconst float rayleighZenithLength = 8.4E3;\nconst float mieZenithLength = 1.25E3;\nconst vec3 up = vec3(0.0, 1.0, 0.0);\nconst float EE = 1000.0;\nconst float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\nconst float cutoffAngle = pi/1.95;\nconst float steepness = 1.5;\nvec3 totalRayleigh(vec3 lambda)\n{\nreturn (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn));\n}\nvec3 simplifiedRayleigh()\n{\nreturn 0.0005 / vec3(94, 40, 18);\n}\nfloat rayleighPhase(float cosTheta)\n{\nreturn (3.0 / (16.0*pi)) * (1.0 + pow(cosTheta, 2.0));\n}\nvec3 totalMie(vec3 lambda, vec3 K, float T)\n{\nfloat c = (0.2 * T ) * 10E-18;\nreturn 0.434 * c * pi * pow((2.0 * pi) / lambda, vec3(v - 2.0)) * K;\n}\nfloat hgPhase(float cosTheta, float g)\n{\nreturn (1.0 / (4.0*pi)) * ((1.0 - pow(g, 2.0)) / pow(1.0 - 2.0*g*cosTheta + pow(g, 2.0), 1.5));\n}\nfloat sunIntensity(float zenithAngleCos)\n{\nreturn EE * max(0.0, 1.0 - exp((-(cutoffAngle - acos(zenithAngleCos))/steepness)));\n}\nfloat A = 0.15;\nfloat B = 0.50;\nfloat C = 0.10;\nfloat D = 0.20;\nfloat EEE = 0.02;\nfloat F = 0.30;\nfloat W = 1000.0;\nvec3 Uncharted2Tonemap(vec3 x)\n{\nreturn ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;\n}\nvoid main(void) {\n// Clip plane\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade = 1.0 - clamp(1.0 - exp((sunPosition.y / 450000.0)), 0.0, 1.0);\nfloat rayleighCoefficient = rayleigh - (1.0 * (1.0 - sunfade));\nvec3 sunDirection = normalize(sunPosition);\nfloat sunE = sunIntensity(dot(sunDirection, up));\nvec3 betaR = simplifiedRayleigh() * rayleighCoefficient;\nvec3 betaM = totalMie(lambda, K, turbidity) * mieCoefficient;\nfloat zenithAngle = acos(max(0.0, dot(up, normalize(vPositionW - cameraPosition))));\nfloat sR = rayleighZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));\nfloat sM = mieZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));\nvec3 Fex = exp(-(betaR * sR + betaM * sM));\nfloat cosTheta = dot(normalize(vPositionW - cameraPosition), sunDirection);\nfloat rPhase = rayleighPhase(cosTheta*0.5+0.5);\nvec3 betaRTheta = betaR * rPhase;\nfloat mPhase = hgPhase(cosTheta, mieDirectionalG);\nvec3 betaMTheta = betaM * mPhase;\nvec3 Lin = pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * (1.0 - Fex),vec3(1.5));\nLin *= mix(vec3(1.0), pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * Fex, vec3(1.0 / 2.0)), clamp(pow(1.0-dot(up, sunDirection), 5.0), 0.0, 1.0));\nvec3 direction = normalize(vPositionW - cameraPosition);\nfloat theta = acos(direction.y);\nfloat phi = atan(direction.z, direction.x);\nvec2 uv = vec2(phi, theta) / vec2(2.0 * pi, pi) + vec2(0.5, 0.0);\nvec3 L0 = vec3(0.1) * Fex;\nfloat sundisk = smoothstep(sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta);\nL0 += (sunE * 19000.0 * Fex) * sundisk;\nvec3 whiteScale = 1.0/Uncharted2Tonemap(vec3(W));\nvec3 texColor = (Lin+L0);\ntexColor *= 0.04 ;\ntexColor += vec3(0.0,0.001,0.0025)*0.3;\nfloat g_fMaxLuminance = 1.0;\nfloat fLumScaled = 0.1 / luminance;\nfloat fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (g_fMaxLuminance * g_fMaxLuminance)))) / (1.0 + fLumScaled);\nfloat ExposureBias = fLumCompressed;\nvec3 curr = Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);\n// May generate a bug so just just keep retColor = skyColor;\n// vec3 skyColor = curr * whiteScale;\n//vec3 retColor = pow(skyColor,vec3(1.0/(1.2+(1.2*sunfade))));\nvec3 retColor = curr * whiteScale;\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\n// Alpha\nfloat alpha = 1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb *= vColor.rgb;\n#endif\n#ifdef VERTEXALPHA\nalpha *= vColor.a;\n#endif\n// Composition\nvec4 color = clamp(vec4(retColor.rgb, alpha), 0.0, 1.0);\n// Fog\n#include<fogFragment>\ngl_FragColor = color;\n}";BABYLON.Effect.IncludesShadersStore.dsCameraDeclaration="uniform vec3 CameraPos;\nvarying float vDistanceToCamera;";BABYLON.Effect.IncludesShadersStore.dsClipPlaneDeclaration="uniform bool IsUseClipPlane;\nuniform vec4 vClipPlane;\nvarying float fClipDistance;";BABYLON.Effect.IncludesShadersStore.dsClipPlaneFragment="if(fClipDistance > 0.0)\ndiscard;";BABYLON.Effect.IncludesShadersStore.dsClipPlaneVertex="if(IsUseClipPlane)\n{\nvec4 worldPos = World * vec4(Position, 1.0);\nfClipDistance = dot(worldPos, vClipPlane);\n}";BABYLON.Effect.IncludesShadersStore.dsColorTextureDeclaration="uniform bool IsUseAlphaTest;\nuniform bool IsTextureEnabled;\nuniform float Alpha;\nuniform vec4 Color;\nvarying vec2 vTextureCoords;\nvarying vec2 vTextureCoords2;\nuniform sampler2D TextureSampler;";BABYLON.Effect.IncludesShadersStore.dsFogDeclaration="uniform bool IsFogEnabled;\nuniform float FogStart;\nuniform float FogEnd;\nuniform vec3 FogColor;";BABYLON.Effect.IncludesShadersStore.dsFogFunction="vec4 CalcFogColor(vec4 srcColor, float distanceToCamera, float fogStart, float fogEnd)\n{\nfloat ratio = (distanceToCamera - fogStart) / (fogEnd - fogStart);\nratio = clamp(ratio, 0.0, 1.0);\nreturn vec4((1.0 - ratio) * srcColor.xyz + ratio * FogColor.xyz, 1.0);\n}";BABYLON.Effect.IncludesShadersStore.dsFogVertex="if(IsFogEnabled)\nvDistanceToCamera  = length( CameraPos - (World * vec4(Position,1.0)).xyz);\nelse\nvDistanceToCamera  = 0.0;";BABYLON.Effect.IncludesShadersStore.dsLightDeclaration="uniform bool IsUseLight;\nuniform vec3 LightDirection;\nuniform float AmbientLightBrightness;\nvarying vec3 vNormal;";BABYLON.Effect.IncludesShadersStore.dsLightFunction="highp float CalcLightRatio(vec3 vNormal, vec3 LightDirection, float ambientLightBrightness)\n{\nif (!IsUseLight)\nreturn 1.0;\nhighp vec3 normal= normalize(vNormal);\nhighp vec3 dir = normalize(LightDirection);\nfloat lightRatio = clamp( dot(normal, -dir), 0.0, 1.0);\nlightRatio = max(0.0000001, (1.0 - ambientLightBrightness) * lightRatio + ambientLightBrightness); // simulate ambient\nreturn lightRatio;\n}\nfloat computeFallOff(float value, vec2 clipSpace, float frustumEdgeFalloff)\n{\nfloat mask = smoothstep(1.0 - frustumEdgeFalloff, 1.0, clamp(dot(clipSpace, clipSpace), 0., 1.));\nreturn mix(value, 1.0, mask);\n}\nfloat computeShadowWithESM(vec4 vPositionFromLight, float depthMetric, sampler2D shadowSampler, float darkness, float depthScale, float frustumEdgeFalloff)\n{\nvec3 clipSpace = vPositionFromLight.xyz / vPositionFromLight.w;\nvec2 uv = 0.5 * clipSpace.xy + vec2(0.5);\nif (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth = clamp(depthMetric, 0., 1.0);\nfloat shadowMapSample = texture2D(shadowSampler, uv).x;\nfloat esm = 1.0 - clamp(exp(min(87., depthScale * shadowPixelDepth)) * shadowMapSample, 0., 1. - darkness);\nreturn computeFallOff(esm, clipSpace.xy, frustumEdgeFalloff);\n}";BABYLON.Effect.IncludesShadersStore.dsPortraitDeclaration="uniform mat4 World;\nuniform mat4 View;\nuniform mat4 Projection;\nuniform bool IsUseAlphaTest;\nuniform float ScaleRatio;\nuniform vec3 CameraPos;\nuniform sampler2D TextureSampler;\nvarying vec2 vUv;\nuniform bool IsReversed;";BABYLON.Effect.IncludesShadersStore.dsViewshedFunction="vec4 pack(float depth) {\nconst vec4 bit_shift = vec4(255.0 * 255.0 * 255.0, 255.0 * 255.0, 255.0, 1.0);\nconst vec4 bit_mask = vec4(0.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\nvec4 res = fract(depth * bit_shift);\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nfloat getDepth(vec4 vWatchPosition) {\nreturn vWatchPosition.z/vWatchPosition.w;\n}\nfloat unpack(vec4 color) {\nconst vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);\nreturn dot(color, bit_shift);\n}";BABYLON.Effect.IncludesShadersStore.dsWorldMatrixDeclaration="uniform mat4 World;\nuniform mat4 View;\nuniform mat4 Projection;\nuniform mat4 ViewProjection;"